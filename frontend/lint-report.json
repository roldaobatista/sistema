[{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\e2e\\auth.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\e2e\\navigation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\e2e\\permissions.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\public\\sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\App.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchMe', 'isAuthenticated', and 'logout'. Either include them or remove the dependency array.","line":100,"column":6,"nodeType":"ArrayExpression","endLine":100,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMe, isAuthenticated, logout]","fix":{"range":[5679,5681],"text":"[fetchMe, isAuthenticated, logout]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\ActivityForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\CustomerHealthScore.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\CustomerTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\DealCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\DealDetailDrawer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CrmDeal' is defined but never used.","line":7,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":30,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CrmDeal"},"fix":{"range":[390,404],"text":""},"desc":"Remove unused variable \"CrmDeal\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { X, DollarSign, User, Calendar, FileText, Phone, Mail, MessageCircle, CheckCircle2, XCircle, Loader2 } from 'lucide-react'\r\nimport { useState } from 'react'\r\nimport { cn } from '@/lib/utils'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { crmApi, type CrmDeal, type CrmActivity } from '@/lib/crm-api'\r\nimport { SendMessageModal } from '@/components/crm/SendMessageModal'\r\nimport { MessageHistory } from '@/components/crm/MessageHistory'\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nconst typeIcons: Record<string, React.ElementType> = {\r\n    ligacao: Phone,\r\n    email: Mail,\r\n    whatsapp: MessageCircle,\r\n    nota: FileText,\r\n    system: FileText,\r\n    reuniao: User,\r\n    visita: User,\r\n    tarefa: CheckCircle2,\r\n}\r\n\r\ninterface Props {\r\n    dealId: number | null\r\n    open: boolean\r\n    onClose: () => void\r\n}\r\n\r\nexport function DealDetailDrawer({ dealId, open, onClose }: Props) {\r\n    const queryClient = useQueryClient()\r\n    const [lostReason, setLostReason] = useState('')\r\n    const [showLostForm, setShowLostForm] = useState(false)\r\n    const [sendMessageOpen, setSendMessageOpen] = useState(false)\r\n\r\n    const { data: deal, isLoading } = useQuery({\r\n        queryKey: ['crm-deal', dealId],\r\n        queryFn: () => crmApi.getDeal(dealId!).then(r => r.data),\r\n        enabled: !!dealId && open,\r\n    })\r\n\r\n    const wonMutation = useMutation({\r\n        mutationFn: (id: number) => crmApi.markDealWon(id),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['crm'] })\r\n            queryClient.invalidateQueries({ queryKey: ['crm-deal', dealId] })\r\n        },\r\n    })\r\n\r\n    const lostMutation = useMutation({\r\n        mutationFn: ({ id, reason }: { id: number; reason: string }) => crmApi.markDealLost(id, reason),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['crm'] })\r\n            queryClient.invalidateQueries({ queryKey: ['crm-deal', dealId] })\r\n            setShowLostForm(false)\r\n            setLostReason('')\r\n        },\r\n    })\r\n\r\n    if (!open) return null\r\n\r\n    return (\r\n        <>\r\n            {/* Backdrop */}\r\n            <div className=\"fixed inset-0 z-40 bg-black/30 backdrop-blur-sm\" onClick={onClose} />\r\n\r\n            {/* Drawer */}\r\n            <div className={cn(\r\n                'fixed right-0 top-0 z-50 flex h-full w-full max-w-lg flex-col border-l border-surface-200 bg-white shadow-modal',\r\n                'animate-in slide-in-from-right duration-300'\r\n            )}>\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between border-b border-surface-200 px-5 py-4\">\r\n                    <h2 className=\"text-lg font-semibold text-surface-900 truncate\">\r\n                        {isLoading ? 'Carregando…' : deal?.title}\r\n                    </h2>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"rounded-lg p-1.5 text-surface-400 hover:bg-surface-100 hover:text-surface-600 transition-colors\"\r\n                    >\r\n                        <X className=\"h-5 w-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {isLoading ? (\r\n                    <div className=\"flex flex-1 items-center justify-center\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-brand-500\" />\r\n                    </div>\r\n                ) : deal ? (\r\n                    <div className=\"flex-1 overflow-y-auto\">\r\n                        {/* Status + Actions */}\r\n                        <div className=\"border-b border-surface-200 px-5 py-4\">\r\n                            <div className=\"flex items-center gap-2 mb-4\">\r\n                                <Badge variant={deal.status === 'won' ? 'success' : deal.status === 'lost' ? 'danger' : 'info'} dot>\r\n                                    {deal.status === 'won' ? 'Ganho' : deal.status === 'lost' ? 'Perdido' : 'Aberto'}\r\n                                </Badge>\r\n                                {deal.stage && (\r\n                                    <span className=\"rounded-full px-2.5 py-0.5 text-xs font-medium\"\r\n                                        style={{ backgroundColor: `${deal.stage.color}20`, color: deal.stage.color || undefined }}>\r\n                                        {deal.stage.name}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n\r\n                            {deal.status === 'open' && (\r\n                                <div className=\"flex gap-2\">\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        variant=\"primary\"\r\n                                        onClick={() => wonMutation.mutate(deal.id)}\r\n                                        disabled={wonMutation.isPending}\r\n                                    >\r\n                                        <CheckCircle2 className=\"h-4 w-4 mr-1\" />\r\n                                        Marcar Ganho\r\n                                    </Button>\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        variant=\"ghost\"\r\n                                        className=\"text-red-600 hover:bg-red-50\"\r\n                                        onClick={() => setShowLostForm(!showLostForm)}\r\n                                    >\r\n                                        <XCircle className=\"h-4 w-4 mr-1\" />\r\n                                        Marcar Perdido\r\n                                    </Button>\r\n                                </div>\r\n                            )}\r\n\r\n                            {deal.status === 'open' && deal.customer && (\r\n                                <div className=\"mt-2\">\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        variant=\"ghost\"\r\n                                        onClick={() => setSendMessageOpen(true)}\r\n                                    >\r\n                                        <MessageCircle className=\"h-4 w-4 mr-1\" />\r\n                                        Enviar Mensagem\r\n                                    </Button>\r\n                                </div>\r\n                            )}\r\n\r\n                            {showLostForm && (\r\n                                <div className=\"mt-3 space-y-2\">\r\n                                    <textarea\r\n                                        value={lostReason}\r\n                                        onChange={e => setLostReason(e.target.value)}\r\n                                        placeholder=\"Motivo da perda (opcional)\"\r\n                                        className=\"w-full rounded-lg border border-surface-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500/30\"\r\n                                        rows={2}\r\n                                    />\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        variant=\"danger\"\r\n                                        onClick={() => lostMutation.mutate({ id: deal.id, reason: lostReason })}\r\n                                        disabled={lostMutation.isPending}\r\n                                    >\r\n                                        Confirmar Perda\r\n                                    </Button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Info Grid */}\r\n                        <div className=\"border-b border-surface-200 px-5 py-4 space-y-3\">\r\n                            <InfoRow icon={DollarSign} label=\"Valor\" value={fmtBRL(deal.value)} />\r\n                            <InfoRow icon={User} label=\"Cliente\" value={deal.customer?.name ?? '—'} />\r\n                            <InfoRow icon={User} label=\"Responsável\" value={deal.assignee?.name ?? 'Não atribuído'} />\r\n                            <InfoRow icon={Calendar} label=\"Previsão\" value={\r\n                                deal.expected_close_date\r\n                                    ? new Date(deal.expected_close_date).toLocaleDateString('pt-BR')\r\n                                    : 'Não definida'\r\n                            } />\r\n                            {deal.source && <InfoRow icon={FileText} label=\"Origem\" value={deal.source} />}\r\n                            {deal.quote && (\r\n                                <InfoRow icon={FileText} label=\"Orçamento\" value={`#${deal.quote.quote_number} — ${fmtBRL(deal.quote.total)}`} />\r\n                            )}\r\n                            {deal.workOrder && (\r\n                                <InfoRow icon={FileText} label=\"OS\" value={`#${deal.workOrder.number} — ${deal.workOrder.status}`} />\r\n                            )}\r\n                            {deal.equipment && (\r\n                                <InfoRow icon={FileText} label=\"Equipamento\" value={`${deal.equipment.code} — ${deal.equipment.brand} ${deal.equipment.model}`} />\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Notes */}\r\n                        {deal.notes && (\r\n                            <div className=\"border-b border-surface-200 px-5 py-4\">\r\n                                <p className=\"text-xs font-medium text-surface-500 mb-1\">Observações</p>\r\n                                <p className=\"text-sm text-surface-700 whitespace-pre-wrap\">{deal.notes}</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Messages */}\r\n                        {deal.customer && (\r\n                            <div className=\"border-b border-surface-200 px-5 py-4\">\r\n                                <div className=\"flex items-center justify-between mb-3\">\r\n                                    <h3 className=\"text-xs font-semibold text-surface-500 uppercase tracking-wider\">Mensagens</h3>\r\n                                    <button\r\n                                        onClick={() => setSendMessageOpen(true)}\r\n                                        className=\"text-xs font-medium text-brand-600 hover:text-brand-700\"\r\n                                    >\r\n                                        + Nova\r\n                                    </button>\r\n                                </div>\r\n                                <MessageHistory customerId={deal.customer.id} dealId={deal.id} />\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Timeline */}\r\n                        <div className=\"px-5 py-4\">\r\n                            <h3 className=\"text-xs font-semibold text-surface-500 uppercase tracking-wider mb-3\">Atividades</h3>\r\n                            <div className=\"space-y-3\">\r\n                                {(deal.activities ?? []).length === 0 ? (\r\n                                    <p className=\"text-sm text-surface-400 text-center py-4\">Nenhuma atividade registrada</p>\r\n                                ) : (\r\n                                    (deal.activities ?? []).map((act: CrmActivity) => {\r\n                                        const Icon = typeIcons[act.type] ?? FileText\r\n                                        return (\r\n                                            <div key={act.id} className=\"flex gap-3\">\r\n                                                <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-surface-100 text-surface-500\">\r\n                                                    <Icon className=\"h-4 w-4\" />\r\n                                                </div>\r\n                                                <div className=\"min-w-0 flex-1\">\r\n                                                    <p className=\"text-sm font-medium text-surface-800\">{act.title}</p>\r\n                                                    <div className=\"flex items-center gap-2 text-xs text-surface-400 mt-0.5\">\r\n                                                        {act.user?.name && <span>{act.user.name}</span>}\r\n                                                        <span>•</span>\r\n                                                        <span>{new Date(act.created_at).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' })}</span>\r\n                                                    </div>\r\n                                                    {act.description && (\r\n                                                        <p className=\"text-xs text-surface-500 mt-1\">{act.description}</p>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        )\r\n                                    })\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ) : null}\r\n            </div>\r\n\r\n            {/* Send Message Modal */}\r\n            {deal?.customer && (\r\n                <SendMessageModal\r\n                    open={sendMessageOpen}\r\n                    onClose={() => setSendMessageOpen(false)}\r\n                    customerId={deal.customer.id}\r\n                    customerName={deal.customer.name}\r\n                    customerPhone={deal.customer.phone}\r\n                    customerEmail={deal.customer.email}\r\n                    dealId={deal.id}\r\n                />\r\n            )}\r\n        </>\r\n    )\r\n}\r\n\r\nfunction InfoRow({ icon: Icon, label, value }: { icon: React.ElementType; label: string; value: string }) {\r\n    return (\r\n        <div className=\"flex items-center gap-3\">\r\n            <Icon className=\"h-4 w-4 text-surface-400\" />\r\n            <div className=\"flex items-baseline gap-2\">\r\n                <span className=\"text-xs text-surface-500 w-24 shrink-0\">{label}</span>\r\n                <span className=\"text-sm font-medium text-surface-800\">{value}</span>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\MessageHistory.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\r\nimport { crmApi } from '@/lib/crm-api'\r\nimport type { CrmMessage } from '@/lib/crm-api'\r\nimport { cn } from '@/lib/utils'\r\nimport { MessageCircle, Mail, Check, CheckCheck, Clock, AlertCircle, Eye } from 'lucide-react'\r\n\r\ninterface Props {\r\n    customerId: number\r\n    dealId?: number\r\n}\r\n\r\nconst STATUS_ICONS: Record<string, { icon: React.ElementType; color: string; label: string }> = {\r\n    pending: { icon: Clock, color: 'text-surface-400', label: 'Pendente' },\r\n    sent: { icon: Check, color: 'text-surface-500', label: 'Enviada' },\r\n    delivered: { icon: CheckCheck, color: 'text-surface-500', label: 'Entregue' },\r\n    read: { icon: Eye, color: 'text-blue-500', label: 'Lida' },\r\n    failed: { icon: AlertCircle, color: 'text-red-500', label: 'Falhou' },\r\n}\r\n\r\nconst CHANNEL_CONFIG = {\r\n    whatsapp: { icon: MessageCircle, color: 'bg-green-500', label: 'WhatsApp' },\r\n    email: { icon: Mail, color: 'bg-blue-500', label: 'E-mail' },\r\n    sms: { icon: MessageCircle, color: 'bg-amber-500', label: 'SMS' },\r\n}\r\n\r\nfunction fmtTime(dateStr: string) {\r\n    const d = new Date(dateStr)\r\n    const now = new Date()\r\n    const diffMs = now.getTime() - d.getTime()\r\n    const diffDays = Math.floor(diffMs / 86400000)\r\n\r\n    const time = d.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })\r\n\r\n    if (diffDays === 0) return time\r\n    if (diffDays === 1) return `Ontem ${time}`\r\n    if (diffDays < 7) return `${d.toLocaleDateString('pt-BR', { weekday: 'short' })} ${time}`\r\n    return `${d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })} ${time}`\r\n}\r\n\r\nexport function MessageHistory({ customerId, dealId }: Props) {\r\n    const params: Record<string, unknown> = { customer_id: customerId, per_page: 50 }\r\n    if (dealId) params.deal_id = dealId\r\n\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['crm', 'messages', customerId, dealId],\r\n        queryFn: () => crmApi.getMessages(params).then(r => r.data),\r\n    })\r\n\r\n    const messages: CrmMessage[] = (data as any)?.data ?? []\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center py-12\">\r\n                <div className=\"h-5 w-5 animate-spin rounded-full border-2 border-brand-500 border-t-transparent\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (messages.length === 0) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n                <div className=\"rounded-full bg-surface-100 p-4 mb-3\">\r\n                    <MessageCircle className=\"h-6 w-6 text-surface-400\" />\r\n                </div>\r\n                <p className=\"text-sm text-surface-500\">Nenhuma mensagem</p>\r\n                <p className=\"text-xs text-surface-400 mt-1\">Use o botão acima para enviar a primeira mensagem</p>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    // Group messages by date\r\n    const grouped: Record<string, CrmMessage[]> = {}\r\n    for (const msg of messages) {\r\n        const date = new Date(msg.created_at).toLocaleDateString('pt-BR')\r\n        if (!grouped[date]) grouped[date] = []\r\n        grouped[date].push(msg)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {Object.entries(grouped).map(([date, msgs]) => (\r\n                <div key={date}>\r\n                    {/* Date separator */}\r\n                    <div className=\"flex items-center gap-3 mb-3\">\r\n                        <div className=\"h-px flex-1 bg-surface-200\" />\r\n                        <span className=\"text-[10px] font-medium text-surface-400 uppercase tracking-wider\">{date}</span>\r\n                        <div className=\"h-px flex-1 bg-surface-200\" />\r\n                    </div>\r\n\r\n                    {/* Messages */}\r\n                    <div className=\"space-y-2\">\r\n                        {msgs.map(msg => {\r\n                            const isOutbound = msg.direction === 'outbound'\r\n                            const channelCfg = CHANNEL_CONFIG[msg.channel]\r\n                            const statusCfg = STATUS_ICONS[msg.status]\r\n                            const StatusIcon = statusCfg?.icon ?? Check\r\n\r\n                            return (\r\n                                <div\r\n                                    key={msg.id}\r\n                                    className={cn('flex', isOutbound ? 'justify-end' : 'justify-start')}\r\n                                >\r\n                                    <div className={cn(\r\n                                        'max-w-[80%] rounded-2xl px-4 py-2.5 shadow-sm',\r\n                                        isOutbound\r\n                                            ? 'bg-brand-50 border border-brand-100 rounded-br-md'\r\n                                            : 'bg-white border border-surface-200 rounded-bl-md'\r\n                                    )}>\r\n                                        {/* Channel + direction */}\r\n                                        <div className=\"flex items-center gap-1.5 mb-1\">\r\n                                            <div className={cn('flex h-4 w-4 items-center justify-center rounded-full', channelCfg.color)}>\r\n                                                <channelCfg.icon className=\"h-2.5 w-2.5 text-white\" />\r\n                                            </div>\r\n                                            <span className=\"text-[10px] font-medium text-surface-500\">\r\n                                                {channelCfg.label} • {isOutbound ? 'Enviada' : 'Recebida'}\r\n                                            </span>\r\n                                            {msg.user?.name && (\r\n                                                <span className=\"text-[10px] text-surface-400\">por {msg.user.name}</span>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Subject (email) */}\r\n                                        {msg.subject && (\r\n                                            <p className=\"text-xs font-semibold text-surface-700 mb-1\">{msg.subject}</p>\r\n                                        )}\r\n\r\n                                        {/* Body */}\r\n                                        <p className=\"text-sm text-surface-800 whitespace-pre-wrap break-words leading-relaxed\">\r\n                                            {msg.body}\r\n                                        </p>\r\n\r\n                                        {/* Attachments */}\r\n                                        {msg.attachments && msg.attachments.length > 0 && (\r\n                                            <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                                                {msg.attachments.map((att, i) => (\r\n                                                    <span\r\n                                                        key={i}\r\n                                                        className=\"inline-flex items-center gap-1 rounded-md bg-surface-100 px-2 py-0.5 text-[10px] font-medium text-surface-600\"\r\n                                                    >\r\n                                                        📎 {att.name}\r\n                                                    </span>\r\n                                                ))}\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {/* Footer: time + status */}\r\n                                        <div className=\"flex items-center justify-end gap-1.5 mt-1.5\">\r\n                                            <span className=\"text-[10px] text-surface-400\">{fmtTime(msg.created_at)}</span>\r\n                                            {isOutbound && (\r\n                                                <StatusIcon className={cn('h-3 w-3', statusCfg?.color ?? 'text-surface-400')} />\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Error message */}\r\n                                        {msg.status === 'failed' && msg.error_message && (\r\n                                            <div className=\"mt-1.5 rounded-md bg-red-50 px-2 py-1 text-[10px] text-red-600\">\r\n                                                ⚠ {msg.error_message}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            ))}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\NewDealModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2853,2856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2853,2856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { crmApi } from '@/lib/crm-api'\r\nimport api from '@/lib/api'\r\n\r\ninterface Props {\r\n    open: boolean\r\n    onClose: () => void\r\n    pipelineId: number\r\n    stageId: number\r\n}\r\n\r\nexport function NewDealModal({ open, onClose, pipelineId, stageId }: Props) {\r\n    const queryClient = useQueryClient()\r\n    const [form, setForm] = useState({\r\n        title: '',\r\n        customer_id: '',\r\n        value: '',\r\n        expected_close_date: '',\r\n        source: '',\r\n        notes: '',\r\n    })\r\n\r\n    // Fetch customers for select\r\n    const { data: customersRes } = useQuery({\r\n        queryKey: ['customers-list'],\r\n        queryFn: () => api.get('/customers', { params: { per_page: 500 } }),\r\n        enabled: open,\r\n    })\r\n\r\n    const customers = customersRes?.data?.data ?? []\r\n\r\n    const createMutation = useMutation({\r\n        mutationFn: () => crmApi.createDeal({\r\n            title: form.title,\r\n            customer_id: Number(form.customer_id),\r\n            pipeline_id: pipelineId,\r\n            stage_id: stageId,\r\n            value: Number(form.value) || 0,\r\n            expected_close_date: form.expected_close_date || null,\r\n            source: form.source || null,\r\n            notes: form.notes || null,\r\n        }),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['crm'] })\r\n            onClose()\r\n        },\r\n    })\r\n\r\n    const set = (key: string, val: string) => setForm(prev => ({ ...prev, [key]: val }))\r\n\r\n    return (\r\n        <Modal open={open} onOpenChange={v => !v && onClose()} title=\"Novo Deal\" size=\"lg\">\r\n            <div className=\"space-y-4\">\r\n                <div>\r\n                    <label className=\"text-xs font-medium text-surface-600 mb-1 block\">Título *</label>\r\n                    <Input\r\n                        value={form.title}\r\n                        onChange={e => set('title', e.target.value)}\r\n                        placeholder=\"Ex: Calibração Balança 500kg\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"text-xs font-medium text-surface-600 mb-1 block\">Cliente *</label>\r\n                    <select\r\n                        value={form.customer_id}\r\n                        onChange={e => set('customer_id', e.target.value)}\r\n                        className=\"w-full rounded-lg border border-surface-200 px-3 py-2 text-sm text-surface-700 focus:outline-none focus:ring-2 focus:ring-brand-500/30\"\r\n                    >\r\n                        <option value=\"\">Selecione um cliente</option>\r\n                        {customers.map((c: any) => (\r\n                            <option key={c.id} value={c.id}>{c.name}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"text-xs font-medium text-surface-600 mb-1 block\">Valor (R$)</label>\r\n                        <Input\r\n                            type=\"number\"\r\n                            value={form.value}\r\n                            onChange={e => set('value', e.target.value)}\r\n                            placeholder=\"0,00\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-xs font-medium text-surface-600 mb-1 block\">Previsão de Fechamento</label>\r\n                        <Input\r\n                            type=\"date\"\r\n                            value={form.expected_close_date}\r\n                            onChange={e => set('expected_close_date', e.target.value)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"text-xs font-medium text-surface-600 mb-1 block\">Origem</label>\r\n                    <select\r\n                        value={form.source}\r\n                        onChange={e => set('source', e.target.value)}\r\n                        className=\"w-full rounded-lg border border-surface-200 px-3 py-2 text-sm text-surface-700 focus:outline-none focus:ring-2 focus:ring-brand-500/30\"\r\n                    >\r\n                        <option value=\"\">Selecione</option>\r\n                        <option value=\"calibracao_vencendo\">Calibração Vencendo</option>\r\n                        <option value=\"indicacao\">Indicação</option>\r\n                        <option value=\"prospeccao\">Prospecção</option>\r\n                        <option value=\"chamado\">Chamado Técnico</option>\r\n                        <option value=\"contrato_renovacao\">Renovação de Contrato</option>\r\n                        <option value=\"retorno\">Retorno de Cliente</option>\r\n                        <option value=\"outro\">Outro</option>\r\n                    </select>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"text-xs font-medium text-surface-600 mb-1 block\">Observações</label>\r\n                    <textarea\r\n                        value={form.notes}\r\n                        onChange={e => set('notes', e.target.value)}\r\n                        className=\"w-full rounded-lg border border-surface-200 px-3 py-2 text-sm text-surface-700 focus:outline-none focus:ring-2 focus:ring-brand-500/30\"\r\n                        rows={3}\r\n                        placeholder=\"Notas opcionais...\"\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-2 pt-2\">\r\n                    <Button variant=\"ghost\" onClick={onClose}>Cancelar</Button>\r\n                    <Button\r\n                        variant=\"primary\"\r\n                        onClick={() => createMutation.mutate()}\r\n                        disabled={!form.title || !form.customer_id || createMutation.isPending}\r\n                    >\r\n                        {createMutation.isPending ? 'Criando…' : 'Criar Deal'}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\crm\\SendMessageModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\financial\\FinancialExportButtons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\layout\\AppLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\layout\\PortalLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[130,141],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Download' is defined but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Download"},"fix":{"range":[170,185],"text":""},"desc":"Remove unused variable \"Download\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Link, useLocation } from 'react-router-dom'\r\nimport {\r\n    LayoutDashboard,\r\n    FileText,\r\n    LogOut,\r\n    Menu,\r\n    X,\r\n    User,\r\n    Phone,\r\n    DollarSign,\r\n    Download\r\n} from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport { usePortalAuthStore } from '@/stores/portal-auth-store'\r\nimport { useState } from 'react'\r\n\r\ninterface NavItem {\r\n    label: string\r\n    icon: React.ElementType\r\n    path: string\r\n}\r\n\r\nconst navigation: NavItem[] = [\r\n    { label: 'Visão Geral', icon: LayoutDashboard, path: '/portal' },\r\n    { label: 'Minhas OS', icon: FileText, path: '/portal/os' },\r\n    { label: 'Orçamentos', icon: DollarSign, path: '/portal/orcamentos' },\r\n    { label: 'Financeiro', icon: DollarSign, path: '/portal/financeiro' },\r\n    { label: 'Abrir Chamado', icon: Phone, path: '/portal/chamados/novo' },\r\n]\r\n\r\nexport function PortalLayout({ children }: { children: React.ReactNode }) {\r\n    const location = useLocation()\r\n    const { user, logout } = usePortalAuthStore()\r\n    const [mobileMenuOpen, setMobileMenuOpen] = useState(false)\r\n\r\n    const isActive = (path: string) => location.pathname === path\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-surface-50\">\r\n            {/* Topbar */}\r\n            <header className=\"bg-white border-b border-surface-200 sticky top-0 z-30\">\r\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n                    <div className=\"flex justify-between h-16\">\r\n                        <div className=\"flex\">\r\n                            <div className=\"flex-shrink-0 flex items-center gap-2\">\r\n                                <div className=\"bg-brand-600 text-white p-1.5 rounded-lg font-bold\">\r\n                                    PC\r\n                                </div>\r\n                                <span className=\"font-bold text-surface-900 hidden sm:block\">Portal do Cliente</span>\r\n                            </div>\r\n                            <nav className=\"hidden sm:ml-6 sm:flex sm:space-x-4\">\r\n                                {navigation.map((item) => (\r\n                                    <Link\r\n                                        key={item.path}\r\n                                        to={item.path}\r\n                                        className={cn(\r\n                                            \"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors duration-200 h-full\",\r\n                                            isActive(item.path)\r\n                                                ? \"border-brand-500 text-brand-600\"\r\n                                                : \"border-transparent text-surface-500 hover:text-surface-700 hover:border-surface-300\"\r\n                                        )}\r\n                                    >\r\n                                        <item.icon className=\"h-4 w-4 mr-2\" />\r\n                                        {item.label}\r\n                                    </Link>\r\n                                ))}\r\n                            </nav>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <span className=\"text-sm text-surface-600 hidden sm:block\">\r\n                                Olá, <span className=\"font-semibold text-surface-900\">{user?.name}</span>\r\n                            </span>\r\n                            <div className=\"h-8 w-8 rounded-full bg-brand-100 flex items-center justify-center text-brand-700 font-bold text-sm\">\r\n                                {user?.name?.charAt(0)}\r\n                            </div>\r\n                            <button\r\n                                onClick={() => logout()}\r\n                                className=\"p-2 rounded-full text-surface-400 hover:text-red-500 hover:bg-red-50 transition-colors\"\r\n                            >\r\n                                <LogOut className=\"h-5 w-5\" />\r\n                            </button>\r\n                            <button\r\n                                className=\"sm:hidden p-2 text-surface-500\"\r\n                                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\r\n                            >\r\n                                {mobileMenuOpen ? <X className=\"h-6 w-6\" /> : <Menu className=\"h-6 w-6\" />}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Mobile Menu */}\r\n                {mobileMenuOpen && (\r\n                    <div className=\"sm:hidden bg-white border-t border-surface-200\">\r\n                        <div className=\"pt-2 pb-4 space-y-1\">\r\n                            {navigation.map((item) => (\r\n                                <Link\r\n                                    key={item.path}\r\n                                    to={item.path}\r\n                                    onClick={() => setMobileMenuOpen(false)}\r\n                                    className={cn(\r\n                                        \"block pl-3 pr-4 py-2 border-l-4 text-base font-medium\",\r\n                                        isActive(item.path)\r\n                                            ? \"bg-brand-50 border-brand-500 text-brand-700\"\r\n                                            : \"border-transparent text-surface-500 hover:bg-surface-50 hover:border-surface-300 hover:text-surface-700\"\r\n                                    )}\r\n                                >\r\n                                    <div className=\"flex items-center\">\r\n                                        <item.icon className=\"h-5 w-5 mr-3\" />\r\n                                        {item.label}\r\n                                    </div>\r\n                                </Link>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </header>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\r\n                {children}\r\n            </main>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\notifications\\NotificationPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\signature\\SignaturePad.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\ui\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\ui\\Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\ui\\Select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\components\\ui\\Textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\hooks\\useCurrentTenant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\hooks\\usePWA.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\hooks\\useWebSocket.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\lib\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\lib\\crm-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\CrmCustomer360Page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tag' is defined but never used.","line":6,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Tag"},"fix":{"range":[243,248],"text":""},"desc":"Remove unused variable \"Tag\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":7,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[248,263],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Scale' is defined but never used.","line":7,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Scale"},"fix":{"range":[275,282],"text":""},"desc":"Remove unused variable \"Scale\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FileText' is defined but never used.","line":7,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[282,292],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":7,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":55,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[298,305],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit' is defined but never used.","line":8,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Edit"},"fix":{"range":[319,325],"text":""},"desc":"Remove unused variable \"Edit\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2227,2230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2227,2230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8968,8971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8968,8971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11595,11598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11595,11598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14216,14219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14216,14219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":267,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16064,16067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16064,16067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":356,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22475,22478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22475,22478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { useParams, Link } from 'react-router-dom'\r\nimport * as Tabs from '@radix-ui/react-tabs'\r\nimport {\r\n    ArrowLeft, User, Phone, Mail, MapPin, Building2, Tag,\r\n    Calendar, DollarSign, Scale, FileText, Plus, Clock,\r\n    Loader2, Edit, Target, FileCheck, Download,\r\n} from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { CustomerHealthScore } from '@/components/crm/CustomerHealthScore'\r\nimport { CustomerTimeline } from '@/components/crm/CustomerTimeline'\r\nimport { ActivityForm } from '@/components/crm/ActivityForm'\r\nimport { SendMessageModal } from '@/components/crm/SendMessageModal'\r\nimport { MessageHistory } from '@/components/crm/MessageHistory'\r\nimport { crmApi } from '@/lib/crm-api'\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nexport function Customer360Page() {\n    const { id } = useParams()\n    const customerId = Number(id)\n    const [nowTs] = useState(() => Date.now())\n    const [activityFormOpen, setActivityFormOpen] = useState(false)\n    const [sendMessageOpen, setSendMessageOpen] = useState(false)\n\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['customer-360', customerId],\r\n        queryFn: () => crmApi.getCustomer360(customerId).then(r => r.data),\r\n        enabled: !!customerId,\r\n    })\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex h-full items-center justify-center\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-brand-500\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const customer = data?.customer\r\n    const healthBreakdown = data?.health_breakdown ? Object.values(data.health_breakdown) as { score: number; max: number; label: string }[] : []\r\n    const equipments = data?.equipments ?? []\r\n    const deals = data?.deals ?? []\r\n    const timeline = data?.timeline ?? []\r\n    const workOrders = data?.work_orders ?? []\r\n    const quotes = data?.quotes ?? []\r\n    const pendingReceivables = data?.pending_receivables ?? 0\r\n    const documents = data?.documents ?? [] as any[]\r\n\r\n    if (!customer) {\r\n        return (\r\n            <div className=\"flex h-full items-center justify-center\">\r\n                <p className=\"text-surface-400\">Cliente não encontrado</p>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-start justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link to=\"/crm\" className=\"rounded-lg p-1.5 text-surface-400 hover:bg-surface-100 hover:text-surface-600 transition-colors\">\r\n                        <ArrowLeft className=\"h-5 w-5\" />\r\n                    </Link>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"flex h-12 w-12 items-center justify-center rounded-xl bg-brand-100 text-brand-700 text-lg font-bold\">\r\n                            {customer.name?.charAt(0)?.toUpperCase()}\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"text-xl font-bold text-surface-900\">{customer.name}</h1>\r\n                            <div className=\"flex items-center gap-3 mt-1 text-xs text-surface-400\">\r\n                                {customer.type && <Badge variant=\"default\">{customer.type === 'pj' ? 'PJ' : 'PF'}</Badge>}\r\n                                {customer.segment && <span className=\"capitalize\">{customer.segment}</span>}\r\n                                {customer.rating && <Badge variant=\"brand\">{customer.rating}</Badge>}\r\n                                {customer.assigned_seller?.name && (\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <User className=\"h-3 w-3\" /> {customer.assigned_seller.name}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => setSendMessageOpen(true)}>\r\n                        <Mail className=\"h-4 w-4 mr-1\" />\r\n                        Mensagem\r\n                    </Button>\r\n                    <Button variant=\"primary\" size=\"sm\" onClick={() => setActivityFormOpen(true)}>\r\n                        <Plus className=\"h-4 w-4 mr-1\" />\r\n                        Atividade\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Quick Info Row */}\r\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\r\n                {customer.phone && (\r\n                    <QuickInfo icon={Phone} label=\"Telefone\" value={customer.phone} />\r\n                )}\r\n                {customer.email && (\r\n                    <QuickInfo icon={Mail} label=\"E-mail\" value={customer.email} />\r\n                )}\r\n                {customer.address_city && (\r\n                    <QuickInfo icon={MapPin} label=\"Cidade\" value={`${customer.address_city}/${customer.address_state}`} />\r\n                )}\r\n                {customer.document && (\r\n                    <QuickInfo icon={Building2} label=\"Documento\" value={customer.document} />\r\n                )}\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <Tabs.Root defaultValue=\"overview\">\r\n                <Tabs.List className=\"flex border-b border-surface-200 gap-1\">\r\n                    {[\r\n                        { value: 'overview', label: 'Visão Geral' },\r\n                        { value: 'equipments', label: `Equipamentos (${equipments.length})` },\r\n                        { value: 'deals', label: `Oportunidades (${deals.length})` },\r\n                        { value: 'messages', label: 'Mensagens' },\r\n                        { value: 'timeline', label: 'Timeline' },\r\n                        { value: 'financial', label: 'Financeiro' },\r\n                        { value: 'documents', label: `Documentos (${documents.length})` },\r\n                        { value: 'data', label: 'Dados' },\r\n                    ].map(tab => (\r\n                        <Tabs.Trigger\r\n                            key={tab.value}\r\n                            value={tab.value}\r\n                            className=\"px-4 py-2.5 text-sm font-medium text-surface-500 border-b-2 border-transparent transition-colors data-[state=active]:text-brand-600 data-[state=active]:border-brand-500 hover:text-surface-700\"\r\n                        >\r\n                            {tab.label}\r\n                        </Tabs.Trigger>\r\n                    ))}\r\n                </Tabs.List>\r\n\r\n                {/* Tab: Overview */}\r\n                <Tabs.Content value=\"overview\" className=\"mt-5\">\r\n                    <div className=\"grid gap-5 lg:grid-cols-3\">\r\n                        <CustomerHealthScore\r\n                            score={customer.health_score ?? 0}\r\n                            breakdown={healthBreakdown}\r\n                        />\r\n                        <div className=\"lg:col-span-2\">\r\n                            <CustomerTimeline activities={timeline.slice(0, 10)} />\r\n                        </div>\r\n                    </div>\r\n                </Tabs.Content>\r\n\r\n                {/* Tab: Equipments */}\r\n                <Tabs.Content value=\"equipments\" className=\"mt-5\">\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden\">\r\n                        <table className=\"w-full text-sm\">\r\n                            <thead>\r\n                                <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                    <th className=\"px-4 py-2.5 text-left text-xs font-semibold text-surface-500\">Código</th>\r\n                                    <th className=\"px-4 py-2.5 text-left text-xs font-semibold text-surface-500\">Equipamento</th>\r\n                                    <th className=\"px-4 py-2.5 text-left text-xs font-semibold text-surface-500\">Categoria</th>\r\n                                    <th className=\"px-4 py-2.5 text-left text-xs font-semibold text-surface-500\">Status</th>\r\n                                    <th className=\"px-4 py-2.5 text-left text-xs font-semibold text-surface-500\">Próx. Calibração</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-surface-100\">\r\n                                {equipments.length === 0 ? (\n                                    <tr><td colSpan={5} className=\"px-4 py-8 text-center text-surface-400\">Nenhum equipamento</td></tr>\n                                ) : equipments.map((eq: any) => {\n                                    const nextCal = eq.next_calibration_at ? new Date(eq.next_calibration_at) : null\n                                    const diff = nextCal ? Math.ceil((nextCal.getTime() - nowTs) / 86400000) : null\n                                    return (\n                                        <tr key={eq.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                            <td className=\"px-4 py-2.5 font-mono text-xs font-bold text-brand-600\">{eq.code}</td>\r\n                                            <td className=\"px-4 py-2.5 text-surface-800\">{eq.brand} {eq.model}</td>\r\n                                            <td className=\"px-4 py-2.5 text-surface-500 capitalize\">{eq.category}</td>\r\n                                            <td className=\"px-4 py-2.5\">\r\n                                                <Badge variant={eq.status === 'active' ? 'success' : 'default'}>{eq.status}</Badge>\r\n                                            </td>\r\n                                            <td className=\"px-4 py-2.5\">\r\n                                                {nextCal ? (\r\n                                                    <span className={cn('text-xs font-medium',\r\n                                                        diff && diff < 0 ? 'text-red-600' : diff && diff < 30 ? 'text-amber-600' : 'text-surface-600'\r\n                                                    )}>\r\n                                                        {nextCal.toLocaleDateString('pt-BR')}\r\n                                                        {diff !== null && ` (${diff < 0 ? `${Math.abs(diff)}d atrás` : `${diff}d`})`}\r\n                                                    </span>\r\n                                                ) : (\r\n                                                    <span className=\"text-xs text-surface-400\">—</span>\r\n                                                )}\r\n                                            </td>\r\n                                        </tr>\r\n                                    )\r\n                                })}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </Tabs.Content>\r\n\r\n                {/* Tab: Deals */}\r\n                <Tabs.Content value=\"deals\" className=\"mt-5\">\r\n                    <div className=\"space-y-3\">\r\n                        {deals.length === 0 ? (\r\n                            <p className=\"text-center text-sm text-surface-400 py-8\">Nenhuma oportunidade</p>\r\n                        ) : deals.map((deal: any) => (\r\n                            <div key={deal.id} className=\"rounded-lg border border-surface-200 bg-white p-4 shadow-card hover:shadow-elevated transition-shadow\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <Target className=\"h-4 w-4 text-brand-500\" />\r\n                                        <div>\r\n                                            <p className=\"text-sm font-semibold text-surface-800\">{deal.title}</p>\r\n                                            <p className=\"text-xs text-surface-400\">{deal.pipeline?.name} → {deal.stage?.name}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <Badge variant={deal.status === 'won' ? 'success' : deal.status === 'lost' ? 'danger' : 'info'} dot>\r\n                                            {deal.status === 'won' ? 'Ganho' : deal.status === 'lost' ? 'Perdido' : 'Aberto'}\r\n                                        </Badge>\r\n                                        <span className=\"text-sm font-bold text-surface-900\">{fmtBRL(Number(deal.value))}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </Tabs.Content>\r\n\r\n                {/* Tab: Timeline */}\r\n                <Tabs.Content value=\"timeline\" className=\"mt-5\">\r\n                    <CustomerTimeline activities={timeline} />\r\n                </Tabs.Content>\r\n\r\n                {/* Tab: Financial */}\r\n                <Tabs.Content value=\"financial\" className=\"mt-5\">\r\n                    <div className=\"grid gap-5 lg:grid-cols-2\">\r\n                        {/* Work Orders */}\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                            <div className=\"border-b border-surface-200 px-5 py-3\">\r\n                                <h3 className=\"text-sm font-semibold text-surface-900\">Últimas Ordens de Serviço</h3>\r\n                            </div>\r\n                            <div className=\"divide-y divide-surface-100\">\r\n                                {workOrders.length === 0 ? (\r\n                                    <p className=\"px-5 py-6 text-center text-sm text-surface-400\">Nenhuma OS</p>\r\n                                ) : workOrders.map((wo: any) => (\r\n                                    <div key={wo.id} className=\"flex items-center justify-between px-5 py-2.5\">\r\n                                        <div>\r\n                                            <span className=\"text-sm font-bold text-brand-600\">#{wo.number}</span>\r\n                                            <p className=\"text-xs text-surface-400 mt-0.5\">{new Date(wo.created_at).toLocaleDateString('pt-BR')}</p>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Badge variant={wo.status === 'completed' ? 'success' : wo.status === 'cancelled' ? 'danger' : 'info'}>\r\n                                                {wo.status}\r\n                                            </Badge>\r\n                                            <span className=\"text-sm font-medium text-surface-800\">{fmtBRL(Number(wo.total ?? 0))}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Quotes */}\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                            <div className=\"border-b border-surface-200 px-5 py-3\">\r\n                                <h3 className=\"text-sm font-semibold text-surface-900\">Últimos Orçamentos</h3>\r\n                            </div>\r\n                            <div className=\"divide-y divide-surface-100\">\r\n                                {quotes.length === 0 ? (\r\n                                    <p className=\"px-5 py-6 text-center text-sm text-surface-400\">Nenhum orçamento</p>\r\n                                ) : quotes.map((q: any) => (\r\n                                    <div key={q.id} className=\"flex items-center justify-between px-5 py-2.5\">\r\n                                        <div>\r\n                                            <span className=\"text-sm font-bold text-brand-600\">#{q.quote_number}</span>\r\n                                            <p className=\"text-xs text-surface-400 mt-0.5\">{new Date(q.created_at).toLocaleDateString('pt-BR')}</p>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Badge variant={q.status === 'approved' ? 'success' : q.status === 'rejected' ? 'danger' : 'warning'}>\r\n                                                {q.status}\r\n                                            </Badge>\r\n                                            <span className=\"text-sm font-medium text-surface-800\">{fmtBRL(Number(q.total ?? 0))}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Receivables summary */}\r\n                    {pendingReceivables > 0 && (\r\n                        <div className=\"mt-4 rounded-xl border border-amber-200 bg-amber-50/50 p-4 flex items-center gap-3\">\r\n                            <DollarSign className=\"h-5 w-5 text-amber-600\" />\r\n                            <div>\r\n                                <p className=\"text-sm font-semibold text-surface-800\">Pendências Financeiras</p>\r\n                                <p className=\"text-xs text-amber-700\">{fmtBRL(pendingReceivables)} em contas a receber pendentes/vencidas</p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </Tabs.Content>\r\n\r\n                {/* Tab: Data */}\r\n                <Tabs.Content value=\"data\" className=\"mt-5\">\r\n                    <div className=\"grid gap-5 lg:grid-cols-2\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-3\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-900 mb-3\">Informações de Contato</h3>\r\n                            <DataRow label=\"Nome\" value={customer.name} />\r\n                            <DataRow label=\"Documento\" value={customer.document} />\r\n                            <DataRow label=\"E-mail\" value={customer.email} />\r\n                            <DataRow label=\"Telefone\" value={customer.phone} />\r\n                            <DataRow label=\"Telefone 2\" value={customer.phone2} />\r\n                            <DataRow label=\"Endereço\" value={\r\n                                [customer.address_street, customer.address_number, customer.address_complement,\r\n                                customer.address_neighborhood, customer.address_city, customer.address_state, customer.address_zip]\r\n                                    .filter(Boolean).join(', ')\r\n                            } />\r\n                        </div>\r\n\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-3\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-900 mb-3\">Informações CRM</h3>\r\n                            <DataRow label=\"Origem\" value={customer.source} />\r\n                            <DataRow label=\"Segmento\" value={customer.segment} />\r\n                            <DataRow label=\"Porte\" value={customer.company_size} />\r\n                            <DataRow label=\"Receita Estimada\" value={customer.annual_revenue_estimate ? fmtBRL(Number(customer.annual_revenue_estimate)) : undefined} />\r\n                            <DataRow label=\"Tipo Contrato\" value={customer.contract_type} />\r\n                            <DataRow label=\"Contrato Início\" value={customer.contract_start} />\r\n                            <DataRow label=\"Contrato Fim\" value={customer.contract_end} />\r\n                            <DataRow label=\"Rating\" value={customer.rating} />\r\n                            <DataRow label=\"Tags\" value={customer.tags?.join(', ')} />\r\n                            <DataRow label=\"Último Contato\" value={customer.last_contact_at ? new Date(customer.last_contact_at).toLocaleDateString('pt-BR') : undefined} />\r\n                            <DataRow label=\"Próximo Follow-up\" value={customer.next_follow_up_at ? new Date(customer.next_follow_up_at).toLocaleDateString('pt-BR') : undefined} />\r\n                            <DataRow label=\"Observações\" value={customer.notes} />\r\n                        </div>\r\n                    </div>\r\n                </Tabs.Content>\r\n\r\n                {/* Tab: Messages */}\r\n                <Tabs.Content value=\"messages\" className=\"mt-5\">\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-900\">Histórico de Conversas</h3>\r\n                            <Button variant=\"primary\" size=\"sm\" onClick={() => setSendMessageOpen(true)}>\r\n                                <Mail className=\"h-4 w-4 mr-1\" />\r\n                                Nova Mensagem\r\n                            </Button>\r\n                        </div>\r\n                        <MessageHistory customerId={customerId} />\r\n                    </div>\r\n                </Tabs.Content>\r\n\r\n                {/* Tab: Documentos */}\r\n                <Tabs.Content value=\"documents\" className=\"mt-5\">\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                        <div className=\"flex items-center justify-between border-b border-surface-200 px-5 py-3\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-900\">Documentos & Certificados</h3>\r\n                        </div>\r\n                        {documents.length === 0 ? (\r\n                            <p className=\"py-10 text-center text-sm text-surface-400\">Nenhum documento encontrado</p>\r\n                        ) : (\r\n                            <div className=\"divide-y divide-surface-100\">\r\n                                {documents.map((doc: any) => {\r\n                                    const isExpired = doc.expires_at && new Date(doc.expires_at) < new Date()\r\n                                    const typeLabels: Record<string, string> = {\r\n                                        certificado: 'Certificado',\r\n                                        laudo: 'Laudo',\r\n                                        contrato: 'Contrato',\r\n                                        manual: 'Manual',\r\n                                        foto: 'Foto',\r\n                                        outro: 'Outro',\r\n                                    }\r\n                                    return (\r\n                                        <div key={doc.id} className=\"flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors\">\r\n                                            <div className=\"flex items-center gap-3 min-w-0\">\r\n                                                <div className={cn('rounded-lg p-2', isExpired ? 'bg-red-50 text-red-500' : 'bg-emerald-50 text-emerald-600')}>\r\n                                                    <FileCheck className=\"h-4 w-4\" />\r\n                                                </div>\r\n                                                <div className=\"min-w-0\">\r\n                                                    <p className=\"text-sm font-medium text-surface-800 truncate\">{doc.name}</p>\r\n                                                    <div className=\"flex items-center gap-2 text-xs text-surface-400\">\r\n                                                        <span>{typeLabels[doc.type] ?? doc.type}</span>\r\n                                                        {doc.equipment && (\r\n                                                            <>\r\n                                                                <span>•</span>\r\n                                                                <span>{doc.equipment.code} — {doc.equipment.brand} {doc.equipment.model}</span>\r\n                                                            </>\r\n                                                        )}\r\n                                                        {doc.expires_at && (\r\n                                                            <>\r\n                                                                <span>•</span>\r\n                                                                <span className={isExpired ? 'text-red-500 font-medium' : ''}>\r\n                                                                    {isExpired ? 'Vencido' : 'Válido até'} {new Date(doc.expires_at).toLocaleDateString('pt-BR')}\r\n                                                                </span>\r\n                                                            </>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            {doc.file_path && (\r\n                                                <a\r\n                                                    href={doc.file_path}\r\n                                                    target=\"_blank\"\r\n                                                    rel=\"noopener noreferrer\"\r\n                                                    className=\"flex items-center gap-1 rounded-lg px-2.5 py-1.5 text-xs font-medium text-brand-600 hover:bg-brand-50 transition-colors\"\r\n                                                >\r\n                                                    <Download className=\"h-3.5 w-3.5\" />\r\n                                                    Baixar\r\n                                                </a>\r\n                                            )}\r\n                                        </div>\r\n                                    )\r\n                                })}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </Tabs.Content>\r\n            </Tabs.Root>\r\n\r\n            {/* Activity Form Modal */}\r\n            <ActivityForm\r\n                open={activityFormOpen}\r\n                onClose={() => setActivityFormOpen(false)}\r\n                customerId={customerId}\r\n            />\r\n\r\n            {/* Send Message Modal */}\r\n            <SendMessageModal\r\n                open={sendMessageOpen}\r\n                onClose={() => setSendMessageOpen(false)}\r\n                customerId={customerId}\r\n                customerName={customer.name}\r\n                customerPhone={customer.phone}\r\n                customerEmail={customer.email}\r\n            />\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction QuickInfo({ icon: Icon, label, value }: { icon: React.ElementType; label: string; value: string }) {\r\n    return (\r\n        <div className=\"rounded-lg border border-surface-200 bg-white p-3 shadow-sm\">\r\n            <div className=\"flex items-center gap-2\">\r\n                <Icon className=\"h-4 w-4 text-surface-400\" />\r\n                <div className=\"min-w-0\">\r\n                    <p className=\"text-[10px] text-surface-400 uppercase\">{label}</p>\r\n                    <p className=\"text-sm font-medium text-surface-800 truncate\">{value}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction DataRow({ label, value }: { label: string; value?: string | null }) {\r\n    return (\r\n        <div className=\"flex items-baseline gap-3\">\r\n            <span className=\"text-xs text-surface-500 w-32 shrink-0\">{label}</span>\r\n            <span className=\"text-sm text-surface-800\">{value || '—'}</span>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\CrmDashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Users' is defined but never used.","line":4,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":34,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[118,125],"text":""},"desc":"Remove unused variable \"Users\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":5,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[148,163],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Phone' is defined but never used.","line":5,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Phone"},"fix":{"range":[163,170],"text":""},"desc":"Remove unused variable \"Phone\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CrmDashboardData' is defined but never used.","line":11,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CrmDashboardData"},"fix":{"range":[436,459],"text":""},"desc":"Remove unused variable \"CrmDashboardData\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6646,6649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6646,6649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6691,6694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6691,6694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":240,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15266,15269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15266,15269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":266,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17098,17101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17098,17101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { useQuery } from '@tanstack/react-query'\nimport {\r\n    TrendingUp, DollarSign, Users, Target, AlertTriangle,\r\n    Calendar, Phone, ArrowRight, Scale, Handshake, XCircle,\r\n    ArrowUpRight, BarChart3, Clock, MessageCircle, Mail, Send,\r\n} from 'lucide-react'\r\nimport { Link } from 'react-router-dom'\r\nimport { cn } from '@/lib/utils'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { crmApi, type CrmDashboardData } from '@/lib/crm-api'\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nexport function CrmDashboardPage() {\n    const [nowTs] = useState(() => Date.now())\n    const { data, isLoading } = useQuery({\n        queryKey: ['crm', 'dashboard'],\n        queryFn: () => crmApi.getDashboard().then(r => r.data),\n        refetchInterval: 60_000,\r\n    })\r\n\r\n    const kpis = data?.kpis\r\n    const msgStats = data?.messaging_stats\r\n    const pipelines = data?.pipelines ?? []\r\n    const recentDeals = data?.recent_deals ?? []\r\n    const upcomingActivities = data?.upcoming_activities ?? []\r\n    const topCustomers = data?.top_customers ?? []\r\n    const calibrationAlerts = data?.calibration_alerts ?? []\r\n\r\n    const kpiCards = [\r\n        { label: 'Deals Abertos', value: kpis?.open_deals ?? 0, icon: Target, color: 'text-blue-600 bg-blue-50' },\r\n        { label: 'Ganhos (mês)', value: kpis?.won_month ?? 0, icon: Handshake, color: 'text-emerald-600 bg-emerald-50' },\r\n        { label: 'Perdidos (mês)', value: kpis?.lost_month ?? 0, icon: XCircle, color: 'text-red-500 bg-red-50' },\r\n        { label: 'Conversão', value: `${kpis?.conversion_rate ?? 0}%`, icon: TrendingUp, color: 'text-brand-600 bg-brand-50' },\r\n    ]\r\n\r\n    const kpiCards2 = [\r\n        { label: 'Receita no Pipeline', value: fmtBRL(kpis?.revenue_in_pipeline ?? 0), icon: DollarSign, color: 'text-emerald-600 bg-emerald-50' },\r\n        { label: 'Receita Ganha (mês)', value: fmtBRL(kpis?.won_revenue ?? 0), icon: ArrowUpRight, color: 'text-blue-600 bg-blue-50' },\r\n        { label: 'Health Score Médio', value: kpis?.avg_health_score ?? 0, icon: BarChart3, color: 'text-amber-600 bg-amber-50' },\r\n        { label: 'Sem Contato > 90d', value: kpis?.no_contact_90d ?? 0, icon: AlertTriangle, color: 'text-red-500 bg-red-50' },\r\n    ]\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">CRM</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Pipeline de vendas e relacionamento com clientes</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    {pipelines.map(p => (\r\n                        <Link\r\n                            key={p.id}\r\n                            to={`/crm/pipeline/${p.id}`}\r\n                            className=\"flex items-center gap-1.5 rounded-lg border border-surface-200 bg-white px-3 py-2 text-sm font-medium text-surface-700 hover:bg-surface-50 transition-colors shadow-card\"\r\n                        >\r\n                            <span className=\"h-2 w-2 rounded-full\" style={{ backgroundColor: p.color || '#94a3b8' }} />\r\n                            {p.name}\r\n                            <ArrowRight className=\"h-3.5 w-3.5 text-surface-400\" />\r\n                        </Link>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* KPI Row 1 */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                {kpiCards.map(card => (\r\n                    <div key={card.label}\r\n                        className=\"group rounded-xl border border-surface-200 bg-white p-5 shadow-card transition-all duration-200 hover:shadow-elevated hover:-translate-y-0.5\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-xs font-medium text-surface-500 uppercase tracking-wider\">{card.label}</p>\r\n                                <p className=\"mt-2 text-2xl font-bold text-surface-900\">{isLoading ? '…' : card.value}</p>\r\n                            </div>\r\n                            <div className={cn('rounded-lg p-2.5', card.color)}>\r\n                                <card.icon className=\"h-5 w-5\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* KPI Row 2 */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                {kpiCards2.map(card => (\r\n                    <div key={card.label} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className={cn('rounded-lg p-2.5', card.color)}>\r\n                                <card.icon className=\"h-5 w-5\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-xs text-surface-500\">{card.label}</p>\r\n                                <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : card.value}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Pipeline Funnel Summary */}\r\n            {pipelines.length > 0 && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"border-b border-surface-200 px-5 py-3\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Funil de Vendas</h2>\r\n                    </div>\r\n                    <div className=\"p-5 space-y-4\">\r\n                        {pipelines.map(pipeline => (\r\n                            <div key={pipeline.id}>\r\n                                <div className=\"flex items-center gap-2 mb-2\">\r\n                                    <span className=\"h-2 w-2 rounded-full\" style={{ backgroundColor: pipeline.color || '#94a3b8' }} />\r\n                                    <Link to={`/crm/pipeline/${pipeline.id}`} className=\"text-sm font-medium text-surface-800 hover:text-brand-600 transition-colors\">\r\n                                        {pipeline.name}\r\n                                    </Link>\r\n                                </div>\r\n                                <div className=\"flex gap-1\">\r\n                                    {pipeline.stages.filter((s: any) => !s.is_won && !s.is_lost).map((stage: any) => {\r\n                                        const count = stage.deals_count ?? 0\r\n                                        const value = stage.deals_sum_value ?? 0\r\n                                        return (\r\n                                            <div key={stage.id} className=\"flex-1 group/stage\">\r\n                                                <div className=\"h-8 rounded-md flex items-center justify-center text-xs font-medium text-white relative overflow-hidden\"\r\n                                                    style={{ backgroundColor: stage.color || '#94a3b8' }}\r\n                                                    title={`${stage.name}: ${count} deal(s) — ${fmtBRL(value)}`}>\r\n                                                    <span className=\"relative z-10\">{count > 0 ? count : ''}</span>\r\n                                                </div>\r\n                                                <p className=\"text-[10px] text-surface-400 mt-1 text-center truncate\">{stage.name}</p>\r\n                                            </div>\r\n                                        )\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Messaging Stats */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <div className=\"flex items-center justify-between border-b border-surface-200 px-5 py-3\">\r\n                    <h2 className=\"text-sm font-semibold text-surface-900\">Mensageria (mês atual)</h2>\r\n                    <Link to=\"/crm/templates\" className=\"text-xs font-medium text-brand-600 hover:text-brand-700 flex items-center gap-1\">\r\n                        Templates <ArrowRight className=\"h-3 w-3\" />\r\n                    </Link>\r\n                </div>\r\n                <div className=\"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 divide-x divide-surface-100\">\r\n                    {[\r\n                        { label: 'Enviadas', value: msgStats?.sent_month ?? 0, icon: Send, color: 'text-brand-600 bg-brand-50' },\r\n                        { label: 'Recebidas', value: msgStats?.received_month ?? 0, icon: Mail, color: 'text-blue-600 bg-blue-50' },\r\n                        { label: 'WhatsApp', value: msgStats?.whatsapp_sent ?? 0, icon: MessageCircle, color: 'text-green-600 bg-green-50' },\r\n                        { label: 'E-mail', value: msgStats?.email_sent ?? 0, icon: Mail, color: 'text-sky-600 bg-sky-50' },\r\n                        { label: 'Entregues', value: msgStats?.delivered ?? 0, icon: Handshake, color: 'text-emerald-600 bg-emerald-50' },\r\n                        { label: 'Falharam', value: msgStats?.failed ?? 0, icon: XCircle, color: 'text-red-500 bg-red-50' },\r\n                        { label: 'Tx Entrega', value: `${msgStats?.delivery_rate ?? 0}%`, icon: TrendingUp, color: 'text-amber-600 bg-amber-50' },\r\n                    ].map(stat => (\r\n                        <div key={stat.label} className=\"flex items-center gap-2.5 px-4 py-3\">\r\n                            <div className={cn('rounded-lg p-2', stat.color)}>\r\n                                <stat.icon className=\"h-4 w-4\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-[10px] text-surface-400 uppercase tracking-wider\">{stat.label}</p>\r\n                                <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : stat.value}</p>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid gap-4 lg:grid-cols-3\">\r\n                {/* Recent Deals */}\r\n                <div className=\"lg:col-span-2 rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"flex items-center justify-between border-b border-surface-200 px-5 py-3\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Deals Recentes</h2>\r\n                    </div>\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Carregando…</p>\r\n                        ) : recentDeals.length === 0 ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Nenhum deal encontrado</p>\r\n                        ) : recentDeals.map(deal => (\r\n                            <div key={deal.id} className=\"flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors\">\r\n                                <div className=\"flex items-center gap-3 min-w-0\">\r\n                                    <div className=\"h-2 w-2 rounded-full shrink-0\"\r\n                                        style={{ backgroundColor: deal.stage?.color || '#94a3b8' }} />\r\n                                    <div className=\"min-w-0\">\r\n                                        <p className=\"text-sm font-medium text-surface-800 truncate\">{deal.title}</p>\r\n                                        <p className=\"text-xs text-surface-400 truncate\">{deal.customer?.name}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3 shrink-0\">\r\n                                    <Badge variant={deal.status === 'won' ? 'success' : deal.status === 'lost' ? 'danger' : 'info'}>\r\n                                        {deal.stage?.name ?? deal.status}\r\n                                    </Badge>\r\n                                    <span className=\"text-sm font-bold text-surface-900\">{fmtBRL(deal.value)}</span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Upcoming Activities */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"border-b border-surface-200 px-5 py-3\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Próximas Atividades</h2>\r\n                    </div>\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Carregando…</p>\r\n                        ) : upcomingActivities.length === 0 ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Nenhuma atividade agendada</p>\r\n                        ) : upcomingActivities.map(act => (\r\n                            <div key={act.id} className=\"px-5 py-3 hover:bg-surface-50 transition-colors\">\r\n                                <p className=\"text-sm font-medium text-surface-800\">{act.title}</p>\r\n                                <div className=\"flex items-center gap-2 mt-1 text-xs text-surface-400\">\r\n                                    <Clock className=\"h-3 w-3\" />\r\n                                    {act.scheduled_at && new Date(act.scheduled_at).toLocaleDateString('pt-BR', {\r\n                                        day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'\r\n                                    })}\r\n                                    {act.customer?.name && <span>• {act.customer.name}</span>}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid gap-4 lg:grid-cols-2\">\r\n                {/* Top Customers */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"border-b border-surface-200 px-5 py-3\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Top Clientes (receita ganha)</h2>\r\n                    </div>\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Carregando…</p>\r\n                        ) : topCustomers.length === 0 ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Sem dados</p>\r\n                        ) : topCustomers.map((row: any, i: number) => (\r\n                            <div key={row.customer_id} className=\"flex items-center justify-between px-5 py-3\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className={cn('flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold',\r\n                                        i === 0 ? 'bg-amber-100 text-amber-700' : 'bg-surface-100 text-surface-600')}>\r\n                                        {i + 1}\r\n                                    </span>\r\n                                    <span className=\"text-sm font-medium text-surface-800\">{row.customer?.name}</span>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <p className=\"text-sm font-bold text-surface-900\">{fmtBRL(parseFloat(row.total_value))}</p>\r\n                                    <p className=\"text-[10px] text-surface-400\">{row.deal_count} deal(s)</p>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Calibration Alerts */}\r\n                {calibrationAlerts.length > 0 && (\r\n                    <div className=\"rounded-xl border border-amber-200 bg-amber-50/50 shadow-card\">\r\n                        <div className=\"flex items-center gap-2 border-b border-amber-200 px-5 py-3\">\r\n                            <Scale className=\"h-4 w-4 text-amber-600\" />\r\n                            <h2 className=\"text-sm font-semibold text-surface-900\">Calibrações Vencendo (oportunidade)</h2>\r\n                        </div>\r\n                        <div className=\"divide-y divide-amber-100\">\r\n                            {calibrationAlerts.map((eq: any) => {\n                                const d = new Date(eq.next_calibration_at)\n                                const diff = Math.ceil((d.getTime() - nowTs) / (1000 * 60 * 60 * 24))\n                                const isPast = diff < 0\n                                return (\n                                    <div key={eq.id} className=\"flex items-center justify-between px-5 py-2.5\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <span className=\"font-mono text-xs font-medium text-brand-600\">{eq.code}</span>\r\n                                            <span className=\"text-sm text-surface-700\">{eq.brand} {eq.model}</span>\r\n                                            {eq.customer && <span className=\"text-xs text-surface-400\">• {eq.customer.name}</span>}\r\n                                        </div>\r\n                                        <span className={cn('rounded-full px-2.5 py-0.5 text-xs font-semibold',\r\n                                            isPast ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700')}>\r\n                                            {isPast ? `Vencido ${Math.abs(diff)}d` : `${diff}d restantes`}\r\n                                        </span>\r\n                                    </div>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\CrmPipelinePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":10,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":33,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[496,504],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Button"},"fix":{"range":[571,618],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CrmPipeline' is defined but never used.","line":16,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CrmPipeline"},"fix":{"range":[835,853],"text":""},"desc":"Remove unused variable \"CrmPipeline\"."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'deals' logical expression could make the dependencies of useMemo Hook (at line 59) change on every render. To fix this, wrap the initialization of 'deals' in its own useMemo() Hook.","line":46,"column":11,"nodeType":"VariableDeclarator","endLine":46,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4317,4320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4317,4320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { useParams, Link } from 'react-router-dom'\r\nimport {\r\n    DndContext, closestCorners, PointerSensor, useSensor, useSensors,\r\n    type DragEndEvent, type DragStartEvent, DragOverlay,\r\n} from '@dnd-kit/core'\r\nimport { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable'\r\nimport { useDroppable } from '@dnd-kit/core'\r\nimport { Plus, ArrowLeft, Filter, Loader2 } from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { DealCard } from '@/components/crm/DealCard'\r\nimport { DealDetailDrawer } from '@/components/crm/DealDetailDrawer'\r\nimport { NewDealModal } from '@/components/crm/NewDealModal'\r\nimport { crmApi, type CrmDeal, type CrmPipeline, type CrmPipelineStage } from '@/lib/crm-api'\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nexport function CrmPipelinePage() {\r\n    const { id: routeId } = useParams()\r\n    const queryClient = useQueryClient()\r\n    const [selectedDealId, setSelectedDealId] = useState<number | null>(null)\r\n    const [drawerOpen, setDrawerOpen] = useState(false)\r\n    const [newDealOpen, setNewDealOpen] = useState(false)\r\n    const [newDealStageId, setNewDealStageId] = useState<number | null>(null)\r\n    const [activeDeal, setActiveDeal] = useState<CrmDeal | null>(null)\r\n    const [statusFilter, setStatusFilter] = useState<string>('open')\r\n\r\n    // Fetch pipelines to find current pipeline\r\n    const { data: pipelines = [], isLoading: pipelinesLoading } = useQuery({\r\n        queryKey: ['crm', 'pipelines'],\r\n        queryFn: () => crmApi.getPipelines().then(r => r.data),\r\n    })\r\n\r\n    const pipelineId = routeId ? Number(routeId) : pipelines.find(p => p.is_default)?.id ?? pipelines[0]?.id\r\n    const pipeline = pipelines.find(p => p.id === pipelineId)\r\n\r\n    // Fetch deals for pipeline\r\n    const { data: dealsResponse, isLoading: dealsLoading } = useQuery({\r\n        queryKey: ['crm', 'deals', pipelineId, statusFilter],\r\n        queryFn: () => crmApi.getDeals({ pipeline_id: pipelineId, status: statusFilter, per_page: 200 }).then(r => r.data),\r\n        enabled: !!pipelineId,\r\n    })\r\n\r\n    const deals = dealsResponse?.data ?? []\r\n\r\n    // Group deals by stage\r\n    const dealsByStage = useMemo(() => {\r\n        const map = new Map<number, CrmDeal[]>()\r\n        if (pipeline) {\r\n            pipeline.stages.forEach(s => map.set(s.id, []))\r\n        }\r\n        deals.forEach(d => {\r\n            const list = map.get(d.stage_id)\r\n            if (list) list.push(d)\r\n        })\r\n        return map\r\n    }, [deals, pipeline])\r\n\r\n    // DnD\r\n    const sensors = useSensors(\r\n        useSensor(PointerSensor, { activationConstraint: { distance: 8 } })\r\n    )\r\n\r\n    const stageMutation = useMutation({\r\n        mutationFn: ({ dealId, stageId }: { dealId: number; stageId: number }) =>\r\n            crmApi.updateDealStage(dealId, stageId),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['crm'] })\r\n        },\r\n    })\r\n\r\n    const handleDragStart = (event: DragStartEvent) => {\r\n        const deal = event.active.data?.current?.deal as CrmDeal | undefined\r\n        setActiveDeal(deal ?? null)\r\n    }\r\n\r\n    const handleDragEnd = (event: DragEndEvent) => {\r\n        setActiveDeal(null)\r\n        const { active, over } = event\r\n        if (!over) return\r\n\r\n        const dealId = active.id as number\r\n        const deal = deals.find(d => d.id === dealId)\r\n        if (!deal) return\r\n\r\n        // The \"over\" could be a deal or a stage droppable\r\n        let targetStageId: number | null = null\r\n\r\n        // If dropped over a stage column\r\n        if (typeof over.id === 'string' && over.id.startsWith('stage-')) {\r\n            targetStageId = Number(over.id.replace('stage-', ''))\r\n        } else {\r\n            // Dropped over another deal — find its stage\r\n            const overDeal = deals.find(d => d.id === over.id)\r\n            if (overDeal) targetStageId = overDeal.stage_id\r\n        }\r\n\r\n        if (targetStageId && targetStageId !== deal.stage_id) {\r\n            // Optimistic update\r\n            queryClient.setQueryData(['crm', 'deals', pipelineId, statusFilter], (old: any) => {\r\n                if (!old?.data) return old\r\n                return {\r\n                    ...old,\r\n                    data: old.data.map((d: CrmDeal) =>\r\n                        d.id === dealId ? { ...d, stage_id: targetStageId! } : d\r\n                    ),\r\n                }\r\n            })\r\n            stageMutation.mutate({ dealId, stageId: targetStageId })\r\n        }\r\n    }\r\n\r\n    const openDealDetail = (dealId: number) => {\r\n        setSelectedDealId(dealId)\r\n        setDrawerOpen(true)\r\n    }\r\n\r\n    const openNewDeal = (stageId: number) => {\r\n        setNewDealStageId(stageId)\r\n        setNewDealOpen(true)\r\n    }\r\n\r\n    if (pipelinesLoading) {\r\n        return (\r\n            <div className=\"flex h-full items-center justify-center\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-brand-500\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex h-full flex-col -m-4 lg:-m-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between border-b border-surface-200 bg-white px-5 py-3\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Link to=\"/crm\" className=\"rounded-lg p-1.5 text-surface-400 hover:bg-surface-100 hover:text-surface-600 transition-colors\">\r\n                        <ArrowLeft className=\"h-5 w-5\" />\r\n                    </Link>\r\n                    <div>\r\n                        <h1 className=\"text-lg font-bold text-surface-900\">{pipeline?.name ?? 'Pipeline'}</h1>\r\n                        <p className=\"text-xs text-surface-500\">{deals.length} deal(s)</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    {/* Pipeline Tabs */}\r\n                    <div className=\"hidden sm:flex items-center gap-1 rounded-lg border border-surface-200 bg-surface-50 p-0.5\">\r\n                        {pipelines.map(p => (\r\n                            <Link\r\n                                key={p.id}\r\n                                to={`/crm/pipeline/${p.id}`}\r\n                                className={cn(\r\n                                    'rounded-md px-3 py-1.5 text-xs font-medium transition-colors',\r\n                                    p.id === pipelineId\r\n                                        ? 'bg-white text-surface-900 shadow-sm'\r\n                                        : 'text-surface-500 hover:text-surface-700'\r\n                                )}\r\n                            >\r\n                                {p.name}\r\n                            </Link>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Status filter */}\r\n                    <select\r\n                        value={statusFilter}\r\n                        onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-200 bg-white px-3 py-1.5 text-xs font-medium text-surface-700 focus:outline-none focus:ring-2 focus:ring-brand-500/30\"\r\n                    >\r\n                        <option value=\"open\">Abertos</option>\r\n                        <option value=\"won\">Ganhos</option>\r\n                        <option value=\"lost\">Perdidos</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Kanban Board */}\r\n            <div className=\"flex-1 overflow-x-auto\">\r\n                <DndContext\r\n                    sensors={sensors}\r\n                    collisionDetection={closestCorners}\r\n                    onDragStart={handleDragStart}\r\n                    onDragEnd={handleDragEnd}\r\n                >\r\n                    <div className=\"flex h-full gap-3 p-4\" style={{ minWidth: pipeline ? `${pipeline.stages.length * 280}px` : undefined }}>\r\n                        {pipeline?.stages.filter(s => !s.is_won && !s.is_lost).map(stage => (\r\n                            <KanbanColumn\r\n                                key={stage.id}\r\n                                stage={stage}\r\n                                deals={dealsByStage.get(stage.id) ?? []}\r\n                                isLoading={dealsLoading}\r\n                                onDealClick={openDealDetail}\r\n                                onAddDeal={() => openNewDeal(stage.id)}\r\n                            />\r\n                        ))}\r\n                        {/* Won / Lost columns (condensed) */}\r\n                        {pipeline?.stages.filter(s => s.is_won || s.is_lost).map(stage => (\r\n                            <KanbanColumn\r\n                                key={stage.id}\r\n                                stage={stage}\r\n                                deals={dealsByStage.get(stage.id) ?? []}\r\n                                isLoading={dealsLoading}\r\n                                onDealClick={openDealDetail}\r\n                                onAddDeal={() => openNewDeal(stage.id)}\r\n                                condensed\r\n                            />\r\n                        ))}\r\n                    </div>\r\n\r\n                    <DragOverlay>\r\n                        {activeDeal && <DealCard deal={activeDeal} />}\r\n                    </DragOverlay>\r\n                </DndContext>\r\n            </div>\r\n\r\n            {/* Drawers & Modals */}\r\n            <DealDetailDrawer\r\n                dealId={selectedDealId}\r\n                open={drawerOpen}\r\n                onClose={() => setDrawerOpen(false)}\r\n            />\r\n\r\n            {newDealOpen && pipeline && (\r\n                <NewDealModal\r\n                    open={newDealOpen}\r\n                    onClose={() => setNewDealOpen(false)}\r\n                    pipelineId={pipeline.id}\r\n                    stageId={newDealStageId!}\r\n                />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\n// ─── Kanban Column ──────────────────────────────────\r\n\r\ninterface KanbanColumnProps {\r\n    stage: CrmPipelineStage\r\n    deals: CrmDeal[]\r\n    isLoading: boolean\r\n    onDealClick: (id: number) => void\r\n    onAddDeal: () => void\r\n    condensed?: boolean\r\n}\r\n\r\nfunction KanbanColumn({ stage, deals, isLoading, onDealClick, onAddDeal, condensed }: KanbanColumnProps) {\r\n    const { setNodeRef, isOver } = useDroppable({ id: `stage-${stage.id}` })\r\n    const totalValue = deals.reduce((sum, d) => sum + Number(d.value), 0)\r\n\r\n    return (\r\n        <div\r\n            ref={setNodeRef}\r\n            className={cn(\r\n                'flex flex-col rounded-xl bg-surface-50/80 border border-surface-200/60 transition-colors',\r\n                condensed ? 'w-56 shrink-0' : 'w-72 shrink-0',\r\n                isOver && 'bg-brand-50/50 border-brand-200'\r\n            )}\r\n        >\r\n            {/* Column header */}\r\n            <div className=\"flex items-center justify-between px-3 py-2.5 border-b border-surface-200/60\">\r\n                <div className=\"flex items-center gap-2 min-w-0\">\r\n                    <span className=\"h-2.5 w-2.5 rounded-full shrink-0\" style={{ backgroundColor: stage.color || '#94a3b8' }} />\r\n                    <span className=\"text-xs font-semibold text-surface-700 truncate\">{stage.name}</span>\r\n                    <span className=\"rounded-full bg-surface-200 px-1.5 py-0.5 text-[10px] font-bold text-surface-600\">{deals.length}</span>\r\n                </div>\r\n                {!condensed && (\r\n                    <button\r\n                        onClick={onAddDeal}\r\n                        className=\"rounded p-0.5 text-surface-400 hover:bg-surface-200 hover:text-surface-600 transition-colors\"\r\n                    >\r\n                        <Plus className=\"h-4 w-4\" />\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Total value */}\r\n            {totalValue > 0 && (\r\n                <div className=\"px-3 py-1.5 text-[10px] font-medium text-surface-400\">\r\n                    {fmtBRL(totalValue)}\r\n                </div>\r\n            )}\r\n\r\n            {/* Cards */}\r\n            <div className=\"flex-1 overflow-y-auto p-2 space-y-2\">\r\n                <SortableContext items={deals.map(d => d.id)} strategy={verticalListSortingStrategy}>\r\n                    {isLoading ? (\r\n                        <div className=\"flex items-center justify-center py-4\">\r\n                            <Loader2 className=\"h-5 w-5 animate-spin text-surface-300\" />\r\n                        </div>\r\n                    ) : deals.length === 0 ? (\r\n                        <div className=\"rounded-lg border-2 border-dashed border-surface-200 py-6 text-center opacity-60\">\r\n                            <p className=\"text-xs text-surface-400\">Sem deals</p>\r\n                        </div>\r\n                    ) : (\r\n                        deals.map(deal => (\r\n                            <DealCard key={deal.id} deal={deal} onClick={() => onDealClick(deal.id)} />\r\n                        ))\r\n                    )}\r\n                </SortableContext>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\DashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[533,536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[533,536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":328,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20717,20720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20717,20720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":356,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22689,22692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22689,22692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18090,18093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18090,18093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\r\nimport {\r\n    FileText, DollarSign, TrendingUp,\r\n    Clock, CheckCircle2, Wallet, Receipt, AlertCircle, Scale, AlertTriangle, Package,\r\n} from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport { useAuthStore } from '@/stores/auth-store'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport api from '@/lib/api'\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any; color: string }> = {\r\n    pending: { label: 'Pendente', variant: 'warning', color: 'text-amber-600' },\r\n    in_progress: { label: 'Em Andamento', variant: 'info', color: 'text-sky-600' },\r\n    completed: { label: 'Concluída', variant: 'success', color: 'text-emerald-600' },\r\n    cancelled: { label: 'Cancelada', variant: 'danger', color: 'text-red-600' },\r\n}\r\n\r\nexport function DashboardPage() {\r\n    const { user } = useAuthStore()\r\n\r\n    const { data: statsRes, isLoading } = useQuery({\r\n        queryKey: ['dashboard-stats'],\r\n        queryFn: () => api.get('/dashboard-stats'),\r\n        refetchInterval: 60_000,\r\n    })\r\n\r\n    const s = statsRes?.data ?? {}\r\n\r\n    const cards = [\r\n        { label: 'OS Abertas', value: s.open_os ?? 0, icon: FileText, color: 'text-brand-600 bg-brand-50' },\r\n        { label: 'Em Andamento', value: s.in_progress_os ?? 0, icon: Clock, color: 'text-amber-600 bg-amber-50' },\r\n        { label: 'Concluídas (mês)', value: s.completed_month ?? 0, icon: CheckCircle2, color: 'text-emerald-600 bg-emerald-50' },\r\n        { label: 'Faturamento', value: fmtBRL(s.revenue_month ?? 0), icon: DollarSign, color: 'text-blue-600 bg-blue-50' },\r\n    ]\r\n\r\n    const cards2 = [\r\n        { label: 'Comissões Pendentes', value: fmtBRL(s.pending_commissions ?? 0), icon: Wallet, color: 'text-sky-600 bg-sky-50' },\r\n        { label: 'Despesas (mês)', value: fmtBRL(s.expenses_month ?? 0), icon: Receipt, color: 'text-red-600 bg-red-50' },\r\n        { label: 'Estoque Baixo', value: s.stock_low ?? 0, icon: Package, color: 'text-amber-600 bg-amber-50' },\r\n        { label: 'SLA Estourado', value: (s.sla_response_breached ?? 0) + (s.sla_resolution_breached ?? 0), icon: AlertTriangle, color: 'text-red-600 bg-red-50' },\r\n    ]\r\n\r\n    const recentOs = s.recent_os ?? []\r\n    const topTechs = s.top_technicians ?? []\r\n    const eqAlerts = s.eq_alerts ?? []\r\n    const eqOverdue = s.eq_overdue ?? 0\r\n    const eqDue7 = s.eq_due_7 ?? 0\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Dashboard</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">\r\n                    Olá, {user?.name ?? 'Usuário'}. Aqui está o resumo do dia.\r\n                </p>\r\n            </div>\r\n\r\n            {/* KPI Cards */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                {cards.map((stat) => (\r\n                    <div key={stat.label}\r\n                        className=\"group rounded-xl border border-surface-200 bg-white p-5 shadow-card transition-all duration-200 hover:shadow-elevated hover:-translate-y-0.5\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-xs font-medium text-surface-500 uppercase tracking-wider\">{stat.label}</p>\r\n                                <p className=\"mt-2 text-2xl font-bold text-surface-900\">{isLoading ? '…' : stat.value}</p>\r\n                            </div>\r\n                            <div className={cn('rounded-lg p-2.5', stat.color)}>\r\n                                <stat.icon className=\"h-5 w-5\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Financial cards */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                {cards2.map((stat) => (\r\n                    <div key={stat.label} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className={cn('rounded-lg p-2.5', stat.color)}>\r\n                                <stat.icon className=\"h-5 w-5\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-xs text-surface-500\">{stat.label}</p>\r\n                                <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : stat.value}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Charts Row */}\r\n            <div className=\"grid gap-4 lg:grid-cols-3\">\r\n                {/* Monthly Revenue Bar Chart */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <h3 className=\"text-sm font-semibold text-surface-900 mb-4\">Faturamento Mensal</h3>\r\n                    {(() => {\r\n                        const monthly: { month: string; total: number }[] = s.monthly_revenue ?? []\r\n                        const max = Math.max(...monthly.map(m => m.total), 1)\r\n                        return monthly.length > 0 ? (\r\n                            <div className=\"flex items-end gap-2 h-36\">\r\n                                {monthly.map((m, i) => (\r\n                                    <div key={i} className=\"flex-1 flex flex-col items-center gap-1\">\r\n                                        <span className=\"text-[10px] text-surface-400 font-medium\">\r\n                                            {fmtBRL(m.total).replace('R$\\u00a0', '')}\r\n                                        </span>\r\n                                        <div\r\n                                            className=\"w-full rounded-t-md bg-gradient-to-t from-brand-500 to-brand-400 transition-all duration-700\"\r\n                                            style={{ height: `${Math.max((m.total / max) * 100, 4)}%`, minHeight: 4 }}\r\n                                        />\r\n                                        <span className=\"text-[10px] text-surface-500\">{m.month}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <p className=\"text-center text-sm text-surface-400 py-8\">Sem dados</p>\r\n                        )\r\n                    })()}\r\n                </div>\r\n\r\n                {/* OS by Status Donut */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <h3 className=\"text-sm font-semibold text-surface-900 mb-4\">OS por Status</h3>\r\n                    {(() => {\r\n                        const data = [\r\n                            { key: 'open', label: 'Abertas', value: s.open_os ?? 0, color: '#3b82f6' },\r\n                            { key: 'in_progress', label: 'Em Andamento', value: s.in_progress_os ?? 0, color: '#f59e0b' },\r\n                            { key: 'completed', label: 'Concluídas', value: s.completed_month ?? 0, color: '#10b981' },\r\n                        ]\r\n                        const total = data.reduce((a, d) => a + d.value, 0) || 1\r\n                        let offset = 0\r\n                        return (\r\n                            <div className=\"flex items-center gap-6\">\r\n                                <svg viewBox=\"0 0 36 36\" className=\"h-28 w-28 flex-shrink-0\">\r\n                                    {data.map(d => {\r\n                                        const pct = (d.value / total) * 100\r\n                                        const dash = `${pct} ${100 - pct}`\r\n                                        const el = (\r\n                                            <circle key={d.key} cx=\"18\" cy=\"18\" r=\"15.9155\" fill=\"transparent\"\r\n                                                stroke={d.color} strokeWidth=\"3.5\"\r\n                                                strokeDasharray={dash} strokeDashoffset={-offset}\r\n                                                className=\"transition-all duration-700\" />\r\n                                        )\r\n                                        offset += pct\r\n                                        return el\r\n                                    })}\r\n                                    <text x=\"18\" y=\"19\" textAnchor=\"middle\" className=\"text-[5px] font-bold fill-surface-900\">\r\n                                        {total}\r\n                                    </text>\r\n                                    <text x=\"18\" y=\"23\" textAnchor=\"middle\" className=\"text-[3px] fill-surface-400\">\r\n                                        total\r\n                                    </text>\r\n                                </svg>\r\n                                <div className=\"space-y-2\">\r\n                                    {data.map(d => (\r\n                                        <div key={d.key} className=\"flex items-center gap-2\">\r\n                                            <div className=\"h-2.5 w-2.5 rounded-full\" style={{ backgroundColor: d.color }} />\r\n                                            <span className=\"text-xs text-surface-600\">{d.label}</span>\r\n                                            <span className=\"text-xs font-bold text-surface-900\">{d.value}</span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })()}\r\n                </div>\r\n\r\n                {/* Revenue vs Expenses */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <h3 className=\"text-sm font-semibold text-surface-900 mb-4\">Receita vs Despesa</h3>\r\n                    {(() => {\r\n                        const rev = s.revenue_month ?? 0\r\n                        const exp = s.expenses_month ?? 0\r\n                        const max = Math.max(rev, exp, 1)\r\n                        const profit = rev - exp\r\n                        return (\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-xs text-surface-500 w-16\">Receita</span>\r\n                                    <div className=\"flex-1 h-6 bg-surface-100 rounded-md overflow-hidden\">\r\n                                        <div className=\"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 rounded-md transition-all duration-700\"\r\n                                            style={{ width: `${(rev / max) * 100}%` }} />\r\n                                    </div>\r\n                                    <span className=\"text-xs font-bold text-emerald-600 w-24 text-right\">{fmtBRL(rev)}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-xs text-surface-500 w-16\">Despesa</span>\r\n                                    <div className=\"flex-1 h-6 bg-surface-100 rounded-md overflow-hidden\">\r\n                                        <div className=\"h-full bg-gradient-to-r from-red-500 to-red-400 rounded-md transition-all duration-700\"\r\n                                            style={{ width: `${(exp / max) * 100}%` }} />\r\n                                    </div>\r\n                                    <span className=\"text-xs font-bold text-red-600 w-24 text-right\">{fmtBRL(exp)}</span>\r\n                                </div>\r\n                                <div className=\"border-t border-surface-200 pt-3 flex items-center justify-between\">\r\n                                    <span className=\"text-xs font-medium text-surface-600\">Lucro Líquido</span>\r\n                                    <span className={cn('text-lg font-bold', profit >= 0 ? 'text-emerald-600' : 'text-red-600')}>\r\n                                        {fmtBRL(profit)}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })()}\r\n                </div>\r\n            </div>\r\n\r\n            {/* CRM Pipeline Widget */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                <h3 className=\"text-sm font-semibold text-surface-900 mb-4\">Pipeline CRM</h3>\r\n                <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\r\n                    {[\r\n                        { label: 'Deals Abertos', value: s.crm_open_deals ?? 0, color: 'bg-sky-500' },\r\n                        { label: 'Ganhos (mês)', value: s.crm_won_month ?? 0, color: 'bg-emerald-500' },\r\n                        { label: 'Receita CRM', value: fmtBRL(s.crm_revenue_month ?? 0), color: 'bg-brand-500' },\r\n                        { label: 'Follow-ups', value: s.crm_pending_followups ?? 0, color: 'bg-amber-500' },\r\n                    ].map((item, i) => (\r\n                        <div key={i} className=\"text-center\">\r\n                            <div className={cn('mx-auto h-1.5 w-full rounded-full mb-2', item.color, 'opacity-20')} style={{ position: 'relative' }}>\r\n                                <div className={cn('absolute inset-y-0 left-0 rounded-full', item.color)} style={{ width: `${Math.min(100, typeof item.value === 'number' ? Math.max(10, item.value * 5) : 60)}%` }} />\r\n                            </div>\r\n                            <p className=\"text-lg font-bold text-surface-900\">{item.value}</p>\r\n                            <p className=\"text-[10px] text-surface-400 font-medium\">{item.label}</p>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Financial + SLA cards */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"rounded-lg p-2.5 text-emerald-600 bg-emerald-50\"><TrendingUp className=\"h-5 w-5\" /></div>\r\n                        <div>\r\n                            <p className=\"text-xs text-surface-500\">A Receber (pendente)</p>\r\n                            <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : fmtBRL(s.receivables_pending ?? 0)}</p>\r\n                        </div>\r\n                    </div>\r\n                    {(s.receivables_overdue ?? 0) > 0 && (\r\n                        <p className=\"mt-2 text-xs font-semibold text-red-600\">⚠ {fmtBRL(s.receivables_overdue)} vencido</p>\r\n                    )}\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"rounded-lg p-2.5 text-red-600 bg-red-50\"><Receipt className=\"h-5 w-5\" /></div>\r\n                        <div>\r\n                            <p className=\"text-xs text-surface-500\">A Pagar (pendente)</p>\r\n                            <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : fmtBRL(s.payables_pending ?? 0)}</p>\r\n                        </div>\r\n                    </div>\r\n                    {(s.payables_overdue ?? 0) > 0 && (\r\n                        <p className=\"mt-2 text-xs font-semibold text-red-600\">⚠ {fmtBRL(s.payables_overdue)} vencido</p>\r\n                    )}\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"rounded-lg p-2.5 text-blue-600 bg-blue-50\"><Clock className=\"h-5 w-5\" /></div>\r\n                        <div>\r\n                            <p className=\"text-xs text-surface-500\">SLA — Tempo Médio OS</p>\r\n                            <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : `${s.avg_completion_hours ?? 0}h`}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Equipments Alerts Widget */}\r\n            {(eqOverdue > 0 || eqDue7 > 0 || eqAlerts.length > 0) && (\r\n                <div className=\"rounded-xl border border-amber-200 bg-amber-50/50 p-5 shadow-card\">\r\n                    <div className=\"flex items-center justify-between mb-3\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Scale size={18} className=\"text-amber-600\" />\r\n                            <h2 className=\"text-sm font-semibold text-surface-900\">Alertas de Calibração</h2>\r\n                        </div>\r\n                        <div className=\"flex gap-3 text-xs\">\r\n                            {eqOverdue > 0 && (\r\n                                <span className=\"flex items-center gap-1 rounded-full bg-red-100 px-2.5 py-0.5 font-semibold text-red-700\">\r\n                                    <AlertTriangle size={12} />{eqOverdue} vencido{eqOverdue > 1 ? 's' : ''}\r\n                                </span>\r\n                            )}\r\n                            {eqDue7 > 0 && (\r\n                                <span className=\"flex items-center gap-1 rounded-full bg-amber-100 px-2.5 py-0.5 font-semibold text-amber-700\">\r\n                                    <Clock size={12} />{eqDue7} vence em 7d\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        {/* eslint-disable-next-line @typescript-eslint/no-explicit-any */}\r\n                        {eqAlerts.map((eq: any) => {\r\n                            const d = new Date(eq.next_calibration_at)\r\n                            const now = new Date()\r\n                            const diff = Math.ceil((d.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))\r\n                            const isPast = diff < 0\r\n                            return (\r\n                                <div key={eq.id} className=\"flex items-center justify-between rounded-lg bg-white px-4 py-2.5\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <span className=\"font-mono text-xs font-medium text-brand-600\">{eq.code}</span>\r\n                                        <span className=\"text-sm text-surface-700\">{eq.brand} {eq.model}</span>\r\n                                        {eq.customer && <span className=\"text-xs text-surface-400\">• {eq.customer.name}</span>}\r\n                                    </div>\r\n                                    <span className={cn('rounded-full px-2.5 py-0.5 text-xs font-semibold',\r\n                                        isPast ? 'bg-red-100 text-red-700' : diff <= 7 ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'\r\n                                    )}>\r\n                                        {isPast ? `Vencido ${Math.abs(diff)}d` : `${diff}d restantes`}\r\n                                    </span>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"grid gap-4 lg:grid-cols-3\">\r\n                {/* Recent OS */}\r\n                <div className=\"lg:col-span-2 rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"flex items-center justify-between border-b border-surface-200 px-5 py-3\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Últimas Ordens de Serviço</h2>\r\n                    </div>\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Carregando...</p>\r\n                        ) : recentOs.length === 0 ? (\r\n                            <div className=\"py-12 text-center\">\r\n                                <AlertCircle className=\"mx-auto h-8 w-8 text-surface-300\" />\r\n                                <p className=\"mt-2 text-sm text-surface-400\">Nenhuma OS encontrada</p>\r\n                            </div>\r\n                        ) : recentOs.map((os: any) => (\r\n                            <div key={os.id} className=\"flex items-center justify-between px-5 py-3 hover:bg-surface-50 transition-colors\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-sm font-bold text-brand-600\">{os.number}</span>\r\n                                    <span className=\"text-sm text-surface-700 truncate max-w-[200px]\">{os.customer?.name}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-sm text-surface-500\">{os.assignee?.name}</span>\r\n                                    <Badge variant={statusConfig[os.status]?.variant ?? 'default'}>\r\n                                        {statusConfig[os.status]?.label ?? os.status}\r\n                                    </Badge>\r\n                                    <span className=\"text-sm font-semibold text-surface-900\">{fmtBRL(parseFloat(os.total ?? '0'))}</span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Top Technicians */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"border-b border-surface-200 px-5 py-3\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Top Técnicos (mês)</h2>\r\n                    </div>\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Carregando...</p>\r\n                        ) : topTechs.length === 0 ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Sem dados</p>\r\n                        ) : topTechs.map((t: any, i: number) => (\r\n                            <div key={t.assignee_id} className=\"flex items-center justify-between px-5 py-3\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className={cn('flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold',\r\n                                        i === 0 ? 'bg-amber-100 text-amber-700' : 'bg-surface-100 text-surface-600')}>\r\n                                        {i + 1}\r\n                                    </span>\r\n                                    <span className=\"text-sm font-medium text-surface-800\">{t.assignee?.name}</span>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <p className=\"text-sm font-bold text-surface-900\">{t.os_count} OS</p>\r\n                                    <p className=\"text-[10px] text-surface-400\">{fmtBRL(parseFloat(t.total_revenue ?? '0'))}</p>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\MessageTemplatesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\admin\\AuditLogPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\cadastros\\BatchExportPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\cadastros\\CustomerMergePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Input' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[319,364],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Card' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Card"},"fix":{"range":[375,380],"text":""},"desc":"Remove unused variable \"Card\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardHeader' is defined but never used.","line":8,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":26,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardHeader"},"fix":{"range":[379,391],"text":""},"desc":"Remove unused variable \"CardHeader\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardTitle' is defined but never used.","line":8,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardTitle"},"fix":{"range":[391,402],"text":""},"desc":"Remove unused variable \"CardTitle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardContent' is defined but never used.","line":8,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":50,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"CardContent"},"fix":{"range":[366,445],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Select' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Select"},"fix":{"range":[482,529],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'format' is defined but never used.","line":11,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"format"},"fix":{"range":[582,615],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'queryClient' is assigned a value but never used.","line":27,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":22}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Search, Merge, AlertTriangle, ArrowRight, Check } from 'lucide-react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/Card' // Assuming these exist or use div\r\nimport { Select } from '@/components/ui/Select' // Assuming exists\r\nimport { toast } from 'sonner'\r\nimport { format } from 'date-fns'\r\n\r\ninterface DuplicateGroup {\r\n    key: string\r\n    count: number\r\n    customers: {\r\n        id: number\r\n        name: string\r\n        document: string\r\n        email: string\r\n        created_at: string\r\n    }[]\r\n}\r\n\r\nexport function CustomerMergePage() {\r\n    const navigate = useNavigate()\r\n    const queryClient = useQueryClient()\r\n    const [searchType, setSearchType] = useState<'name' | 'document' | 'email'>('name')\r\n\r\n    // State for the merge process\r\n    const [selectedGroup, setSelectedGroup] = useState<DuplicateGroup | null>(null)\r\n    const [primaryId, setPrimaryId] = useState<number | null>(null)\r\n    const [selectedDuplicates, setSelectedDuplicates] = useState<number[]>([])\r\n\r\n    const { data: duplicates, isLoading, refetch } = useQuery({\r\n        queryKey: ['customer-duplicates', searchType],\r\n        queryFn: () => api.get('/customers/duplicates', { params: { type: searchType } }).then(res => res.data),\r\n    })\r\n\r\n    const mergeMutation = useMutation({\r\n        mutationFn: (data: { primary_id: number, duplicate_ids: number[] }) =>\r\n            api.post('/customers/merge', data),\r\n        onSuccess: (res) => {\r\n            toast.success(res.data.message)\r\n            setSelectedGroup(null)\r\n            setPrimaryId(null)\r\n            setSelectedDuplicates([])\r\n            refetch()\r\n        },\r\n        onError: () => {\r\n            toast.error('Erro ao realizar a fusão de clientes.')\r\n        }\r\n    })\r\n\r\n    const handleSelectGroup = (group: DuplicateGroup) => {\r\n        setSelectedGroup(group)\r\n        // Auto-select the oldest as primary by default\r\n        const sorted = [...group.customers].sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime())\r\n        setPrimaryId(sorted[0].id)\r\n        // Select all others as duplicates by default\r\n        setSelectedDuplicates(sorted.slice(1).map(c => c.id))\r\n    }\r\n\r\n    const handleMerge = () => {\r\n        if (!primaryId || selectedDuplicates.length === 0) return\r\n\r\n        if (confirm(`Tem certeza que deseja mesclar ${selectedDuplicates.length} clientes no cliente #${primaryId}? Esta ação não pode ser desfeita.`)) {\r\n            mergeMutation.mutate({\r\n                primary_id: primaryId,\r\n                duplicate_ids: selectedDuplicates\r\n            })\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Fusão de Clientes Duplicados</h1>\r\n                <Button variant=\"outline\" onClick={() => navigate('/cadastros/clientes')}>\r\n                    Voltar para Clientes\r\n                </Button>\r\n            </div>\r\n\r\n            <div className=\"bg-white p-4 rounded-lg shadow border border-surface-200\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <span className=\"text-sm font-medium text-surface-700\">Buscar duplicatas por:</span>\r\n                    <div className=\"flex gap-2\">\r\n                        <Button\r\n                            variant={searchType === 'name' ? 'default' : 'outline'}\r\n                            onClick={() => setSearchType('name')}\r\n                            size=\"sm\"\r\n                        >\r\n                            Nome\r\n                        </Button>\r\n                        <Button\r\n                            variant={searchType === 'document' ? 'default' : 'outline'}\r\n                            onClick={() => setSearchType('document')}\r\n                            size=\"sm\"\r\n                        >\r\n                            CPF/CNPJ\r\n                        </Button>\r\n                        <Button\r\n                            variant={searchType === 'email' ? 'default' : 'outline'}\r\n                            onClick={() => setSearchType('email')}\r\n                            size=\"sm\"\r\n                        >\r\n                            E-mail\r\n                        </Button>\r\n                    </div>\r\n                    <Button variant=\"ghost\" onClick={() => refetch()} className=\"ml-auto\">\r\n                        <Search className=\"h-4 w-4 mr-2\" />\r\n                        Atualizar Busca\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {isLoading ? (\r\n                <div className=\"text-center py-8\">Carregando duplicatas...</div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                    {/* List of Duplicate Groups */}\r\n                    <div className=\"lg:col-span-1 space-y-4\">\r\n                        <h2 className=\"font-semibold text-lg text-surface-800\">Grupos Encontrados ({duplicates?.length || 0})</h2>\r\n                        <div className=\"space-y-3\">\r\n                            {duplicates?.map((group: DuplicateGroup, idx: number) => (\r\n                                <div\r\n                                    key={idx}\r\n                                    onClick={() => handleSelectGroup(group)}\r\n                                    className={`p-4 rounded-lg border cursor-pointer transition-colors ${selectedGroup === group ? 'bg-brand-50 border-brand-500' : 'bg-white border-surface-200 hover:bg-surface-50'}`}\r\n                                >\r\n                                    <div className=\"flex justify-between items-start\">\r\n                                        <div>\r\n                                            <p className=\"font-medium text-surface-900\">{group.key || '(Vazio)'}</p>\r\n                                            <p className=\"text-sm text-surface-500\">{group.count} registros</p>\r\n                                        </div>\r\n                                        <ArrowRight className={`h-5 w-5 ${selectedGroup === group ? 'text-brand-600' : 'text-surface-300'}`} />\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                            {duplicates?.length === 0 && (\r\n                                <p className=\"text-surface-500 text-sm\">Nenhuma duplicata encontrada com este critério.</p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Merge Area */}\r\n                    <div className=\"lg:col-span-2\">\r\n                        {selectedGroup ? (\r\n                            <div className=\"bg-white rounded-lg shadow border border-surface-200 p-6 space-y-6\">\r\n                                <div>\r\n                                    <h2 className=\"text-lg font-bold text-surface-900 flex items-center\">\r\n                                        <Merge className=\"h-5 w-5 mr-2 text-brand-600\" />\r\n                                        Configurar Fusão\r\n                                    </h2>\r\n                                    <p className=\"text-sm text-surface-500 mt-1\">\r\n                                        Selecione qual será o cliente <strong>Principal</strong> (que receberá os dados) e quais serão <strong>Mesclados</strong> (serão arquivados).\r\n                                    </p>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    {selectedGroup.customers.map((cust) => (\r\n                                        <div key={cust.id} className={`flex items-center p-4 rounded-md border ${primaryId === cust.id ? 'border-success-500 bg-success-50' : selectedDuplicates.includes(cust.id) ? 'border-warning-300 bg-warning-50' : 'border-surface-200'}`}>\r\n                                            <div className=\"flex-1\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"font-bold text-surface-900\">{cust.name}</span>\r\n                                                    <span className=\"text-xs text-surface-500\">#{cust.id}</span>\r\n                                                </div>\r\n                                                <div className=\"text-sm text-surface-600 mt-1 space-x-3\">\r\n                                                    <span>{cust.document || 'Sem documento'}</span>\r\n                                                    <span>•</span>\r\n                                                    <span>{cust.email || 'Sem e-mail'}</span>\r\n                                                </div>\r\n                                                <div className=\"text-xs text-surface-400 mt-1\">\r\n                                                    Criado em: {new Date(cust.created_at).toLocaleDateString()}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Button\r\n                                                    size=\"sm\"\r\n                                                    variant={primaryId === cust.id ? 'success' : 'outline'}\r\n                                                    onClick={() => {\r\n                                                        setPrimaryId(cust.id)\r\n                                                        setSelectedDuplicates(selectedGroup.customers.filter(c => c.id !== cust.id).map(c => c.id))\r\n                                                    }}\r\n                                                >\r\n                                                    {primaryId === cust.id ? <Check className=\"h-4 w-4 mr-1\" /> : null}\r\n                                                    {primaryId === cust.id ? 'Principal' : 'Definir Principal'}\r\n                                                </Button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                <div className=\"bg-blue-50 p-4 rounded-md flex items-start\">\r\n                                    <AlertTriangle className=\"h-5 w-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0\" />\r\n                                    <div className=\"text-sm text-blue-800\">\r\n                                        <p className=\"font-medium\">O que acontece na fusão?</p>\r\n                                        <ul className=\"list-disc ml-4 mt-1 space-y-1\">\r\n                                            <li>Todos os contatos, OS, orçamentos, equipamentos e financeiro dos clientes duplicados serão movidos para o <strong>Principal</strong>.</li>\r\n                                            <li>As anotações serão concatenadas no histórico do Principal.</li>\r\n                                            <li>Os clientes duplicados serão movidos para a lixeira (Soft Delete).</li>\r\n                                        </ul>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex justify-end pt-4 border-t border-surface-200\">\r\n                                    <Button\r\n                                        variant=\"default\"\r\n                                        size=\"lg\"\r\n                                        onClick={handleMerge}\r\n                                        disabled={!primaryId || selectedDuplicates.length === 0 || mergeMutation.isPending}\r\n                                        className=\"bg-brand-600 hover:bg-brand-700\"\r\n                                    >\r\n                                        {mergeMutation.isPending ? 'Processando...' : 'Confirmar e Mesclar Clientes'}\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"h-full flex flex-col items-center justify-center text-surface-400 p-12 border-2 border-dashed border-surface-200 rounded-lg\">\r\n                                <Merge className=\"h-12 w-12 mb-4 opacity-20\" />\r\n                                <p>Selecione um grupo de duplicatas ao lado para iniciar a fusão.</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\cadastros\\CustomersPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[24,35],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronUp' is defined but never used.","line":5,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":54,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronUp"},"fix":{"range":[237,248],"text":""},"desc":"Remove unused variable \"ChevronUp\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n  Search, Plus, Pencil, Trash2, Phone, Mail, MapPin,\r\n  User as UserIcon, Building2, ChevronDown, ChevronUp,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\ninterface Customer {\r\n  id: number\r\n  type: 'PF' | 'PJ'\r\n  name: string\r\n  document: string | null\r\n  email: string | null\r\n  phone: string | null\r\n  phone2: string | null\r\n  address_city: string | null\r\n  address_state: string | null\r\n  is_active: boolean\r\n  contacts: Contact[]\r\n}\r\n\r\ninterface Contact {\r\n  id?: number\r\n  name: string\r\n  role: string\r\n  phone: string\r\n  email: string\r\n  is_primary: boolean\r\n}\r\n\r\nconst emptyForm = {\r\n  type: 'PF' as 'PF' | 'PJ',\r\n  name: '', document: '', email: '', phone: '', phone2: '',\r\n  address_zip: '', address_street: '', address_number: '',\r\n  address_complement: '', address_neighborhood: '',\r\n  address_city: '', address_state: '', notes: '',\r\n  is_active: true, contacts: [] as Contact[],\r\n}\r\n\r\nexport function CustomersPage() {\r\n  const qc = useQueryClient()\r\n  const [search, setSearch] = useState('')\r\n  const [showForm, setShowForm] = useState(false)\r\n  const [editing, setEditing] = useState<Customer | null>(null)\r\n  const [form, setForm] = useState(emptyForm)\r\n\r\n  const { data: res, isLoading } = useQuery({\r\n    queryKey: ['customers', search],\r\n    queryFn: () => api.get('/customers', { params: { search, per_page: 50 } }),\r\n  })\r\n  const customers: Customer[] = res?.data?.data ?? []\r\n\r\n  const saveMut = useMutation({\r\n    mutationFn: (data: typeof form) =>\r\n      editing ? api.put(`/customers/${editing.id}`, data) : api.post('/customers', data),\r\n    onSuccess: () => { qc.invalidateQueries({ queryKey: ['customers'] }); setShowForm(false) },\r\n  })\r\n\r\n  const delMut = useMutation({\r\n    mutationFn: (id: number) => api.delete(`/customers/${id}`),\r\n    onSuccess: () => qc.invalidateQueries({ queryKey: ['customers'] }),\r\n  })\r\n\r\n  const openCreate = () => { setEditing(null); setForm(emptyForm); setShowForm(true) }\r\n  const openEdit = (c: Customer) => {\r\n    setEditing(c)\r\n    setForm({\r\n      ...emptyForm,\r\n      type: c.type, name: c.name, document: c.document ?? '', email: c.email ?? '',\r\n      phone: c.phone ?? '', phone2: c.phone2 ?? '',\r\n      is_active: c.is_active, contacts: c.contacts ?? [],\r\n    })\r\n    setShowForm(true)\r\n  }\r\n\r\n  const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n    setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n  const addContact = () =>\r\n    set('contacts', [...form.contacts, { name: '', role: '', phone: '', email: '', is_primary: false }])\r\n\r\n  const updateContact = (i: number, field: keyof Contact, val: string | boolean) =>\r\n    set('contacts', form.contacts.map((c, idx) => idx === i ? { ...c, [field]: val } : c))\r\n\r\n  const removeContact = (i: number) =>\r\n    set('contacts', form.contacts.filter((_, idx) => idx !== i))\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-surface-900\">Clientes</h1>\r\n          <p className=\"mt-1 text-sm text-surface-500\">Cadastro de clientes PF e PJ</p>\r\n        </div>\r\n        <Button icon={<Plus className=\"h-4 w-4\" />} onClick={openCreate}>Novo Cliente</Button>\r\n      </div>\r\n\r\n      {/* Quick counters */}\r\n      {!isLoading && customers.length > 0 && (() => {\r\n        const pfCount = customers.filter(c => c.type === 'PF').length\r\n        const pjCount = customers.filter(c => c.type === 'PJ').length\r\n        const activeCount = customers.filter(c => c.is_active).length\r\n        const inactiveCount = customers.filter(c => !c.is_active).length\r\n        return (\r\n          <div className=\"grid grid-cols-2 gap-2 sm:grid-cols-4\">\r\n            <div className=\"flex items-center gap-3 rounded-xl border border-emerald-200 bg-emerald-50/50 p-3\">\r\n              <div className=\"rounded-lg bg-emerald-100 p-1.5\"><UserIcon className=\"h-4 w-4 text-emerald-600\" /></div>\r\n              <div><p className=\"text-lg font-bold text-emerald-700\">{pfCount}</p><p className=\"text-[10px] text-emerald-600\">Pessoa Física</p></div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3 rounded-xl border border-blue-200 bg-blue-50/50 p-3\">\r\n              <div className=\"rounded-lg bg-blue-100 p-1.5\"><Building2 className=\"h-4 w-4 text-blue-600\" /></div>\r\n              <div><p className=\"text-lg font-bold text-blue-700\">{pjCount}</p><p className=\"text-[10px] text-blue-600\">Pessoa Jurídica</p></div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3 rounded-xl border border-surface-200 bg-surface-50 p-3\">\r\n              <div><p className=\"text-lg font-bold text-surface-900\">{activeCount}</p><p className=\"text-[10px] text-surface-500\">Ativos</p></div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3 rounded-xl border border-surface-200 bg-surface-50 p-3\">\r\n              <div><p className=\"text-lg font-bold text-surface-400\">{inactiveCount}</p><p className=\"text-[10px] text-surface-500\">Inativos</p></div>\r\n            </div>\r\n          </div>\r\n        )\r\n      })()}\r\n\r\n      <div className=\"max-w-sm\">\r\n        <div className=\"relative\">\r\n          <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n          <input type=\"text\" value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)}\r\n            placeholder=\"Buscar nome, CPF/CNPJ, email...\"\r\n            className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n        <table className=\"w-full\">\r\n          <thead>\r\n            <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n              <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Cliente</th>\r\n              <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 md:table-cell\">Documento</th>\r\n              <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 lg:table-cell\">Contato</th>\r\n              <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 lg:table-cell\">Cidade</th>\r\n              <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Status</th>\r\n              <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Ações</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"divide-y divide-surface-100\">\r\n            {isLoading ? (\r\n              <tr><td colSpan={6} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n            ) : customers.length === 0 ? (\r\n              <tr><td colSpan={6} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum cliente encontrado</td></tr>\r\n            ) : customers.map(c => (\r\n              <tr key={c.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                <td className=\"px-4 py-3\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className={cn('flex h-9 w-9 items-center justify-center rounded-full text-xs font-bold',\r\n                      c.type === 'PJ' ? 'bg-blue-100 text-blue-700' : 'bg-emerald-100 text-emerald-700')}>\r\n                      {c.type === 'PJ' ? <Building2 className=\"h-4 w-4\" /> : <UserIcon className=\"h-4 w-4\" />}\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm font-medium text-surface-900\">{c.name}</p>\r\n                      <Badge variant={c.type === 'PJ' ? 'info' : 'success'} className=\"mt-0.5\">{c.type}</Badge>\r\n                    </div>\r\n                  </div>\r\n                </td>\r\n                <td className=\"hidden px-4 py-3 text-sm text-surface-600 md:table-cell\">{c.document || '—'}</td>\r\n                <td className=\"hidden px-4 py-3 lg:table-cell\">\r\n                  <div className=\"space-y-0.5 text-xs text-surface-600\">\r\n                    {c.phone && <span className=\"flex items-center gap-1\"><Phone className=\"h-3 w-3\" />{c.phone}</span>}\r\n                    {c.email && <span className=\"flex items-center gap-1\"><Mail className=\"h-3 w-3\" />{c.email}</span>}\r\n                  </div>\r\n                </td>\r\n                <td className=\"hidden px-4 py-3 text-sm text-surface-600 lg:table-cell\">\r\n                  {c.address_city ? `${c.address_city}/${c.address_state}` : '—'}\r\n                </td>\r\n                <td className=\"px-4 py-3\">\r\n                  <Badge variant={c.is_active ? 'success' : 'danger'} dot>{c.is_active ? 'Ativo' : 'Inativo'}</Badge>\r\n                </td>\r\n                <td className=\"px-4 py-3\">\r\n                  <div className=\"flex items-center justify-end gap-1\">\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => openEdit(c)}><Pencil className=\"h-4 w-4\" /></Button>\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delMut.mutate(c.id) }}>\r\n                      <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                    </Button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Form Modal */}\r\n      <Modal open={showForm} onOpenChange={setShowForm} title={editing ? 'Editar Cliente' : 'Novo Cliente'} size=\"xl\">\r\n        <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"max-h-[70vh] overflow-y-auto space-y-4 pr-1\">\r\n          {/* Tipo */}\r\n          <div className=\"flex gap-2\">\r\n            {(['PF', 'PJ'] as const).map(t => (\r\n              <button key={t} type=\"button\" onClick={() => set('type', t)}\r\n                className={cn('flex-1 rounded-lg border py-2 text-sm font-medium transition-all',\r\n                  form.type === t ? 'border-brand-500 bg-brand-50 text-brand-700' : 'border-surface-300 text-surface-600 hover:border-surface-400')}>\r\n                {t === 'PF' ? 'Pessoa Física' : 'Pessoa Jurídica'}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"grid gap-4 sm:grid-cols-2\">\r\n            <Input label=\"Nome\" value={form.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('name', e.target.value)} required />\r\n            <Input label={form.type === 'PJ' ? 'CNPJ' : 'CPF'} value={form.document} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('document', e.target.value)} />\r\n            <Input label=\"E-mail\" type=\"email\" value={form.email} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('email', e.target.value)} />\r\n            <Input label=\"Telefone\" value={form.phone} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('phone', e.target.value)} />\r\n          </div>\r\n\r\n          {/* Endereço */}\r\n          <details className=\"group\">\r\n            <summary className=\"cursor-pointer text-sm font-medium text-surface-700 flex items-center gap-1\">\r\n              <MapPin className=\"h-4 w-4\" /> Endereço\r\n              <ChevronDown className=\"h-3 w-3 transition-transform group-open:rotate-180\" />\r\n            </summary>\r\n            <div className=\"mt-3 grid gap-3 sm:grid-cols-3\">\r\n              <Input label=\"CEP\" value={form.address_zip} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address_zip', e.target.value)} />\r\n              <div className=\"sm:col-span-2\">\r\n                <Input label=\"Rua\" value={form.address_street} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address_street', e.target.value)} />\r\n              </div>\r\n              <Input label=\"Número\" value={form.address_number} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address_number', e.target.value)} />\r\n              <Input label=\"Complemento\" value={form.address_complement} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address_complement', e.target.value)} />\r\n              <Input label=\"Bairro\" value={form.address_neighborhood} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address_neighborhood', e.target.value)} />\r\n              <Input label=\"Cidade\" value={form.address_city} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address_city', e.target.value)} />\r\n              <Input label=\"UF\" value={form.address_state} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address_state', e.target.value)} maxLength={2} />\r\n            </div>\r\n          </details>\r\n\r\n          {/* Contatos */}\r\n          <div>\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <span className=\"text-sm font-medium text-surface-700\">Contatos</span>\r\n              <Button variant=\"ghost\" size=\"sm\" type=\"button\" onClick={addContact}><Plus className=\"h-4 w-4\" /> Adicionar</Button>\r\n            </div>\r\n            {form.contacts.map((ct, i) => (\r\n              <div key={i} className=\"mb-2 grid gap-2 rounded-lg border border-surface-200 p-3 sm:grid-cols-4\">\r\n                <Input placeholder=\"Nome\" value={ct.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateContact(i, 'name', e.target.value)} />\r\n                <Input placeholder=\"Cargo\" value={ct.role} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateContact(i, 'role', e.target.value)} />\r\n                <Input placeholder=\"Telefone\" value={ct.phone} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateContact(i, 'phone', e.target.value)} />\r\n                <div className=\"flex items-end gap-2\">\r\n                  <Input placeholder=\"E-mail\" value={ct.email} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateContact(i, 'email', e.target.value)} className=\"flex-1\" />\r\n                  <Button variant=\"ghost\" size=\"sm\" type=\"button\" onClick={() => removeContact(i)}>\r\n                    <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-end gap-3 border-t border-surface-200 pt-4\">\r\n            <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n            <Button type=\"submit\" loading={saveMut.isPending}>{editing ? 'Salvar' : 'Criar Cliente'}</Button>\r\n          </div>\r\n        </form>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\cadastros\\PriceHistoryPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Search' is defined but never used.","line":3,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":49,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[124,132],"text":""},"desc":"Remove unused variable \"Search\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":3,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[132,140],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowUpDown' is defined but never used.","line":3,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":70,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ArrowUpDown"},"fix":{"range":[140,153],"text":""},"desc":"Remove unused variable \"ArrowUpDown\"."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\r\nimport { useState } from 'react'\r\nimport { TrendingUp, TrendingDown, Minus, Search, Filter, ArrowUpDown } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { format } from 'date-fns'\r\nimport { ptBR } from 'date-fns/locale'\r\nimport { formatCurrency } from '@/lib/utils'\r\n\r\ninterface PriceHistoryEntry {\r\n    id: number\r\n    priceable_type: string\r\n    priceable_id: number\r\n    old_cost_price: string | null\r\n    new_cost_price: string | null\r\n    old_sell_price: string | null\r\n    new_sell_price: string | null\r\n    change_percent: string | null\r\n    reason: string | null\r\n    changed_by_user: { id: number; name: string } | null\r\n    created_at: string\r\n}\r\n\r\nexport function PriceHistoryPage() {\r\n    const [dateFrom, setDateFrom] = useState('')\r\n    const [dateTo, setDateTo] = useState('')\r\n    const [entityType, setEntityType] = useState<string>('all')\r\n\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['price-history', entityType, dateFrom, dateTo],\r\n        queryFn: () => {\r\n            const params: Record<string, string> = {}\r\n            if (entityType === 'product') params.priceable_type = 'App\\\\Models\\\\Product'\r\n            if (entityType === 'service') params.priceable_type = 'App\\\\Models\\\\Service'\r\n            if (dateFrom) params.date_from = dateFrom\r\n            if (dateTo) params.date_to = dateTo\r\n            return api.get('/price-history', { params }).then(res => res.data)\r\n        },\r\n    })\r\n\r\n    const entries: PriceHistoryEntry[] = data?.data || []\r\n\r\n    const getEntityLabel = (type: string) => {\r\n        if (type.includes('Product')) return 'Produto'\r\n        if (type.includes('Service')) return 'Serviço'\r\n        return type\r\n    }\r\n\r\n    const getChangeIcon = (percent: string | null) => {\r\n        if (!percent) return <Minus className=\"h-4 w-4 text-surface-400\" />\r\n        const val = parseFloat(percent)\r\n        if (val > 0) return <TrendingUp className=\"h-4 w-4 text-red-500\" />\r\n        if (val < 0) return <TrendingDown className=\"h-4 w-4 text-green-500\" />\r\n        return <Minus className=\"h-4 w-4 text-surface-400\" />\r\n    }\r\n\r\n    const getChangeBadge = (percent: string | null) => {\r\n        if (!percent) return null\r\n        const val = parseFloat(percent)\r\n        if (val > 0) return <Badge variant=\"danger\">+{val}%</Badge>\r\n        if (val < 0) return <Badge variant=\"success\">{val}%</Badge>\r\n        return <Badge variant=\"default\">0%</Badge>\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Histórico de Preços</h1>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"bg-white p-4 rounded-lg shadow border border-surface-200\">\r\n                <div className=\"flex flex-wrap items-center gap-4\">\r\n                    <div className=\"flex gap-2\">\r\n                        <Button\r\n                            variant={entityType === 'all' ? 'default' : 'outline'}\r\n                            onClick={() => setEntityType('all')}\r\n                            size=\"sm\"\r\n                        >\r\n                            Tudo\r\n                        </Button>\r\n                        <Button\r\n                            variant={entityType === 'product' ? 'default' : 'outline'}\r\n                            onClick={() => setEntityType('product')}\r\n                            size=\"sm\"\r\n                        >\r\n                            Produtos\r\n                        </Button>\r\n                        <Button\r\n                            variant={entityType === 'service' ? 'default' : 'outline'}\r\n                            onClick={() => setEntityType('service')}\r\n                            size=\"sm\"\r\n                        >\r\n                            Serviços\r\n                        </Button>\r\n                    </div>\r\n                    <div className=\"flex gap-2 items-center ml-auto\">\r\n                        <Input\r\n                            type=\"date\"\r\n                            value={dateFrom}\r\n                            onChange={e => setDateFrom(e.target.value)}\r\n                            className=\"w-40\"\r\n                        />\r\n                        <span className=\"text-surface-400\">até</span>\r\n                        <Input\r\n                            type=\"date\"\r\n                            value={dateTo}\r\n                            onChange={e => setDateTo(e.target.value)}\r\n                            className=\"w-40\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"bg-white shadow overflow-hidden sm:rounded-lg border border-surface-200\">\r\n                <table className=\"min-w-full divide-y divide-surface-200\">\r\n                    <thead className=\"bg-surface-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-surface-500 uppercase tracking-wider\">Data</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-surface-500 uppercase tracking-wider\">Tipo</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-surface-500 uppercase tracking-wider\">Item #</th>\r\n                            <th className=\"px-6 py-3 text-right text-xs font-medium text-surface-500 uppercase tracking-wider\">Custo Anterior</th>\r\n                            <th className=\"px-6 py-3 text-right text-xs font-medium text-surface-500 uppercase tracking-wider\">Custo Novo</th>\r\n                            <th className=\"px-6 py-3 text-right text-xs font-medium text-surface-500 uppercase tracking-wider\">Venda Anterior</th>\r\n                            <th className=\"px-6 py-3 text-right text-xs font-medium text-surface-500 uppercase tracking-wider\">Venda Nova</th>\r\n                            <th className=\"px-6 py-3 text-center text-xs font-medium text-surface-500 uppercase tracking-wider\">Variação</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-surface-500 uppercase tracking-wider\">Alterado por</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-surface-200\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={9} className=\"px-6 py-8 text-center text-surface-500\">Carregando...</td></tr>\r\n                        ) : entries.length === 0 ? (\r\n                            <tr><td colSpan={9} className=\"px-6 py-8 text-center text-surface-500\">Nenhum registro de alteração de preço encontrado.</td></tr>\r\n                        ) : entries.map(entry => (\r\n                            <tr key={entry.id} className=\"hover:bg-surface-50\">\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-surface-900\">\r\n                                    {format(new Date(entry.created_at), 'dd/MM/yyyy HH:mm', { locale: ptBR })}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                    <Badge variant={entry.priceable_type.includes('Product') ? 'primary' : 'secondary'}>\r\n                                        {getEntityLabel(entry.priceable_type)}\r\n                                    </Badge>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-surface-600\">\r\n                                    #{entry.priceable_id}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-right text-surface-600\">\r\n                                    {entry.old_cost_price ? formatCurrency(Number(entry.old_cost_price)) : '—'}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-surface-900\">\r\n                                    {entry.new_cost_price ? formatCurrency(Number(entry.new_cost_price)) : '—'}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-right text-surface-600\">\r\n                                    {entry.old_sell_price ? formatCurrency(Number(entry.old_sell_price)) : '—'}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-surface-900\">\r\n                                    {entry.new_sell_price ? formatCurrency(Number(entry.new_sell_price)) : '—'}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-center\">\r\n                                    <div className=\"flex items-center justify-center gap-1\">\r\n                                        {getChangeIcon(entry.change_percent)}\r\n                                        {getChangeBadge(entry.change_percent)}\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-surface-600\">\r\n                                    {entry.changed_by_user?.name || 'Sistema'}\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\cadastros\\ProductsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10077,10080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10077,10080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Search, Plus, Pencil, Trash2, Package, AlertTriangle } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\ninterface Product {\r\n    id: number; code: string | null; name: string; description: string | null\r\n    unit: string; cost_price: string; sell_price: string\r\n    stock_qty: string; stock_min: string; is_active: boolean\r\n    category: { id: number; name: string } | null\r\n}\r\n\r\nconst emptyForm = {\r\n    category_id: '' as string | number, code: '', name: '', description: '',\r\n    unit: 'UN', cost_price: '0', sell_price: '0',\r\n    stock_qty: '0', stock_min: '0', is_active: true,\r\n}\r\n\r\nexport function ProductsPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editing, setEditing] = useState<Product | null>(null)\r\n    const [form, setForm] = useState(emptyForm)\r\n    const [newCat, setNewCat] = useState('')\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['products', search],\r\n        queryFn: () => api.get('/products', { params: { search, per_page: 50 } }),\r\n    })\r\n    const products: Product[] = res?.data?.data ?? []\r\n\r\n    const { data: catsRes } = useQuery({\r\n        queryKey: ['product-categories'],\r\n        queryFn: () => api.get('/product-categories'),\r\n    })\r\n    const categories = catsRes?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) =>\r\n            editing ? api.put(`/products/${editing.id}`, data) : api.post('/products', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['products'] }); setShowForm(false) },\r\n    })\r\n\r\n    const delMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/products/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['products'] }),\r\n    })\r\n\r\n    const catMut = useMutation({\r\n        mutationFn: (name: string) => api.post('/product-categories', { name }),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['product-categories'] }); setNewCat('') },\r\n    })\r\n\r\n    const openCreate = () => { setEditing(null); setForm(emptyForm); setShowForm(true) }\r\n    const openEdit = (p: Product) => {\r\n        setEditing(p)\r\n        setForm({\r\n            category_id: p.category?.id ?? '', code: p.code ?? '', name: p.name,\r\n            description: p.description ?? '', unit: p.unit,\r\n            cost_price: p.cost_price, sell_price: p.sell_price,\r\n            stock_qty: p.stock_qty, stock_min: p.stock_min, is_active: p.is_active,\r\n        })\r\n        setShowForm(true)\r\n    }\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n        setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n    const isLowStock = (p: Product) => parseFloat(p.stock_qty) <= parseFloat(p.stock_min)\r\n\r\n    const formatBRL = (v: string) => parseFloat(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Produtos</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Catálogo de produtos e peças</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={openCreate}>Novo Produto</Button>\r\n            </div>\r\n\r\n            <div className=\"max-w-sm\">\r\n                <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input type=\"text\" value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)}\r\n                        placeholder=\"Buscar por nome ou código...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Produto</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 md:table-cell\">Categoria</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Preço</th>\r\n                            <th className=\"hidden px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600 lg:table-cell\">Estoque</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : products.length === 0 ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum produto encontrado</td></tr>\r\n                        ) : products.map(p => (\r\n                            <tr key={p.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"flex h-9 w-9 items-center justify-center rounded-lg bg-brand-50\">\r\n                                            <Package className=\"h-4 w-4 text-brand-600\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <p className=\"text-sm font-medium text-surface-900\">{p.name}</p>\r\n                                            {p.code && <p className=\"text-xs text-surface-400\">#{p.code}</p>}\r\n                                        </div>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"hidden px-4 py-3 md:table-cell\">\r\n                                    {p.category ? <Badge variant=\"brand\">{p.category.name}</Badge> : <span className=\"text-xs text-surface-400\">—</span>}\r\n                                </td>\r\n                                <td className=\"px-4 py-3 text-right text-sm font-medium text-surface-900\">{formatBRL(p.sell_price)}</td>\r\n                                <td className=\"hidden px-4 py-3 text-right lg:table-cell\">\r\n                                    <div className=\"flex items-center justify-end gap-1.5\">\r\n                                        {isLowStock(p) && <AlertTriangle className=\"h-3.5 w-3.5 text-amber-500\" />}\r\n                                        <span className={cn('text-sm font-medium', isLowStock(p) ? 'text-amber-600' : 'text-surface-700')}>\r\n                                            {parseFloat(p.stock_qty)} {p.unit}\r\n                                        </span>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center justify-end gap-1\">\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => openEdit(p)}><Pencil className=\"h-4 w-4\" /></Button>\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delMut.mutate(p.id) }}>\r\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Form */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title={editing ? 'Editar Produto' : 'Novo Produto'} size=\"lg\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Nome\" value={form.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('name', e.target.value)} required />\r\n                        <Input label=\"Código\" value={form.code} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('code', e.target.value)} placeholder=\"Opcional\" />\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Categoria</label>\r\n                            <select value={form.category_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('category_id', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Sem categoria</option>\r\n                                {categories.map((c: any) => <option key={c.id} value={c.id}>{c.name}</option>)}\r\n                            </select>\r\n                            <div className=\"mt-1.5 flex gap-1\">\r\n                                <input value={newCat} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewCat(e.target.value)} placeholder=\"Nova categoria\"\r\n                                    className=\"flex-1 rounded-md border border-surface-200 px-2 py-1 text-xs\" />\r\n                                <Button variant=\"ghost\" size=\"sm\" type=\"button\" disabled={!newCat}\r\n                                    onClick={() => catMut.mutate(newCat)}>+</Button>\r\n                            </div>\r\n                        </div>\r\n                        <Input label=\"Unidade\" value={form.unit} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('unit', e.target.value)} placeholder=\"UN, CX, KG...\" />\r\n                        <div /> {/* spacer */}\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                        <Input label=\"Preço Custo (R$)\" type=\"number\" step=\"0.01\" value={form.cost_price} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('cost_price', e.target.value)} />\r\n                        <Input label=\"Preço Venda (R$)\" type=\"number\" step=\"0.01\" value={form.sell_price} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('sell_price', e.target.value)} />\r\n                        <Input label=\"Estoque\" type=\"number\" step=\"0.01\" value={form.stock_qty} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('stock_qty', e.target.value)} />\r\n                        <Input label=\"Estoque Mín.\" type=\"number\" step=\"0.01\" value={form.stock_min} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('stock_min', e.target.value)} />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Descrição</label>\r\n                        <textarea value={form.description} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('description', e.target.value)} rows={2}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex items-center justify-end gap-3 border-t border-surface-200 pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>{editing ? 'Salvar' : 'Criar'}</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\cadastros\\ServicesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[221,253],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9871,9874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9871,9874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Search, Plus, Pencil, Trash2, Briefcase, Clock } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\ninterface Service {\r\n    id: number; code: string | null; name: string; description: string | null\r\n    default_price: string; estimated_minutes: number | null; is_active: boolean\r\n    category: { id: number; name: string } | null\r\n}\r\n\r\nconst emptyForm = {\r\n    category_id: '' as string | number, code: '', name: '', description: '',\r\n    default_price: '0', estimated_minutes: '' as string | number, is_active: true,\r\n}\r\n\r\nexport function ServicesPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editing, setEditing] = useState<Service | null>(null)\r\n    const [form, setForm] = useState(emptyForm)\r\n    const [newCat, setNewCat] = useState('')\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['services', search],\r\n        queryFn: () => api.get('/services', { params: { search, per_page: 50 } }),\r\n    })\r\n    const services: Service[] = res?.data?.data ?? []\r\n\r\n    const { data: catsRes } = useQuery({\r\n        queryKey: ['service-categories'],\r\n        queryFn: () => api.get('/service-categories'),\r\n    })\r\n    const categories = catsRes?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) =>\r\n            editing ? api.put(`/services/${editing.id}`, data) : api.post('/services', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['services'] }); setShowForm(false) },\r\n    })\r\n\r\n    const delMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/services/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['services'] }),\r\n    })\r\n\r\n    const catMut = useMutation({\r\n        mutationFn: (name: string) => api.post('/service-categories', { name }),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['service-categories'] }); setNewCat('') },\r\n    })\r\n\r\n    const openCreate = () => { setEditing(null); setForm(emptyForm); setShowForm(true) }\r\n    const openEdit = (s: Service) => {\r\n        setEditing(s)\r\n        setForm({\r\n            category_id: s.category?.id ?? '', code: s.code ?? '', name: s.name,\r\n            description: s.description ?? '', default_price: s.default_price,\r\n            estimated_minutes: s.estimated_minutes ?? '', is_active: s.is_active,\r\n        })\r\n        setShowForm(true)\r\n    }\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n        setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n    const formatBRL = (v: string) => parseFloat(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n    const formatTime = (m: number | null) => {\r\n        if (!m) return '—'\r\n        const h = Math.floor(m / 60)\r\n        const min = m % 60\r\n        return h > 0 ? `${h}h${min > 0 ? min.toString().padStart(2, '0') : ''}` : `${min}min`\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Serviços</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Catálogo de serviços prestados</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={openCreate}>Novo Serviço</Button>\r\n            </div>\r\n\r\n            <div className=\"max-w-sm\">\r\n                <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input type=\"text\" value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)}\r\n                        placeholder=\"Buscar por nome ou código...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Serviço</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 md:table-cell\">Categoria</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Preço</th>\r\n                            <th className=\"hidden px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600 lg:table-cell\">Tempo</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : services.length === 0 ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum serviço encontrado</td></tr>\r\n                        ) : services.map(s => (\r\n                            <tr key={s.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"flex h-9 w-9 items-center justify-center rounded-lg bg-emerald-50\">\r\n                                            <Briefcase className=\"h-4 w-4 text-emerald-600\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <p className=\"text-sm font-medium text-surface-900\">{s.name}</p>\r\n                                            {s.code && <p className=\"text-xs text-surface-400\">#{s.code}</p>}\r\n                                        </div>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"hidden px-4 py-3 md:table-cell\">\r\n                                    {s.category ? <Badge variant=\"success\">{s.category.name}</Badge> : <span className=\"text-xs text-surface-400\">—</span>}\r\n                                </td>\r\n                                <td className=\"px-4 py-3 text-right text-sm font-medium text-surface-900\">{formatBRL(s.default_price)}</td>\r\n                                <td className=\"hidden px-4 py-3 text-right lg:table-cell\">\r\n                                    <span className=\"flex items-center justify-end gap-1 text-sm text-surface-600\">\r\n                                        <Clock className=\"h-3.5 w-3.5\" /> {formatTime(s.estimated_minutes)}\r\n                                    </span>\r\n                                </td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center justify-end gap-1\">\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => openEdit(s)}><Pencil className=\"h-4 w-4\" /></Button>\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delMut.mutate(s.id) }}>\r\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Form */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title={editing ? 'Editar Serviço' : 'Novo Serviço'} size=\"lg\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Nome\" value={form.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('name', e.target.value)} required />\r\n                        <Input label=\"Código\" value={form.code} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('code', e.target.value)} placeholder=\"Opcional\" />\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Categoria</label>\r\n                            <select value={form.category_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('category_id', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Sem categoria</option>\r\n                                {categories.map((c: any) => <option key={c.id} value={c.id}>{c.name}</option>)}\r\n                            </select>\r\n                            <div className=\"mt-1.5 flex gap-1\">\r\n                                <input value={newCat} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewCat(e.target.value)} placeholder=\"Nova categoria\"\r\n                                    className=\"flex-1 rounded-md border border-surface-200 px-2 py-1 text-xs\" />\r\n                                <Button variant=\"ghost\" size=\"sm\" type=\"button\" disabled={!newCat}\r\n                                    onClick={() => catMut.mutate(newCat)}>+</Button>\r\n                            </div>\r\n                        </div>\r\n                        <Input label=\"Preço Padrão (R$)\" type=\"number\" step=\"0.01\" value={form.default_price} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('default_price', e.target.value)} />\r\n                        <Input label=\"Tempo Estimado (min)\" type=\"number\" value={form.estimated_minutes} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('estimated_minutes', e.target.value)} placeholder=\"Ex: 60\" />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Descrição</label>\r\n                        <textarea value={form.description} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('description', e.target.value)} rows={2}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex items-center justify-end gap-3 border-t border-surface-200 pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>{editing ? 'Salvar' : 'Criar'}</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\cadastros\\SuppliersPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\central\\CentralDashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BarChart3' is defined but never used.","line":4,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BarChart3"},"fix":{"range":[91,101],"text":""},"desc":"Remove unused variable \"BarChart3\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[455,458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[455,458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1562,1565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1562,1565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1850,1853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1850,1853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5968,5971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5968,5971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8863,8866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8863,8866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport {\r\n    BarChart3, Users, AlertTriangle, TrendingUp, Clock,\r\n    CheckCircle, Inbox, Target, ArrowRight, Wrench,\r\n    Phone, FileText, DollarSign, Scale, Percent,\r\n} from 'lucide-react'\r\nimport { Link } from 'react-router-dom'\r\nimport api from '@/lib/api'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\n// ── Configuração de tipos ──\r\n\r\nconst tipoIcons: Record<string, any> = {\r\n    os: Wrench, chamado: Phone, orcamento: FileText,\r\n    financeiro: DollarSign, calibracao: Scale,\r\n    contrato: FileText, tarefa: CheckCircle, lembrete: Clock,\r\n}\r\n\r\nconst tipoColors: Record<string, string> = {\r\n    os: 'text-blue-600 bg-blue-50',\r\n    chamado: 'text-cyan-600 bg-cyan-50',\r\n    orcamento: 'text-amber-600 bg-amber-50',\r\n    financeiro: 'text-emerald-600 bg-emerald-50',\r\n    calibracao: 'text-indigo-600 bg-indigo-50',\r\n    contrato: 'text-rose-600 bg-rose-50',\r\n    tarefa: 'text-surface-600 bg-surface-50',\r\n    lembrete: 'text-surface-500 bg-surface-50',\r\n}\r\n\r\nexport function CentralDashboardPage() {\r\n    const { data: kpisRes, isLoading: loadingKpis } = useQuery({\r\n        queryKey: ['central-kpis'],\r\n        queryFn: () => api.get('/central/kpis'),\r\n        refetchInterval: 60000,\r\n    })\r\n    const kpis = kpisRes?.data?.data ?? {}\r\n\r\n    const { data: workloadRes, isLoading: loadingWorkload } = useQuery({\r\n        queryKey: ['central-workload'],\r\n        queryFn: () => api.get('/central/workload'),\r\n        refetchInterval: 60000,\r\n    })\r\n    const workload: any[] = workloadRes?.data?.data ?? []\r\n\r\n    const { data: overdueRes, isLoading: loadingOverdue } = useQuery({\r\n        queryKey: ['central-overdue-by-team'],\r\n        queryFn: () => api.get('/central/overdue-by-team'),\r\n        refetchInterval: 60000,\r\n    })\r\n    const overdueByTeam: any[] = overdueRes?.data?.data ?? []\r\n\r\n    const isLoading = loadingKpis || loadingWorkload || loadingOverdue\r\n\r\n    // ── KPI Cards config ──\r\n    const kpiCards = [\r\n        { label: 'Total', value: kpis.total ?? 0, icon: Inbox, color: 'text-surface-700', bg: 'bg-surface-100' },\r\n        { label: 'Abertas', value: kpis.abertas ?? 0, icon: Target, color: 'text-blue-600', bg: 'bg-blue-50' },\r\n        { label: 'Em Andamento', value: kpis.em_andamento ?? 0, icon: TrendingUp, color: 'text-amber-600', bg: 'bg-amber-50' },\r\n        { label: 'Concluídas', value: kpis.concluidas ?? 0, icon: CheckCircle, color: 'text-emerald-600', bg: 'bg-emerald-50' },\r\n        { label: 'Atrasadas', value: kpis.atrasadas ?? 0, icon: AlertTriangle, color: 'text-red-600', bg: 'bg-red-50' },\r\n        { label: 'Taxa Conclusão', value: `${kpis.taxa_conclusao ?? 0}%`, icon: Percent, color: 'text-indigo-600', bg: 'bg-indigo-50' },\r\n        { label: 'Tempo Médio', value: `${kpis.tempo_medio_horas ?? 0}h`, icon: Clock, color: 'text-purple-600', bg: 'bg-purple-50' },\r\n    ]\r\n\r\n    // Max workload for bar chart scaling\r\n    const maxWorkload = Math.max(1, ...workload.map(w => w.total))\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Dashboard Gerencial</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Visão analítica da Central de Trabalho</p>\r\n                </div>\r\n                <Link to=\"/central\"\r\n                    className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition-colors hover:bg-brand-700\">\r\n                    <Inbox className=\"h-4 w-4\" /> Ver Central\r\n                    <ArrowRight className=\"h-4 w-4\" />\r\n                </Link>\r\n            </div>\r\n\r\n            {isLoading ? (\r\n                <div className=\"flex items-center justify-center py-20\">\r\n                    <div className=\"h-10 w-10 animate-spin rounded-full border-3 border-brand-500 border-t-transparent\" />\r\n                </div>\r\n            ) : (\r\n                <>\r\n                    {/* KPI Cards */}\r\n                    <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-7\">\r\n                        {kpiCards.map(k => {\r\n                            const Icon = k.icon\r\n                            return (\r\n                                <div key={k.label} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card hover:shadow-md transition-shadow\">\r\n                                    <div className={`mb-2 inline-flex rounded-lg p-2 ${k.bg}`}>\r\n                                        <Icon className={`h-5 w-5 ${k.color}`} />\r\n                                    </div>\r\n                                    <p className=\"text-2xl font-bold text-surface-900\">{k.value}</p>\r\n                                    <p className=\"text-xs text-surface-500 mt-0.5\">{k.label}</p>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n\r\n                    {/* Two columns */}\r\n                    <div className=\"grid gap-6 lg:grid-cols-2\">\r\n                        {/* Workload by User */}\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card\">\r\n                            <div className=\"flex items-center gap-2 mb-4\">\r\n                                <Users className=\"h-5 w-5 text-brand-500\" />\r\n                                <h2 className=\"text-lg font-semibold text-surface-900\">Carga por Responsável</h2>\r\n                            </div>\r\n                            {workload.length === 0 ? (\r\n                                <p className=\"text-sm text-surface-400 py-8 text-center\">Nenhum responsável com itens pendentes</p>\r\n                            ) : (\r\n                                <div className=\"space-y-3\">\r\n                                    {workload.map((w: any) => (\r\n                                        <div key={w.user_id} className=\"group\">\r\n                                            <div className=\"flex items-center justify-between mb-1\">\r\n                                                <span className=\"text-sm font-medium text-surface-700 truncate\">{w.nome}</span>\r\n                                                <div className=\"flex items-center gap-2 text-xs\">\r\n                                                    <span className=\"text-surface-500\">{w.total} itens</span>\r\n                                                    {(w.atrasadas ?? 0) > 0 && (\r\n                                                        <Badge variant=\"danger\">{w.atrasadas} atrasadas</Badge>\r\n                                                    )}\r\n                                                    {(w.urgentes ?? 0) > 0 && (\r\n                                                        <Badge variant=\"warning\">{w.urgentes} urgentes</Badge>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"h-3 w-full overflow-hidden rounded-full bg-surface-100\">\r\n                                                <div\r\n                                                    className=\"h-full rounded-full bg-gradient-to-r from-brand-400 to-brand-600 transition-all duration-500\"\r\n                                                    style={{ width: `${Math.max(4, (w.total / maxWorkload) * 100)}%` }}\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Overdue by Type */}\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card\">\r\n                            <div className=\"flex items-center gap-2 mb-4\">\r\n                                <AlertTriangle className=\"h-5 w-5 text-red-500\" />\r\n                                <h2 className=\"text-lg font-semibold text-surface-900\">Atrasos por Tipo</h2>\r\n                            </div>\r\n                            {overdueByTeam.length === 0 ? (\r\n                                <div className=\"flex flex-col items-center py-8\">\r\n                                    <CheckCircle className=\"h-10 w-10 text-emerald-400 mb-2\" />\r\n                                    <p className=\"text-sm text-surface-500\">Nenhum item atrasado! 🎉</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-3\">\r\n                                    {overdueByTeam.map((row: any) => {\r\n                                        const Icon = tipoIcons[row.tipo] ?? FileText\r\n                                        const colors = tipoColors[row.tipo] ?? 'text-surface-600 bg-surface-50'\r\n                                        return (\r\n                                            <div key={row.tipo} className=\"flex items-center gap-3 rounded-lg border border-red-100 bg-red-50/30 p-3\">\r\n                                                <div className={`rounded-lg p-2 ${colors}`}>\r\n                                                    <Icon className=\"h-4 w-4\" />\r\n                                                </div>\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <p className=\"text-sm font-medium text-surface-800 capitalize\">{row.tipo}</p>\r\n                                                    <p className=\"text-xs text-surface-500\">\r\n                                                        Atraso médio: <span className=\"font-semibold text-red-600\">{row.atraso_medio_horas}h</span>\r\n                                                    </p>\r\n                                                </div>\r\n                                                <div className=\"text-right\">\r\n                                                    <p className=\"text-xl font-bold text-red-600\">{row.total}</p>\r\n                                                    <p className=\"text-[10px] text-surface-400\">itens</p>\r\n                                                </div>\r\n                                            </div>\r\n                                        )\r\n                                    })}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\central\\CentralPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowRight' is defined but never used.","line":4,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":71,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ArrowRight"},"fix":{"range":[188,200],"text":""},"desc":"Remove unused variable \"ArrowRight\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Pause' is defined but never used.","line":5,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Pause"},"fix":{"range":[231,238],"text":""},"desc":"Remove unused variable \"Pause\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":5,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":56,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[250,258],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":6,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":54,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[321,324],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[661,664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[661,664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1480,1483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1480,1483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2745,2748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2745,2748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4570,4573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4570,4573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5792,5795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5792,5795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11199,11202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11199,11202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15384,15387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15384,15387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":278,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15534,15537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15534,15537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":297,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17096,17099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17096,17099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":345,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21002,21005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21002,21005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":353,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21511,21514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21511,21514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":373,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":373,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23117,23120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23117,23120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Inbox, Plus, Search, CheckCircle, Clock, AlertTriangle, ArrowRight,\r\n    MessageSquare, UserCheck, Pause, Play, Flag, Filter, Calendar,\r\n    FileText, Phone, DollarSign, Wrench, BarChart3, X,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\n// ── Configurações visuais ──\r\n\r\nconst tipoConfig: Record<string, { label: string; icon: any; color: string }> = {\r\n    os: { label: 'OS', icon: Wrench, color: 'text-blue-600 bg-blue-50' },\r\n    chamado: { label: 'Chamado', icon: Phone, color: 'text-cyan-600 bg-cyan-50' },\r\n    orcamento: { label: 'Orçamento', icon: FileText, color: 'text-amber-600 bg-amber-50' },\r\n    financeiro: { label: 'Financeiro', icon: DollarSign, color: 'text-emerald-600 bg-emerald-50' },\r\n    calibracao: { label: 'Calibração', icon: BarChart3, color: 'text-indigo-600 bg-indigo-50' },\r\n    contrato: { label: 'Contrato', icon: FileText, color: 'text-rose-600 bg-rose-50' },\r\n    tarefa: { label: 'Tarefa', icon: CheckCircle, color: 'text-surface-600 bg-surface-50' },\r\n    lembrete: { label: 'Lembrete', icon: Clock, color: 'text-surface-500 bg-surface-50' },\r\n}\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any }> = {\r\n    aberto: { label: 'Aberto', variant: 'info' },\r\n    em_andamento: { label: 'Em Andamento', variant: 'warning' },\r\n    concluido: { label: 'Concluído', variant: 'success' },\r\n    cancelado: { label: 'Cancelado', variant: 'danger' },\r\n    aguardando: { label: 'Aguardando', variant: 'default' },\r\n}\r\n\r\nconst prioridadeConfig: Record<string, { label: string; color: string; bg: string }> = {\r\n    baixa: { label: 'Baixa', color: 'text-surface-500', bg: '' },\r\n    media: { label: 'Média', color: 'text-blue-600', bg: '' },\r\n    alta: { label: 'Alta', color: 'text-amber-600', bg: 'bg-amber-50' },\r\n    urgente: { label: 'Urgente', color: 'text-red-600', bg: 'bg-red-50' },\r\n}\r\n\r\nconst tabs = [\r\n    { key: 'todas', label: 'Todas' },\r\n    { key: 'hoje', label: 'Hoje' },\r\n    { key: 'atrasadas', label: 'Atrasadas' },\r\n    { key: 'sem_prazo', label: 'Sem Prazo' },\r\n]\r\n\r\nexport function CentralPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [tab, setTab] = useState('todas')\r\n    const [tipoFilter, setTipoFilter] = useState('')\r\n    const [prioridadeFilter, setPrioridadeFilter] = useState('')\r\n    const [showCreate, setShowCreate] = useState(false)\r\n    const [showDetail, setShowDetail] = useState<any>(null)\r\n    const [comment, setComment] = useState('')\r\n\r\n    // Form state\r\n    const [form, setForm] = useState({\r\n        titulo: '', descricao_curta: '', tipo: 'tarefa',\r\n        prioridade: 'media', due_at: '', visibilidade: 'equipe',\r\n    })\r\n\r\n    // ── Queries ──\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['central-summary'],\r\n        queryFn: () => api.get('/central/summary'),\r\n        refetchInterval: 30000,\r\n    })\r\n    const summary = summaryRes?.data?.data ?? {}\r\n\r\n    const { data: itemsRes, isLoading } = useQuery({\r\n        queryKey: ['central-items', search, tab, tipoFilter, prioridadeFilter],\r\n        queryFn: () => api.get('/central/items', {\r\n            params: {\r\n                search: search || undefined,\r\n                aba: tab !== 'todas' ? tab : undefined,\r\n                tipo: tipoFilter || undefined,\r\n                prioridade: prioridadeFilter || undefined,\r\n                per_page: 50,\r\n            },\r\n        }),\r\n    })\r\n    const items = itemsRes?.data?.data ?? []\r\n\r\n    const { data: usersRes } = useQuery({\r\n        queryKey: ['users-central'],\r\n        queryFn: () => api.get('/users', { params: { per_page: 100 } }),\r\n    })\r\n    const users = usersRes?.data?.data ?? []\r\n\r\n    // ── Mutations ──\r\n\r\n    const createMut = useMutation({\r\n        mutationFn: () => api.post('/central/items', form),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['central-items'] })\r\n            qc.invalidateQueries({ queryKey: ['central-summary'] })\r\n            setShowCreate(false)\r\n            setForm({ titulo: '', descricao_curta: '', tipo: 'tarefa', prioridade: 'media', due_at: '', visibilidade: 'equipe' })\r\n        },\r\n    })\r\n\r\n    const updateMut = useMutation({\r\n        mutationFn: ({ id, data }: { id: number; data: any }) => api.patch(`/central/items/${id}`, data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['central-items'] })\r\n            qc.invalidateQueries({ queryKey: ['central-summary'] })\r\n        },\r\n    })\r\n\r\n    const assignMut = useMutation({\r\n        mutationFn: ({ id, userId }: { id: number; userId: number }) =>\r\n            api.post(`/central/items/${id}/assign`, { responsavel_user_id: userId }),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['central-items'] }),\r\n    })\r\n\r\n    const commentMut = useMutation({\r\n        mutationFn: ({ id, body }: { id: number; body: string }) =>\r\n            api.post(`/central/items/${id}/comments`, { body }),\r\n        onSuccess: () => { setComment(''); if (showDetail) fetchDetail(showDetail.id) },\r\n    })\r\n\r\n    // ── Detail ──\r\n\r\n    const fetchDetail = async (id: number) => {\r\n        const res = await api.get(`/central/items/${id}`)\r\n        setShowDetail(res.data?.data ?? res.data)\r\n    }\r\n\r\n    // ── Helpers ──\r\n\r\n    const formatDate = (d: string | null) => {\r\n        if (!d) return '—'\r\n        return new Date(d).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })\r\n    }\r\n\r\n    const isOverdue = (item: any) => {\r\n        if (!item.due_at || item.status === 'concluido' || item.status === 'cancelado') return false\r\n        return new Date(item.due_at) < new Date()\r\n    }\r\n\r\n    const stats = [\r\n        { label: 'Abertas', value: summary.abertas ?? 0, icon: Inbox, color: 'text-blue-600', bg: 'bg-blue-50' },\r\n        { label: 'Hoje', value: summary.hoje ?? 0, icon: Calendar, color: 'text-amber-600', bg: 'bg-amber-50' },\r\n        { label: 'Atrasadas', value: summary.atrasadas ?? 0, icon: AlertTriangle, color: 'text-red-600', bg: 'bg-red-50' },\r\n        { label: 'Urgentes', value: summary.urgentes ?? 0, icon: Flag, color: 'text-rose-600', bg: 'bg-rose-50' },\r\n    ]\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Central</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Inbox unificado de trabalho — OS, Chamados, Tarefas e mais</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => setShowCreate(true)}>Nova Tarefa</Button>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-2 gap-4 lg:grid-cols-4\">\r\n                {stats.map(s => {\r\n                    const Icon = s.icon\r\n                    return (\r\n                        <div key={s.label} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card hover:shadow-md transition-shadow\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className={`rounded-lg p-2 ${s.bg}`}><Icon className={`h-5 w-5 ${s.color}`} /></div>\r\n                                <div><p className=\"text-xs text-surface-500\">{s.label}</p><p className=\"text-xl font-bold text-surface-900\">{s.value}</p></div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                })}\r\n            </div>\r\n\r\n            {/* Tabs + Filters */}\r\n            <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n                <div className=\"flex gap-1 rounded-lg bg-surface-100 p-1\">\r\n                    {tabs.map(t => (\r\n                        <button key={t.key} onClick={() => setTab(t.key)}\r\n                            className={`rounded-md px-3 py-1.5 text-sm font-medium transition-colors ${tab === t.key ? 'bg-white text-surface-900 shadow-sm' : 'text-surface-500 hover:text-surface-700'}`}>\r\n                            {t.label}\r\n                            {t.key === 'atrasadas' && (summary.atrasadas ?? 0) > 0 && (\r\n                                <span className=\"ml-1.5 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-red-500 px-1 text-[10px] font-bold text-white\">\r\n                                    {summary.atrasadas}\r\n                                </span>\r\n                            )}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    <div className=\"relative flex-1 min-w-[200px]\">\r\n                        <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                        <input value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)} placeholder=\"Buscar...\"\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white py-2 pl-10 pr-3 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <select value={tipoFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setTipoFilter(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm\">\r\n                        <option value=\"\">Tipo</option>\r\n                        {Object.entries(tipoConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                    </select>\r\n                    <select value={prioridadeFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setPrioridadeFilter(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm\">\r\n                        <option value=\"\">Prioridade</option>\r\n                        {Object.entries(prioridadeConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Items List */}\r\n            <div className=\"space-y-2\">\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-12\">\r\n                        <div className=\"h-8 w-8 animate-spin rounded-full border-2 border-brand-500 border-t-transparent\" />\r\n                    </div>\r\n                ) : items.length === 0 ? (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white py-16 text-center\">\r\n                        <Inbox className=\"mx-auto h-12 w-12 text-surface-300\" />\r\n                        <p className=\"mt-3 text-sm text-surface-500\">Nenhum item encontrado</p>\r\n                    </div>\r\n                ) : items.map((item: any) => {\r\n                    const tipo = tipoConfig[item.tipo] ?? tipoConfig.tarefa\r\n                    const status = statusConfig[item.status] ?? statusConfig.aberto\r\n                    const prio = prioridadeConfig[item.prioridade] ?? prioridadeConfig.media\r\n                    const TipoIcon = tipo.icon\r\n                    const overdue = isOverdue(item)\r\n\r\n                    return (\r\n                        <div key={item.id} onClick={() => fetchDetail(item.id)}\r\n                            className={`group cursor-pointer rounded-xl border bg-white p-4 shadow-card transition-all hover:shadow-md hover:border-brand-200 ${overdue ? 'border-red-200 bg-red-50/30' : 'border-surface-200'} ${prio.bg}`}>\r\n                            <div className=\"flex items-start gap-3\">\r\n                                {/* Type icon */}\r\n                                <div className={`mt-0.5 rounded-lg p-2 ${tipo.color}`}>\r\n                                    <TipoIcon className=\"h-4 w-4\" />\r\n                                </div>\r\n\r\n                                {/* Content */}\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <h3 className=\"text-sm font-semibold text-surface-900 truncate\">{item.titulo}</h3>\r\n                                        <Badge variant={status.variant}>{status.label}</Badge>\r\n                                        {overdue && <Badge variant=\"danger\">Atrasado</Badge>}\r\n                                    </div>\r\n                                    {item.descricao_curta && (\r\n                                        <p className=\"mt-0.5 text-xs text-surface-500 truncate\">{item.descricao_curta}</p>\r\n                                    )}\r\n                                    <div className=\"mt-2 flex flex-wrap items-center gap-3 text-xs text-surface-400\">\r\n                                        <span className={`font-medium ${prio.color}`}>{prio.label}</span>\r\n                                        {item.due_at && <span className=\"flex items-center gap-1\"><Calendar className=\"h-3 w-3\" />{formatDate(item.due_at)}</span>}\r\n                                        {item.responsavel && <span className=\"flex items-center gap-1\"><UserCheck className=\"h-3 w-3\" />{item.responsavel.name}</span>}\r\n                                        {(item.comments_count ?? 0) > 0 && <span className=\"flex items-center gap-1\"><MessageSquare className=\"h-3 w-3\" />{item.comments_count}</span>}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Quick actions */}\r\n                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                    {item.status === 'aberto' && (\r\n                                        <button onClick={(e) => { e.stopPropagation(); updateMut.mutate({ id: item.id, data: { status: 'em_andamento' } }) }}\r\n                                            title=\"Iniciar\" className=\"rounded p-1.5 text-blue-600 hover:bg-blue-50\"><Play className=\"h-4 w-4\" /></button>\r\n                                    )}\r\n                                    {(item.status === 'aberto' || item.status === 'em_andamento') && (\r\n                                        <button onClick={(e) => { e.stopPropagation(); updateMut.mutate({ id: item.id, data: { status: 'concluido' } }) }}\r\n                                            title=\"Concluir\" className=\"rounded p-1.5 text-emerald-600 hover:bg-emerald-50\"><CheckCircle className=\"h-4 w-4\" /></button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                })}\r\n            </div>\r\n\r\n            {/* ── Modal Criar Tarefa ── */}\r\n            <Modal open={showCreate} onOpenChange={(v) => { if (!v) setShowCreate(false) }} title=\"Nova Tarefa\">\r\n                <div className=\"space-y-4\">\r\n                    <Input label=\"Título\" value={form.titulo} onChange={(e: any) => setForm(f => ({ ...f, titulo: e.target.value }))} />\r\n                    <Input label=\"Descrição\" value={form.descricao_curta} onChange={(e: any) => setForm(f => ({ ...f, descricao_curta: e.target.value }))} />\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-sm font-medium text-surface-700\">Tipo</label>\r\n                            <select value={form.tipo} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, tipo: e.target.value }))}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                <option value=\"tarefa\">Tarefa</option>\r\n                                <option value=\"lembrete\">Lembrete</option>\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-sm font-medium text-surface-700\">Prioridade</label>\r\n                            <select value={form.prioridade} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, prioridade: e.target.value }))}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                {Object.entries(prioridadeConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <Input label=\"Prazo\" type=\"datetime-local\" value={form.due_at} onChange={(e: any) => setForm(f => ({ ...f, due_at: e.target.value }))} />\r\n                        <div>\r\n                            <label className=\"text-sm font-medium text-surface-700\">Visibilidade</label>\r\n                            <select value={form.visibilidade} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, visibilidade: e.target.value }))}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                <option value=\"privado\">Privado</option>\r\n                                <option value=\"equipe\">Equipe</option>\r\n                                <option value=\"empresa\">Empresa</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button variant=\"outline\" onClick={() => setShowCreate(false)}>Cancelar</Button>\r\n                        <Button onClick={() => createMut.mutate()} loading={createMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n\r\n            {/* ── Modal Detalhes ── */}\r\n            <Modal open={!!showDetail} onOpenChange={(v) => { if (!v) setShowDetail(null) }} title={showDetail?.titulo ?? 'Detalhes'}>\r\n                {showDetail && (\r\n                    <div className=\"space-y-4\">\r\n                        {/* Info */}\r\n                        <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                            <div><span className=\"text-surface-500\">Status:</span> <Badge variant={statusConfig[showDetail.status]?.variant ?? 'default'}>{statusConfig[showDetail.status]?.label ?? showDetail.status}</Badge></div>\r\n                            <div><span className=\"text-surface-500\">Prioridade:</span> <span className={`font-medium ${prioridadeConfig[showDetail.prioridade]?.color ?? ''}`}>{prioridadeConfig[showDetail.prioridade]?.label ?? showDetail.prioridade}</span></div>\r\n                            <div><span className=\"text-surface-500\">Tipo:</span> {tipoConfig[showDetail.tipo]?.label ?? showDetail.tipo}</div>\r\n                            <div><span className=\"text-surface-500\">Prazo:</span> {formatDate(showDetail.due_at)}</div>\r\n                            <div><span className=\"text-surface-500\">Responsável:</span> {showDetail.responsavel?.name ?? '—'}</div>\r\n                            <div><span className=\"text-surface-500\">Criado em:</span> {formatDate(showDetail.created_at)}</div>\r\n                        </div>\r\n\r\n                        {showDetail.descricao_curta && (\r\n                            <p className=\"text-sm text-surface-600 bg-surface-50 rounded-lg p-3\">{showDetail.descricao_curta}</p>\r\n                        )}\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"flex flex-wrap gap-2 border-t border-surface-200 pt-3\">\r\n                            {showDetail.status !== 'concluido' && showDetail.status !== 'cancelado' && (\r\n                                <Button size=\"sm\" variant=\"outline\" icon={<CheckCircle className=\"h-4 w-4\" />}\r\n                                    onClick={() => { updateMut.mutate({ id: showDetail.id, data: { status: 'concluido' } }); setShowDetail(null) }}>\r\n                                    Concluir\r\n                                </Button>\r\n                            )}\r\n                            <div className=\"flex-1\" />\r\n                            <select onChange={(e: React.ChangeEvent<HTMLSelectElement>) => { if (e.target.value) assignMut.mutate({ id: showDetail.id, userId: +e.target.value }) }}\r\n                                className=\"rounded-lg border border-surface-300 bg-white px-2 py-1.5 text-xs\">\r\n                                <option value=\"\">Reatribuir...</option>\r\n                                {users.map((u: any) => <option key={u.id} value={u.id}>{u.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n\r\n                        {/* Comments */}\r\n                        <div className=\"border-t border-surface-200 pt-3\">\r\n                            <h4 className=\"text-sm font-semibold text-surface-700 mb-2\">Comentários</h4>\r\n                            <div className=\"space-y-2 max-h-40 overflow-y-auto\">\r\n                                {(showDetail.comments ?? []).map((c: any) => (\r\n                                    <div key={c.id} className=\"rounded-lg bg-surface-50 p-2\">\r\n                                        <p className=\"text-xs text-surface-900\">{c.body}</p>\r\n                                        <p className=\"text-[10px] text-surface-400 mt-1\">{c.user?.name ?? 'Sistema'} • {formatDate(c.created_at)}</p>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                            <div className=\"mt-2 flex gap-2\">\r\n                                <input value={comment} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setComment(e.target.value)} placeholder=\"Adicionar comentário...\"\r\n                                    className=\"flex-1 rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                                <Button size=\"sm\" onClick={() => commentMut.mutate({ id: showDetail.id, body: comment })} loading={commentMut.isPending}\r\n                                    disabled={!comment.trim()}>Enviar</Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* History */}\r\n                        {(showDetail.history ?? []).length > 0 && (\r\n                            <div className=\"border-t border-surface-200 pt-3\">\r\n                                <h4 className=\"text-sm font-semibold text-surface-700 mb-2\">Histórico</h4>\r\n                                <div className=\"space-y-1 text-xs text-surface-500 max-h-32 overflow-y-auto\">\r\n                                    {(showDetail.history ?? []).map((h: any) => (\r\n                                        <div key={h.id} className=\"flex gap-2\">\r\n                                            <span className=\"text-surface-400\">{formatDate(h.created_at)}</span>\r\n                                            <span>{h.action}: {h.from_value ?? ''} → {h.to_value ?? ''}</span>\r\n                                            <span className=\"text-surface-300\">{h.user?.name}</span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\central\\CentralRulesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[530,533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[530,533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1161,1164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1161,1164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1199,1202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1199,1202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1644,1647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1644,1647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1868,1871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1868,1871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3139,3142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3139,3142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3845,3848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3845,3848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5327,5330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5327,5330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9534,9537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9534,9537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9729,9732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9729,9732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":230,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12711,12714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12711,12714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13649,13652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13649,13652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":246,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13912,13915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13912,13915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":268,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15320,15323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15320,15323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Zap, Plus, Trash2, Edit2, ToggleLeft, ToggleRight,\r\n    UserCheck, Flag, Clock, Bell, Save, X,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\nconst acaoLabels: Record<string, { label: string; icon: any; color: string }> = {\r\n    auto_assign: { label: 'Auto-atribuir', icon: UserCheck, color: 'text-blue-600 bg-blue-50' },\r\n    set_priority: { label: 'Definir Prioridade', icon: Flag, color: 'text-amber-600 bg-amber-50' },\r\n    set_due: { label: 'Definir Prazo', icon: Clock, color: 'text-emerald-600 bg-emerald-50' },\r\n    notify: { label: 'Notificar', icon: Bell, color: 'text-indigo-600 bg-indigo-50' },\r\n}\r\n\r\nconst emptyForm = {\r\n    nome: '', descricao: '', ativo: true,\r\n    evento_trigger: '', tipo_item: '', status_trigger: '', prioridade_minima: '',\r\n    acao_tipo: 'auto_assign',\r\n    acao_config: {} as Record<string, any>,\r\n    responsavel_user_id: '' as any, role_alvo: '',\r\n}\r\n\r\nexport function CentralRulesPage() {\r\n    const qc = useQueryClient()\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editingId, setEditingId] = useState<number | null>(null)\r\n    const [form, setForm] = useState({ ...emptyForm })\r\n\r\n    const { data: rulesRes, isLoading } = useQuery({\r\n        queryKey: ['central-rules'],\r\n        queryFn: () => api.get('/central/rules'),\r\n    })\r\n    const rules: any[] = rulesRes?.data?.data ?? []\r\n\r\n    const { data: usersRes } = useQuery({\r\n        queryKey: ['users-central-rules'],\r\n        queryFn: () => api.get('/users', { params: { per_page: 100 } }),\r\n    })\r\n    const users: any[] = usersRes?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: () => {\r\n            const payload = {\r\n                ...form,\r\n                responsavel_user_id: form.responsavel_user_id || null,\r\n                acao_config: Object.keys(form.acao_config).length > 0 ? form.acao_config : null,\r\n            }\r\n            return editingId\r\n                ? api.patch(`/central/rules/${editingId}`, payload)\r\n                : api.post('/central/rules', payload)\r\n        },\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['central-rules'] })\r\n            resetForm()\r\n        },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/central/rules/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['central-rules'] }),\r\n    })\r\n\r\n    const toggleMut = useMutation({\r\n        mutationFn: ({ id, ativo }: { id: number; ativo: boolean }) =>\r\n            api.patch(`/central/rules/${id}`, { ativo }),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['central-rules'] }),\r\n    })\r\n\r\n    const resetForm = () => {\r\n        setForm({ ...emptyForm })\r\n        setEditingId(null)\r\n        setShowForm(false)\r\n    }\r\n\r\n    const openEdit = (rule: any) => {\r\n        setForm({\r\n            nome: rule.nome ?? '',\r\n            descricao: rule.descricao ?? '',\r\n            ativo: rule.ativo ?? true,\r\n            evento_trigger: rule.evento_trigger ?? '',\r\n            tipo_item: rule.tipo_item ?? '',\r\n            status_trigger: rule.status_trigger ?? '',\r\n            prioridade_minima: rule.prioridade_minima ?? '',\r\n            acao_tipo: rule.acao_tipo ?? 'auto_assign',\r\n            acao_config: rule.acao_config ?? {},\r\n            responsavel_user_id: rule.responsavel_user_id ?? '',\r\n            role_alvo: rule.role_alvo ?? '',\r\n        })\r\n        setEditingId(rule.id)\r\n        setShowForm(true)\r\n    }\r\n\r\n    const setF = (key: string, val: any) => setForm(f => ({ ...f, [key]: val }))\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Regras de Automação</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Configure ações automáticas para itens da Central</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { resetForm(); setShowForm(true) }}>\r\n                    Nova Regra\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Rules list */}\r\n            {isLoading ? (\r\n                <div className=\"flex items-center justify-center py-16\">\r\n                    <div className=\"h-8 w-8 animate-spin rounded-full border-2 border-brand-500 border-t-transparent\" />\r\n                </div>\r\n            ) : rules.length === 0 ? (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white py-16 text-center\">\r\n                    <Zap className=\"mx-auto h-12 w-12 text-surface-300\" />\r\n                    <p className=\"mt-3 text-sm text-surface-500\">Nenhuma regra de automação criada</p>\r\n                    <p className=\"text-xs text-surface-400 mt-1\">Clique em \"Nova Regra\" para começar</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-3\">\r\n                    {rules.map((rule: any) => {\r\n                        const acao = acaoLabels[rule.acao_tipo] ?? acaoLabels.auto_assign\r\n                        const AcaoIcon = acao.icon\r\n                        return (\r\n                            <div key={rule.id}\r\n                                className={`rounded-xl border bg-white p-4 shadow-card transition-all hover:shadow-md ${rule.ativo ? 'border-surface-200' : 'border-surface-100 opacity-60'}`}>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    {/* Toggle */}\r\n                                    <button onClick={() => toggleMut.mutate({ id: rule.id, ativo: !rule.ativo })}\r\n                                        className=\"text-surface-400 hover:text-brand-600 transition-colors\" title={rule.ativo ? 'Desativar' : 'Ativar'}>\r\n                                        {rule.ativo\r\n                                            ? <ToggleRight className=\"h-6 w-6 text-brand-500\" />\r\n                                            : <ToggleLeft className=\"h-6 w-6\" />}\r\n                                    </button>\r\n\r\n                                    {/* Action icon */}\r\n                                    <div className={`rounded-lg p-2 ${acao.color}`}>\r\n                                        <AcaoIcon className=\"h-4 w-4\" />\r\n                                    </div>\r\n\r\n                                    {/* Content */}\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <h3 className=\"text-sm font-semibold text-surface-900\">{rule.nome}</h3>\r\n                                            <Badge variant={rule.ativo ? 'success' : 'default'}>\r\n                                                {rule.ativo ? 'Ativa' : 'Inativa'}\r\n                                            </Badge>\r\n                                        </div>\r\n                                        <p className=\"text-xs text-surface-500 mt-0.5\">\r\n                                            {acao.label}\r\n                                            {rule.tipo_item && <> • Tipo: <span className=\"font-medium\">{rule.tipo_item}</span></>}\r\n                                            {rule.prioridade_minima && <> • Prioridade mín: <span className=\"font-medium\">{rule.prioridade_minima}</span></>}\r\n                                            {rule.responsavel?.name && <> → <span className=\"font-medium\">{rule.responsavel.name}</span></>}\r\n                                            {rule.role_alvo && <> → Role: <span className=\"font-medium\">{rule.role_alvo}</span></>}\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    {/* Actions */}\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        <button onClick={() => openEdit(rule)}\r\n                                            className=\"rounded p-1.5 text-surface-400 hover:bg-surface-100 hover:text-surface-700 transition-colors\">\r\n                                            <Edit2 className=\"h-4 w-4\" />\r\n                                        </button>\r\n                                        <button onClick={() => deleteMut.mutate(rule.id)}\r\n                                            className=\"rounded p-1.5 text-surface-400 hover:bg-red-50 hover:text-red-600 transition-colors\">\r\n                                            <Trash2 className=\"h-4 w-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n            )}\r\n\r\n            {/* ── Modal Criar/Editar ── */}\r\n            <Modal open={showForm} onOpenChange={(v) => { if (!v) resetForm() }}\r\n                title={editingId ? 'Editar Regra' : 'Nova Regra de Automação'}>\r\n                <div className=\"space-y-4\">\r\n                    <Input label=\"Nome da Regra\" value={form.nome}\r\n                        onChange={(e: any) => setF('nome', e.target.value)} placeholder=\"Ex: Auto-atribuir OS urgentes\" />\r\n\r\n                    <Input label=\"Descrição\" value={form.descricao}\r\n                        onChange={(e: any) => setF('descricao', e.target.value)} placeholder=\"Opcional\" />\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-sm font-medium text-surface-700\">Tipo de Ação</label>\r\n                            <select value={form.acao_tipo} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setF('acao_tipo', e.target.value)}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                <option value=\"auto_assign\">Auto-atribuir</option>\r\n                                <option value=\"set_priority\">Definir Prioridade</option>\r\n                                <option value=\"set_due\">Definir Prazo</option>\r\n                                <option value=\"notify\">Notificar</option>\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-sm font-medium text-surface-700\">Tipo de Item</label>\r\n                            <select value={form.tipo_item} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setF('tipo_item', e.target.value)}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                <option value=\"\">Qualquer</option>\r\n                                <option value=\"os\">OS</option>\r\n                                <option value=\"chamado\">Chamado</option>\r\n                                <option value=\"orcamento\">Orçamento</option>\r\n                                <option value=\"financeiro\">Financeiro</option>\r\n                                <option value=\"calibracao\">Calibração</option>\r\n                                <option value=\"tarefa\">Tarefa</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"text-sm font-medium text-surface-700\">Prioridade Mínima</label>\r\n                            <select value={form.prioridade_minima} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setF('prioridade_minima', e.target.value)}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                <option value=\"\">Sem filtro</option>\r\n                                <option value=\"baixa\">Baixa</option>\r\n                                <option value=\"media\">Média</option>\r\n                                <option value=\"alta\">Alta</option>\r\n                                <option value=\"urgente\">Urgente</option>\r\n                            </select>\r\n                        </div>\r\n                        <Input label=\"Evento Trigger\" value={form.evento_trigger}\r\n                            onChange={(e: any) => setF('evento_trigger', e.target.value)} placeholder=\"Ex: WorkOrderCreated\" />\r\n                    </div>\r\n\r\n                    {/* Ação-specific config */}\r\n                    {form.acao_tipo === 'auto_assign' && (\r\n                        <div className=\"grid grid-cols-2 gap-4 rounded-lg bg-blue-50/50 p-3\">\r\n                            <div>\r\n                                <label className=\"text-sm font-medium text-surface-700\">Atribuir para</label>\r\n                                <select value={form.responsavel_user_id}\r\n                                    onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setF('responsavel_user_id', e.target.value || '')}\r\n                                    className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                    <option value=\"\">Por role (balanceado)</option>\r\n                                    {users.map((u: any) => <option key={u.id} value={u.id}>{u.name}</option>)}\r\n                                </select>\r\n                            </div>\r\n                            <Input label=\"Role Alvo\" value={form.role_alvo}\r\n                                onChange={(e: any) => setF('role_alvo', e.target.value)}\r\n                                placeholder=\"Ex: tecnico\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    {form.acao_tipo === 'set_priority' && (\r\n                        <div className=\"rounded-lg bg-amber-50/50 p-3\">\r\n                            <label className=\"text-sm font-medium text-surface-700\">Nova Prioridade</label>\r\n                            <select value={form.acao_config?.prioridade ?? ''}\r\n                                onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setF('acao_config', { prioridade: e.target.value })}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                <option value=\"baixa\">Baixa</option>\r\n                                <option value=\"media\">Média</option>\r\n                                <option value=\"alta\">Alta</option>\r\n                                <option value=\"urgente\">Urgente</option>\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n\r\n                    {form.acao_tipo === 'set_due' && (\r\n                        <div className=\"rounded-lg bg-emerald-50/50 p-3\">\r\n                            <Input label=\"Prazo em Horas\" type=\"number\" value={form.acao_config?.horas ?? ''}\r\n                                onChange={(e: any) => setF('acao_config', { horas: parseInt(e.target.value) || '' })}\r\n                                placeholder=\"Ex: 24\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Save */}\r\n                    <div className=\"flex justify-end gap-2 border-t border-surface-200 pt-4\">\r\n                        <Button variant=\"outline\" onClick={resetForm} icon={<X className=\"h-4 w-4\" />}>Cancelar</Button>\r\n                        <Button onClick={() => saveMut.mutate()} loading={saveMut.isPending}\r\n                            icon={<Save className=\"h-4 w-4\" />} disabled={!form.nome.trim()}>\r\n                            {editingId ? 'Salvar' : 'Criar Regra'}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\chamados\\ServiceCallMapPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":3,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":30,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[113,120],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Button"},"fix":{"range":[294,341],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'priorityColors' is assigned a value but never used.","line":18,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3264,3267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3264,3267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { MapPin, Phone, Clock, AlertTriangle, ArrowLeft } from 'lucide-react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport api from '@/lib/api'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Button } from '@/components/ui/Button'\r\n\r\nconst statusLabels: Record<string, { label: string; color: string }> = {\r\n    open: { label: 'Aberto', color: '#3b82f6' },\r\n    scheduled: { label: 'Agendado', color: '#f59e0b' },\r\n    en_route: { label: 'A Caminho', color: '#8b5cf6' },\r\n    in_progress: { label: 'Em Atend.', color: '#ef4444' },\r\n    completed: { label: 'Concluído', color: '#22c55e' },\r\n    cancelled: { label: 'Cancelado', color: '#6b7280' },\r\n}\r\n\r\nconst priorityColors: Record<string, string> = {\r\n    low: '#94a3b8', normal: '#3b82f6', high: '#f59e0b', urgent: '#ef4444',\r\n}\r\n\r\nexport function ServiceCallMapPage() {\r\n    const navigate = useNavigate()\r\n    const [statusFilter, setStatusFilter] = useState<string>('')\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['service-calls-map', statusFilter],\r\n        queryFn: () => api.get('/service-calls/map-data', { params: statusFilter ? { status: statusFilter } : {} }),\r\n    })\r\n\r\n    const calls = res?.data ?? []\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button onClick={() => navigate('/chamados')} className=\"rounded-lg p-1.5 hover:bg-surface-100\">\r\n                        <ArrowLeft className=\"h-5 w-5 text-surface-500\" />\r\n                    </button>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-surface-900\">Mapa de Chamados</h1>\r\n                        <p className=\"text-sm text-surface-500\">{calls.length} chamados com localização</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                        <option value=\"\">Todos os status</option>\r\n                        {Object.entries(statusLabels).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {isLoading ? (\r\n                <div className=\"py-16 text-center text-sm text-surface-500\">Carregando mapa...</div>\r\n            ) : calls.length === 0 ? (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-12 text-center shadow-card\">\r\n                    <MapPin className=\"mx-auto h-12 w-12 text-surface-300\" />\r\n                    <p className=\"mt-3 text-sm text-surface-500\">Nenhum chamado com localização disponível</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n                    {calls.map((call: any) => {\r\n                        const st = statusLabels[call.status] ?? statusLabels.open\r\n                        return (\r\n                            <div key={call.id} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card hover:shadow-md transition-shadow\">\r\n                                <div className=\"flex items-start justify-between mb-3\">\r\n                                    <div>\r\n                                        <span className=\"text-xs font-mono text-surface-400\">{call.call_number}</span>\r\n                                        <p className=\"text-sm font-semibold text-surface-900\">{call.customer?.name}</p>\r\n                                    </div>\r\n                                    <Badge variant={call.status === 'completed' ? 'success' : call.status === 'cancelled' ? 'danger' : call.status === 'in_progress' ? 'warning' : 'info'}>\r\n                                        {st.label}\r\n                                    </Badge>\r\n                                </div>\r\n                                <p className=\"text-xs text-surface-600 line-clamp-2 mb-3\">{call.description}</p>\r\n                                <div className=\"flex items-center gap-4 text-xs text-surface-500\">\r\n                                    {call.customer?.phone && (\r\n                                        <span className=\"flex items-center gap-1\"><Phone className=\"h-3 w-3\" />{call.customer.phone}</span>\r\n                                    )}\r\n                                    {call.latitude && call.longitude && (\r\n                                        <a href={`https://www.google.com/maps?q=${call.latitude},${call.longitude}`}\r\n                                            target=\"_blank\" rel=\"noopener noreferrer\"\r\n                                            className=\"flex items-center gap-1 text-brand-600 hover:underline\">\r\n                                            <MapPin className=\"h-3 w-3\" />Ver no Maps\r\n                                        </a>\r\n                                    )}\r\n                                </div>\r\n                                {call.priority === 'urgent' && (\r\n                                    <div className=\"mt-2 flex items-center gap-1 text-xs text-red-600\">\r\n                                        <AlertTriangle className=\"h-3 w-3\" />Urgente\r\n                                    </div>\r\n                                )}\r\n                                {call.technician && (\r\n                                    <p className=\"mt-2 text-xs text-surface-500\">Técnico: <span className=\"font-medium text-surface-700\">{call.technician.name}</span></p>\r\n                                )}\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n            )}\r\n\r\n            {/* Legenda */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                {Object.entries(statusLabels).map(([k, v]) => (\r\n                    <div key={k} className=\"flex items-center gap-1.5 text-xs text-surface-600\">\r\n                        <span className=\"h-2.5 w-2.5 rounded-full\" style={{ backgroundColor: v.color }} />\r\n                        {v.label}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\chamados\\ServiceCallsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[546,549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[546,549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[557,560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[557,560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1614,1617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1614,1617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10249,10252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10249,10252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":207,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13696,13699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13696,13699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":121,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":124,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14906,14909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14906,14909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15144,15147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15144,15147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15279,15282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15279,15282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":225,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15423,15426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15423,15426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":227,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15601,15604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15601,15604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16740,16743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16740,16743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17358,17361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17358,17361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":123,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":126,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17582,17585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17582,17585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Plus, Search, Phone, MapPin, UserCheck, ArrowRight,\r\n    AlertCircle, Clock, Truck, CheckCircle, XCircle,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any; icon: any }> = {\r\n    open: { label: 'Aberto', variant: 'info', icon: Phone },\r\n    scheduled: { label: 'Agendado', variant: 'warning', icon: Clock },\r\n    in_transit: { label: 'Em Deslocamento', variant: 'info', icon: Truck },\r\n    in_progress: { label: 'Em Atendimento', variant: 'default', icon: AlertCircle },\r\n    completed: { label: 'Concluído', variant: 'success', icon: CheckCircle },\r\n    cancelled: { label: 'Cancelado', variant: 'danger', icon: XCircle },\r\n}\r\n\r\nconst priorityConfig: Record<string, { label: string; color: string }> = {\r\n    low: { label: 'Baixa', color: 'text-surface-500' },\r\n    normal: { label: 'Normal', color: 'text-blue-500' },\r\n    high: { label: 'Alta', color: 'text-amber-500' },\r\n    urgent: { label: 'Urgente', color: 'text-red-500' },\r\n}\r\n\r\nexport function ServiceCallsPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n    const [showCreate, setShowCreate] = useState(false)\r\n    const [showAssign, setShowAssign] = useState<any>(null)\r\n\r\n    // Form state\r\n    const [form, setForm] = useState({ customer_id: '', priority: 'normal', address: '', city: '', state: '', observations: '', scheduled_date: '' })\r\n    const [assignForm, setAssignForm] = useState({ technician_id: '', driver_id: '', scheduled_date: '' })\r\n    const [customerSearch, setCustomerSearch] = useState('')\r\n\r\n    const { data: summaryRes } = useQuery({ queryKey: ['service-calls-summary'], queryFn: () => api.get('/service-calls-summary') })\r\n    const summary = summaryRes?.data ?? {}\r\n\r\n    const { data: callsRes } = useQuery({\r\n        queryKey: ['service-calls', search, statusFilter],\r\n        queryFn: () => api.get('/service-calls', { params: { search: search || undefined, status: statusFilter || undefined, per_page: 50 } }),\r\n    })\r\n    const calls = callsRes?.data?.data ?? []\r\n\r\n    const { data: customersRes } = useQuery({\r\n        queryKey: ['customers-lookup', customerSearch],\r\n        queryFn: () => api.get('/customers', { params: { search: customerSearch, per_page: 10 } }),\r\n        enabled: customerSearch.length > 1,\r\n    })\r\n\r\n    const { data: techniciansRes } = useQuery({\r\n        queryKey: ['users-all'],\r\n        queryFn: () => api.get('/users', { params: { per_page: 100 } }),\r\n    })\r\n    const technicians = techniciansRes?.data?.data ?? []\r\n\r\n    const createMut = useMutation({\r\n        mutationFn: () => api.post('/service-calls', form),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['service-calls'] }); setShowCreate(false) },\r\n    })\r\n\r\n    const assignMut = useMutation({\r\n        mutationFn: () => api.put(`/service-calls/${showAssign.id}/assign`, assignForm),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['service-calls'] }); setShowAssign(null) },\r\n    })\r\n\r\n    const statusMut = useMutation({\r\n        mutationFn: ({ id, status }: { id: number; status: string }) => api.put(`/service-calls/${id}/status`, { status }),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['service-calls'] }),\r\n    })\r\n\r\n    const convertMut = useMutation({\r\n        mutationFn: (id: number) => api.post(`/service-calls/${id}/convert-to-os`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['service-calls'] }),\r\n    })\r\n\r\n    const stats = [\r\n        { label: 'Abertos', value: summary.open ?? 0, icon: Phone, color: 'text-blue-600' },\r\n        { label: 'Agendados', value: summary.scheduled ?? 0, icon: Clock, color: 'text-amber-600' },\r\n        { label: 'Em Andamento', value: summary.in_progress ?? 0, icon: Truck, color: 'text-cyan-600' },\r\n        { label: 'Concluídos Hoje', value: summary.completed_today ?? 0, icon: CheckCircle, color: 'text-emerald-600' },\r\n    ]\r\n\r\n    const nextStatus: Record<string, string> = {\r\n        open: 'scheduled', scheduled: 'in_transit', in_transit: 'in_progress', in_progress: 'completed',\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div><h1 className=\"text-2xl font-bold text-surface-900\">Chamados Técnicos</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Gestão de atendimentos e agendamentos</p></div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => setShowCreate(true)}>Novo Chamado</Button>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-2 gap-4 lg:grid-cols-4\">\r\n                {stats.map(s => {\r\n                    const Icon = s.icon\r\n                    return (\r\n                        <div key={s.label} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className={`rounded-lg bg-surface-50 p-2 ${s.color}`}><Icon className=\"h-5 w-5\" /></div>\r\n                                <div><p className=\"text-xs text-surface-500\">{s.label}</p><p className=\"text-xl font-bold text-surface-900\">{s.value}</p></div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                })}\r\n            </div>\r\n\r\n            {/* Pipeline Visual */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                <h3 className=\"text-sm font-semibold text-surface-900 mb-3\">Fluxo de Atendimento</h3>\r\n                <div className=\"flex items-center gap-1\">\r\n                    {[\r\n                        { key: 'open', label: 'Aberto', count: summary.open ?? 0, color: 'bg-blue-500' },\r\n                        { key: 'scheduled', label: 'Agendado', count: summary.scheduled ?? 0, color: 'bg-amber-500' },\r\n                        { key: 'in_transit', label: 'Deslocamento', count: summary.in_transit ?? 0, color: 'bg-cyan-500' },\r\n                        { key: 'in_progress', label: 'Atendimento', count: summary.in_progress ?? 0, color: 'bg-brand-500' },\r\n                        { key: 'completed', label: 'Concluído', count: summary.completed_today ?? 0, color: 'bg-emerald-500' },\r\n                    ].map((stage, i, arr) => (\r\n                        <React.Fragment key={stage.key}>\r\n                            <div className=\"flex-1 text-center\">\r\n                                <div className={`mx-auto h-10 rounded-lg ${stage.color} flex items-center justify-center`}>\r\n                                    <span className=\"text-sm font-bold text-white\">{stage.count}</span>\r\n                                </div>\r\n                                <p className=\"text-[10px] text-surface-500 mt-1 font-medium\">{stage.label}</p>\r\n                            </div>\r\n                            {i < arr.length - 1 && (\r\n                                <ArrowRight className=\"h-4 w-4 text-surface-300 flex-shrink-0\" />\r\n                            )}\r\n                        </React.Fragment>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <div className=\"relative flex-1 min-w-[200px]\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)} placeholder=\"Buscar chamado ou cliente...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2 pl-10 pr-3 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                </div>\r\n                <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm\">\r\n                    <option value=\"\">Todos</option>\r\n                    {Object.entries(statusConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead><tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                        <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Nº</th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Cliente</th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Técnico</th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Status</th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Prioridade</th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Agendado</th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Local</th>\r\n                        <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Ações</th>\r\n                    </tr></thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {calls.length === 0 ? (\r\n                            <tr><td colSpan={8} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum chamado encontrado</td></tr>\r\n                        ) : calls.map((c: any) => {\r\n                            const sc = statusConfig[c.status] ?? statusConfig.open\r\n                            const pr = priorityConfig[c.priority] ?? priorityConfig.normal\r\n                            return (\r\n                                <tr key={c.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 text-sm font-mono font-semibold text-brand-700\">{c.call_number}</td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-900\">{c.customer?.name}</td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-600\">{c.technician?.name ?? <span className=\"text-amber-500 italic\">Não atribuído</span>}</td>\r\n                                    <td className=\"px-4 py-3\"><Badge variant={sc.variant}>{sc.label}</Badge></td>\r\n                                    <td className=\"px-4 py-3\"><span className={`text-sm font-medium ${pr.color}`}>{pr.label}</span></td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-500\">{c.scheduled_date ? new Date(c.scheduled_date).toLocaleDateString('pt-BR') : '—'}</td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-500\">{c.city && c.state ? `${c.city}/${c.state}` : '—'}</td>\r\n                                    <td className=\"px-4 py-3 text-right\">\r\n                                        <div className=\"flex justify-end gap-1\">\r\n                                            {!c.technician_id && (<button onClick={() => { setShowAssign(c); setAssignForm({ technician_id: '', driver_id: '', scheduled_date: '' }) }} title=\"Atribuir técnico\"\r\n                                                className=\"rounded p-1.5 text-blue-600 hover:bg-blue-50\"><UserCheck className=\"h-4 w-4\" /></button>)}\r\n                                            {nextStatus[c.status] && (<button onClick={() => statusMut.mutate({ id: c.id, status: nextStatus[c.status] })} title=\"Avançar status\"\r\n                                                className=\"rounded p-1.5 text-emerald-600 hover:bg-emerald-50\"><ArrowRight className=\"h-4 w-4\" /></button>)}\r\n                                            {(c.status === 'completed' || c.status === 'in_progress') && (<button onClick={() => convertMut.mutate(c.id)} title=\"Converter em OS\"\r\n                                                className=\"rounded p-1.5 text-brand-600 hover:bg-brand-50\"><MapPin className=\"h-4 w-4\" /></button>)}\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            )\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Modal Criar */}\r\n            <Modal open={showCreate} onOpenChange={(v) => { if (!v) setShowCreate(false) }} title=\"Novo Chamado Técnico\">\r\n                <div className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"text-sm font-medium text-surface-700\">Cliente</label>\r\n                        <input value={customerSearch} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCustomerSearch(e.target.value)} placeholder=\"Buscar cliente...\"\r\n                            className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                        {(customersRes?.data?.data ?? []).map((c: any) => (\r\n                            <button key={c.id} onClick={() => { setForm(f => ({ ...f, customer_id: c.id })); setCustomerSearch(c.name) }}\r\n                                className={`mt-1 w-full rounded border p-2 text-left text-sm ${+form.customer_id === c.id ? 'border-brand-500 bg-brand-50' : 'border-surface-200'}`}>\r\n                                {c.name}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div><label className=\"text-sm font-medium text-surface-700\">Prioridade</label>\r\n                            <select value={form.priority} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, priority: e.target.value }))}\r\n                                className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                {Object.entries(priorityConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                            </select></div>\r\n                        <Input label=\"Data Agendamento\" type=\"datetime-local\" value={form.scheduled_date} onChange={(e: any) => setForm(f => ({ ...f, scheduled_date: e.target.value }))} />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-3 gap-4\">\r\n                        <Input label=\"Cidade\" value={form.city} onChange={(e: any) => setForm(f => ({ ...f, city: e.target.value }))} />\r\n                        <Input label=\"UF\" value={form.state} onChange={(e: any) => setForm(f => ({ ...f, state: e.target.value }))} />\r\n                        <Input label=\"Endereço\" value={form.address} onChange={(e: any) => setForm(f => ({ ...f, address: e.target.value }))} />\r\n                    </div>\r\n                    <Input label=\"Observações\" value={form.observations} onChange={(e: any) => setForm(f => ({ ...f, observations: e.target.value }))} />\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button variant=\"outline\" onClick={() => setShowCreate(false)}>Cancelar</Button>\r\n                        <Button onClick={() => createMut.mutate()} loading={createMut.isPending}>Criar Chamado</Button>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n\r\n            {/* Modal Atribuir */}\r\n            <Modal open={!!showAssign} onOpenChange={(v) => { if (!v) setShowAssign(null) }} title=\"Atribuir Técnico\">\r\n                <div className=\"space-y-4\">\r\n                    <div><label className=\"text-sm font-medium text-surface-700\">Técnico</label>\r\n                        <select value={assignForm.technician_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setAssignForm(f => ({ ...f, technician_id: e.target.value }))}\r\n                            className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                            <option value=\"\">Selecione</option>\r\n                            {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                        </select></div>\r\n                    <div><label className=\"text-sm font-medium text-surface-700\">Motorista (UMC)</label>\r\n                        <select value={assignForm.driver_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setAssignForm(f => ({ ...f, driver_id: e.target.value }))}\r\n                            className=\"mt-1 w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                            <option value=\"\">Selecione (opcional)</option>\r\n                            {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                        </select></div>\r\n                    <Input label=\"Data Agendamento\" type=\"datetime-local\" value={assignForm.scheduled_date} onChange={(e: any) => setAssignForm(f => ({ ...f, scheduled_date: e.target.value }))} />\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button variant=\"outline\" onClick={() => setShowAssign(null)}>Cancelar</Button>\r\n                        <Button onClick={() => assignMut.mutate()} loading={assignMut.isPending}>Atribuir</Button>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\chamados\\TechnicianAgendaPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":3,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[109,119],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[419,422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[419,422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2155,2158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2155,2158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2308,2311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2308,2311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3664,3667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3664,3667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6210,6213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6210,6213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8818,8821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8818,8821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9190,9193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9190,9193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { ArrowLeft, Calendar, Clock, User, ChevronLeft, ChevronRight } from 'lucide-react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport api from '@/lib/api'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Button } from '@/components/ui/Button'\r\n\r\nconst statusLabels: Record<string, { label: string; variant: any }> = {\r\n    open: { label: 'Aberto', variant: 'info' },\r\n    scheduled: { label: 'Agendado', variant: 'warning' },\r\n    en_route: { label: 'A Caminho', variant: 'brand' },\r\n    in_progress: { label: 'Em Atend.', variant: 'danger' },\r\n    completed: { label: 'Concluído', variant: 'success' },\r\n    cancelled: { label: 'Cancelado', variant: 'default' },\r\n}\r\n\r\nconst WEEKDAYS = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab']\r\n\r\nfunction formatDate(d: Date) {\r\n    return d.toISOString().split('T')[0]\r\n}\r\n\r\nexport function TechnicianAgendaPage() {\r\n    const navigate = useNavigate()\r\n    const [selectedTech, setSelectedTech] = useState<string>('')\r\n    const [weekOffset, setWeekOffset] = useState(0)\r\n\r\n    const { data: techsRes } = useQuery({\r\n        queryKey: ['technicians'],\r\n        queryFn: () => api.get('/users', { params: { per_page: 50 } }),\r\n    })\r\n\r\n    const today = new Date()\r\n    const startOfWeek = new Date(today)\r\n    startOfWeek.setDate(today.getDate() - today.getDay() + 1 + weekOffset * 7) // Monday\r\n    const weekDays = Array.from({ length: 7 }, (_, i) => {\r\n        const d = new Date(startOfWeek)\r\n        d.setDate(startOfWeek.getDate() + i)\r\n        return d\r\n    })\r\n\r\n    const { data: agendaRes, isLoading } = useQuery({\r\n        queryKey: ['agenda', selectedTech, formatDate(weekDays[0]), formatDate(weekDays[6])],\r\n        queryFn: () => api.get('/service-calls/agenda', {\r\n            params: {\r\n                technician_id: selectedTech || undefined,\r\n                date_from: formatDate(weekDays[0]),\r\n                date_to: formatDate(weekDays[6]),\r\n            },\r\n        }),\r\n        enabled: true,\r\n    })\r\n\r\n    const technicians = techsRes?.data?.data ?? []\r\n    const calls: any[] = agendaRes?.data ?? []\r\n\r\n    const getCallsForDay = (date: Date) => {\r\n        const dateStr = formatDate(date)\r\n        return calls.filter((c: any) => c.scheduled_date === dateStr || c.created_at?.startsWith(dateStr))\r\n    }\r\n\r\n    const isToday = (d: Date) => formatDate(d) === formatDate(today)\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button onClick={() => navigate('/chamados')} className=\"rounded-lg p-1.5 hover:bg-surface-100\">\r\n                        <ArrowLeft className=\"h-5 w-5 text-surface-500\" />\r\n                    </button>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-surface-900\">Agenda de Técnicos</h1>\r\n                        <p className=\"text-sm text-surface-500\">Chamados agendados por semana</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <select value={selectedTech} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setSelectedTech(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                        <option value=\"\">Todos os técnicos</option>\r\n                        {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Week navigation */}\r\n            <div className=\"flex items-center justify-between rounded-xl border border-surface-200 bg-white px-4 py-3 shadow-card\">\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setWeekOffset(w => w - 1)}>\r\n                    <ChevronLeft className=\"h-4 w-4\" />\r\n                </Button>\r\n                <div className=\"text-center\">\r\n                    <p className=\"text-sm font-semibold text-surface-900\">\r\n                        {weekDays[0].toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' })} — {weekDays[6].toLocaleDateString('pt-BR', { day: '2-digit', month: 'short', year: 'numeric' })}\r\n                    </p>\r\n                    {weekOffset !== 0 && (\r\n                        <button onClick={() => setWeekOffset(0)} className=\"text-xs text-brand-600 hover:underline\">Ir para hoje</button>\r\n                    )}\r\n                </div>\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setWeekOffset(w => w + 1)}>\r\n                    <ChevronRight className=\"h-4 w-4\" />\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Calendar grid */}\r\n            {isLoading ? (\r\n                <div className=\"py-16 text-center text-sm text-surface-500\">Carregando agenda...</div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-7 gap-2\">\r\n                    {weekDays.map((day, i) => {\r\n                        const dayCalls = getCallsForDay(day)\r\n                        return (\r\n                            <div key={i} className={`rounded-xl border bg-white p-3 min-h-[140px] shadow-card transition-colors ${isToday(day) ? 'border-brand-400 bg-brand-50/30' : 'border-surface-200'}`}>\r\n                                <div className=\"mb-2 text-center\">\r\n                                    <p className=\"text-[10px] font-medium uppercase text-surface-400\">{WEEKDAYS[day.getDay()]}</p>\r\n                                    <p className={`text-lg font-bold ${isToday(day) ? 'text-brand-600' : 'text-surface-900'}`}>{day.getDate()}</p>\r\n                                </div>\r\n                                <div className=\"space-y-1.5\">\r\n                                    {dayCalls.length === 0 ? (\r\n                                        <p className=\"py-2 text-center text-[10px] text-surface-300\">—</p>\r\n                                    ) : dayCalls.map((call: any) => {\r\n                                        const st = statusLabels[call.status] ?? statusLabels.open\r\n                                        return (\r\n                                            <div key={call.id} className=\"rounded-md border border-surface-100 bg-surface-50 p-1.5 hover:bg-surface-100 cursor-pointer transition-colors\"\r\n                                                title={`${call.call_number} — ${call.customer?.name}`}>\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <Badge variant={st.variant} className=\"text-[8px] px-1 py-0\">{st.label}</Badge>\r\n                                                </div>\r\n                                                <p className=\"text-[10px] font-medium text-surface-700 mt-0.5 truncate\">{call.customer?.name}</p>\r\n                                                {call.technician && (\r\n                                                    <p className=\"text-[9px] text-surface-400 flex items-center gap-0.5 mt-0.5\">\r\n                                                        <User className=\"h-2 w-2\" />{call.technician.name}\r\n                                                    </p>\r\n                                                )}\r\n                                                {call.scheduled_time && (\r\n                                                    <p className=\"text-[9px] text-surface-400 flex items-center gap-0.5\">\r\n                                                        <Clock className=\"h-2 w-2\" />{call.scheduled_time}\r\n                                                    </p>\r\n                                                )}\r\n                                            </div>\r\n                                        )\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n            )}\r\n\r\n            {/* Summary */}\r\n            <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card text-center\">\r\n                    <p className=\"text-2xl font-bold text-brand-600\">{calls.length}</p>\r\n                    <p className=\"text-xs text-surface-500\">Chamados na semana</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card text-center\">\r\n                    <p className=\"text-2xl font-bold text-amber-600\">{calls.filter((c: any) => ['open', 'scheduled', 'en_route'].includes(c.status)).length}</p>\r\n                    <p className=\"text-xs text-surface-500\">Pendentes</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card text-center\">\r\n                    <p className=\"text-2xl font-bold text-emerald-600\">{calls.filter((c: any) => c.status === 'completed').length}</p>\r\n                    <p className=\"text-xs text-surface-500\">Concluídos</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\configuracoes\\AuditLogsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":4,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[120,128],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":4,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[133,136],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowRight' is defined but never used.","line":4,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ArrowRight"},"fix":{"range":[136,148],"text":""},"desc":"Remove unused variable \"ArrowRight\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":4,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":54,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[148,154],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":4,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":64,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[154,164],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[218,250],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[505,508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[505,508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1098,1101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1098,1101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":35,"column":72,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1676,1679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1676,1679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1689,1692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1689,1692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7022,7025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7022,7025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport {\r\n    History, Search, Filter, Eye, X, ArrowRight, User, Calendar\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\nconst actionConfig: Record<string, { label: string; variant: any }> = {\r\n    created: { label: 'Criado', variant: 'success' },\r\n    updated: { label: 'Atualizado', variant: 'warning' },\r\n    deleted: { label: 'Excluído', variant: 'danger' },\r\n    login: { label: 'Login', variant: 'info' },\r\n    logout: { label: 'Logout', variant: 'default' },\r\n    status_changed: { label: 'Status', variant: 'brand' },\r\n}\r\n\r\nconst fmtDate = (d: string) => new Date(d).toLocaleString('pt-BR')\r\n\r\nexport function AuditLogsPage() {\r\n    const [page, setPage] = useState(1)\r\n    const [search, setSearch] = useState('')\r\n    const [selectedLog, setSelectedLog] = useState<any>(null)\r\n    const [filters, setFilters] = useState({ user_id: '', action: '', date_from: '', date_to: '' })\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['audit-logs', page, search, filters],\r\n        queryFn: () => api.get('/audit-logs', {\r\n            params: {\r\n                page, search: search || undefined,\r\n                ...Object.fromEntries(Object.entries(filters).filter(([_, v]) => v))\r\n            }\r\n        }),\r\n    })\r\n\r\n    const logs = res?.data?.data ?? []\r\n    const meta = res?.data ?? {}\r\n\r\n    const renderDiff = (oldVal: any, newVal: any) => {\r\n        if (!oldVal && !newVal) return <p className=\"text-sm text-surface-500 italic\">Sem alterações registradas.</p>\r\n\r\n        const allKeys = new Set([...Object.keys(oldVal || {}), ...Object.keys(newVal || {})])\r\n        const changes: string[] = []\r\n\r\n        allKeys.forEach(key => {\r\n            const v1 = oldVal?.[key]\r\n            const v2 = newVal?.[key]\r\n            if (JSON.stringify(v1) !== JSON.stringify(v2)) {\r\n                changes.push(key)\r\n            }\r\n        })\r\n\r\n        if (changes.length === 0) return <p className=\"text-sm text-surface-500 italic\">Nenhuma mudança identificada.</p>\r\n\r\n        return (\r\n            <div className=\"space-y-3\">\r\n                {changes.map(key => (\r\n                    <div key={key} className=\"grid grid-cols-2 gap-4 rounded-lg border border-surface-200 p-3 text-sm\">\r\n                        <div>\r\n                            <span className=\"mb-1 block text-xs font-semibold uppercase text-surface-500\">{key} (Antes)</span>\r\n                            <pre className=\"whitespace-pre-wrap rounded bg-red-50 p-2 text-red-700 font-mono text-xs\">\r\n                                {JSON.stringify(oldVal?.[key] ?? null, null, 2)}\r\n                            </pre>\r\n                        </div>\r\n                        <div>\r\n                            <span className=\"mb-1 block text-xs font-semibold uppercase text-surface-500\">{key} (Depois)</span>\r\n                            <pre className=\"whitespace-pre-wrap rounded bg-emerald-50 p-2 text-emerald-700 font-mono text-xs\">\r\n                                {JSON.stringify(newVal?.[key] ?? null, null, 2)}\r\n                            </pre>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Logs de Auditoria</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Rastreabilidade e histórico de alterações</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3 rounded-xl border border-surface-200 bg-white p-4 shadow-sm\">\r\n                <div className=\"relative flex-1 min-w-[200px]\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input\r\n                        value={search} onChange={e => setSearch(e.target.value)}\r\n                        placeholder=\"Buscar em descrições e valores...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none\"\r\n                    />\r\n                </div>\r\n                <select\r\n                    value={filters.action} onChange={e => setFilters(f => ({ ...f, action: e.target.value }))}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\"\r\n                >\r\n                    <option value=\"\">Todas as ações</option>\r\n                    {Object.entries(actionConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                </select>\r\n                <Input type=\"date\" value={filters.date_from} onChange={e => setFilters(f => ({ ...f, date_from: e.target.value }))} className=\"w-auto\" />\r\n                <Input type=\"date\" value={filters.date_to} onChange={e => setFilters(f => ({ ...f, date_to: e.target.value }))} className=\"w-auto\" />\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Data</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Usuário</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Ação</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Recurso</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Descrição</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Detalhes</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={6} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : logs.length === 0 ? (\r\n                            <tr><td colSpan={6} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum registro encontrado</td></tr>\r\n                        ) : logs.map((log: any) => (\r\n                            <tr key={log.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                <td className=\"px-4 py-3 text-sm text-surface-500 whitespace-nowrap\">\r\n                                    {fmtDate(log.created_at)}\r\n                                </td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"flex h-6 w-6 items-center justify-center rounded-full bg-surface-100 text-xs font-bold text-surface-600\">\r\n                                            {log.user?.name?.charAt(0) ?? '?'}\r\n                                        </div>\r\n                                        <span className=\"text-sm font-medium text-surface-900\">{log.user?.name ?? 'Sistema'}</span>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <Badge variant={actionConfig[log.action]?.variant}>{actionConfig[log.action]?.label ?? log.action}</Badge>\r\n                                </td>\r\n                                <td className=\"px-4 py-3 text-sm text-surface-600\">\r\n                                    {log.auditable_type?.split('\\\\').pop()} #{log.auditable_id}\r\n                                </td>\r\n                                <td className=\"px-4 py-3 text-sm text-surface-900 max-w-xs truncate\" title={log.description}>\r\n                                    {log.description}\r\n                                </td>\r\n                                <td className=\"px-4 py-3 text-right\">\r\n                                    <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedLog(log)}>\r\n                                        <Eye className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n                {/* Pagination (Simple) */}\r\n                <div className=\"flex items-center justify-between border-t border-surface-200 px-4 py-3\">\r\n                    <Button variant=\"outline\" size=\"sm\" disabled={page <= 1} onClick={() => setPage(p => p - 1)}>Anterior</Button>\r\n                    <span className=\"text-sm text-surface-600\">Página {meta.current_page} de {meta.last_page}</span>\r\n                    <Button variant=\"outline\" size=\"sm\" disabled={page >= (meta.last_page || 1)} onClick={() => setPage(p => p + 1)}>Próxima</Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Detail Modal */}\r\n            <Modal open={!!selectedLog} onOpenChange={() => setSelectedLog(null)} title=\"Detalhes da Auditoria\" size=\"lg\">\r\n                {selectedLog && (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"grid grid-cols-2 gap-4 rounded-lg bg-surface-50 p-4 text-sm\">\r\n                            <div><span className=\"text-surface-500\">Usuário:</span> <span className=\"font-medium\">{selectedLog.user?.name ?? 'Sistema'}</span></div>\r\n                            <div><span className=\"text-surface-500\">Data:</span> <span className=\"font-medium\">{fmtDate(selectedLog.created_at)}</span></div>\r\n                            <div><span className=\"text-surface-500\">Ação:</span> <Badge className=\"ml-2\" variant={actionConfig[selectedLog.action]?.variant}>{actionConfig[selectedLog.action]?.label}</Badge></div>\r\n                            <div><span className=\"text-surface-500\">IP:</span> <span className=\"font-medium font-mono\">{selectedLog.ip_address}</span></div>\r\n                            <div className=\"col-span-2\"><span className=\"text-surface-500\">Agent:</span> <span className=\"text-xs text-surface-700 truncate block\" title={selectedLog.user_agent}>{selectedLog.user_agent}</span></div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <h4 className=\"mb-3 text-sm font-semibold text-surface-900 flex items-center gap-2\">\r\n                                <History className=\"h-4 w-4\" /> Alterações\r\n                            </h4>\r\n                            {renderDiff(selectedLog.old_values, selectedLog.new_values)}\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end pt-4 border-t border-surface-100\">\r\n                            <Button variant=\"outline\" onClick={() => setSelectedLog(null)}>Fechar</Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\configuracoes\\BranchesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":4,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":60,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[179,182],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Check' is defined but never used.","line":4,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":67,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Check"},"fix":{"range":[182,189],"text":""},"desc":"Remove unused variable \"Check\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Building2, Plus, Pencil, Trash2, Phone, Mail, MapPin, X, Check,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\ninterface Branch {\r\n    id: number\r\n    name: string\r\n    code: string | null\r\n    address_street: string | null\r\n    address_number: string | null\r\n    address_complement: string | null\r\n    address_neighborhood: string | null\r\n    address_city: string | null\r\n    address_state: string | null\r\n    address_zip: string | null\r\n    phone: string | null\r\n    email: string | null\r\n}\r\n\r\nconst emptyForm = {\r\n    name: '', code: '',\r\n    address_street: '', address_number: '', address_complement: '',\r\n    address_neighborhood: '', address_city: '', address_state: '', address_zip: '',\r\n    phone: '', email: '',\r\n}\r\n\r\nexport function BranchesPage() {\r\n    const qc = useQueryClient()\r\n    const [showModal, setShowModal] = useState(false)\r\n    const [editingId, setEditingId] = useState<number | null>(null)\r\n    const [form, setForm] = useState(emptyForm)\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['branches'],\r\n        queryFn: () => api.get('/branches'),\r\n    })\r\n    const branches: Branch[] = res?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof emptyForm) =>\r\n            editingId ? api.put(`/branches/${editingId}`, data) : api.post('/branches', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['branches'] }); closeModal() },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/branches/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['branches'] }),\r\n    })\r\n\r\n    function openNew() {\r\n        setEditingId(null)\r\n        setForm(emptyForm)\r\n        setShowModal(true)\r\n    }\r\n\r\n    function openEdit(b: Branch) {\r\n        setEditingId(b.id)\r\n        setForm({\r\n            name: b.name, code: b.code ?? '',\r\n            address_street: b.address_street ?? '', address_number: b.address_number ?? '',\r\n            address_complement: b.address_complement ?? '', address_neighborhood: b.address_neighborhood ?? '',\r\n            address_city: b.address_city ?? '', address_state: b.address_state ?? '',\r\n            address_zip: b.address_zip ?? '', phone: b.phone ?? '', email: b.email ?? '',\r\n        })\r\n        setShowModal(true)\r\n    }\r\n\r\n    function closeModal() { setShowModal(false); setEditingId(null) }\r\n\r\n    const set = (key: string) => (e: React.ChangeEvent<HTMLInputElement>) =>\r\n        setForm(f => ({ ...f, [key]: e.target.value }))\r\n\r\n    if (isLoading) return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <div className=\"skeleton h-7 w-32\" />\r\n                    <div className=\"skeleton mt-2 h-4 w-48\" />\r\n                </div>\r\n                <div className=\"skeleton h-9 w-28\" />\r\n            </div>\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n                {[1, 2, 3].map(i => <div key={i} className=\"skeleton h-32 rounded-xl\" />)}\r\n            </div>\r\n        </div>\r\n    )\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Filiais</h1>\r\n                    <p className=\"text-sm text-surface-500\">{branches.length} filiais cadastradas</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={openNew}>Nova Filial</Button>\r\n            </div>\r\n\r\n            {branches.length === 0 ? (\r\n                <div className=\"rounded-xl border border-dashed border-surface-300 bg-surface-50 py-16 text-center\">\r\n                    <Building2 className=\"mx-auto mb-3 h-10 w-10 text-surface-300\" />\r\n                    <p className=\"text-sm font-medium text-surface-500\">Nenhuma filial cadastrada</p>\r\n                    <p className=\"mt-1 text-xs text-surface-400\">Crie sua primeira filial para começar</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n                    {branches.map((b, i) => (\r\n                        <div key={b.id} className={`animate-slide-up stagger-${Math.min(i + 1, 6)} rounded-xl border border-surface-200 bg-white p-5 shadow-card hover:shadow-elevated hover:-translate-y-0.5 transition-all duration-200`}>\r\n                            <div className=\"flex items-start justify-between\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-brand-50\">\r\n                                        <Building2 className=\"h-5 w-5 text-brand-600\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h3 className=\"font-semibold text-surface-900\">{b.name}</h3>\r\n                                        {b.code && <span className=\"text-xs text-surface-400 font-mono\">{b.code}</span>}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex gap-1\">\r\n                                    <button onClick={() => openEdit(b)} title=\"Editar\" className=\"rounded-md p-1.5 text-surface-400 hover:bg-surface-100 hover:text-surface-600\">\r\n                                        <Pencil className=\"h-3.5 w-3.5\" />\r\n                                    </button>\r\n                                    <button onClick={() => { if (confirm(`Remover filial \"${b.name}\"?`)) deleteMut.mutate(b.id) }}\r\n                                        title=\"Excluir\" className=\"rounded-md p-1.5 text-surface-400 hover:bg-red-50 hover:text-red-500\">\r\n                                        <Trash2 className=\"h-3.5 w-3.5\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"mt-3 space-y-1.5 text-xs text-surface-500\">\r\n                                {b.address_city && (\r\n                                    <p className=\"flex items-center gap-1.5\">\r\n                                        <MapPin className=\"h-3 w-3\" />\r\n                                        {b.address_street && `${b.address_street}, ${b.address_number || 'S/N'} — `}\r\n                                        {b.address_city}/{b.address_state}\r\n                                    </p>\r\n                                )}\r\n                                {b.phone && <p className=\"flex items-center gap-1.5\"><Phone className=\"h-3 w-3\" />{b.phone}</p>}\r\n                                {b.email && <p className=\"flex items-center gap-1.5\"><Mail className=\"h-3 w-3\" />{b.email}</p>}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            <Modal open={showModal} onOpenChange={setShowModal} title={editingId ? 'Editar Filial' : 'Nova Filial'} size=\"lg\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        <Input label=\"Nome *\" value={form.name} onChange={set('name')} required />\r\n                        <Input label=\"Código\" value={form.code} onChange={set('code')} />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-3 gap-3\">\r\n                        <div className=\"col-span-2\"><Input label=\"Rua\" value={form.address_street} onChange={set('address_street')} /></div>\r\n                        <Input label=\"Número\" value={form.address_number} onChange={set('address_number')} />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-3 gap-3\">\r\n                        <Input label=\"Complemento\" value={form.address_complement} onChange={set('address_complement')} />\r\n                        <Input label=\"Bairro\" value={form.address_neighborhood} onChange={set('address_neighborhood')} />\r\n                        <Input label=\"CEP\" value={form.address_zip} onChange={set('address_zip')} />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-3 gap-3\">\r\n                        <Input label=\"Cidade\" value={form.address_city} onChange={set('address_city')} />\r\n                        <Input label=\"UF\" value={form.address_state} onChange={set('address_state')} maxLength={2} />\r\n                        <Input label=\"Telefone\" value={form.phone} onChange={set('phone')} />\r\n                    </div>\r\n                    <Input label=\"E-mail\" type=\"email\" value={form.email} onChange={set('email')} />\r\n                    <div className=\"flex justify-end gap-2 pt-2\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={closeModal}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>{editingId ? 'Salvar' : 'Criar'}</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\configuracoes\\ProfilePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Mail' is defined but never used.","line":4,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Mail"},"fix":{"range":[131,137],"text":""},"desc":"Remove unused variable \"Mail\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Phone' is defined but never used.","line":4,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Phone"},"fix":{"range":[137,144],"text":""},"desc":"Remove unused variable \"Phone\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8671,8674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8671,8674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    User, Mail, Phone, Shield, Building2, Key, Save, CheckCircle, Eye, EyeOff,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { useAuthStore } from '@/stores/auth-store'\r\n\r\nexport function ProfilePage() {\r\n    const qc = useQueryClient()\r\n    const { setUser } = useAuthStore()\r\n    const [showPassword, setShowPassword] = useState(false)\r\n    const [passwordForm, setPasswordForm] = useState({ current_password: '', password: '', password_confirmation: '' })\r\n    const [saved, setSaved] = useState(false)\r\n    const [pwSaved, setPwSaved] = useState(false)\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['profile'],\r\n        queryFn: () => api.get('/me'),\r\n    })\r\n    const profile = res?.data\r\n\r\n    const [form, setForm] = useState<{ name: string; email: string; phone: string }>({\r\n        name: '', email: '', phone: '',\r\n    })\r\n\r\n    const isFormLoaded = form.name !== '' || form.email !== ''\r\n\r\n    if (profile && !isFormLoaded) {\r\n        setForm({ name: profile.name ?? '', email: profile.email ?? '', phone: profile.phone ?? '' })\r\n    }\r\n\r\n    const updateMut = useMutation({\r\n        mutationFn: (data: typeof form) => api.put('/me', data),\r\n        onSuccess: (res) => {\r\n            qc.invalidateQueries({ queryKey: ['profile'] })\r\n            if (res.data?.user) setUser(res.data.user)\r\n            setSaved(true)\r\n            setTimeout(() => setSaved(false), 3000)\r\n        },\r\n    })\r\n\r\n    const passwordMut = useMutation({\r\n        mutationFn: (data: typeof passwordForm) => api.put('/me', data),\r\n        onSuccess: () => {\r\n            setPwSaved(true)\r\n            setPasswordForm({ current_password: '', password: '', password_confirmation: '' })\r\n            setTimeout(() => setPwSaved(false), 3000)\r\n        },\r\n    })\r\n\r\n    const set = (key: string) => (e: React.ChangeEvent<HTMLInputElement>) =>\r\n        setForm(f => ({ ...f, [key]: e.target.value }))\r\n\r\n    const setPw = (key: string) => (e: React.ChangeEvent<HTMLInputElement>) =>\r\n        setPasswordForm(f => ({ ...f, [key]: e.target.value }))\r\n\r\n    if (isLoading || !profile) {\r\n        return (\r\n            <div className=\"mx-auto max-w-3xl space-y-6 animate-fade-in\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"skeleton h-16 w-16 rounded-2xl\" />\r\n                    <div>\r\n                        <div className=\"skeleton h-7 w-40\" />\r\n                        <div className=\"skeleton mt-2 h-4 w-56\" />\r\n                    </div>\r\n                </div>\r\n                <div className=\"skeleton h-56 rounded-xl\" />\r\n                <div className=\"skeleton h-48 rounded-xl\" />\r\n                <div className=\"skeleton h-36 rounded-xl\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"mx-auto max-w-3xl space-y-6 animate-fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4\">\r\n                <div className=\"flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-brand-500 to-brand-700 text-2xl font-bold text-white shadow-lg\">\r\n                    {profile.name?.charAt(0)?.toUpperCase() ?? 'U'}\r\n                </div>\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">{profile.name}</h1>\r\n                    <p className=\"text-sm text-surface-500\">{profile.email}</p>\r\n                    <div className=\"mt-1 flex items-center gap-2\">\r\n                        {profile.roles?.map((r: string) => (\r\n                            <Badge key={r} variant=\"brand\">{r}</Badge>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Dados pessoais */}\r\n            <div className=\"animate-slide-up rounded-xl border border-surface-200 bg-white p-6 shadow-card hover:shadow-elevated transition-shadow duration-200\">\r\n                <h2 className=\"mb-4 flex items-center gap-2 text-lg font-semibold text-surface-900\">\r\n                    <User className=\"h-5 w-5 text-brand-500\" />\r\n                    Dados Pessoais\r\n                </h2>\r\n                <form onSubmit={e => { e.preventDefault(); updateMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <Input label=\"Nome\" value={form.name} onChange={set('name')} required />\r\n                        <Input label=\"Telefone\" value={form.phone} onChange={set('phone')} />\r\n                    </div>\r\n                    <Input label=\"E-mail\" type=\"email\" value={form.email} onChange={set('email')} required />\r\n                    <div className=\"flex items-center justify-between\">\r\n                        {saved && (\r\n                            <span className=\"flex items-center gap-1 text-sm font-medium text-emerald-600\">\r\n                                <CheckCircle className=\"h-4 w-4\" /> Salvo com sucesso\r\n                            </span>\r\n                        )}\r\n                        <div className=\"ml-auto\" />\r\n                        <Button type=\"submit\" loading={updateMut.isPending} icon={<Save className=\"h-4 w-4\" />}>\r\n                            Salvar Alterações\r\n                        </Button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n\r\n            {/* Alterar Senha */}\r\n            <div className=\"animate-slide-up stagger-2 rounded-xl border border-surface-200 bg-white p-6 shadow-card hover:shadow-elevated transition-shadow duration-200\">\r\n                <h2 className=\"mb-4 flex items-center gap-2 text-lg font-semibold text-surface-900\">\r\n                    <Key className=\"h-5 w-5 text-brand-500\" />\r\n                    Alterar Senha\r\n                </h2>\r\n                <form onSubmit={e => { e.preventDefault(); passwordMut.mutate(passwordForm) }} className=\"space-y-4\">\r\n                    <Input\r\n                        label=\"Senha Atual\"\r\n                        type={showPassword ? 'text' : 'password'}\r\n                        value={passwordForm.current_password}\r\n                        onChange={setPw('current_password')}\r\n                        required\r\n                    />\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <Input\r\n                            label=\"Nova Senha\"\r\n                            type={showPassword ? 'text' : 'password'}\r\n                            value={passwordForm.password}\r\n                            onChange={setPw('password')}\r\n                            required\r\n                        />\r\n                        <Input\r\n                            label=\"Confirmar Nova Senha\"\r\n                            type={showPassword ? 'text' : 'password'}\r\n                            value={passwordForm.password_confirmation}\r\n                            onChange={setPw('password_confirmation')}\r\n                            required\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => setShowPassword(!showPassword)}\r\n                            className=\"flex items-center gap-1.5 text-xs text-surface-500 hover:text-surface-700\"\r\n                        >\r\n                            {showPassword ? <EyeOff className=\"h-3.5 w-3.5\" /> : <Eye className=\"h-3.5 w-3.5\" />}\r\n                            {showPassword ? 'Ocultar senhas' : 'Mostrar senhas'}\r\n                        </button>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {pwSaved && (\r\n                                <span className=\"flex items-center gap-1 text-sm font-medium text-emerald-600\">\r\n                                    <CheckCircle className=\"h-4 w-4\" /> Senha alterada\r\n                                </span>\r\n                            )}\r\n                            <Button type=\"submit\" loading={passwordMut.isPending} icon={<Save className=\"h-4 w-4\" />}>\r\n                                Alterar Senha\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                    {passwordMut.isError && (\r\n                        <p className=\"text-sm text-red-600\">\r\n                            {(passwordMut.error as any)?.response?.data?.message || 'Erro ao alterar senha'}\r\n                        </p>\r\n                    )}\r\n                </form>\r\n            </div>\r\n\r\n            {/* Info card */}\r\n            <div className=\"animate-slide-up stagger-3 rounded-xl border border-surface-200 bg-white p-6 shadow-card hover:shadow-elevated transition-shadow duration-200\">\r\n                <h2 className=\"mb-4 flex items-center gap-2 text-lg font-semibold text-surface-900\">\r\n                    <Shield className=\"h-5 w-5 text-brand-500\" />\r\n                    Informações da Conta\r\n                </h2>\r\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                    <div>\r\n                        <span className=\"text-surface-500\">Tenant</span>\r\n                        <p className=\"mt-0.5 flex items-center gap-1.5 font-medium text-surface-800\">\r\n                            <Building2 className=\"h-3.5 w-3.5 text-brand-500\" />\r\n                            {profile.tenant?.name ?? '—'}\r\n                        </p>\r\n                    </div>\r\n                    <div>\r\n                        <span className=\"text-surface-500\">Filial</span>\r\n                        <p className=\"mt-0.5 font-medium text-surface-800\">{profile.branch?.name ?? '—'}</p>\r\n                    </div>\r\n                    <div>\r\n                        <span className=\"text-surface-500\">Permissões</span>\r\n                        <p className=\"mt-0.5 font-medium text-surface-800\">{profile.permissions?.length ?? 0} atribuídas</p>\r\n                    </div>\r\n                    <div>\r\n                        <span className=\"text-surface-500\">Membro desde</span>\r\n                        <p className=\"mt-0.5 font-medium text-surface-800\">\r\n                            {profile.created_at ? new Date(profile.created_at).toLocaleDateString('pt-BR') : '—'}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\configuracoes\\SettingsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Search' is defined but never used.","line":4,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[157,165],"text":""},"desc":"Remove unused variable \"Search\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":5,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[165,176],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Input' is defined but never used.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[478,523],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[623,626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[623,626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1043,1046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1043,1046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15148,15151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15148,15151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":295,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17605,17608],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17605,17608],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Settings, History, Save, Search,\r\n    User, Calendar, ArrowRight, Shield,\r\n    MessageSquare, Mail, Building2, GitBranch,\r\n    ChevronDown, ChevronUp, Download,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\ntype Tab = 'settings' | 'audit'\r\n\r\nconst actionLabels: Record<string, { label: string; variant: any }> = {\r\n    created: { label: 'Criado', variant: 'success' },\r\n    updated: { label: 'Atualizado', variant: 'info' },\r\n    deleted: { label: 'Excluído', variant: 'danger' },\r\n    login: { label: 'Login', variant: 'default' },\r\n    logout: { label: 'Logout', variant: 'default' },\r\n    status_changed: { label: 'Status Alterado', variant: 'warning' },\r\n}\r\n\r\nconst settingGroups: Record<string, { label: string; icon: any }> = {\r\n    general: { label: 'Empresa', icon: Building2 },\r\n    os: { label: 'Ordens de Serviço', icon: Settings },\r\n    financial: { label: 'Financeiro', icon: Shield },\r\n    notification: { label: 'Notificações', icon: Settings },\r\n    whatsapp: { label: 'WhatsApp / Evolution API', icon: MessageSquare },\r\n    smtp: { label: 'E-mail / SMTP', icon: Mail },\r\n    crm: { label: 'CRM', icon: GitBranch },\r\n}\r\n\r\ninterface SettingItem {\r\n    id?: number; key: string; value: string; type: string; group: string\r\n}\r\n\r\nconst defaultSettings: SettingItem[] = [\r\n    // Empresa\r\n    { key: 'company_name', value: '', type: 'string', group: 'general' },\r\n    { key: 'company_phone', value: '', type: 'string', group: 'general' },\r\n    { key: 'company_email', value: '', type: 'string', group: 'general' },\r\n    { key: 'company_document', value: '', type: 'string', group: 'general' },\r\n    { key: 'company_logo_url', value: '', type: 'string', group: 'general' },\r\n    { key: 'company_address', value: '', type: 'string', group: 'general' },\r\n    // OS\r\n    { key: 'default_warranty_days', value: '90', type: 'integer', group: 'os' },\r\n    { key: 'auto_generate_os_number', value: 'true', type: 'boolean', group: 'os' },\r\n    { key: 'require_approval_above', value: '500', type: 'integer', group: 'os' },\r\n    { key: 'os_number_prefix', value: 'OS-', type: 'string', group: 'os' },\r\n    // Financeiro\r\n    { key: 'default_payment_method', value: 'pix', type: 'string', group: 'financial' },\r\n    { key: 'late_fee_percentage', value: '2', type: 'integer', group: 'financial' },\r\n    { key: 'auto_generate_invoice', value: 'true', type: 'boolean', group: 'financial' },\r\n    // Notificações\r\n    { key: 'notify_overdue', value: 'true', type: 'boolean', group: 'notification' },\r\n    { key: 'notify_os_completed', value: 'true', type: 'boolean', group: 'notification' },\r\n    { key: 'notify_new_deal', value: 'true', type: 'boolean', group: 'notification' },\r\n    // WhatsApp\r\n    { key: 'evolution_api_url', value: '', type: 'string', group: 'whatsapp' },\r\n    { key: 'evolution_api_key', value: '', type: 'string', group: 'whatsapp' },\r\n    { key: 'evolution_instance', value: '', type: 'string', group: 'whatsapp' },\r\n    { key: 'whatsapp_enabled', value: 'false', type: 'boolean', group: 'whatsapp' },\r\n    // SMTP\r\n    { key: 'smtp_host', value: '', type: 'string', group: 'smtp' },\r\n    { key: 'smtp_port', value: '587', type: 'integer', group: 'smtp' },\r\n    { key: 'smtp_user', value: '', type: 'string', group: 'smtp' },\r\n    { key: 'smtp_password', value: '', type: 'string', group: 'smtp' },\r\n    { key: 'smtp_encryption', value: 'tls', type: 'string', group: 'smtp' },\r\n    { key: 'smtp_from_name', value: '', type: 'string', group: 'smtp' },\r\n    { key: 'smtp_from_email', value: '', type: 'string', group: 'smtp' },\r\n    // CRM\r\n    { key: 'crm_default_pipeline', value: 'Vendas', type: 'string', group: 'crm' },\r\n    { key: 'crm_auto_create_activity', value: 'true', type: 'boolean', group: 'crm' },\r\n    { key: 'crm_deal_rot_days', value: '14', type: 'integer', group: 'crm' },\r\n    { key: 'crm_enable_scoring', value: 'true', type: 'boolean', group: 'crm' },\r\n]\r\n\r\nconst settingLabels: Record<string, string> = {\r\n    company_name: 'Nome da Empresa',\r\n    company_phone: 'Telefone',\r\n    company_email: 'E-mail',\r\n    company_document: 'CNPJ/CPF',\r\n    company_logo_url: 'URL do Logo',\r\n    company_address: 'Endereço Completo',\r\n    default_warranty_days: 'Dias de Garantia Padrão',\r\n    auto_generate_os_number: 'Gerar Número OS Automaticamente',\r\n    require_approval_above: 'Exigir Aprovação Acima de (R$)',\r\n    os_number_prefix: 'Prefixo da Numeração OS',\r\n    default_payment_method: 'Forma de Pagamento Padrão',\r\n    late_fee_percentage: 'Multa por Atraso (%)',\r\n    auto_generate_invoice: 'Gerar Fatura Automaticamente ao Concluir OS',\r\n    notify_overdue: 'Notificar Vencimentos',\r\n    notify_os_completed: 'Notificar OS Concluída',\r\n    notify_new_deal: 'Notificar Novo Negócio CRM',\r\n    evolution_api_url: 'URL da Evolution API',\r\n    evolution_api_key: 'API Key',\r\n    evolution_instance: 'Nome da Instância',\r\n    whatsapp_enabled: 'WhatsApp Ativo',\r\n    smtp_host: 'Servidor SMTP',\r\n    smtp_port: 'Porta',\r\n    smtp_user: 'Usuário',\r\n    smtp_password: 'Senha',\r\n    smtp_encryption: 'Criptografia (tls/ssl)',\r\n    smtp_from_name: 'Nome do Remetente',\r\n    smtp_from_email: 'E-mail do Remetente',\r\n    crm_default_pipeline: 'Pipeline Padrão',\r\n    crm_auto_create_activity: 'Criar Atividade Automática em Novo Negócio',\r\n    crm_deal_rot_days: 'Dias Sem Atividade para \"Rot\" do Negócio',\r\n    crm_enable_scoring: 'Ativar Lead Scoring',\r\n}\r\n\r\nexport function SettingsPage() {\r\n    const qc = useQueryClient()\r\n    const [tab, setTab] = useState<Tab>('settings')\r\n    const [actionFilter, setActionFilter] = useState('')\r\n    const [entityFilter, setEntityFilter] = useState('')\r\n    const [dateFrom, setDateFrom] = useState('')\r\n    const [dateTo, setDateTo] = useState('')\r\n    const [expandedLog, setExpandedLog] = useState<number | null>(null)\r\n\r\n    // Settings\r\n    const { data: settingsRes } = useQuery({\r\n        queryKey: ['settings'],\r\n        queryFn: () => api.get('/settings'),\r\n        enabled: tab === 'settings',\r\n    })\r\n    const serverSettings = settingsRes?.data ?? []\r\n\r\n    const mergedSettings = defaultSettings.map(d => {\r\n        const existing = serverSettings.find((s: SettingItem) => s.key === d.key)\r\n        return existing ? { ...d, ...existing } : d\r\n    })\r\n\r\n    const [localSettings, setLocalSettings] = useState<Record<string, string>>({})\r\n\r\n    const getVal = (key: string) => localSettings[key] ?? mergedSettings.find(s => s.key === key)?.value ?? ''\r\n\r\n    const setVal = (key: string, value: string) => setLocalSettings(p => ({ ...p, [key]: value }))\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: () => {\r\n            const settings = mergedSettings.map(s => ({\r\n                key: s.key, value: localSettings[s.key] ?? s.value, type: s.type, group: s.group,\r\n            }))\r\n            return api.put('/settings', { settings })\r\n        },\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['settings'] }); setLocalSettings({}) },\r\n    })\r\n\r\n    // Audit\r\n    const { data: auditRes } = useQuery({\r\n        queryKey: ['audit-logs', actionFilter, dateFrom, dateTo],\r\n        queryFn: () => api.get('/audit-logs', {\r\n            params: {\r\n                action: actionFilter || undefined,\r\n                auditable_type: entityFilter || undefined,\r\n                from: dateFrom || undefined,\r\n                to: dateTo || undefined,\r\n                per_page: 50,\r\n            },\r\n        }),\r\n        enabled: tab === 'audit',\r\n    })\r\n    const auditLogs = auditRes?.data?.data ?? []\r\n\r\n    const grouped = Object.entries(settingGroups).map(([group, cfg]) => ({\r\n        group, label: cfg.label,\r\n        items: mergedSettings.filter(s => s.group === group),\r\n    })).filter(g => g.items.length > 0)\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Configurações</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Parametrizações do sistema e logs de auditoria</p>\r\n                </div>\r\n                {tab === 'settings' && (\r\n                    <Button icon={<Save className=\"h-4 w-4\" />} onClick={() => saveMut.mutate()} loading={saveMut.isPending}>\r\n                        Salvar\r\n                    </Button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex rounded-lg border border-surface-200 bg-surface-50 p-0.5 w-fit\">\r\n                {([{ key: 'settings' as const, label: 'Configurações', icon: Settings }, { key: 'audit' as const, label: 'Auditoria', icon: History }]).map(t => {\r\n                    const Icon = t.icon\r\n                    return (\r\n                        <button key={t.key} onClick={() => setTab(t.key)}\r\n                            className={cn('flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all',\r\n                                tab === t.key ? 'bg-white text-brand-700 shadow-sm' : 'text-surface-500 hover:text-surface-700')}>\r\n                            <Icon className=\"h-3.5 w-3.5\" />{t.label}\r\n                        </button>\r\n                    )\r\n                })}\r\n            </div>\r\n\r\n            {/* Settings Tab */}\r\n            {tab === 'settings' && (\r\n                <div className=\"space-y-6\">\r\n                    {grouped.map(g => (\r\n                        <div key={g.group} className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-4 flex items-center gap-2 text-sm font-semibold text-surface-700\">\r\n                                {(() => { const GIcon = settingGroups[g.group]?.icon ?? Shield; return <GIcon className=\"h-4 w-4 text-brand-500\" /> })()}\r\n                                {settingGroups[g.group]?.label ?? g.group}\r\n                            </h3>\r\n                            <div className=\"space-y-4\">\r\n                                {g.items.map(s => (\r\n                                    <div key={s.key} className=\"flex flex-col gap-1.5 sm:flex-row sm:items-center sm:justify-between\">\r\n                                        <label className=\"text-sm font-medium text-surface-600\">{settingLabels[s.key] ?? s.key}</label>\r\n                                        {s.type === 'boolean' ? (\r\n                                            <button onClick={() => setVal(s.key, getVal(s.key) === 'true' ? 'false' : 'true')}\r\n                                                aria-label={settingLabels[s.key] ?? s.key}\r\n                                                className={cn('relative h-6 w-11 rounded-full transition-colors',\r\n                                                    getVal(s.key) === 'true' ? 'bg-brand-500' : 'bg-surface-300')}>\r\n                                                <span className={cn('absolute top-0.5 left-0.5 h-5 w-5 rounded-full bg-white transition-transform shadow',\r\n                                                    getVal(s.key) === 'true' && 'translate-x-5')} />\r\n                                            </button>\r\n                                        ) : (\r\n                                            <input value={getVal(s.key)} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setVal(s.key, e.target.value)}\r\n                                                type={s.type === 'integer' ? 'number' : 'text'}\r\n                                                aria-label={settingLabels[s.key] ?? s.key}\r\n                                                className=\"w-full max-w-xs rounded-lg border border-surface-300 bg-white px-3.5 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Audit Tab */}\r\n            {tab === 'audit' && (\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"flex flex-wrap items-center gap-3\">\r\n                        <select value={actionFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setActionFilter(e.target.value)}\r\n                            aria-label=\"Filtrar por ação\"\r\n                            className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                            <option value=\"\">Todas ações</option>\r\n                            {Object.entries(actionLabels).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                        </select>\r\n                        <select value={entityFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setEntityFilter(e.target.value)}\r\n                            aria-label=\"Filtrar por entidade\"\r\n                            className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                            <option value=\"\">Todas entidades</option>\r\n                            <option value=\"WorkOrder\">Ordem de Serviço</option>\r\n                            <option value=\"Quote\">Orçamento</option>\r\n                            <option value=\"Customer\">Cliente</option>\r\n                            <option value=\"CrmDeal\">Negócio CRM</option>\r\n                            <option value=\"Equipment\">Equipamento</option>\r\n                            <option value=\"Tenant\">Empresa</option>\r\n                            <option value=\"User\">Usuário</option>\r\n                        </select>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Calendar className=\"h-4 w-4 text-surface-400\" />\r\n                            <input type=\"date\" value={dateFrom} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDateFrom(e.target.value)}\r\n                                aria-label=\"Data início auditoria\"\r\n                                className=\"rounded-lg border border-surface-300 bg-white px-3 py-1.5 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                            <ArrowRight className=\"h-3.5 w-3.5 text-surface-400\" />\r\n                            <input type=\"date\" value={dateTo} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDateTo(e.target.value)}\r\n                                aria-label=\"Data fim auditoria\"\r\n                                className=\"rounded-lg border border-surface-300 bg-white px-3 py-1.5 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                        </div>\r\n                        <button onClick={() => {\r\n                            const rows = auditLogs.map((l: any) => `${l.created_at},${l.user?.name ?? ''},${l.action},\"${l.description}\",${l.ip_address ?? ''}`)\r\n                            const csv = `Data,Usu\\u00e1rio,A\\u00e7\\u00e3o,Descri\\u00e7\\u00e3o,IP\\n${rows.join('\\n')}`\r\n                            const blob = new Blob([csv], { type: 'text/csv' })\r\n                            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'audit_logs.csv'; a.click()\r\n                        }} className=\"inline-flex items-center gap-1.5 rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm font-medium text-surface-600 hover:bg-surface-50 transition-colors\"\r\n                            title=\"Exportar CSV\">\r\n                            <Download className=\"h-3.5 w-3.5\" /> CSV\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                        <table className=\"w-full\">\r\n                            <thead>\r\n                                <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                    <th className=\"w-8 px-2 py-3\" />\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Data</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Usuário</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Ação</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Descrição</th>\r\n                                    <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">Entidade</th>\r\n                                    <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">IP</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-surface-100\">\r\n                                {auditLogs.length === 0 ? (\r\n                                    <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum registro</td></tr>\r\n                                ) : auditLogs.map((log: any) => {\r\n                                    const hasChanges = log.old_values || log.new_values\r\n                                    const isExpanded = expandedLog === log.id\r\n                                    const entityName = log.auditable_type?.split('\\\\').pop() ?? ''\r\n                                    return (\r\n                                        <>\r\n                                            <tr key={log.id} className={cn('hover:bg-surface-50 transition-colors', hasChanges && 'cursor-pointer')}\r\n                                                onClick={() => hasChanges && setExpandedLog(isExpanded ? null : log.id)}>\r\n                                                <td className=\"px-2 py-3 text-center\">\r\n                                                    {hasChanges && (isExpanded\r\n                                                        ? <ChevronUp className=\"h-3.5 w-3.5 text-surface-400 mx-auto\" />\r\n                                                        : <ChevronDown className=\"h-3.5 w-3.5 text-surface-400 mx-auto\" />)}\r\n                                                </td>\r\n                                                <td className=\"px-4 py-3 text-xs text-surface-500 whitespace-nowrap\">{new Date(log.created_at).toLocaleString('pt-BR')}</td>\r\n                                                <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{log.user?.name ?? '\\u2014'}</td>\r\n                                                <td className=\"px-4 py-3\">\r\n                                                    <Badge variant={actionLabels[log.action]?.variant ?? 'default'}>\r\n                                                        {actionLabels[log.action]?.label ?? log.action}\r\n                                                    </Badge>\r\n                                                </td>\r\n                                                <td className=\"px-4 py-3 text-sm text-surface-600\">{log.description}</td>\r\n                                                <td className=\"hidden px-4 py-3 text-xs text-surface-400 md:table-cell\">\r\n                                                    {entityName && <span className=\"rounded bg-surface-100 px-1.5 py-0.5 text-xs font-medium\">{entityName}</span>}\r\n                                                </td>\r\n                                                <td className=\"hidden px-4 py-3 text-xs text-surface-400 md:table-cell\">{log.ip_address}</td>\r\n                                            </tr>\r\n                                            {isExpanded && hasChanges && (\r\n                                                <tr key={`${log.id}-diff`}>\r\n                                                    <td colSpan={7} className=\"px-6 py-4 bg-surface-50\">\r\n                                                        <div className=\"rounded-lg border border-surface-200 bg-white p-4\">\r\n                                                            <h4 className=\"text-xs font-semibold text-surface-700 mb-3\">Alterações</h4>\r\n                                                            <div className=\"space-y-2 text-xs font-mono\">\r\n                                                                {Object.keys({ ...(log.old_values ?? {}), ...(log.new_values ?? {}) }).map((key: string) => {\r\n                                                                    const oldVal = log.old_values?.[key]\r\n                                                                    const newVal = log.new_values?.[key]\r\n                                                                    if (JSON.stringify(oldVal) === JSON.stringify(newVal)) return null\r\n                                                                    return (\r\n                                                                        <div key={key} className=\"flex items-start gap-2\">\r\n                                                                            <span className=\"font-semibold text-surface-600 min-w-[120px]\">{key}:</span>\r\n                                                                            <div className=\"flex flex-col gap-0.5\">\r\n                                                                                {oldVal !== undefined && (\r\n                                                                                    <span className=\"rounded bg-red-50 px-1.5 py-0.5 text-red-700 line-through\">\r\n                                                                                        {typeof oldVal === 'object' ? JSON.stringify(oldVal) : String(oldVal)}\r\n                                                                                    </span>\r\n                                                                                )}\r\n                                                                                {newVal !== undefined && (\r\n                                                                                    <span className=\"rounded bg-emerald-50 px-1.5 py-0.5 text-emerald-700\">\r\n                                                                                        {typeof newVal === 'object' ? JSON.stringify(newVal) : String(newVal)}\r\n                                                                                    </span>\r\n                                                                                )}\r\n                                                                            </div>\r\n                                                                        </div>\r\n                                                                    )\r\n                                                                })}\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            )}\r\n                                        </>\r\n                                    )\r\n                                })}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\configuracoes\\TenantManagementPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MoreHorizontal' is defined but never used.","line":5,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MoreHorizontal"},"fix":{"range":[195,216],"text":""},"desc":"Remove unused variable \"MoreHorizontal\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[584,587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[584,587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[595,598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[595,598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1121,1124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1121,1124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1186,1189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1186,1189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2104,2107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2104,2107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2814,2817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2814,2817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3529,3532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3529,3532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3742,3745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3742,3745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7066,7069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7066,7069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StatusIcon' is assigned a value but never used.","line":147,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":147,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16613,16616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16613,16616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":286,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18599,18602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18599,18602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Building2, Plus, Search, Users, MapPin, Mail, Phone, FileText,\r\n    MoreHorizontal, Edit, Trash2, UserPlus, UserMinus, X,\r\n    CheckCircle2, XCircle, Clock,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any; icon: any }> = {\r\n    active: { label: 'Ativo', variant: 'success', icon: CheckCircle2 },\r\n    inactive: { label: 'Inativo', variant: 'danger', icon: XCircle },\r\n    trial: { label: 'Trial', variant: 'warning', icon: Clock },\r\n}\r\n\r\nexport function TenantManagementPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [showModal, setShowModal] = useState(false)\r\n    const [showInviteModal, setShowInviteModal] = useState(false)\r\n    const [selectedTenant, setSelectedTenant] = useState<any>(null)\r\n    const [detailTenant, setDetailTenant] = useState<any>(null)\r\n    const [form, setForm] = useState({ name: '', document: '', email: '', phone: '', status: 'active' })\r\n    const [inviteForm, setInviteForm] = useState({ name: '', email: '', role: '' })\r\n\r\n    const { data: tenantsRes, isLoading } = useQuery({\r\n        queryKey: ['tenants'],\r\n        queryFn: () => api.get('/tenants'),\r\n    })\r\n    const tenants = tenantsRes?.data ?? []\r\n\r\n    const { data: statsRes } = useQuery({\r\n        queryKey: ['tenants-stats'],\r\n        queryFn: () => api.get('/tenants-stats'),\r\n    })\r\n    const stats = statsRes?.data ?? { total: 0, active: 0, trial: 0, inactive: 0 }\r\n\r\n    const { data: detailRes } = useQuery({\r\n        queryKey: ['tenants', detailTenant?.id],\r\n        queryFn: () => api.get(`/tenants/${detailTenant.id}`),\r\n        enabled: !!detailTenant,\r\n    })\r\n    const detail = detailRes?.data\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: any) =>\r\n            selectedTenant ? api.put(`/tenants/${selectedTenant.id}`, data) : api.post('/tenants', data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['tenants'] })\r\n            qc.invalidateQueries({ queryKey: ['tenants-stats'] })\r\n            setShowModal(false)\r\n            setSelectedTenant(null)\r\n        },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/tenants/${id}`),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['tenants'] })\r\n            qc.invalidateQueries({ queryKey: ['tenants-stats'] })\r\n        },\r\n    })\r\n\r\n    const inviteMut = useMutation({\r\n        mutationFn: (data: any) => api.post(`/tenants/${detailTenant.id}/invite`, data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['tenants', detailTenant.id] })\r\n            setShowInviteModal(false)\r\n            setInviteForm({ name: '', email: '', role: '' })\r\n        },\r\n    })\r\n\r\n    const removeUserMut = useMutation({\r\n        mutationFn: (userId: number) => api.delete(`/tenants/${detailTenant.id}/users/${userId}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['tenants', detailTenant.id] }),\r\n    })\r\n\r\n    const openCreate = () => { setSelectedTenant(null); setForm({ name: '', document: '', email: '', phone: '', status: 'active' }); setShowModal(true) }\r\n    const openEdit = (t: any) => { setSelectedTenant(t); setForm({ name: t.name, document: t.document ?? '', email: t.email ?? '', phone: t.phone ?? '', status: t.status }); setShowModal(true) }\r\n\r\n    const filtered = tenants.filter((t: any) =>\r\n        t.name.toLowerCase().includes(search.toLowerCase()) ||\r\n        (t.document ?? '').includes(search))\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"space-y-6 animate-fade-in\">\r\n                <div className=\"h-8 w-48 rounded-lg skeleton\" />\r\n                <div className=\"grid gap-4 sm:grid-cols-4\">\r\n                    {[...Array(4)].map((_, i) => <div key={i} className=\"h-24 rounded-xl skeleton\" />)}\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                    {[...Array(5)].map((_, i) => <div key={i} className=\"h-20 rounded-xl skeleton\" />)}\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Gerenciamento de Empresas</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Administre tenants, usuários e acessos</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={openCreate}>Nova Empresa</Button>\r\n            </div>\r\n\r\n            {/* Stats Cards */}\r\n            <div className=\"grid gap-4 sm:grid-cols-4\">\r\n                {[\r\n                    { label: 'Total', value: stats.total, color: 'text-surface-700', bg: 'bg-surface-50' },\r\n                    { label: 'Ativas', value: stats.active, color: 'text-emerald-700', bg: 'bg-emerald-50' },\r\n                    { label: 'Trial', value: stats.trial, color: 'text-amber-700', bg: 'bg-amber-50' },\r\n                    { label: 'Inativas', value: stats.inactive, color: 'text-red-700', bg: 'bg-red-50' },\r\n                ].map((s, i) => (\r\n                    <div key={i} className={cn('rounded-xl border border-surface-200 p-4 shadow-card', s.bg)}\r\n                        style={{ animationDelay: `${i * 80}ms` }}>\r\n                        <p className=\"text-xs font-medium text-surface-500\">{s.label}</p>\r\n                        <p className={cn('text-2xl font-bold mt-1', s.color)}>{s.value}</p>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"relative max-w-sm\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-surface-400\" />\r\n                <input value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)}\r\n                    placeholder=\"Buscar por nome ou CNPJ...\" aria-label=\"Buscar empresas\"\r\n                    className=\"w-full rounded-lg border border-surface-300 bg-white pl-9 pr-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n            </div>\r\n\r\n            {/* Tenant List */}\r\n            <div className=\"space-y-3\">\r\n                {filtered.length === 0 ? (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-12 text-center\">\r\n                        <Building2 className=\"mx-auto h-10 w-10 text-surface-300 mb-3\" />\r\n                        <p className=\"text-sm text-surface-500\">Nenhuma empresa encontrada</p>\r\n                    </div>\r\n                ) : filtered.map((t: any, idx: number) => {\r\n                    const sc = statusConfig[t.status] ?? statusConfig.active\r\n                    const StatusIcon = sc.icon\r\n                    return (\r\n                        <div key={t.id}\r\n                            className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card hover:shadow-elevated transition-all duration-200 cursor-pointer animate-slide-up\"\r\n                            style={{ animationDelay: `${idx * 50}ms` }}\r\n                            onClick={() => setDetailTenant(t)}>\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-brand-50 text-brand-600 font-bold text-sm\">\r\n                                        {t.name?.charAt(0)?.toUpperCase()}\r\n                                    </div>\r\n                                    <div>\r\n                                        <h3 className=\"text-sm font-semibold text-surface-900\">{t.name}</h3>\r\n                                        <div className=\"flex items-center gap-3 mt-0.5 text-xs text-surface-500\">\r\n                                            {t.document && <span className=\"flex items-center gap-1\"><FileText className=\"h-3 w-3\" />{t.document}</span>}\r\n                                            {t.email && <span className=\"flex items-center gap-1\"><Mail className=\"h-3 w-3\" />{t.email}</span>}\r\n                                            {t.phone && <span className=\"flex items-center gap-1\"><Phone className=\"h-3 w-3\" />{t.phone}</span>}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"flex items-center gap-2 text-xs text-surface-500\">\r\n                                        <span className=\"flex items-center gap-1\"><Users className=\"h-3.5 w-3.5\" />{t.users_count ?? 0}</span>\r\n                                        <span className=\"flex items-center gap-1\"><MapPin className=\"h-3.5 w-3.5\" />{t.branches_count ?? 0}</span>\r\n                                    </div>\r\n                                    <Badge variant={sc.variant} dot>{sc.label}</Badge>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        <button title=\"Editar empresa\" onClick={e => { e.stopPropagation(); openEdit(t) }}\r\n                                            className=\"rounded-lg p-1.5 text-surface-400 hover:bg-surface-100 hover:text-surface-600 transition-colors\">\r\n                                            <Edit className=\"h-4 w-4\" />\r\n                                        </button>\r\n                                        <button title=\"Excluir empresa\" onClick={e => { e.stopPropagation(); if (confirm('Excluir esta empresa?')) deleteMut.mutate(t.id) }}\r\n                                            className=\"rounded-lg p-1.5 text-surface-400 hover:bg-red-50 hover:text-red-600 transition-colors\">\r\n                                            <Trash2 className=\"h-4 w-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                })}\r\n            </div>\r\n\r\n            {/* Create/Edit Modal */}\r\n            {showModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\" onClick={() => setShowModal(false)}>\r\n                    <div className=\"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl animate-scale-in\" onClick={e => e.stopPropagation()}>\r\n                        <div className=\"flex items-center justify-between mb-5\">\r\n                            <h2 className=\"text-lg font-bold text-surface-900\">{selectedTenant ? 'Editar Empresa' : 'Nova Empresa'}</h2>\r\n                            <button onClick={() => setShowModal(false)} className=\"rounded-lg p-1 hover:bg-surface-100\" aria-label=\"Fechar modal\"><X className=\"h-5 w-5\" /></button>\r\n                        </div>\r\n                        <div className=\"space-y-4\">\r\n                            <Input label=\"Nome *\" value={form.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, name: e.target.value }))} />\r\n                            <Input label=\"CNPJ/CPF\" value={form.document} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, document: e.target.value }))} />\r\n                            <Input label=\"E-mail\" type=\"email\" value={form.email} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, email: e.target.value }))} />\r\n                            <Input label=\"Telefone\" value={form.phone} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, phone: e.target.value }))} />\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-surface-700 mb-1\">Status</label>\r\n                                <select value={form.status} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, status: e.target.value }))}\r\n                                    aria-label=\"Status da empresa\"\r\n                                    className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                                    <option value=\"active\">Ativo</option>\r\n                                    <option value=\"trial\">Trial</option>\r\n                                    <option value=\"inactive\">Inativo</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-6 flex justify-end gap-2\">\r\n                            <Button variant=\"outline\" onClick={() => setShowModal(false)}>Cancelar</Button>\r\n                            <Button onClick={() => saveMut.mutate(form)} loading={saveMut.isPending}>\r\n                                {selectedTenant ? 'Salvar' : 'Criar'}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Detail Panel */}\r\n            {detailTenant && (\r\n                <div className=\"fixed inset-0 z-50 flex items-end justify-end\" onClick={() => setDetailTenant(null)}>\r\n                    <div className=\"fixed inset-0 bg-black/30\" />\r\n                    <div className=\"relative h-full w-full max-w-lg bg-white shadow-xl animate-slide-up overflow-y-auto\"\r\n                        onClick={e => e.stopPropagation()}>\r\n                        <div className=\"sticky top-0 bg-white border-b border-surface-200 p-4 flex items-center justify-between z-10\">\r\n                            <h2 className=\"text-lg font-bold text-surface-900\">{detailTenant.name}</h2>\r\n                            <button onClick={() => setDetailTenant(null)} className=\"rounded-lg p-1 hover:bg-surface-100\" aria-label=\"Fechar painel\"><X className=\"h-5 w-5\" /></button>\r\n                        </div>\r\n                        <div className=\"p-5 space-y-6\">\r\n                            {/* Info */}\r\n                            <div className=\"rounded-xl border border-surface-200 p-4 space-y-3\">\r\n                                <h3 className=\"text-sm font-semibold text-surface-700\">Informações</h3>\r\n                                {detail && (\r\n                                    <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                                        <div><span className=\"text-surface-500\">CNPJ:</span> <span className=\"font-medium\">{detail.document || '—'}</span></div>\r\n                                        <div><span className=\"text-surface-500\">E-mail:</span> <span className=\"font-medium\">{detail.email || '—'}</span></div>\r\n                                        <div><span className=\"text-surface-500\">Telefone:</span> <span className=\"font-medium\">{detail.phone || '—'}</span></div>\r\n                                        <div><span className=\"text-surface-500\">Status:</span> <Badge variant={statusConfig[detail.status]?.variant}>{statusConfig[detail.status]?.label}</Badge></div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Users */}\r\n                            <div className=\"rounded-xl border border-surface-200 p-4 space-y-3\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <h3 className=\"text-sm font-semibold text-surface-700\">\r\n                                        Usuários ({detail?.users?.length ?? 0})\r\n                                    </h3>\r\n                                    <Button size=\"sm\" variant=\"outline\" icon={<UserPlus className=\"h-3.5 w-3.5\" />}\r\n                                        onClick={() => setShowInviteModal(true)}>\r\n                                        Convidar\r\n                                    </Button>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    {(detail?.users ?? []).map((u: any) => (\r\n                                        <div key={u.id} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <div className=\"h-8 w-8 flex items-center justify-center rounded-full bg-brand-100 text-brand-700 text-xs font-bold\">\r\n                                                    {u.name?.charAt(0)?.toUpperCase()}\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"text-sm font-medium text-surface-900\">{u.name}</p>\r\n                                                    <p className=\"text-xs text-surface-500\">{u.email}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <button title=\"Remover usuário\" onClick={() => removeUserMut.mutate(u.id)}\r\n                                                className=\"rounded-lg p-1.5 text-surface-400 hover:bg-red-50 hover:text-red-600 transition-colors\">\r\n                                                <UserMinus className=\"h-4 w-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Branches */}\r\n                            <div className=\"rounded-xl border border-surface-200 p-4 space-y-3\">\r\n                                <h3 className=\"text-sm font-semibold text-surface-700\">\r\n                                    Filiais ({detail?.branches?.length ?? 0})\r\n                                </h3>\r\n                                <div className=\"space-y-2\">\r\n                                    {(detail?.branches ?? []).map((b: any) => (\r\n                                        <div key={b.id} className=\"flex items-center gap-2 rounded-lg bg-surface-50 p-3 text-sm\">\r\n                                            <MapPin className=\"h-4 w-4 text-brand-500\" />\r\n                                            <span className=\"font-medium text-surface-900\">{b.name}</span>\r\n                                            {b.code && <span className=\"text-surface-400\">({b.code})</span>}\r\n                                        </div>\r\n                                    ))}\r\n                                    {(detail?.branches ?? []).length === 0 && (\r\n                                        <p className=\"text-xs text-surface-400\">Nenhuma filial</p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Invite Modal */}\r\n            {showInviteModal && (\r\n                <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/40\" onClick={() => setShowInviteModal(false)}>\r\n                    <div className=\"w-full max-w-sm rounded-2xl bg-white p-6 shadow-xl animate-scale-in\" onClick={e => e.stopPropagation()}>\r\n                        <h2 className=\"text-lg font-bold text-surface-900 mb-4\">Convidar Usuário</h2>\r\n                        <div className=\"space-y-4\">\r\n                            <Input label=\"Nome *\" value={inviteForm.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setInviteForm(f => ({ ...f, name: e.target.value }))} />\r\n                            <Input label=\"E-mail *\" type=\"email\" value={inviteForm.email} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setInviteForm(f => ({ ...f, email: e.target.value }))} />\r\n                            <Input label=\"Papel (role)\" value={inviteForm.role} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setInviteForm(f => ({ ...f, role: e.target.value }))} placeholder=\"admin, technician...\" />\r\n                        </div>\r\n                        <div className=\"mt-5 flex justify-end gap-2\">\r\n                            <Button variant=\"outline\" onClick={() => setShowInviteModal(false)}>Cancelar</Button>\r\n                            <Button onClick={() => inviteMut.mutate(inviteForm)} loading={inviteMut.isPending}>Convidar</Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\equipamentos\\EquipmentCalendarPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":6,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Eye"},"fix":{"range":[221,226],"text":""},"desc":"Remove unused variable \"Eye\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[639,642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[639,642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\nimport { useQuery } from '@tanstack/react-query'\r\nimport { Link } from 'react-router-dom'\r\nimport {\r\n    ChevronLeft, ChevronRight, Calendar, AlertTriangle,\r\n    Clock, CheckCircle2, Scale, Eye\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface Alert {\r\n    id: number\r\n    code: string\r\n    brand: string | null\r\n    model: string | null\r\n    serial_number: string | null\r\n    customer: string | null\r\n    next_calibration_at: string\r\n    days_remaining: number\r\n    status: string\r\n}\r\n\r\nconst statusConfig: Record<string, { bg: string; text: string; icon: any; label: string }> = {\r\n    vencida: { bg: 'bg-red-100 border-red-300', text: 'text-red-700', icon: AlertTriangle, label: 'Vencida' },\r\n    vence_em_breve: { bg: 'bg-amber-100 border-amber-300', text: 'text-amber-700', icon: Clock, label: 'Vencendo' },\r\n    em_dia: { bg: 'bg-emerald-100 border-emerald-300', text: 'text-emerald-700', icon: CheckCircle2, label: 'Em dia' },\r\n}\r\n\r\nexport default function EquipmentCalendarPage() {\r\n    const [currentDate, setCurrentDate] = useState(new Date())\r\n\r\n    const { data } = useQuery({\r\n        queryKey: ['equipments-alerts'],\r\n        queryFn: () => api.get('/equipments-alerts').then(r => r.data),\r\n    })\r\n\r\n    const alerts = useMemo<Alert[]>(() => data?.alerts ?? [], [data?.alerts])\n\r\n    const year = currentDate.getFullYear()\r\n    const month = currentDate.getMonth()\r\n\r\n    const daysInMonth = new Date(year, month + 1, 0).getDate()\r\n    const firstDayOfWeek = new Date(year, month, 1).getDay()\r\n\r\n    const monthName = currentDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })\r\n\r\n    const alertsByDay: Record<number, Alert[]> = {}\n    alerts.forEach(a => {\n        const d = new Date(a.next_calibration_at)\n        if (d.getFullYear() === year && d.getMonth() === month) {\n            const day = d.getDate()\n            if (!alertsByDay[day]) alertsByDay[day] = []\n            alertsByDay[day].push(a)\n        }\n    })\n\r\n    const prev = () => setCurrentDate(new Date(year, month - 1, 1))\r\n    const next = () => setCurrentDate(new Date(year, month + 1, 1))\r\n    const today = () => setCurrentDate(new Date())\r\n\r\n    const todayDay = new Date().getDate()\r\n    const isCurrentMonth = new Date().getFullYear() === year && new Date().getMonth() === month\r\n\r\n    // Grouped list for sidebar\r\n    const overdueAlerts = alerts.filter(a => a.days_remaining < 0)\r\n    const upcomingAlerts = alerts.filter(a => a.days_remaining >= 0 && a.days_remaining <= 30)\r\n\r\n    const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb']\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Agenda de Calibrações</h1>\r\n                    <p className=\"text-sm text-surface-500\">Visualize os vencimentos de calibração por mês</p>\r\n                </div>\r\n                <Link\r\n                    to=\"/equipamentos\"\r\n                    className=\"flex items-center gap-2 rounded-lg border border-surface-200 px-4 py-2.5 text-sm font-medium text-surface-700 hover:bg-surface-50\"\r\n                >\r\n                    <Scale size={16} />\r\n                    Ver Equipamentos\r\n                </Link>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 gap-6 xl:grid-cols-3\">\r\n                {/* Calendar */}\r\n                <div className=\"xl:col-span-2 rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    {/* Month nav */}\r\n                    <div className=\"mb-4 flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Calendar size={20} className=\"text-brand-500\" />\r\n                            <h2 className=\"text-lg font-semibold text-surface-900 capitalize\">{monthName}</h2>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <button onClick={today} className=\"rounded-lg border border-surface-200 px-3 py-1.5 text-xs font-medium text-surface-600 hover:bg-surface-50\">\r\n                                Hoje\r\n                            </button>\r\n                            <button onClick={prev} className=\"rounded-lg p-1.5 text-surface-400 hover:bg-surface-100\">\r\n                                <ChevronLeft size={18} />\r\n                            </button>\r\n                            <button onClick={next} className=\"rounded-lg p-1.5 text-surface-400 hover:bg-surface-100\">\r\n                                <ChevronRight size={18} />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Week headers */}\r\n                    <div className=\"grid grid-cols-7 mb-1\">\r\n                        {weekDays.map(d => (\r\n                            <div key={d} className=\"py-2 text-center text-xs font-semibold text-surface-500\">{d}</div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Day cells */}\r\n                    <div className=\"grid grid-cols-7 gap-px rounded-lg bg-surface-200 overflow-hidden border border-surface-200\">\r\n                        {/* Empty cells before first day */}\r\n                        {Array.from({ length: firstDayOfWeek }).map((_, i) => (\r\n                            <div key={`empty-${i}`} className=\"min-h-[90px] bg-surface-50 p-1.5\" />\r\n                        ))}\r\n\r\n                        {/* Day cells */}\r\n                        {Array.from({ length: daysInMonth }).map((_, i) => {\r\n                            const day = i + 1\r\n                            const dayAlerts = alertsByDay[day] || []\r\n                            const isToday = isCurrentMonth && day === todayDay\r\n\r\n                            return (\r\n                                <div\r\n                                    key={day}\r\n                                    className={cn(\r\n                                        'min-h-[90px] bg-white p-1.5 transition-colors',\r\n                                        isToday && 'bg-brand-50/40'\r\n                                    )}\r\n                                >\r\n                                    <span className={cn(\r\n                                        'inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-medium',\r\n                                        isToday ? 'bg-brand-600 text-white' : 'text-surface-700'\r\n                                    )}>\r\n                                        {day}\r\n                                    </span>\r\n                                    <div className=\"mt-0.5 space-y-0.5\">\r\n                                        {dayAlerts.slice(0, 3).map(a => {\r\n                                            const cfg = statusConfig[a.status] || statusConfig.em_dia\r\n                                            return (\r\n                                                <Link\r\n                                                    key={a.id}\r\n                                                    to={`/equipamentos/${a.id}`}\r\n                                                    className={cn(\r\n                                                        'block truncate rounded px-1 py-0.5 text-[10px] font-medium border',\r\n                                                        cfg.bg, cfg.text\r\n                                                    )}\r\n                                                    title={`${a.code} - ${a.brand} ${a.model}`}\r\n                                                >\r\n                                                    {a.code}\r\n                                                </Link>\r\n                                            )\r\n                                        })}\r\n                                        {dayAlerts.length > 3 && (\r\n                                            <span className=\"text-[10px] text-surface-400 pl-1\">\r\n                                                +{dayAlerts.length - 3} mais\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Sidebar: Alerts */}\r\n                <div className=\"space-y-4\">\r\n                    {/* Overdue */}\r\n                    <div className=\"rounded-xl border border-red-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"mb-3 flex items-center gap-2\">\r\n                            <AlertTriangle size={16} className=\"text-red-600\" />\r\n                            <h3 className=\"text-sm font-semibold text-red-700\">\r\n                                Vencidas ({overdueAlerts.length})\r\n                            </h3>\r\n                        </div>\r\n                        {overdueAlerts.length === 0 ? (\r\n                            <p className=\"text-xs text-surface-400\">Nenhum equipamento vencido 🎉</p>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                {overdueAlerts.slice(0, 8).map(a => (\r\n                                    <Link\r\n                                        key={a.id}\r\n                                        to={`/equipamentos/${a.id}`}\r\n                                        className=\"flex items-center justify-between rounded-lg border border-red-100 bg-red-50 p-2 text-xs hover:bg-red-100 transition-colors\"\r\n                                    >\r\n                                        <div>\r\n                                            <span className=\"font-mono font-semibold text-red-700\">{a.code}</span>\r\n                                            <span className=\"ml-1.5 text-red-600\">{a.brand} {a.model}</span>\r\n                                        </div>\r\n                                        <span className=\"rounded-full bg-red-200 px-2 py-0.5 text-[10px] font-bold text-red-800\">\r\n                                            {Math.abs(a.days_remaining)}d atrás\r\n                                        </span>\r\n                                    </Link>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Upcoming */}\r\n                    <div className=\"rounded-xl border border-amber-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"mb-3 flex items-center gap-2\">\r\n                            <Clock size={16} className=\"text-amber-600\" />\r\n                            <h3 className=\"text-sm font-semibold text-amber-700\">\r\n                                Próximas 30 dias ({upcomingAlerts.length})\r\n                            </h3>\r\n                        </div>\r\n                        {upcomingAlerts.length === 0 ? (\r\n                            <p className=\"text-xs text-surface-400\">Nenhuma calibração nos próximos 30 dias</p>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                {upcomingAlerts.slice(0, 8).map(a => (\r\n                                    <Link\r\n                                        key={a.id}\r\n                                        to={`/equipamentos/${a.id}`}\r\n                                        className=\"flex items-center justify-between rounded-lg border border-amber-100 bg-amber-50 p-2 text-xs hover:bg-amber-100 transition-colors\"\r\n                                    >\r\n                                        <div>\r\n                                            <span className=\"font-mono font-semibold text-amber-700\">{a.code}</span>\r\n                                            <span className=\"ml-1.5 text-amber-600\">{a.brand} {a.model}</span>\r\n                                        </div>\r\n                                        <span className=\"rounded-full bg-amber-200 px-2 py-0.5 text-[10px] font-bold text-amber-800\">\r\n                                            {a.days_remaining}d\r\n                                        </span>\r\n                                    </Link>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Summary */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <h3 className=\"mb-2 text-sm font-semibold text-surface-900\">Resumo</h3>\r\n                        <div className=\"space-y-2 text-xs\">\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-surface-600\">Total monitorados</span>\r\n                                <span className=\"font-semibold text-surface-900\">{alerts.length}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-red-600\">Vencidas</span>\r\n                                <span className=\"font-bold text-red-700\">{overdueAlerts.length}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-amber-600\">Vencendo em 30d</span>\r\n                                <span className=\"font-bold text-amber-700\">{upcomingAlerts.length}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\equipamentos\\EquipmentCreatePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[245,277],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1291,1294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1291,1294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1456,1459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1456,1459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3693,3696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3693,3696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport { useQuery, useMutation } from '@tanstack/react-query'\r\nimport { ArrowLeft, Save, Loader2, Scale } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nexport default function EquipmentCreatePage() {\r\n    const navigate = useNavigate()\r\n\r\n    const { data: constants } = useQuery({\r\n        queryKey: ['equipments-constants'],\r\n        queryFn: () => api.get('/equipments-constants').then(r => r.data),\r\n    })\r\n\r\n    const { data: customers } = useQuery({\r\n        queryKey: ['customers-list'],\r\n        queryFn: () => api.get('/customers?per_page=100').then(r => r.data.data),\r\n    })\r\n\r\n    const [form, setForm] = useState({\r\n        customer_id: '',\r\n        type: 'Balança',\r\n        category: 'balanca_plataforma',\r\n        brand: '',\r\n        manufacturer: '',\r\n        model: '',\r\n        serial_number: '',\r\n        capacity: '',\r\n        capacity_unit: 'kg',\r\n        resolution: '',\r\n        precision_class: '',\r\n        location: '',\r\n        calibration_interval_months: '12',\r\n        inmetro_number: '',\r\n        tag: '',\r\n        is_critical: false,\r\n        notes: '',\r\n    })\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: (data: any) => api.post('/equipments', data),\r\n        onSuccess: (r) => navigate(`/equipamentos/${r.data.equipment.id}`),\r\n    })\r\n\r\n    const update = (key: string, val: any) => setForm(f => ({ ...f, [key]: val }))\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        mutation.mutate({\r\n            ...form,\r\n            customer_id: +form.customer_id || undefined,\r\n            capacity: form.capacity ? +form.capacity : undefined,\r\n            resolution: form.resolution ? +form.resolution : undefined,\r\n            calibration_interval_months: form.calibration_interval_months ? +form.calibration_interval_months : undefined,\r\n        })\r\n    }\r\n\r\n    const cats = constants?.categories ?? {}\r\n    const classes = constants?.precision_classes ?? {}\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n                <button onClick={() => navigate('/equipamentos')} className=\"rounded-lg border border-surface-200 p-2 hover:bg-surface-50\">\r\n                    <ArrowLeft size={18} />\r\n                </button>\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Novo Equipamento</h1>\r\n                    <p className=\"text-sm text-surface-500\">Cadastrar equipamento / instrumento de medição</p>\r\n                </div>\r\n            </div>\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n                {/* Identificação */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card\">\r\n                    <h3 className=\"mb-4 flex items-center gap-2 font-semibold text-surface-900\">\r\n                        <Scale size={18} className=\"text-brand-500\" />\r\n                        Identificação\r\n                    </h3>\r\n                    <div className=\"grid grid-cols-3 gap-4\">\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Cliente *</label>\r\n                            <select value={form.customer_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => update('customer_id', e.target.value)} required className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\">\r\n                                <option value=\"\">Selecione...</option>\r\n                                {(customers ?? []).map((c: any) => <option key={c.id} value={c.id}>{c.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Tipo *</label>\r\n                            <input value={form.type} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('type', e.target.value)} required className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" placeholder=\"Ex: Balança, Termômetro\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Categoria</label>\r\n                            <select value={form.category} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => update('category', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\">\r\n                                {Object.entries(cats).map(([k, v]) => <option key={k} value={k}>{v as string}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Marca</label>\r\n                            <input value={form.brand} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('brand', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" placeholder=\"Ex: Toledo, Marte\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Fabricante</label>\r\n                            <input value={form.manufacturer} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('manufacturer', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Modelo</label>\r\n                            <input value={form.model} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('model', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" placeholder=\"Ex: 2098\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Nº Série</label>\r\n                            <input value={form.serial_number} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('serial_number', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Tag / Patrimônio</label>\r\n                            <input value={form.tag} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('tag', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Localização</label>\r\n                            <input value={form.location} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('location', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Especificações Técnicas */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card\">\r\n                    <h3 className=\"mb-4 font-semibold text-surface-900\">Especificações Técnicas</h3>\r\n                    <div className=\"grid grid-cols-3 gap-4\">\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Capacidade</label>\r\n                            <div className=\"flex gap-2\">\r\n                                <input type=\"number\" step=\"any\" value={form.capacity} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('capacity', e.target.value)} className=\"flex-1 rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                                <select value={form.capacity_unit} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => update('capacity_unit', e.target.value)} className=\"w-20 rounded-lg border border-surface-200 px-2 py-2.5 text-sm\">\r\n                                    <option>kg</option><option>g</option><option>mg</option><option>t</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Resolução</label>\r\n                            <input type=\"number\" step=\"any\" value={form.resolution} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('resolution', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Classe de Precisão</label>\r\n                            <select value={form.precision_class} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => update('precision_class', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\">\r\n                                <option value=\"\">—</option>\r\n                                {Object.entries(classes).map(([k, v]) => <option key={k} value={k}>{v as string}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Nº INMETRO</label>\r\n                            <input value={form.inmetro_number} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('inmetro_number', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1 block text-xs font-medium text-surface-600\">Intervalo Calibração (meses)</label>\r\n                            <input type=\"number\" value={form.calibration_interval_months} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('calibration_interval_months', e.target.value)} className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\" />\r\n                        </div>\r\n                        <div className=\"flex items-end\">\r\n                            <label className=\"flex cursor-pointer items-center gap-2\">\r\n                                <input type=\"checkbox\" checked={form.is_critical} onChange={(e: React.ChangeEvent<HTMLInputElement>) => update('is_critical', e.target.checked)} className=\"accent-red-600\" />\r\n                                <span className=\"text-sm font-medium text-surface-700\">Equipamento Crítico</span>\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Observações */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card\">\r\n                    <h3 className=\"mb-4 font-semibold text-surface-900\">Observações</h3>\r\n                    <textarea\r\n                        value={form.notes}\r\n                        onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => update('notes', e.target.value)}\r\n                        rows={3}\r\n                        className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\"\r\n                        placeholder=\"Observações gerais sobre o equipamento...\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex justify-end gap-3\">\r\n                    <button type=\"button\" onClick={() => navigate('/equipamentos')} className=\"rounded-lg border border-surface-200 px-4 py-2.5 text-sm hover:bg-surface-50\">\r\n                        Cancelar\r\n                    </button>\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={mutation.isPending || !form.customer_id}\r\n                        className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-6 py-2.5 text-sm font-medium text-white hover:bg-brand-700 disabled:opacity-50\"\r\n                    >\r\n                        {mutation.isPending ? <Loader2 size={16} className=\"animate-spin\" /> : <Save size={16} />}\r\n                        Salvar Equipamento\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\equipamentos\\EquipmentDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertTriangle' is defined but never used.","line":5,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AlertTriangle"},"fix":{"range":[223,238],"text":""},"desc":"Remove unused variable \"AlertTriangle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":5,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[238,245],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash2' is defined but never used.","line":6,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Trash2"},"fix":{"range":[289,297],"text":""},"desc":"Remove unused variable \"Trash2\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[520,523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[520,523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1756,1759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1756,1759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2009,2012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2009,2012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9796,9799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9796,9799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10049,10052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10049,10052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13817,13820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13817,13820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":254,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14074,14077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14074,14077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":305,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17285,17288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17285,17288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":328,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18486,18489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18486,18489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":337,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18768,18771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18768,18771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":380,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22335,22338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22335,22338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useParams, useNavigate } from 'react-router-dom'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    ArrowLeft, Scale, CheckCircle2, AlertTriangle, Clock,\r\n    Plus, FileText, Wrench, Award, Upload, Trash2, Loader2, Download\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\ntype Tab = 'dados' | 'calibracoes' | 'manutencoes' | 'documentos'\r\n\r\nconst tabs: { key: Tab; label: string; icon: any }[] = [\r\n    { key: 'dados', label: 'Dados', icon: Scale },\r\n    { key: 'calibracoes', label: 'Calibrações', icon: Award },\r\n    { key: 'manutencoes', label: 'Manutenções', icon: Wrench },\r\n    { key: 'documentos', label: 'Documentos', icon: FileText },\r\n]\r\n\r\nconst resultColors: Record<string, string> = {\r\n    aprovado: 'bg-emerald-100 text-emerald-700',\r\n    aprovado_com_ressalva: 'bg-amber-100 text-amber-700',\r\n    reprovado: 'bg-red-100 text-red-700',\r\n}\r\n\r\nexport default function EquipmentDetailPage() {\r\n    const { id } = useParams()\r\n    const navigate = useNavigate()\r\n    const qc = useQueryClient()\r\n    const [tab, setTab] = useState<Tab>('dados')\r\n    const [showCalForm, setShowCalForm] = useState(false)\r\n    const [showMaintForm, setShowMaintForm] = useState(false)\r\n\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['equipment', id],\r\n        queryFn: () => api.get(`/equipments/${id}`).then(r => r.data.equipment),\r\n        enabled: !!id,\r\n    })\r\n\r\n    const { data: constants } = useQuery({\r\n        queryKey: ['equipments-constants'],\r\n        queryFn: () => api.get('/equipments-constants').then(r => r.data),\r\n    })\r\n\r\n    const calMutation = useMutation({\r\n        mutationFn: (formData: any) => api.post(`/equipments/${id}/calibrations`, formData),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['equipment', id] }); setShowCalForm(false) },\r\n    })\r\n\r\n    const maintMutation = useMutation({\r\n        mutationFn: (formData: any) => api.post(`/equipments/${id}/maintenances`, formData),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['equipment', id] }); setShowMaintForm(false) },\r\n    })\r\n\r\n    const docMutation = useMutation({\r\n        mutationFn: (formData: FormData) => api.post(`/equipments/${id}/documents`, formData, {\r\n            headers: { 'Content-Type': 'multipart/form-data' },\r\n        }),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['equipment', id] }),\r\n    })\r\n\r\n    if (isLoading) return <div className=\"flex items-center justify-center py-20\"><Loader2 className=\"animate-spin text-brand-500\" size={32} /></div>\r\n    if (!data) return <div className=\"py-20 text-center text-surface-500\">Equipamento não encontrado</div>\r\n\r\n    const eq = data\r\n    const cats = constants?.categories ?? {}\r\n    const classes = constants?.precision_classes ?? {}\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4\">\r\n                <button onClick={() => navigate('/equipamentos')} className=\"rounded-lg border border-surface-200 p-2 hover:bg-surface-50\">\r\n                    <ArrowLeft size={18} />\r\n                </button>\r\n                <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <h1 className=\"text-2xl font-bold text-surface-900\">\r\n                            {eq.brand} {eq.model}\r\n                        </h1>\r\n                        <span className=\"rounded-full bg-brand-100 px-3 py-0.5 text-xs font-semibold text-brand-700\">\r\n                            {eq.code}\r\n                        </span>\r\n                        {eq.is_critical && (\r\n                            <span className=\"rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-semibold text-red-700\">\r\n                                CRÍTICO\r\n                            </span>\r\n                        )}\r\n                    </div>\r\n                    <p className=\"text-sm text-surface-500\">\r\n                        {eq.type} • Série: {eq.serial_number || '—'} • {cats[eq.category] || eq.category}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Status Cards */}\r\n            <div className=\"grid grid-cols-4 gap-3\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <p className=\"text-xs font-medium text-surface-500\">Status</p>\r\n                    <p className={cn('mt-1 inline-block rounded-full px-3 py-0.5 text-sm font-semibold',\r\n                        eq.status === 'ativo' ? 'bg-emerald-100 text-emerald-700' : 'bg-surface-200 text-surface-600')}>\r\n                        {eq.status}\r\n                    </p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <p className=\"text-xs font-medium text-surface-500\">Última Calibração</p>\r\n                    <p className=\"mt-1 text-sm font-semibold text-surface-900\">\r\n                        {eq.last_calibration_at ? new Date(eq.last_calibration_at).toLocaleDateString('pt-BR') : '—'}\r\n                    </p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <p className=\"text-xs font-medium text-surface-500\">Próxima Calibração</p>\r\n                    <p className=\"mt-1 text-sm font-semibold text-surface-900\">\r\n                        {eq.next_calibration_at ? new Date(eq.next_calibration_at).toLocaleDateString('pt-BR') : '—'}\r\n                    </p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <p className=\"text-xs font-medium text-surface-500\">Cliente</p>\r\n                    <p className=\"mt-1 truncate text-sm font-semibold text-surface-900\">\r\n                        {eq.customer?.name || '—'}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex gap-1 rounded-xl bg-surface-100 p-1\">\r\n                {tabs.map(t => (\r\n                    <button\r\n                        key={t.key}\r\n                        onClick={() => setTab(t.key)}\r\n                        className={cn(\r\n                            'flex flex-1 items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium transition-all',\r\n                            tab === t.key\r\n                                ? 'bg-white text-surface-900 shadow-sm'\r\n                                : 'text-surface-500 hover:text-surface-700'\r\n                        )}\r\n                    >\r\n                        <t.icon size={16} />\r\n                        {t.label}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Tab: Dados */}\r\n            {tab === 'dados' && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card\">\r\n                    <div className=\"grid grid-cols-3 gap-x-8 gap-y-4\">\r\n                        <Field label=\"Fabricante\" value={eq.manufacturer} />\r\n                        <Field label=\"Marca\" value={eq.brand} />\r\n                        <Field label=\"Modelo\" value={eq.model} />\r\n                        <Field label=\"Nº Série\" value={eq.serial_number} />\r\n                        <Field label=\"Categoria\" value={cats[eq.category] || eq.category} />\r\n                        <Field label=\"Classe de Precisão\" value={classes[eq.precision_class] || eq.precision_class} />\r\n                        <Field label=\"Capacidade\" value={eq.capacity ? `${eq.capacity} ${eq.capacity_unit || ''}` : null} />\r\n                        <Field label=\"Resolução\" value={eq.resolution} />\r\n                        <Field label=\"Localização\" value={eq.location} />\r\n                        <Field label=\"Nº INMETRO\" value={eq.inmetro_number} />\r\n                        <Field label=\"Tag/Patrimônio\" value={eq.tag} />\r\n                        <Field label=\"Intervalo Calibração\" value={eq.calibration_interval_months ? `${eq.calibration_interval_months} meses` : null} />\r\n                        <Field label=\"Data Aquisição\" value={eq.purchase_date ? new Date(eq.purchase_date).toLocaleDateString('pt-BR') : null} />\r\n                        <Field label=\"Valor Aquisição\" value={eq.purchase_value ? `R$ ${Number(eq.purchase_value).toFixed(2)}` : null} />\r\n                        <Field label=\"Garantia até\" value={eq.warranty_expires_at ? new Date(eq.warranty_expires_at).toLocaleDateString('pt-BR') : null} />\r\n                        <Field label=\"Responsável\" value={eq.responsible?.name} />\r\n                        <div className=\"col-span-3\">\r\n                            <Field label=\"Observações\" value={eq.notes} />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Tab: Calibrações */}\r\n            {tab === 'calibracoes' && (\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"flex justify-end\">\r\n                        <button\r\n                            onClick={() => setShowCalForm(!showCalForm)}\r\n                            className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700\"\r\n                        >\r\n                            <Plus size={16} />\r\n                            Nova Calibração\r\n                        </button>\r\n                    </div>\r\n\r\n                    {showCalForm && (\r\n                        <CalibrationForm\r\n                            constants={constants}\r\n                            onSubmit={(d: any) => calMutation.mutate(d)}\r\n                            loading={calMutation.isPending}\r\n                        />\r\n                    )}\r\n\r\n                    <div className=\"space-y-3\">\r\n                        {(eq.calibrations ?? []).map((c: any) => (\r\n                            <div key={c.id} className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className={cn('rounded-full px-2.5 py-0.5 text-xs font-semibold', resultColors[c.result] || 'bg-surface-100')}>\r\n                                                {c.result}\r\n                                            </span>\r\n                                            <span className=\"text-sm font-medium text-surface-900\">\r\n                                                {new Date(c.calibration_date).toLocaleDateString('pt-BR')}\r\n                                            </span>\r\n                                            <span className=\"text-xs text-surface-500\">• {c.calibration_type}</span>\r\n                                        </div>\r\n                                        {c.laboratory && <p className=\"mt-1 text-sm text-surface-600\">Lab: {c.laboratory}</p>}\r\n                                        {c.certificate_number && <p className=\"text-sm text-surface-600\">Certificado: {c.certificate_number}</p>}\r\n                                        {c.uncertainty && <p className=\"text-sm text-surface-600\">Incerteza: {c.uncertainty}</p>}\r\n                                        {c.notes && <p className=\"mt-1 text-sm text-surface-500\">{c.notes}</p>}\r\n                                    </div>\r\n                                    <div className=\"flex flex-col items-end gap-1 text-right text-xs text-surface-500\">\r\n                                        {c.performer?.name && <p>Por: {c.performer.name}</p>}\r\n                                        {c.cost && <p>R$ {Number(c.cost).toFixed(2)}</p>}\r\n                                        <button\r\n                                            onClick={() => window.open(`${api.defaults.baseURL}/equipments/${id}/calibrations/${c.id}/pdf`, '_blank')}\r\n                                            className=\"mt-1 flex items-center gap-1 rounded-md bg-emerald-50 px-2 py-1 text-xs font-medium text-emerald-700 hover:bg-emerald-100 transition-colors\"\r\n                                        >\r\n                                            <Download size={12} />\r\n                                            Certificado\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        {(eq.calibrations ?? []).length === 0 && (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Nenhuma calibração registrada</p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Tab: Manutenções */}\r\n            {tab === 'manutencoes' && (\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"flex justify-end\">\r\n                        <button\r\n                            onClick={() => setShowMaintForm(!showMaintForm)}\r\n                            className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700\"\r\n                        >\r\n                            <Plus size={16} />\r\n                            Nova Manutenção\r\n                        </button>\r\n                    </div>\r\n\r\n                    {showMaintForm && (\r\n                        <MaintenanceForm\r\n                            constants={constants}\r\n                            onSubmit={(d: any) => maintMutation.mutate(d)}\r\n                            loading={maintMutation.isPending}\r\n                        />\r\n                    )}\r\n\r\n                    <div className=\"space-y-3\">\r\n                        {(eq.maintenances ?? []).map((m: any) => (\r\n                            <div key={m.id} className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div>\r\n                                        <span className=\"rounded-full bg-surface-100 px-2.5 py-0.5 text-xs font-medium text-surface-700\">{m.type}</span>\r\n                                        <p className=\"mt-1 text-sm text-surface-900\">{m.description}</p>\r\n                                        {m.parts_replaced && <p className=\"text-sm text-surface-500\">Peças: {m.parts_replaced}</p>}\r\n                                    </div>\r\n                                    <div className=\"text-right text-xs text-surface-500\">\r\n                                        {m.performer?.name && <p>Por: {m.performer.name}</p>}\r\n                                        {m.cost && <p>R$ {Number(m.cost).toFixed(2)}</p>}\r\n                                        {m.downtime_hours && <p>{m.downtime_hours}h parado</p>}\r\n                                        <p>{new Date(m.created_at).toLocaleDateString('pt-BR')}</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        {(eq.maintenances ?? []).length === 0 && (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Nenhuma manutenção registrada</p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Tab: Documentos */}\r\n            {tab === 'documentos' && (\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"flex justify-end\">\r\n                        <label className=\"flex cursor-pointer items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700\">\r\n                            <Upload size={16} />\r\n                            Upload Documento\r\n                            <input\r\n                                type=\"file\"\r\n                                className=\"hidden\"\r\n                                onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n                                    const file = e.target.files?.[0]\r\n                                    if (!file) return\r\n                                    const name = prompt('Nome do documento:')\r\n                                    const type = prompt('Tipo (certificado, manual, foto, laudo, relatorio):') || 'certificado'\r\n                                    if (!name) return\r\n                                    const fd = new FormData()\r\n                                    fd.append('file', file)\r\n                                    fd.append('name', name)\r\n                                    fd.append('type', type)\r\n                                    docMutation.mutate(fd)\r\n                                }}\r\n                            />\r\n                        </label>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        {(eq.documents ?? []).map((d: any) => (\r\n                            <div key={d.id} className=\"flex items-center justify-between rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <FileText size={20} className=\"text-brand-500\" />\r\n                                    <div>\r\n                                        <p className=\"font-medium text-surface-900\">{d.name}</p>\r\n                                        <p className=\"text-xs text-surface-500\">{d.type} • {new Date(d.created_at).toLocaleDateString('pt-BR')}</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        {(eq.documents ?? []).length === 0 && (\r\n                            <p className=\"col-span-2 py-8 text-center text-sm text-surface-400\">Nenhum documento anexado</p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\n// ─── Componentes auxiliares ─────────────────────────────\r\n\r\nfunction Field({ label, value }: { label: string; value: any }) {\r\n    return (\r\n        <div>\r\n            <p className=\"text-xs font-medium text-surface-500\">{label}</p>\r\n            <p className=\"mt-0.5 text-sm text-surface-900\">{value || '—'}</p>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction CalibrationForm({ constants, onSubmit, loading }: any) {\r\n    const [form, setForm] = useState({\r\n        calibration_date: new Date().toISOString().slice(0, 10),\r\n        calibration_type: 'externa',\r\n        result: 'aprovado',\r\n        laboratory: '',\r\n        certificate_number: '',\r\n        uncertainty: '',\r\n        cost: '',\r\n        notes: '',\r\n    })\r\n\r\n    return (\r\n        <div className=\"rounded-xl border border-brand-200 bg-brand-50/30 p-5\">\r\n            <h3 className=\"mb-3 font-semibold text-surface-900\">Registrar Calibração</h3>\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n                <input type=\"date\" value={form.calibration_date} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, calibration_date: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <select value={form.calibration_type} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, calibration_type: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\">\r\n                    {Object.entries(constants?.calibration_types ?? {}).map(([k, v]) => <option key={k} value={k}>{v as string}</option>)}\r\n                </select>\r\n                <select value={form.result} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, result: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\">\r\n                    {Object.entries(constants?.calibration_results ?? {}).map(([k, v]) => <option key={k} value={k}>{v as string}</option>)}\r\n                </select>\r\n                <input placeholder=\"Laboratório\" value={form.laboratory} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, laboratory: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <input placeholder=\"Nº Certificado\" value={form.certificate_number} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, certificate_number: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <input placeholder=\"Incerteza\" value={form.uncertainty} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, uncertainty: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <input type=\"number\" placeholder=\"Custo (R$)\" value={form.cost} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, cost: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <input placeholder=\"Observações\" value={form.notes} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, notes: e.target.value }))} className=\"col-span-2 rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n            </div>\r\n            <div className=\"mt-3 flex justify-end\">\r\n                <button\r\n                    onClick={() => onSubmit({ ...form, cost: form.cost ? +form.cost : undefined })}\r\n                    disabled={loading}\r\n                    className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700 disabled:opacity-50\"\r\n                >\r\n                    {loading ? <Loader2 size={14} className=\"animate-spin\" /> : <CheckCircle2 size={14} />}\r\n                    Salvar\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction MaintenanceForm({ constants, onSubmit, loading }: any) {\r\n    const [form, setForm] = useState({\r\n        type: 'corretiva',\r\n        description: '',\r\n        parts_replaced: '',\r\n        cost: '',\r\n        downtime_hours: '',\r\n    })\r\n\r\n    return (\r\n        <div className=\"rounded-xl border border-brand-200 bg-brand-50/30 p-5\">\r\n            <h3 className=\"mb-3 font-semibold text-surface-900\">Registrar Manutenção</h3>\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n                <select value={form.type} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setForm(f => ({ ...f, type: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\">\r\n                    {Object.entries(constants?.maintenance_types ?? {}).map(([k, v]) => <option key={k} value={k}>{v as string}</option>)}\r\n                </select>\r\n                <input type=\"number\" placeholder=\"Custo (R$)\" value={form.cost} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, cost: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <input type=\"number\" placeholder=\"Horas parado\" value={form.downtime_hours} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, downtime_hours: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <input placeholder=\"Descrição do serviço\" value={form.description} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, description: e.target.value }))} className=\"col-span-2 rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n                <input placeholder=\"Peças substituídas\" value={form.parts_replaced} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setForm(f => ({ ...f, parts_replaced: e.target.value }))} className=\"rounded-lg border border-surface-200 px-3 py-2 text-sm\" />\r\n            </div>\r\n            <div className=\"mt-3 flex justify-end\">\r\n                <button\r\n                    onClick={() => onSubmit({\r\n                        ...form,\r\n                        cost: form.cost ? +form.cost : undefined,\r\n                        downtime_hours: form.downtime_hours ? +form.downtime_hours : undefined,\r\n                    })}\r\n                    disabled={loading || !form.description}\r\n                    className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700 disabled:opacity-50\"\r\n                >\r\n                    {loading ? <Loader2 size={14} className=\"animate-spin\" /> : <CheckCircle2 size={14} />}\r\n                    Salvar\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\equipamentos\\EquipmentListPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMutation' is defined but never used.","line":2,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMutation"},"fix":{"range":[58,71],"text":""},"desc":"Remove unused variable \"useMutation\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useQueryClient' is defined but never used.","line":2,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":47,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useQueryClient"},"fix":{"range":[71,87],"text":""},"desc":"Remove unused variable \"useQueryClient\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CheckCircle2' is defined but never used.","line":5,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":53,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[209,223],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[230,243],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4289,4292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4289,4292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Link } from 'react-router-dom'\r\nimport {\r\n    Search, Plus, Scale, AlertTriangle, CheckCircle2, Clock,\r\n    Filter, Eye, ChevronLeft, ChevronRight, Shield, Download\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface Equipment {\r\n    id: number\r\n    code: string\r\n    type: string\r\n    category: string\r\n    brand: string | null\r\n    manufacturer: string | null\r\n    model: string | null\r\n    serial_number: string | null\r\n    capacity: number | null\r\n    capacity_unit: string | null\r\n    resolution: number | null\r\n    precision_class: string | null\r\n    status: string\r\n    location: string | null\r\n    is_critical: boolean\r\n    is_active: boolean\r\n    next_calibration_at: string | null\r\n    last_calibration_at: string | null\r\n    customer?: { id: number; name: string }\r\n    responsible?: { id: number; name: string }\r\n}\r\n\r\ninterface DashboardData {\r\n    total: number\r\n    overdue: number\r\n    due_7_days: number\r\n    due_30_days: number\r\n    critical_count: number\r\n    by_category: Record<string, number>\r\n    by_status: Record<string, number>\r\n}\r\n\r\nconst statusColors: Record<string, string> = {\r\n    ativo: 'bg-emerald-100 text-emerald-700',\r\n    em_calibracao: 'bg-blue-100 text-blue-700',\r\n    em_manutencao: 'bg-amber-100 text-amber-700',\r\n    fora_de_uso: 'bg-surface-200 text-surface-600',\r\n    descartado: 'bg-red-100 text-red-700',\r\n}\r\n\r\nconst statusLabels: Record<string, string> = {\r\n    ativo: 'Ativo',\r\n    em_calibracao: 'Em Calibração',\r\n    em_manutencao: 'Em Manutenção',\r\n    fora_de_uso: 'Fora de Uso',\r\n    descartado: 'Descartado',\r\n}\r\n\r\nfunction calibrationBadge(nextDate: string | null) {\r\n    if (!nextDate) return { className: 'bg-surface-100 text-surface-500', label: 'Sem data' }\r\n    const d = new Date(nextDate)\r\n    const now = new Date()\r\n    const diffDays = Math.ceil((d.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))\r\n    if (diffDays < 0) return { className: 'bg-red-100 text-red-700', label: `Vencida (${Math.abs(diffDays)}d)` }\r\n    if (diffDays <= 30) return { className: 'bg-amber-100 text-amber-700', label: `${diffDays}d restantes` }\r\n    return { className: 'bg-emerald-100 text-emerald-700', label: `${diffDays}d` }\r\n}\r\n\r\nexport default function EquipmentListPage() {\r\n    const [search, setSearch] = useState('')\r\n    const [filterCategory, setFilterCategory] = useState('')\r\n    const [filterStatus, setFilterStatus] = useState('')\r\n    const [filterOverdue, setFilterOverdue] = useState(false)\r\n    const [page, setPage] = useState(1)\r\n\r\n    const { data: dashboard } = useQuery<DashboardData>({\r\n        queryKey: ['equipments-dashboard'],\r\n        queryFn: () => api.get('/equipments-dashboard').then(r => r.data),\r\n    })\r\n\r\n    const { data: constants } = useQuery({\r\n        queryKey: ['equipments-constants'],\r\n        queryFn: () => api.get('/equipments-constants').then(r => r.data),\r\n    })\r\n\r\n    const { data: pageData, isLoading } = useQuery({\r\n        queryKey: ['equipments', search, filterCategory, filterStatus, filterOverdue, page],\r\n        queryFn: () => api.get('/equipments', {\r\n            params: {\r\n                search: search || undefined,\r\n                category: filterCategory || undefined,\r\n                status: filterStatus || undefined,\r\n                overdue: filterOverdue || undefined,\r\n                page,\r\n                per_page: 25,\r\n            },\r\n        }).then(r => r.data),\r\n    })\r\n\r\n    const equipments: Equipment[] = pageData?.data ?? []\r\n    const lastPage = pageData?.last_page ?? 1\r\n    const categories = constants?.categories ?? {}\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Equipamentos</h1>\r\n                    <p className=\"text-sm text-surface-500\">Gestão de balanças, instrumentos e metrologia</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button\r\n                        onClick={() => window.open(`${(api.defaults as any).baseURL}/equipments-export`, '_blank')}\r\n                        className=\"flex items-center gap-2 rounded-lg border border-surface-200 px-4 py-2.5 text-sm font-medium text-surface-700 hover:bg-surface-50\"\r\n                    >\r\n                        <Download size={16} />\r\n                        Exportar CSV\r\n                    </button>\r\n                    <Link\r\n                        to=\"/equipamentos/novo\"\r\n                        className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2.5 text-sm font-medium text-white hover:bg-brand-700\"\r\n                    >\r\n                        <Plus size={16} />\r\n                        Novo Equipamento\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n\r\n            {/* KPI Cards */}\r\n            {dashboard && (\r\n                <div className=\"grid grid-cols-5 gap-3\">\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"rounded-lg bg-brand-50 p-2\"><Scale size={20} className=\"text-brand-600\" /></div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-surface-900\">{dashboard.total}</p>\r\n                                <p className=\"text-xs text-surface-500\">Total Ativos</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"rounded-xl border border-red-200 bg-red-50 p-4 shadow-card\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"rounded-lg bg-red-100 p-2\"><AlertTriangle size={20} className=\"text-red-600\" /></div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-red-700\">{dashboard.overdue}</p>\r\n                                <p className=\"text-xs text-red-600\">Vencidos</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"rounded-xl border border-amber-200 bg-amber-50 p-4 shadow-card\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"rounded-lg bg-amber-100 p-2\"><Clock size={20} className=\"text-amber-600\" /></div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-amber-700\">{dashboard.due_7_days}</p>\r\n                                <p className=\"text-xs text-amber-600\">Vence em 7d</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"rounded-xl border border-blue-200 bg-blue-50 p-4 shadow-card\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"rounded-lg bg-blue-100 p-2\"><Clock size={20} className=\"text-blue-600\" /></div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-blue-700\">{dashboard.due_30_days}</p>\r\n                                <p className=\"text-xs text-blue-600\">Vence em 30d</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"rounded-lg bg-surface-100 p-2\"><Shield size={20} className=\"text-surface-600\" /></div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-surface-900\">{dashboard.critical_count}</p>\r\n                                <p className=\"text-xs text-surface-500\">Críticos</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Category distribution bar */}\r\n            {dashboard && Object.keys(dashboard.by_category ?? {}).length > 0 && (() => {\r\n                const cats = Object.entries(dashboard.by_category)\r\n                const total = cats.reduce((s, [, v]) => s + v, 0)\r\n                const catColors: Record<string, string> = {\r\n                    rodoviaria: 'bg-brand-500', industrial: 'bg-emerald-500',\r\n                    laboratorio: 'bg-blue-500', comercial: 'bg-amber-500',\r\n                    especial: 'bg-rose-500', outro: 'bg-surface-400',\r\n                }\r\n                return (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <h3 className=\"text-sm font-semibold text-surface-900 mb-3\">Distribuição por Categoria</h3>\r\n                        <div className=\"flex h-6 overflow-hidden rounded-full\">\r\n                            {cats.map(([key, count]) => (\r\n                                <div key={key} className={cn('transition-all', catColors[key] ?? 'bg-surface-300')}\r\n                                    style={{ width: `${(count / total) * 100}%` }}\r\n                                    title={`${categories[key] as string || key}: ${count}`}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"mt-2 flex flex-wrap gap-3\">\r\n                            {cats.map(([key, count]) => (\r\n                                <div key={key} className=\"flex items-center gap-1.5\">\r\n                                    <span className={cn('h-2.5 w-2.5 rounded-full', catColors[key] ?? 'bg-surface-300')} />\r\n                                    <span className=\"text-xs text-surface-600\">{categories[key] as string || key} <strong>{count}</strong> ({total > 0 ? Math.round((count / total) * 100) : 0}%)</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )\r\n            })()}\r\n\r\n            {/* Filtros */}\r\n            <div className=\"flex flex-wrap items-center gap-3\">\r\n                <div className=\"relative flex-1\">\r\n                    <Search size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-surface-400\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Buscar por código, série, marca, modelo, tag...\"\r\n                        value={search}\r\n                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => { setSearch(e.target.value); setPage(1) }}\r\n                        className=\"w-full rounded-lg border border-surface-200 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-400 focus:outline-none focus:ring-2 focus:ring-brand-100\"\r\n                    />\r\n                </div>\r\n                <select\r\n                    value={filterCategory}\r\n                    onChange={(e: React.ChangeEvent<HTMLSelectElement>) => { setFilterCategory(e.target.value); setPage(1) }}\r\n                    className=\"rounded-lg border border-surface-200 bg-white px-3 py-2.5 text-sm\"\r\n                >\r\n                    <option value=\"\">Todas categorias</option>\r\n                    {Object.entries(categories).map(([k, v]) => (\r\n                        <option key={k} value={k}>{v as string}</option>\r\n                    ))}\r\n                </select>\r\n                <select\r\n                    value={filterStatus}\r\n                    onChange={(e: React.ChangeEvent<HTMLSelectElement>) => { setFilterStatus(e.target.value); setPage(1) }}\r\n                    className=\"rounded-lg border border-surface-200 bg-white px-3 py-2.5 text-sm\"\r\n                >\r\n                    <option value=\"\">Todos status</option>\r\n                    {Object.entries(statusLabels).map(([k, v]) => (\r\n                        <option key={k} value={k}>{v}</option>\r\n                    ))}\r\n                </select>\r\n                <button\r\n                    onClick={() => { setFilterOverdue(!filterOverdue); setPage(1) }}\r\n                    className={cn(\r\n                        'flex items-center gap-1 rounded-lg border px-3 py-2.5 text-sm font-medium transition-all',\r\n                        filterOverdue\r\n                            ? 'border-red-300 bg-red-50 text-red-700'\r\n                            : 'border-surface-200 bg-white text-surface-600 hover:bg-surface-50'\r\n                    )}\r\n                >\r\n                    <AlertTriangle size={14} />\r\n                    Vencidos\r\n                </button>\r\n            </div>\r\n\r\n            {/* Tabela */}\r\n            <div className=\"overflow-auto rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full text-sm\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Código</th>\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Equipamento</th>\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Série</th>\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Cliente</th>\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Categoria</th>\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Status</th>\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Calibração</th>\r\n                            <th className=\"px-4 py-3 text-left font-semibold text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading && (\r\n                            <tr><td colSpan={8} className=\"px-4 py-8 text-center text-surface-400\">Carregando...</td></tr>\r\n                        )}\r\n                        {!isLoading && equipments.length === 0 && (\r\n                            <tr><td colSpan={8} className=\"px-4 py-8 text-center text-surface-400\">Nenhum equipamento encontrado</td></tr>\r\n                        )}\r\n                        {equipments.map(eq => {\r\n                            const calBadge = calibrationBadge(eq.next_calibration_at)\r\n                            return (\r\n                                <tr key={eq.id} className=\"transition-colors hover:bg-surface-50/50\">\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <span className=\"font-mono text-xs font-medium text-brand-600\">{eq.code}</span>\r\n                                        {eq.is_critical && (\r\n                                            <span className=\"ml-1 inline-block h-2 w-2 rounded-full bg-red-500\" title=\"Crítico\" />\r\n                                        )}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <div className=\"font-medium text-surface-900\">\r\n                                            {eq.brand} {eq.model}\r\n                                        </div>\r\n                                        <div className=\"text-xs text-surface-500\">{eq.type}</div>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 font-mono text-xs text-surface-600\">\r\n                                        {eq.serial_number || '—'}\r\n                                    </td>\r\n                                    <td className=\"max-w-[150px] truncate px-4 py-3 text-surface-700\">\r\n                                        {eq.customer?.name || '—'}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-xs text-surface-600\">\r\n                                        {categories[eq.category] as string || eq.category}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <span className={cn('rounded-full px-2.5 py-0.5 text-xs font-medium', statusColors[eq.status] || 'bg-surface-100')}>\r\n                                            {statusLabels[eq.status] || eq.status}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <span className={cn('rounded-full px-2.5 py-0.5 text-xs font-medium', calBadge.className)}>\r\n                                            {calBadge.label}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <Link\r\n                                            to={`/equipamentos/${eq.id}`}\r\n                                            className=\"inline-flex items-center gap-1 rounded-lg bg-surface-100 px-2.5 py-1.5 text-xs font-medium text-surface-700 hover:bg-surface-200\"\r\n                                        >\r\n                                            <Eye size={12} />\r\n                                            Ver\r\n                                        </Link>\r\n                                    </td>\r\n                                </tr>\r\n                            )\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Paginação */}\r\n            {lastPage > 1 && (\r\n                <div className=\"flex items-center justify-center gap-2\">\r\n                    <button\r\n                        onClick={() => setPage(p => Math.max(1, p - 1))}\r\n                        disabled={page === 1}\r\n                        className=\"rounded-lg border border-surface-200 p-2 hover:bg-surface-50 disabled:opacity-50\"\r\n                    >\r\n                        <ChevronLeft size={16} />\r\n                    </button>\r\n                    <span className=\"text-sm text-surface-600\">Página {page} de {lastPage}</span>\r\n                    <button\r\n                        onClick={() => setPage(p => Math.min(lastPage, p + 1))}\r\n                        disabled={page === lastPage}\r\n                        className=\"rounded-lg border border-surface-200 p-2 hover:bg-surface-50 disabled:opacity-50\"\r\n                    >\r\n                        <ChevronRight size={16} />\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\estoque\\StockDashboardPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\estoque\\StockMovementsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":207,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12762,12765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12762,12765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Search, Plus, Package, ArrowDownToLine, ArrowUpFromLine, RotateCcw, Wrench, ArrowLeftRight } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\ninterface StockMovement {\r\n    id: number\r\n    product: { id: number; name: string; code: string | null }\r\n    work_order: { id: number; number: string } | null\r\n    type: 'entry' | 'exit' | 'reserve' | 'return' | 'adjustment'\r\n    quantity: string\r\n    unit_cost: string\r\n    reference: string | null\r\n    notes: string | null\r\n    created_by_user: { id: number; name: string } | null\r\n    created_at: string\r\n}\r\n\r\nconst TYPE_CONFIG: Record<string, { label: string; icon: React.ElementType; color: string; badgeVariant: 'emerald' | 'red' | 'amber' | 'blue' | 'brand' }> = {\r\n    entry: { label: 'Entrada', icon: ArrowDownToLine, color: 'text-emerald-600 bg-emerald-50', badgeVariant: 'emerald' },\r\n    exit: { label: 'Saída', icon: ArrowUpFromLine, color: 'text-red-600 bg-red-50', badgeVariant: 'red' },\r\n    reserve: { label: 'Reserva', icon: Package, color: 'text-amber-600 bg-amber-50', badgeVariant: 'amber' },\r\n    return: { label: 'Devolução', icon: RotateCcw, color: 'text-blue-600 bg-blue-50', badgeVariant: 'blue' },\r\n    adjustment: { label: 'Ajuste', icon: ArrowLeftRight, color: 'text-surface-600 bg-surface-100', badgeVariant: 'brand' },\r\n}\r\n\r\nconst emptyForm = {\r\n    product_id: '' as string | number,\r\n    type: 'entry' as 'entry' | 'adjustment',\r\n    quantity: '',\r\n    unit_cost: '0',\r\n    notes: '',\r\n}\r\n\r\nexport function StockMovementsPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [typeFilter, setTypeFilter] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [form, setForm] = useState(emptyForm)\r\n    const [page, setPage] = useState(1)\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['stock-movements', search, typeFilter, page],\r\n        queryFn: () => api.get('/stock/movements', { params: { search, type: typeFilter || undefined, page, per_page: 25 } }),\r\n    })\r\n    const movements: StockMovement[] = res?.data?.data ?? []\r\n    const pagination = res?.data?.meta ?? { last_page: 1, current_page: 1 }\r\n\r\n    const { data: productsRes } = useQuery({\r\n        queryKey: ['products-select'],\r\n        queryFn: () => api.get('/products', { params: { per_page: 200 } }),\r\n    })\r\n    const products = productsRes?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) => api.post('/stock/movements', data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['stock-movements'] })\r\n            qc.invalidateQueries({ queryKey: ['stock-summary'] })\r\n            qc.invalidateQueries({ queryKey: ['stock-low-alerts'] })\r\n            setShowForm(false)\r\n            setForm(emptyForm)\r\n        },\r\n    })\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n        setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n    const formatDate = (d: string) => new Date(d).toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: '2-digit', hour: '2-digit', minute: '2-digit' })\r\n    const formatBRL = (v: string) => parseFloat(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Movimentações de Estoque</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Registro de entradas, saídas e ajustes</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setForm(emptyForm); setShowForm(true) }}>\r\n                    Nova Movimentação\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <div className=\"relative max-w-sm flex-1\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input\r\n                        type=\"text\" value={search}\r\n                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => { setSearch(e.target.value); setPage(1) }}\r\n                        placeholder=\"Buscar por produto...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                    />\r\n                </div>\r\n                <select\r\n                    value={typeFilter}\r\n                    onChange={(e: React.ChangeEvent<HTMLSelectElement>) => { setTypeFilter(e.target.value); setPage(1) }}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                >\r\n                    <option value=\"\">Todos os tipos</option>\r\n                    <option value=\"entry\">Entrada</option>\r\n                    <option value=\"exit\">Saída</option>\r\n                    <option value=\"reserve\">Reserva</option>\r\n                    <option value=\"return\">Devolução</option>\r\n                    <option value=\"adjustment\">Ajuste</option>\r\n                </select>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Data</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Produto</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Tipo</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Quantidade</th>\r\n                            <th className=\"hidden px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600 md:table-cell\">Custo Unit.</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 lg:table-cell\">Referência</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 lg:table-cell\">Usuário</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : movements.length === 0 ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">\r\n                                <div className=\"flex flex-col items-center gap-2\">\r\n                                    <Package className=\"h-8 w-8 text-surface-300\" />\r\n                                    Nenhuma movimentação encontrada\r\n                                </div>\r\n                            </td></tr>\r\n                        ) : movements.map(m => {\r\n                            const conf = TYPE_CONFIG[m.type] ?? TYPE_CONFIG.adjustment\r\n                            const Icon = conf.icon\r\n                            return (\r\n                                <tr key={m.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-600 whitespace-nowrap\">{formatDate(m.created_at)}</td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <div>\r\n                                            <p className=\"text-sm font-medium text-surface-900\">{m.product?.name}</p>\r\n                                            {m.product?.code && <p className=\"text-xs text-surface-400\">#{m.product.code}</p>}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <div className={cn('flex h-7 w-7 items-center justify-center rounded-md', conf.color)}>\r\n                                                <Icon className=\"h-3.5 w-3.5\" />\r\n                                            </div>\r\n                                            <Badge variant={conf.badgeVariant}>{conf.label}</Badge>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-right text-sm font-medium text-surface-900\">\r\n                                        {m.type === 'entry' || m.type === 'return' ? '+' : m.type === 'exit' || m.type === 'reserve' ? '-' : ''}\r\n                                        {parseFloat(m.quantity)}\r\n                                    </td>\r\n                                    <td className=\"hidden px-4 py-3 text-right text-sm text-surface-600 md:table-cell\">\r\n                                        {parseFloat(m.unit_cost) > 0 ? formatBRL(m.unit_cost) : '—'}\r\n                                    </td>\r\n                                    <td className=\"hidden px-4 py-3 text-sm text-surface-600 lg:table-cell\">\r\n                                        {m.reference ?? m.work_order ? (\r\n                                            <span className=\"flex items-center gap-1\">\r\n                                                <Wrench className=\"h-3 w-3\" />\r\n                                                {m.reference || `OS #${m.work_order?.number}`}\r\n                                            </span>\r\n                                        ) : '—'}\r\n                                    </td>\r\n                                    <td className=\"hidden px-4 py-3 text-sm text-surface-500 lg:table-cell\">\r\n                                        {m.created_by_user?.name ?? '—'}\r\n                                    </td>\r\n                                </tr>\r\n                            )\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n\r\n                {/* Pagination */}\r\n                {pagination.last_page > 1 && (\r\n                    <div className=\"flex items-center justify-between border-t border-surface-200 px-4 py-3\">\r\n                        <p className=\"text-xs text-surface-500\">Página {pagination.current_page} de {pagination.last_page}</p>\r\n                        <div className=\"flex gap-1\">\r\n                            <Button variant=\"outline\" size=\"sm\" disabled={page <= 1} onClick={() => setPage(p => p - 1)}>Anterior</Button>\r\n                            <Button variant=\"outline\" size=\"sm\" disabled={page >= pagination.last_page} onClick={() => setPage(p => p + 1)}>Próxima</Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* New Movement Modal */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title=\"Nova Movimentação\" size=\"md\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Produto</label>\r\n                        <select\r\n                            value={form.product_id}\r\n                            onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('product_id', e.target.value)}\r\n                            required\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                        >\r\n                            <option value=\"\">Selecione um produto</option>\r\n                            {products.map((p: any) => <option key={p.id} value={p.id}>{p.name}{p.code ? ` (#${p.code})` : ''}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Tipo</label>\r\n                            <select\r\n                                value={form.type}\r\n                                onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('type', e.target.value as 'entry' | 'adjustment')}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                            >\r\n                                <option value=\"entry\">Entrada</option>\r\n                                <option value=\"adjustment\">Ajuste</option>\r\n                            </select>\r\n                        </div>\r\n                        <Input label=\"Quantidade\" type=\"number\" step=\"0.01\" min=\"0.01\" value={form.quantity} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('quantity', e.target.value)} required />\r\n                    </div>\r\n                    <Input label=\"Custo Unitário (R$)\" type=\"number\" step=\"0.01\" value={form.unit_cost} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('unit_cost', e.target.value)} />\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Observações</label>\r\n                        <textarea\r\n                            value={form.notes}\r\n                            onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('notes', e.target.value)}\r\n                            rows={2}\r\n                            placeholder=\"Motivo da movimentação...\"\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                        />\r\n                    </div>\r\n                    {saveMut.isError && (\r\n                        <div className=\"rounded-lg bg-red-50 px-4 py-3 text-sm text-red-700\">\r\n                            Erro ao salvar movimentação. Verifique os dados e tente novamente.\r\n                        </div>\r\n                    )}\r\n                    <div className=\"flex items-center justify-end gap-3 border-t border-surface-200 pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>Registrar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\AccountPayableCategoriesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Palette' is defined but never used.","line":3,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Palette"},"fix":{"range":[145,154],"text":""},"desc":"Remove unused variable \"Palette\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1134,1137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1134,1137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Plus, Tag, Trash2, Edit, Palette } from 'lucide-react'\r\nimport api from '@/lib/api'\r\n\r\ninterface Category {\r\n    id: number\r\n    name: string\r\n    color: string | null\r\n    description: string | null\r\n    is_active: boolean\r\n}\r\n\r\nconst presetColors = [\r\n    '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',\r\n    '#ec4899', '#06b6d4', '#f97316', '#6366f1', '#14b8a6',\r\n]\r\n\r\nexport function AccountPayableCategoriesPage() {\r\n    const qc = useQueryClient()\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editing, setEditing] = useState<Category | null>(null)\r\n    const [name, setName] = useState('')\r\n    const [color, setColor] = useState('#3b82f6')\r\n    const [description, setDescription] = useState('')\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['ap-categories'],\r\n        queryFn: () => api.get('/accounts-payable-categories'),\r\n    })\r\n    const categories: Category[] = res?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (payload: any) =>\r\n            editing\r\n                ? api.put(`/accounts-payable-categories/${editing.id}`, payload)\r\n                : api.post('/accounts-payable-categories', payload),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['ap-categories'] })\r\n            resetForm()\r\n        },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/accounts-payable-categories/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['ap-categories'] }),\r\n    })\r\n\r\n    const resetForm = () => {\r\n        setShowForm(false)\r\n        setEditing(null)\r\n        setName('')\r\n        setColor('#3b82f6')\r\n        setDescription('')\r\n    }\r\n\r\n    const openEdit = (c: Category) => {\r\n        setEditing(c)\r\n        setName(c.name)\r\n        setColor(c.color ?? '#3b82f6')\r\n        setDescription(c.description ?? '')\r\n        setShowForm(true)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Categorias de Contas a Pagar</h1>\r\n                <button\r\n                    onClick={() => { resetForm(); setShowForm(true) }}\r\n                    className=\"inline-flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700 transition-colors\"\r\n                >\r\n                    <Plus className=\"h-4 w-4\" /> Nova Categoria\r\n                </button>\r\n            </div>\r\n\r\n            {showForm && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card space-y-4\">\r\n                    <h2 className=\"font-semibold text-surface-900\">{editing ? 'Editar' : 'Nova'} Categoria</h2>\r\n                    <div className=\"grid sm:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-surface-700 mb-1\">Nome</label>\r\n                            <input value={name} onChange={e => setName(e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-surface-700 mb-1\">Descrição</label>\r\n                            <input value={description} onChange={e => setDescription(e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500\" />\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-surface-700 mb-2\">Cor</label>\r\n                        <div className=\"flex gap-2\">\r\n                            {presetColors.map(c => (\r\n                                <button key={c} onClick={() => setColor(c)}\r\n                                    className={`h-8 w-8 rounded-full border-2 transition-transform ${color === c ? 'border-surface-900 scale-110' : 'border-transparent'}`}\r\n                                    style={{ backgroundColor: c }}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex gap-3 justify-end\">\r\n                        <button onClick={resetForm} className=\"px-4 py-2 text-sm text-surface-600 hover:text-surface-800\">Cancelar</button>\r\n                        <button onClick={() => saveMut.mutate({ name, color, description: description || null })}\r\n                            disabled={!name.trim() || saveMut.isPending}\r\n                            className=\"px-4 py-2 text-sm font-medium rounded-lg bg-brand-600 text-white hover:bg-brand-700 disabled:opacity-50\">\r\n                            {saveMut.isPending ? 'Salvando...' : 'Salvar'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {isLoading ? (\r\n                <div className=\"text-center text-surface-400 py-12\">Carregando...</div>\r\n            ) : categories.length === 0 ? (\r\n                <div className=\"text-center text-surface-400 py-12\">Nenhuma categoria cadastrada.</div>\r\n            ) : (\r\n                <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\">\r\n                    {categories.map(c => (\r\n                        <div key={c.id} className=\"rounded-xl border border-surface-200 bg-white shadow-card p-4 flex items-center gap-3\">\r\n                            <div className=\"h-10 w-10 rounded-lg flex items-center justify-center flex-shrink-0\"\r\n                                style={{ backgroundColor: c.color ? `${c.color}20` : '#f1f5f9' }}>\r\n                                <Tag className=\"h-5 w-5\" style={{ color: c.color ?? '#64748b' }} />\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"text-sm font-semibold text-surface-900\">{c.name}</p>\r\n                                {c.description && <p className=\"text-xs text-surface-500 truncate\">{c.description}</p>}\r\n                            </div>\r\n                            <div className=\"flex gap-1\">\r\n                                <button onClick={() => openEdit(c)} className=\"p-1.5 rounded hover:bg-surface-100 text-surface-400 hover:text-brand-600\">\r\n                                    <Edit className=\"h-3.5 w-3.5\" />\r\n                                </button>\r\n                                <button onClick={() => { if (confirm('Excluir categoria?')) deleteMut.mutate(c.id) }}\r\n                                    className=\"p-1.5 rounded hover:bg-surface-100 text-surface-400 hover:text-red-500\">\r\n                                    <Trash2 className=\"h-3.5 w-3.5\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\AccountsPayablePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DollarSign' is defined but never used.","line":4,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DollarSign"},"fix":{"range":[127,138],"text":""},"desc":"Remove unused variable \"DollarSign\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[268,300],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[643,646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[643,646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":286,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20500,20503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20500,20503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    DollarSign, Plus, Search, ArrowUp, AlertTriangle,\r\n    CheckCircle, Clock, Eye, Trash2,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { FinancialExportButtons } from '@/components/financial/FinancialExportButtons'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any }> = {\r\n    pending: { label: 'Pendente', variant: 'warning' },\r\n    partial: { label: 'Parcial', variant: 'info' },\r\n    paid: { label: 'Pago', variant: 'success' },\r\n    overdue: { label: 'Vencido', variant: 'danger' },\r\n    cancelled: { label: 'Cancelado', variant: 'default' },\r\n}\r\n\r\n\r\n\r\nconst paymentMethods: Record<string, string> = {\r\n    dinheiro: 'Dinheiro', pix: 'PIX', cartao_credito: 'Cartão Crédito',\r\n    cartao_debito: 'Cartão Débito', boleto: 'Boleto', transferencia: 'Transferência',\r\n}\r\n\r\ninterface AP {\r\n    id: number; supplier: string | null; category: string | null\r\n    description: string; amount: string; amount_paid: string\r\n    due_date: string; paid_at: string | null; status: string\r\n    payment_method: string | null; notes: string | null\r\n    payments?: { id: number; amount: string; payment_method: string; payment_date: string; receiver: { name: string } }[]\r\n}\r\n\r\nconst fmtBRL = (val: string | number) => Number(val).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\nconst fmtDate = (d: string) => new Date(d + 'T00:00:00').toLocaleDateString('pt-BR')\r\n\r\nexport function AccountsPayablePage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n    const [catFilter, setCatFilter] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [showPay, setShowPay] = useState<AP | null>(null)\r\n    const [showDetail, setShowDetail] = useState<AP | null>(null)\r\n    const [form, setForm] = useState({\r\n        supplier: '', category: '', description: '', amount: '', due_date: '', payment_method: '', notes: '',\r\n    })\r\n    const [payForm, setPayForm] = useState({ amount: '', payment_method: 'pix', payment_date: '', notes: '' })\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['accounts-payable', search, statusFilter, catFilter],\r\n        queryFn: () => api.get('/accounts-payable', {\r\n            params: { search: search || undefined, status: statusFilter || undefined, category: catFilter || undefined, per_page: 50 },\r\n        }),\r\n    })\r\n    const records: AP[] = res?.data?.data ?? []\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['ap-summary'],\r\n        queryFn: () => api.get('/accounts-payable-summary'),\r\n    })\r\n    const summary = summaryRes?.data ?? {}\r\n\r\n    const { data: catRes } = useQuery({\r\n        queryKey: ['ap-categories'],\r\n        queryFn: () => api.get('/accounts-payable-categories'),\r\n    })\r\n    const categories: { id: number; name: string }[] = catRes?.data ?? []\r\n    const catMap: Record<string, string> = {}\r\n    categories.forEach(c => { catMap[c.name] = c.name })\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) => api.post('/accounts-payable', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['accounts-payable'] }); qc.invalidateQueries({ queryKey: ['ap-summary'] }); setShowForm(false) },\r\n    })\r\n\r\n    const payMut = useMutation({\r\n        mutationFn: ({ id, data }: { id: number; data: typeof payForm }) => api.post(`/accounts-payable/${id}/pay`, data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['accounts-payable'] }); qc.invalidateQueries({ queryKey: ['ap-summary'] }); setShowPay(null) },\r\n    })\r\n\r\n    const delMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/accounts-payable/${id}`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['accounts-payable'] }); qc.invalidateQueries({ queryKey: ['ap-summary'] }) },\r\n    })\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) => setForm(p => ({ ...p, [k]: v }))\r\n\r\n    const loadDetail = async (ap: AP) => {\r\n        const { data } = await api.get(`/accounts-payable/${ap.id}`)\r\n        setShowDetail(data)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Contas a Pagar</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Despesas, fornecedores e pagamentos</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <FinancialExportButtons type=\"payable\" />\r\n                    <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setForm({ supplier: '', category: '', description: '', amount: '', due_date: '', payment_method: '', notes: '' }); setShowForm(true) }}>\r\n                        Nova Conta\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid gap-3 sm:grid-cols-3\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-amber-600\"><Clock className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pendente</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-surface-900\">{fmtBRL(summary.pending ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-red-600\"><AlertTriangle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Vencido</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-red-600\">{fmtBRL(summary.overdue ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-emerald-600\"><CheckCircle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pago (mês)</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-emerald-600\">{fmtBRL(summary.paid_this_month ?? 0)}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <div className=\"relative flex-1 max-w-sm\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)} placeholder=\"Buscar descrição ou fornecedor\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                </div>\r\n                <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todos os status</option>\r\n                    {Object.entries(statusConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                </select>\r\n                <select value={catFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setCatFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todas categorias</option>\r\n                    {categories.map(c => <option key={c.id} value={c.name}>{c.name}</option>)}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Descrição</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">Fornecedor</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 sm:table-cell\">Categoria</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">Vencimento</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Status</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Valor</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : records.length === 0 ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhuma conta encontrada</td></tr>\r\n                        ) : records.map(r => (\r\n                            <tr key={r.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{r.description}</td>\r\n                                <td className=\"hidden px-4 py-3 text-sm text-surface-600 md:table-cell\">{r.supplier ?? '—'}</td>\r\n                                <td className=\"hidden px-4 py-3 sm:table-cell\">\r\n                                    {r.category ? <Badge variant=\"default\">{catMap[r.category] ?? r.category}</Badge> : '—'}\r\n                                </td>\r\n                                <td className=\"hidden px-4 py-3 text-sm text-surface-500 md:table-cell\">{fmtDate(r.due_date)}</td>\r\n                                <td className=\"px-4 py-3\"><Badge variant={statusConfig[r.status]?.variant}>{statusConfig[r.status]?.label}</Badge></td>\r\n                                <td className=\"px-4 py-3 text-right text-sm font-semibold text-surface-900\">{fmtBRL(r.amount)}</td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center justify-end gap-1\">\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => loadDetail(r)}><Eye className=\"h-4 w-4\" /></Button>\r\n                                        {r.status !== 'paid' && r.status !== 'cancelled' && (\r\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => {\r\n                                                setShowPay(r)\r\n                                                const remaining = Number(r.amount) - Number(r.amount_paid)\r\n                                                setPayForm({ amount: remaining.toFixed(2), payment_method: 'pix', payment_date: new Date().toISOString().split('T')[0], notes: '' })\r\n                                            }}>\r\n                                                <ArrowUp className=\"h-4 w-4 text-emerald-600\" />\r\n                                            </Button>\r\n                                        )}\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delMut.mutate(r.id) }}>\r\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Create Modal */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title=\"Nova Conta a Pagar\" size=\"lg\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Fornecedor\" value={form.supplier} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('supplier', e.target.value)} />\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Categoria</label>\r\n                            <select value={form.category} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('category', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Selecionar</option>\r\n                                {categories.map(c => <option key={c.id} value={c.name}>{c.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <Input label=\"Descrição\" value={form.description} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('description', e.target.value)} required />\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <Input label=\"Valor (R$)\" type=\"number\" step=\"0.01\" value={form.amount} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('amount', e.target.value)} required />\r\n                        <Input label=\"Vencimento\" type=\"date\" value={form.due_date} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('due_date', e.target.value)} required />\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Forma Pgto</label>\r\n                            <select value={form.payment_method} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('payment_method', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Não definido</option>\r\n                                {Object.entries(paymentMethods).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Observações</label>\r\n                        <textarea value={form.notes} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('notes', e.target.value)} rows={2}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Pay Modal */}\r\n            <Modal open={!!showPay} onOpenChange={() => setShowPay(null)} title=\"Registrar Pagamento\">\r\n                {showPay && (\r\n                    <form onSubmit={e => { e.preventDefault(); payMut.mutate({ id: showPay.id, data: payForm }) }} className=\"space-y-4\">\r\n                        <div className=\"rounded-lg bg-surface-50 p-3 text-sm\">\r\n                            <p className=\"font-medium\">{showPay.description}</p>\r\n                            <p className=\"text-surface-500\">{showPay.supplier ?? 'Sem fornecedor'}</p>\r\n                            <p className=\"mt-1\">Valor: <strong>{fmtBRL(showPay.amount)}</strong> | Pago: <strong>{fmtBRL(showPay.amount_paid)}</strong> | Restante: <strong className=\"text-emerald-600\">{fmtBRL(Number(showPay.amount) - Number(showPay.amount_paid))}</strong></p>\r\n                        </div>\r\n                        <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                            <Input label=\"Valor\" type=\"number\" step=\"0.01\" value={payForm.amount}\r\n                                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setPayForm(p => ({ ...p, amount: e.target.value }))} required />\r\n                            <div>\r\n                                <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Forma Pgto *</label>\r\n                                <select value={payForm.payment_method} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setPayForm(p => ({ ...p, payment_method: e.target.value }))} required\r\n                                    className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                    {Object.entries(paymentMethods).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                                </select>\r\n                            </div>\r\n                            <Input label=\"Data\" type=\"date\" value={payForm.payment_date}\r\n                                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setPayForm(p => ({ ...p, payment_date: e.target.value }))} required />\r\n                        </div>\r\n                        <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                            <Button variant=\"outline\" type=\"button\" onClick={() => setShowPay(null)}>Cancelar</Button>\r\n                            <Button type=\"submit\" loading={payMut.isPending}>Pagar</Button>\r\n                        </div>\r\n                    </form>\r\n                )}\r\n            </Modal>\r\n\r\n            {/* Detail Modal */}\r\n            <Modal open={!!showDetail} onOpenChange={() => setShowDetail(null)} title=\"Detalhes da Conta\" size=\"lg\">\r\n                {showDetail && (\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                            <div><span className=\"text-xs text-surface-500\">Descrição</span><p className=\"text-sm font-medium\">{showDetail.description}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Fornecedor</span><p className=\"text-sm font-medium\">{showDetail.supplier ?? '—'}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Valor</span><p className=\"text-lg font-bold\">{fmtBRL(showDetail.amount)}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Pago</span><p className=\"text-lg font-bold text-emerald-600\">{fmtBRL(showDetail.amount_paid)}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Vencimento</span><p className=\"text-sm\">{fmtDate(showDetail.due_date)}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Status</span><Badge variant={statusConfig[showDetail.status]?.variant}>{statusConfig[showDetail.status]?.label}</Badge></div>\r\n                        </div>\r\n                        {showDetail.payments && showDetail.payments.length > 0 && (\r\n                            <div>\r\n                                <h4 className=\"mb-2 text-sm font-semibold text-surface-700\">Pagamentos</h4>\r\n                                <div className=\"space-y-2\">\r\n                                    {showDetail.payments.map((p: any) => (\r\n                                        <div key={p.id} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                            <div>\r\n                                                <p className=\"text-sm font-medium\">{fmtBRL(p.amount)} — {paymentMethods[p.payment_method] ?? p.payment_method}</p>\r\n                                                <p className=\"text-xs text-surface-500\">{fmtDate(p.payment_date)} por {p.receiver?.name}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\AccountsReceivablePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[655,658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[655,658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16305,16308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16305,16308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":315,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22248,22251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22248,22251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":352,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":352,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25607,25610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25607,25610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    DollarSign, Plus, Search, ArrowDown, AlertTriangle,\r\n    CheckCircle, Clock, Eye, Trash2, FileText,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { FinancialExportButtons } from '@/components/financial/FinancialExportButtons'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any }> = {\r\n    pending: { label: 'Pendente', variant: 'warning' },\r\n    partial: { label: 'Parcial', variant: 'info' },\r\n    paid: { label: 'Pago', variant: 'success' },\r\n    overdue: { label: 'Vencido', variant: 'danger' },\r\n    cancelled: { label: 'Cancelado', variant: 'default' },\r\n}\r\n\r\nconst paymentMethods: Record<string, string> = {\r\n    dinheiro: 'Dinheiro', pix: 'PIX', cartao_credito: 'Cartão Crédito',\r\n    cartao_debito: 'Cartão Débito', boleto: 'Boleto', transferencia: 'Transferência',\r\n}\r\n\r\ninterface AR {\r\n    id: number; description: string; amount: string; amount_paid: string\r\n    due_date: string; paid_at: string | null; status: string\r\n    payment_method: string | null; notes: string | null\r\n    customer: { id: number; name: string }\r\n    work_order: { id: number; number: string } | null\r\n    payments?: { id: number; amount: string; payment_method: string; payment_date: string; receiver: { name: string } }[]\r\n}\r\n\r\nconst fmtBRL = (val: string | number) => Number(val).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\nconst fmtDate = (d: string) => new Date(d + 'T00:00:00').toLocaleDateString('pt-BR')\r\n\r\nexport function AccountsReceivablePage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [showPay, setShowPay] = useState<AR | null>(null)\r\n    const [showDetail, setShowDetail] = useState<AR | null>(null)\r\n    const [form, setForm] = useState({\r\n        customer_id: '' as string | number, description: '', amount: '', due_date: '',\r\n        payment_method: '', notes: '', work_order_id: '' as string | number,\r\n    })\r\n    const [payForm, setPayForm] = useState({ amount: '', payment_method: 'pix', payment_date: '', notes: '' })\r\n    const [showGenOS, setShowGenOS] = useState(false)\r\n    const [genForm, setGenForm] = useState({ work_order_id: '' as string | number, due_date: '', payment_method: '' })\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['accounts-receivable', search, statusFilter],\r\n        queryFn: () => api.get('/accounts-receivable', { params: { search: search || undefined, status: statusFilter || undefined, per_page: 50 } }),\r\n    })\r\n    const records: AR[] = res?.data?.data ?? []\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['ar-summary'],\r\n        queryFn: () => api.get('/accounts-receivable-summary'),\r\n    })\r\n    const summary = summaryRes?.data ?? {}\r\n\r\n    const { data: custsRes } = useQuery({\r\n        queryKey: ['customers-select'],\r\n        queryFn: () => api.get('/customers', { params: { per_page: 100 } }),\r\n        enabled: showForm,\r\n    })\r\n\r\n    const { data: wosRes } = useQuery({\r\n        queryKey: ['work-orders-financial'],\r\n        queryFn: () => api.get('/work-orders', { params: { per_page: 50 } }),\r\n        enabled: showGenOS || showForm,\r\n    })\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) => api.post('/accounts-receivable', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['accounts-receivable'] }); qc.invalidateQueries({ queryKey: ['ar-summary'] }); setShowForm(false) },\r\n    })\r\n\r\n    const payMut = useMutation({\r\n        mutationFn: ({ id, data }: { id: number; data: typeof payForm }) => api.post(`/accounts-receivable/${id}/pay`, data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['accounts-receivable'] }); qc.invalidateQueries({ queryKey: ['ar-summary'] }); setShowPay(null) },\r\n    })\r\n\r\n    const genMut = useMutation({\r\n        mutationFn: (data: typeof genForm) => api.post('/accounts-receivable/generate-from-os', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['accounts-receivable'] }); qc.invalidateQueries({ queryKey: ['ar-summary'] }); setShowGenOS(false) },\r\n    })\r\n\r\n    const delMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/accounts-receivable/${id}`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['accounts-receivable'] }); qc.invalidateQueries({ queryKey: ['ar-summary'] }) },\r\n    })\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) => setForm(p => ({ ...p, [k]: v }))\r\n\r\n    const loadDetail = async (ar: AR) => {\r\n        const { data } = await api.get(`/accounts-receivable/${ar.id}`)\r\n        setShowDetail(data)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Contas a Receber</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Títulos, recebimentos e cobranças</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <FinancialExportButtons type=\"receivable\" />\r\n                    <Button variant=\"outline\" icon={<FileText className=\"h-4 w-4\" />} onClick={() => { setGenForm({ work_order_id: '', due_date: '', payment_method: '' }); setShowGenOS(true) }}>\r\n                        Gerar da OS\r\n                    </Button>\r\n                    <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setForm({ customer_id: '', description: '', amount: '', due_date: '', payment_method: '', notes: '', work_order_id: '' }); setShowForm(true) }}>\r\n                        Novo Título\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid gap-3 sm:grid-cols-4\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-amber-600\"><Clock className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pendente</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-surface-900\">{fmtBRL(summary.pending ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-red-600\"><AlertTriangle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Vencido</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-red-600\">{fmtBRL(summary.overdue ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-emerald-600\"><CheckCircle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Recebido (mês)</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-emerald-600\">{fmtBRL(summary.paid_this_month ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-brand-600\"><DollarSign className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Total Geral</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-surface-900\">{fmtBRL(summary.total ?? 0)}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Aging bar */}\r\n            {records.length > 0 && (() => {\r\n                const groups = [\r\n                    { key: 'paid', label: 'Pago', color: 'bg-emerald-500', count: records.filter(r => r.status === 'paid').length },\r\n                    { key: 'pending', label: 'Pendente', color: 'bg-amber-500', count: records.filter(r => r.status === 'pending').length },\r\n                    { key: 'partial', label: 'Parcial', color: 'bg-blue-500', count: records.filter(r => r.status === 'partial').length },\r\n                    { key: 'overdue', label: 'Vencido', color: 'bg-red-500', count: records.filter(r => r.status === 'overdue').length },\r\n                    { key: 'cancelled', label: 'Cancelado', color: 'bg-surface-300', count: records.filter(r => r.status === 'cancelled').length },\r\n                ].filter(g => g.count > 0)\r\n                const total = groups.reduce((s, g) => s + g.count, 0)\r\n                return (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"flex h-5 overflow-hidden rounded-full\">\r\n                            {groups.map(g => (\r\n                                <div key={g.key} className={cn('transition-all', g.color)} style={{ width: `${(g.count / total) * 100}%` }} />\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"mt-2 flex flex-wrap gap-3\">\r\n                            {groups.map(g => (\r\n                                <span key={g.key} className=\"flex items-center gap-1 text-xs text-surface-600\">\r\n                                    <span className={cn('h-2 w-2 rounded-full', g.color)} />\r\n                                    {g.label}: <strong>{g.count}</strong> ({Math.round((g.count / total) * 100)}%)\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )\r\n            })()}\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex gap-3\">\r\n                <div className=\"relative flex-1 max-w-sm\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)} placeholder=\"Buscar por descrição ou cliente\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                </div>\r\n                <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todos os status</option>\r\n                    {Object.entries(statusConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Descrição</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Cliente</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">Vencimento</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Status</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Valor</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Pago</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : records.length === 0 ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum título encontrado</td></tr>\r\n                        ) : records.map(r => (\r\n                            <tr key={r.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                <td className=\"px-4 py-3\">\r\n                                    <p className=\"text-sm font-medium text-surface-900\">{r.description}</p>\r\n                                    {r.work_order && <p className=\"text-xs text-brand-500\">{r.work_order.number}</p>}\r\n                                </td>\r\n                                <td className=\"px-4 py-3 text-sm text-surface-600\">{r.customer.name}</td>\r\n                                <td className=\"hidden px-4 py-3 text-sm text-surface-500 md:table-cell\">{fmtDate(r.due_date)}</td>\r\n                                <td className=\"px-4 py-3\"><Badge variant={statusConfig[r.status]?.variant}>{statusConfig[r.status]?.label}</Badge></td>\r\n                                <td className=\"px-4 py-3 text-right text-sm font-semibold text-surface-900\">{fmtBRL(r.amount)}</td>\r\n                                <td className=\"px-4 py-3 text-right text-sm text-surface-600\">{fmtBRL(r.amount_paid)}</td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center justify-end gap-1\">\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => loadDetail(r)}><Eye className=\"h-4 w-4\" /></Button>\r\n                                        {r.status !== 'paid' && r.status !== 'cancelled' && (\r\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => {\r\n                                                setShowPay(r)\r\n                                                const remaining = Number(r.amount) - Number(r.amount_paid)\r\n                                                setPayForm({ amount: remaining.toFixed(2), payment_method: 'pix', payment_date: new Date().toISOString().split('T')[0], notes: '' })\r\n                                            }}>\r\n                                                <ArrowDown className=\"h-4 w-4 text-emerald-600\" />\r\n                                            </Button>\r\n                                        )}\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delMut.mutate(r.id) }}>\r\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Create Modal */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title=\"Novo Título a Receber\" size=\"lg\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Cliente *</label>\r\n                        <select value={form.customer_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('customer_id', e.target.value)} required\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                            <option value=\"\">Selecionar</option>\r\n                            {(custsRes?.data?.data ?? []).map((c: any) => <option key={c.id} value={c.id}>{c.name}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <Input label=\"Descrição\" value={form.description} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('description', e.target.value)} required />\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <Input label=\"Valor (R$)\" type=\"number\" step=\"0.01\" value={form.amount} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('amount', e.target.value)} required />\r\n                        <Input label=\"Vencimento\" type=\"date\" value={form.due_date} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('due_date', e.target.value)} required />\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Forma Pgto</label>\r\n                            <select value={form.payment_method} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('payment_method', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Não definido</option>\r\n                                {Object.entries(paymentMethods).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Observações</label>\r\n                        <textarea value={form.notes} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('notes', e.target.value)} rows={2}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Pay Modal */}\r\n            <Modal open={!!showPay} onOpenChange={() => setShowPay(null)} title=\"Registrar Recebimento\">\r\n                {showPay && (\r\n                    <form onSubmit={e => { e.preventDefault(); payMut.mutate({ id: showPay.id, data: payForm }) }} className=\"space-y-4\">\r\n                        <div className=\"rounded-lg bg-surface-50 p-3 text-sm\">\r\n                            <p className=\"font-medium\">{showPay.description}</p>\r\n                            <p className=\"text-surface-500\">{showPay.customer.name}</p>\r\n                            <p className=\"mt-1\">Valor: <strong>{fmtBRL(showPay.amount)}</strong> | Pago: <strong>{fmtBRL(showPay.amount_paid)}</strong> | Restante: <strong className=\"text-emerald-600\">{fmtBRL(Number(showPay.amount) - Number(showPay.amount_paid))}</strong></p>\r\n                        </div>\r\n                        <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                            <Input label=\"Valor\" type=\"number\" step=\"0.01\" value={payForm.amount}\r\n                                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setPayForm(p => ({ ...p, amount: e.target.value }))} required />\r\n                            <div>\r\n                                <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Forma Pgto *</label>\r\n                                <select value={payForm.payment_method} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setPayForm(p => ({ ...p, payment_method: e.target.value }))} required\r\n                                    className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                    {Object.entries(paymentMethods).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                                </select>\r\n                            </div>\r\n                            <Input label=\"Data\" type=\"date\" value={payForm.payment_date}\r\n                                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setPayForm(p => ({ ...p, payment_date: e.target.value }))} required />\r\n                        </div>\r\n                        <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                            <Button variant=\"outline\" type=\"button\" onClick={() => setShowPay(null)}>Cancelar</Button>\r\n                            <Button type=\"submit\" loading={payMut.isPending}>Baixar</Button>\r\n                        </div>\r\n                    </form>\r\n                )}\r\n            </Modal>\r\n\r\n            {/* Generate from OS Modal */}\r\n            <Modal open={showGenOS} onOpenChange={setShowGenOS} title=\"Gerar Título da OS\">\r\n                <form onSubmit={e => { e.preventDefault(); genMut.mutate(genForm) }} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">OS *</label>\r\n                        <select value={genForm.work_order_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setGenForm(p => ({ ...p, work_order_id: e.target.value }))} required\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                            <option value=\"\">Selecionar</option>\r\n                            {(wosRes?.data?.data ?? []).map((wo: any) => <option key={wo.id} value={wo.id}>{wo.number} — {wo.customer?.name} — {fmtBRL(wo.total)}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Vencimento\" type=\"date\" value={genForm.due_date} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setGenForm(p => ({ ...p, due_date: e.target.value }))} required />\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Forma Pgto</label>\r\n                            <select value={genForm.payment_method} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setGenForm(p => ({ ...p, payment_method: e.target.value }))}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Não definido</option>\r\n                                {Object.entries(paymentMethods).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowGenOS(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={genMut.isPending}>Gerar Título</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Detail Modal */}\r\n            <Modal open={!!showDetail} onOpenChange={() => setShowDetail(null)} title=\"Detalhes do Título\" size=\"lg\">\r\n                {showDetail && (\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                            <div><span className=\"text-xs text-surface-500\">Descrição</span><p className=\"text-sm font-medium\">{showDetail.description}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Cliente</span><p className=\"text-sm font-medium\">{showDetail.customer.name}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Valor</span><p className=\"text-lg font-bold\">{fmtBRL(showDetail.amount)}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Pago</span><p className=\"text-lg font-bold text-emerald-600\">{fmtBRL(showDetail.amount_paid)}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Vencimento</span><p className=\"text-sm\">{fmtDate(showDetail.due_date)}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Status</span><Badge variant={statusConfig[showDetail.status]?.variant}>{statusConfig[showDetail.status]?.label}</Badge></div>\r\n                        </div>\r\n                        {showDetail.payments && showDetail.payments.length > 0 && (\r\n                            <div>\r\n                                <h4 className=\"mb-2 text-sm font-semibold text-surface-700\">Pagamentos</h4>\r\n                                <div className=\"space-y-2\">\r\n                                    {showDetail.payments.map((p: any) => (\r\n                                        <div key={p.id} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                            <div>\r\n                                                <p className=\"text-sm font-medium\">{fmtBRL(p.amount)} — {paymentMethods[p.payment_method] ?? p.payment_method}</p>\r\n                                                <p className=\"text-xs text-surface-500\">{fmtDate(p.payment_date)} por {p.receiver?.name}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\BankReconciliationPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Check' is defined but never used.","line":3,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":33,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Check"},"fix":{"range":[138,145],"text":""},"desc":"Remove unused variable \"Check\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":3,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Eye"},"fix":{"range":[155,160],"text":""},"desc":"Remove unused variable \"Eye\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[691,694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[691,694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1815,1818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1815,1818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2515,2518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2515,2518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4871,4874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4871,4874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4887,4890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4887,4890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6673,6676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6673,6676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6692,6695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6692,6695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Upload, FileText, Check, X, Link2, Eye, ChevronDown, ChevronRight, ArrowUpRight, ArrowDownRight } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst fmtBRL = (v: number | string) => Number(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\nconst fmtDate = (d: string) => new Date(d).toLocaleDateString('pt-BR')\r\n\r\nexport function BankReconciliationPage() {\r\n    const qc = useQueryClient()\r\n    const [expandedId, setExpandedId] = useState<number | null>(null)\r\n    const [matchModal, setMatchModal] = useState<any>(null)\r\n\r\n    // ─── Dados ────────────────────────────────────────────\r\n    const { data: statementsRes, isLoading } = useQuery({\r\n        queryKey: ['bank-statements'],\r\n        queryFn: () => api.get('/bank-reconciliation/statements'),\r\n    })\r\n    const statements = statementsRes?.data?.data ?? []\r\n\r\n    const { data: entriesRes } = useQuery({\r\n        queryKey: ['bank-entries', expandedId],\r\n        queryFn: () => api.get(`/bank-reconciliation/statements/${expandedId}/entries`),\r\n        enabled: !!expandedId,\r\n    })\r\n    const entries = entriesRes?.data?.data ?? []\r\n\r\n    // ─── Mutations ────────────────────────────────────────\r\n    const importMut = useMutation({\r\n        mutationFn: (file: File) => {\r\n            const fd = new FormData()\r\n            fd.append('file', file)\r\n            return api.post('/bank-reconciliation/import', fd, { headers: { 'Content-Type': 'multipart/form-data' } })\r\n        },\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['bank-statements'] }) },\r\n    })\r\n\r\n    const matchMut = useMutation({\r\n        mutationFn: ({ entryId, matchedType, matchedId }: any) =>\r\n            api.post(`/bank-reconciliation/entries/${entryId}/match`, { matched_type: matchedType, matched_id: matchedId }),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['bank-entries'] })\r\n            setMatchModal(null)\r\n        },\r\n    })\r\n\r\n    const ignoreMut = useMutation({\r\n        mutationFn: (entryId: number) => api.post(`/bank-reconciliation/entries/${entryId}/ignore`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['bank-entries'] }) },\r\n    })\r\n\r\n    const handleUpload = () => {\r\n        const input = document.createElement('input')\r\n        input.type = 'file'\r\n        input.accept = '.ofx,.txt'\r\n        input.onchange = (e: any) => {\r\n            const file = e.target.files?.[0]\r\n            if (file) importMut.mutate(file)\r\n        }\r\n        input.click()\r\n    }\r\n\r\n    const statusBadge = (s: string) => {\r\n        const map: Record<string, { bg: string; text: string; label: string }> = {\r\n            pending: { bg: 'bg-amber-50', text: 'text-amber-700', label: 'Pendente' },\r\n            matched: { bg: 'bg-emerald-50', text: 'text-emerald-700', label: 'Conciliado' },\r\n            ignored: { bg: 'bg-surface-100', text: 'text-surface-500', label: 'Ignorado' },\r\n        }\r\n        const cfg = map[s] ?? map.pending\r\n        return <span className={cn('inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium', cfg.bg, cfg.text)}>{cfg.label}</span>\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Conciliação Bancária</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Importe extratos OFX e concilie com contas a receber/pagar</p>\r\n                </div>\r\n                <button onClick={handleUpload} disabled={importMut.isPending}\r\n                    className=\"flex items-center gap-2 rounded-xl bg-brand-500 px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-brand-600 transition-colors disabled:opacity-50\">\r\n                    <Upload className=\"h-4 w-4\" />\r\n                    {importMut.isPending ? 'Importando...' : 'Importar OFX'}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Lista de Extratos */}\r\n            <div className=\"space-y-3\">\r\n                {isLoading && <p className=\"text-sm text-surface-400 text-center py-8\">Carregando extratos...</p>}\r\n                {!isLoading && statements.length === 0 && (\r\n                    <div className=\"rounded-xl border border-dashed border-surface-300 bg-white p-12 text-center\">\r\n                        <FileText className=\"mx-auto h-12 w-12 text-surface-300\" />\r\n                        <p className=\"mt-3 text-sm text-surface-500\">Nenhum extrato importado</p>\r\n                        <p className=\"text-xs text-surface-400\">Importe um arquivo OFX para começar a conciliação</p>\r\n                    </div>\r\n                )}\r\n                {(statements as any[]).map((st: any) => (\r\n                    <div key={st.id} className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden\">\r\n                        <button onClick={() => setExpandedId(expandedId === st.id ? null : st.id)}\r\n                            className=\"flex w-full items-center justify-between p-4 hover:bg-surface-50 transition-colors\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                {expandedId === st.id ? <ChevronDown className=\"h-4 w-4 text-surface-400\" /> : <ChevronRight className=\"h-4 w-4 text-surface-400\" />}\r\n                                <FileText className=\"h-5 w-5 text-brand-500\" />\r\n                                <div className=\"text-left\">\r\n                                    <p className=\"text-sm font-semibold text-surface-900\">Extrato #{st.id}</p>\r\n                                    <p className=\"text-xs text-surface-500\">{fmtDate(st.created_at)} • {st.creator?.name ?? 'Sistema'}</p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <p className=\"text-xs text-surface-500\">{st.entries_count ?? '?'} lançamentos</p>\r\n                            </div>\r\n                        </button>\r\n\r\n                        {expandedId === st.id && (\r\n                            <div className=\"border-t border-surface-100 p-4\">\r\n                                {entries.length === 0 ? (\r\n                                    <p className=\"text-sm text-surface-400 text-center py-4\">Carregando lançamentos...</p>\r\n                                ) : (\r\n                                    <div className=\"space-y-2\">\r\n                                        {(entries as any[]).map((entry: any) => (\r\n                                            <div key={entry.id} className=\"flex items-center justify-between rounded-lg border border-surface-100 p-3 hover:bg-surface-50\">\r\n                                                <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                                                    {Number(entry.amount) >= 0\r\n                                                        ? <ArrowUpRight className=\"h-4 w-4 text-emerald-500 shrink-0\" />\r\n                                                        : <ArrowDownRight className=\"h-4 w-4 text-red-500 shrink-0\" />\r\n                                                    }\r\n                                                    <div className=\"min-w-0\">\r\n                                                        <p className=\"text-sm font-medium text-surface-900 truncate\">{entry.description}</p>\r\n                                                        <p className=\"text-xs text-surface-500\">{fmtDate(entry.date)}</p>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <span className={cn('text-sm font-bold', Number(entry.amount) >= 0 ? 'text-emerald-600' : 'text-red-600')}>\r\n                                                        {fmtBRL(entry.amount)}\r\n                                                    </span>\r\n                                                    {statusBadge(entry.status)}\r\n                                                    {entry.status === 'pending' && (\r\n                                                        <div className=\"flex gap-1\">\r\n                                                            <button onClick={() => setMatchModal(entry)} title=\"Conciliar\"\r\n                                                                className=\"rounded-lg border border-surface-200 p-1.5 hover:bg-brand-50 hover:border-brand-300 transition-colors\">\r\n                                                                <Link2 className=\"h-3.5 w-3.5 text-brand-600\" />\r\n                                                            </button>\r\n                                                            <button onClick={() => ignoreMut.mutate(entry.id)} title=\"Ignorar\"\r\n                                                                className=\"rounded-lg border border-surface-200 p-1.5 hover:bg-red-50 hover:border-red-300 transition-colors\">\r\n                                                                <X className=\"h-3.5 w-3.5 text-red-500\" />\r\n                                                            </button>\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Modal de conciliação manual */}\r\n            {matchModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\" onClick={() => setMatchModal(null)}>\r\n                    <div className=\"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\" onClick={e => e.stopPropagation()}>\r\n                        <h3 className=\"text-lg font-bold text-surface-900\">Conciliar Lançamento</h3>\r\n                        <p className=\"mt-1 text-sm text-surface-500\">{matchModal.description} — {fmtBRL(matchModal.amount)}</p>\r\n                        <form onSubmit={e => {\r\n                            e.preventDefault()\r\n                            const fd = new FormData(e.currentTarget)\r\n                            matchMut.mutate({ entryId: matchModal.id, matchedType: fd.get('type'), matchedId: fd.get('id') })\r\n                        }} className=\"mt-4 space-y-3\">\r\n                            <div>\r\n                                <label className=\"text-xs font-medium text-surface-700\">Tipo</label>\r\n                                <select name=\"type\" required className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                    <option value=\"AccountReceivable\">Conta a Receber</option>\r\n                                    <option value=\"AccountPayable\">Conta a Pagar</option>\r\n                                </select>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-medium text-surface-700\">ID do Título</label>\r\n                                <input name=\"id\" type=\"number\" required className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                            </div>\r\n                            <div className=\"flex gap-2 pt-2\">\r\n                                <button type=\"button\" onClick={() => setMatchModal(null)} className=\"flex-1 rounded-xl border border-surface-300 px-4 py-2 text-sm font-medium\">Cancelar</button>\r\n                                <button type=\"submit\" disabled={matchMut.isPending} className=\"flex-1 rounded-xl bg-brand-500 px-4 py-2 text-sm font-semibold text-white hover:bg-brand-600 disabled:opacity-50\">\r\n                                    {matchMut.isPending ? 'Conciliando...' : 'Conciliar'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\CashFlowPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6849,6852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6849,6852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7228,7231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7228,7231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10152,10155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10152,10155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\r\nimport { TrendingUp, TrendingDown, DollarSign, ArrowDownRight, ArrowUpRight, Wallet, ArrowRight } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nexport function CashFlowPage() {\r\n    const { data: cashFlowRes, isLoading: cfLoading } = useQuery({\r\n        queryKey: ['cash-flow'],\r\n        queryFn: () => api.get('/cash-flow'),\r\n    })\r\n\r\n    const { data: dreRes, isLoading: dreLoading } = useQuery({\r\n        queryKey: ['dre'],\r\n        queryFn: () => api.get('/dre'),\r\n    })\r\n\r\n    const { data: dreCompRes, isLoading: compLoading } = useQuery({\r\n        queryKey: ['dre-comparativo'],\r\n        queryFn: () => api.get('/cash-flow/dre-comparativo'),\r\n    })\r\n\r\n    const cashFlow = cashFlowRes?.data ?? []\r\n    const dre = dreRes?.data ?? {}\r\n    const dreComp = dreCompRes?.data\r\n    const isLoading = cfLoading || dreLoading\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h1 className=\"text-2xl font-bold text-surface-900\">Fluxo de Caixa & DRE</h1>\r\n\r\n            {/* DRE Cards */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"rounded-lg p-2.5 text-emerald-600 bg-emerald-50\"><ArrowUpRight className=\"h-5 w-5\" /></div>\r\n                        <div>\r\n                            <p className=\"text-xs text-surface-500\">Receitas (pago)</p>\r\n                            <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : fmtBRL(dre.revenue ?? 0)}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"rounded-lg p-2.5 text-red-600 bg-red-50\"><ArrowDownRight className=\"h-5 w-5\" /></div>\r\n                        <div>\r\n                            <p className=\"text-xs text-surface-500\">Custos (pago)</p>\r\n                            <p className=\"text-lg font-bold text-surface-900\">{isLoading ? '…' : fmtBRL(dre.costs ?? 0)}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"rounded-lg p-2.5 text-blue-600 bg-blue-50\"><DollarSign className=\"h-5 w-5\" /></div>\r\n                        <div>\r\n                            <p className=\"text-xs text-surface-500\">Lucro Bruto</p>\r\n                            <p className={`text-lg font-bold ${(dre.gross_profit ?? 0) >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>\r\n                                {isLoading ? '…' : fmtBRL(dre.gross_profit ?? 0)}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"rounded-lg p-2.5 text-brand-600 bg-brand-50\"><Wallet className=\"h-5 w-5\" /></div>\r\n                        <div>\r\n                            <p className=\"text-xs text-surface-500\">Saldo Líquido</p>\r\n                            <p className={`text-lg font-bold ${(dre.net_balance ?? 0) >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>\r\n                                {isLoading ? '…' : fmtBRL(dre.net_balance ?? 0)}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* DRE Comparativo */}\r\n            {dreComp && !compLoading && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden\">\r\n                    <div className=\"px-5 py-4 border-b border-surface-200\">\r\n                        <h2 className=\"font-semibold text-surface-900 flex items-center gap-2\">\r\n                            <ArrowRight className=\"h-5 w-5 text-brand-600\" />\r\n                            DRE Comparativo — Período Atual vs Anterior\r\n                        </h2>\r\n                    </div>\r\n                    <div className=\"grid sm:grid-cols-3 divide-y sm:divide-y-0 sm:divide-x divide-surface-100\">\r\n                        {[\r\n                            { label: 'Receita', cur: dreComp.current?.revenue ?? 0, prev: dreComp.previous?.revenue ?? 0, var: dreComp.variation?.revenue ?? 0 },\r\n                            { label: 'Custos Totais', cur: dreComp.current?.total_costs ?? 0, prev: dreComp.previous?.total_costs ?? 0, var: dreComp.variation?.total_costs ?? 0 },\r\n                            { label: 'Lucro Bruto', cur: dreComp.current?.gross_profit ?? 0, prev: dreComp.previous?.gross_profit ?? 0, var: dreComp.variation?.gross_profit ?? 0 },\r\n                        ].map(item => (\r\n                            <div key={item.label} className=\"p-5\">\r\n                                <p className=\"text-sm font-medium text-surface-500 mb-2\">{item.label}</p>\r\n                                <p className=\"text-xl font-bold text-surface-900\">{fmtBRL(item.cur)}</p>\r\n                                <div className=\"flex items-center gap-2 mt-1\">\r\n                                    <span className=\"text-xs text-surface-400\">Anterior: {fmtBRL(item.prev)}</span>\r\n                                    <span className={cn('inline-flex items-center gap-0.5 text-xs font-bold rounded-full px-2 py-0.5',\r\n                                        item.label === 'Custos Totais'\r\n                                            ? item.var <= 0 ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'\r\n                                            : item.var >= 0 ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'\r\n                                    )}>\r\n                                        {item.var >= 0 ? <TrendingUp className=\"h-3 w-3\" /> : <TrendingDown className=\"h-3 w-3\" />}\r\n                                        {item.var >= 0 ? '+' : ''}{item.var}%\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Cash Flow Bar Chart */}\r\n            {!isLoading && cashFlow.length > 0 && (() => {\r\n                const maxAbs = Math.max(...cashFlow.map((r: any) => Math.abs(r.balance)), 1)\r\n                return (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <h3 className=\"text-sm font-semibold text-surface-900 mb-4\">Saldo Mensal</h3>\r\n                        <div className=\"flex items-end gap-2 h-32\">\r\n                            {cashFlow.map((r: any) => {\r\n                                const isPositive = r.balance >= 0\r\n                                const pct = Math.max((Math.abs(r.balance) / maxAbs) * 100, 4)\r\n                                return (\r\n                                    <div key={r.month} className=\"flex-1 flex flex-col items-center gap-1\">\r\n                                        <span className={cn('text-[10px] font-bold', isPositive ? 'text-emerald-600' : 'text-red-600')}>\r\n                                            {fmtBRL(r.balance).replace('R$\\u00a0', '')}\r\n                                        </span>\r\n                                        <div\r\n                                            className={cn(\r\n                                                'w-full rounded-t-md transition-all duration-700',\r\n                                                isPositive ? 'bg-gradient-to-t from-emerald-500 to-emerald-400' : 'bg-gradient-to-t from-red-500 to-red-400'\r\n                                            )}\r\n                                            style={{ height: `${pct}%`, minHeight: 4 }}\r\n                                        />\r\n                                        <span className=\"text-[10px] text-surface-500\">{r.label?.slice(0, 3)}</span>\r\n                                    </div>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                )\r\n            })()}\r\n            {/* Cash Flow Table */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden\">\r\n                <div className=\"px-5 py-4 border-b border-surface-200\">\r\n                    <h2 className=\"font-semibold text-surface-900 flex items-center gap-2\">\r\n                        <TrendingUp className=\"h-5 w-5 text-brand-600\" />\r\n                        Fluxo de Caixa Mensal\r\n                    </h2>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm\">\r\n                        <thead className=\"bg-surface-50 text-surface-600\">\r\n                            <tr>\r\n                                <th className=\"px-4 py-3 text-left font-medium\">Mês</th>\r\n                                <th className=\"px-4 py-3 text-right font-medium\">A Receber</th>\r\n                                <th className=\"px-4 py-3 text-right font-medium\">Recebido</th>\r\n                                <th className=\"px-4 py-3 text-right font-medium\">A Pagar</th>\r\n                                <th className=\"px-4 py-3 text-right font-medium\">Pago</th>\r\n                                <th className=\"px-4 py-3 text-right font-medium\">Saldo</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-surface-100\">\r\n                            {cashFlow.map((row: any) => (\r\n                                <tr key={row.month} className=\"hover:bg-surface-50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 font-medium text-surface-900\">{row.label}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-emerald-600\">{fmtBRL(row.receivables_total)}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-emerald-700 font-semibold\">{fmtBRL(row.receivables_paid)}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-red-500\">{fmtBRL(row.payables_total)}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-red-600 font-semibold\">{fmtBRL(row.payables_paid)}</td>\r\n                                    <td className={`px-4 py-3 text-right font-bold ${row.balance >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>\r\n                                        {fmtBRL(row.balance)}\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                            {!isLoading && cashFlow.length === 0 && (\r\n                                <tr><td colSpan={6} className=\"px-4 py-8 text-center text-surface-400\">Sem dados no período</td></tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\ChartOfAccountsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1386,1389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1386,1389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Plus, Edit2, Trash2, FolderTree, ChevronRight, ChevronDown, X } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface Account {\r\n    id: number\r\n    code: string\r\n    name: string\r\n    type: string\r\n    parent_id: number | null\r\n    children?: Account[]\r\n}\r\n\r\nconst typeLabels: Record<string, { label: string; color: string }> = {\r\n    asset: { label: 'Ativo', color: 'text-blue-600 bg-blue-50' },\r\n    liability: { label: 'Passivo', color: 'text-red-600 bg-red-50' },\r\n    equity: { label: 'Patrimônio', color: 'text-purple-600 bg-purple-50' },\r\n    revenue: { label: 'Receita', color: 'text-emerald-600 bg-emerald-50' },\r\n    expense: { label: 'Despesa', color: 'text-amber-600 bg-amber-50' },\r\n}\r\n\r\nexport function ChartOfAccountsPage() {\r\n    const qc = useQueryClient()\r\n    const [modal, setModal] = useState<{ mode: 'create' | 'edit'; account?: Account } | null>(null)\r\n    const [expanded, setExpanded] = useState<Set<number>>(new Set())\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['chart-of-accounts'],\r\n        queryFn: () => api.get('/chart-of-accounts'),\r\n    })\r\n    const accounts: Account[] = res?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: any) =>\r\n            data.id ? api.put(`/chart-of-accounts/${data.id}`, data) : api.post('/chart-of-accounts', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['chart-of-accounts'] }); setModal(null) },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/chart-of-accounts/${id}`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['chart-of-accounts'] }) },\r\n    })\r\n\r\n    const toggle = (id: number) => {\n        const next = new Set(expanded)\n        if (next.has(id)) {\n            next.delete(id)\n        } else {\n            next.add(id)\n        }\n        setExpanded(next)\n    }\n\r\n    // Constrói árvore hierárquica\r\n    const buildTree = (items: Account[], parentId: number | null = null): Account[] =>\r\n        items\r\n            .filter(i => i.parent_id === parentId)\r\n            .map(i => ({ ...i, children: buildTree(items, i.id) }))\r\n\r\n    const tree = buildTree(accounts)\r\n\r\n    const renderNode = (node: Account, depth: number = 0) => {\r\n        const hasChildren = (node.children?.length ?? 0) > 0\r\n        const isOpen = expanded.has(node.id)\r\n        const typeInfo = typeLabels[node.type] ?? { label: node.type, color: 'text-surface-600 bg-surface-100' }\r\n\r\n        return (\r\n            <div key={node.id}>\r\n                <div className={cn('flex items-center gap-2 rounded-lg px-3 py-2.5 hover:bg-surface-50 transition-colors group', depth > 0 && 'ml-6')}>\r\n                    <button onClick={() => hasChildren && toggle(node.id)} className=\"w-5 h-5 flex items-center justify-center shrink-0\">\r\n                        {hasChildren ? (isOpen ? <ChevronDown className=\"h-4 w-4 text-surface-400\" /> : <ChevronRight className=\"h-4 w-4 text-surface-400\" />) : <span className=\"w-4\" />}\r\n                    </button>\r\n                    <span className=\"text-sm font-mono text-brand-600 font-bold w-20 shrink-0\">{node.code}</span>\r\n                    <span className=\"text-sm text-surface-900 flex-1\">{node.name}</span>\r\n                    <span className={cn('inline-flex rounded-full px-2 py-0.5 text-xs font-medium', typeInfo.color)}>{typeInfo.label}</span>\r\n                    <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                        <button onClick={() => setModal({ mode: 'edit', account: node })} className=\"rounded-lg p-1 hover:bg-surface-100\">\r\n                            <Edit2 className=\"h-3.5 w-3.5 text-surface-500\" />\r\n                        </button>\r\n                        <button onClick={() => { if (confirm('Excluir esta conta?')) deleteMut.mutate(node.id) }} className=\"rounded-lg p-1 hover:bg-red-50\">\r\n                            <Trash2 className=\"h-3.5 w-3.5 text-red-500\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                {hasChildren && isOpen && node.children!.map(c => renderNode(c, depth + 1))}\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Plano de Contas</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Estrutura hierárquica de contas contábeis</p>\r\n                </div>\r\n                <button onClick={() => setModal({ mode: 'create' })}\r\n                    className=\"flex items-center gap-2 rounded-xl bg-brand-500 px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-brand-600 transition-colors\">\r\n                    <Plus className=\"h-4 w-4\" /> Nova Conta\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card p-4\">\r\n                {isLoading && <p className=\"text-sm text-surface-400 text-center py-8\">Carregando...</p>}\r\n                {!isLoading && tree.length === 0 && (\r\n                    <div className=\"text-center py-12\">\r\n                        <FolderTree className=\"mx-auto h-12 w-12 text-surface-300\" />\r\n                        <p className=\"mt-3 text-sm text-surface-500\">Nenhuma conta cadastrada</p>\r\n                    </div>\r\n                )}\r\n                <div className=\"space-y-0.5\">{tree.map(n => renderNode(n))}</div>\r\n            </div>\r\n\r\n            {/* Modal CRUD */}\r\n            {modal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\" onClick={() => setModal(null)}>\r\n                    <div className=\"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\" onClick={e => e.stopPropagation()}>\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h3 className=\"text-lg font-bold text-surface-900\">{modal.mode === 'edit' ? 'Editar Conta' : 'Nova Conta'}</h3>\r\n                            <button onClick={() => setModal(null)}><X className=\"h-5 w-5 text-surface-400\" /></button>\r\n                        </div>\r\n                        <form onSubmit={e => {\r\n                            e.preventDefault()\r\n                            const fd = new FormData(e.currentTarget)\r\n                            saveMut.mutate({\r\n                                id: modal.account?.id,\r\n                                code: fd.get('code'),\r\n                                name: fd.get('name'),\r\n                                type: fd.get('type'),\r\n                                parent_id: fd.get('parent_id') || null,\r\n                            })\r\n                        }} className=\"mt-4 space-y-3\">\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <div>\r\n                                    <label className=\"text-xs font-medium text-surface-700\">Código</label>\r\n                                    <input name=\"code\" required defaultValue={modal.account?.code} placeholder=\"1.01.01\" className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-xs font-medium text-surface-700\">Tipo</label>\r\n                                    <select name=\"type\" required defaultValue={modal.account?.type ?? 'asset'} className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                        {Object.entries(typeLabels).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-medium text-surface-700\">Nome</label>\r\n                                <input name=\"name\" required defaultValue={modal.account?.name} className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-medium text-surface-700\">Conta Pai (opcional)</label>\r\n                                <select name=\"parent_id\" defaultValue={modal.account?.parent_id ?? ''} className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                    <option value=\"\">— Nenhuma (raiz) —</option>\r\n                                    {accounts.map(a => <option key={a.id} value={a.id}>{a.code} - {a.name}</option>)}\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"flex gap-2 pt-2\">\r\n                                <button type=\"button\" onClick={() => setModal(null)} className=\"flex-1 rounded-xl border border-surface-300 px-4 py-2 text-sm font-medium\">Cancelar</button>\r\n                                <button type=\"submit\" disabled={saveMut.isPending}\r\n                                    className=\"flex-1 rounded-xl bg-brand-500 px-4 py-2 text-sm font-semibold text-white hover:bg-brand-600 disabled:opacity-50\">\r\n                                    {saveMut.isPending ? 'Salvando...' : 'Salvar'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\CommissionDashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Badge' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[270,315],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1543,1546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1543,1546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1558,1561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1558,1561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1625,1628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1625,1628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1640,1643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1640,1643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6349,6352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6349,6352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6364,6367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6364,6367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7225,7228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7225,7228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7778,7781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7778,7781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7793,7796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7793,7796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8528,8531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8528,8531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9115,9118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9115,9118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9130,9133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9130,9133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10290,10293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10290,10293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10867,10870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10867,10870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11002,11005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11002,11005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11017,11020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11017,11020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11114,11117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11114,11117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11129,11132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11129,11132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport {\r\n    BarChart3, TrendingUp, Trophy, Award, Users, PieChart, ArrowUpRight, ArrowDownRight,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nconst fmtBRL = (val: string | number) => Number(val).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nexport function CommissionDashboardPage() {\r\n    const [months, setMonths] = useState(6)\r\n\r\n    const { data: overviewRes } = useQuery({ queryKey: ['commission-overview'], queryFn: () => api.get('/commission-dashboard/overview') })\r\n    const overview = overviewRes?.data ?? {}\r\n\r\n    const { data: rankingRes } = useQuery({ queryKey: ['commission-ranking'], queryFn: () => api.get('/commission-dashboard/ranking') })\r\n    const ranking = rankingRes?.data ?? []\r\n\r\n    const { data: evolutionRes } = useQuery({ queryKey: ['commission-evolution', months], queryFn: () => api.get('/commission-dashboard/evolution', { params: { months } }) })\r\n    const evolution = evolutionRes?.data ?? []\r\n\r\n    const { data: byRuleRes } = useQuery({ queryKey: ['commission-by-rule'], queryFn: () => api.get('/commission-dashboard/by-rule') })\r\n    const byRule = byRuleRes?.data ?? []\r\n\r\n    const { data: byRoleRes } = useQuery({ queryKey: ['commission-by-role'], queryFn: () => api.get('/commission-dashboard/by-role') })\r\n    const byRole = byRoleRes?.data ?? []\r\n\r\n    const maxEvolution = Math.max(...(evolution as any[]).map((e: any) => e.total), 1)\r\n    const maxByRule = Math.max(...(byRule as any[]).map((r: any) => r.total), 1)\r\n\r\n    const calcTypeLabels: Record<string, string> = {\r\n        percent_gross: '% Bruto', percent_net: '% Líquido', fixed_per_os: 'Fixo/OS',\r\n        percent_services_only: '% Serviços', percent_products_only: '% Produtos',\r\n        percent_profit: '% Lucro', percent_gross_minus_displacement: '% (B−D)',\r\n        percent_gross_minus_expenses: '% (B−Desp)', tiered_gross: 'Escalonado', custom_formula: 'Fórmula',\r\n    }\r\n    const roleLabels: Record<string, string> = { technician: 'Técnico', seller: 'Vendedor', driver: 'Motorista' }\r\n    const roleColor: Record<string, string> = { technician: '#3B82F6', seller: '#10B981', driver: '#F59E0B' }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Dashboard de Comissões</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Visão analítica e KPIs de comissões</p>\r\n            </div>\r\n\r\n            {/* KPI Cards */}\r\n            <div className=\"grid gap-3 sm:grid-cols-2 xl:grid-cols-4\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2 text-amber-600\"><BarChart3 className=\"h-5 w-5\" /><span className=\"text-xs font-semibold uppercase tracking-wider\">Pendente</span></div>\r\n                    </div>\r\n                    <p className=\"mt-3 text-2xl font-bold text-surface-900\">{fmtBRL(overview.pending ?? 0)}</p>\r\n                    <p className=\"mt-1 text-xs text-surface-500\">{overview.total_events ?? 0} eventos totais</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-sky-600\"><Award className=\"h-5 w-5\" /><span className=\"text-xs font-semibold uppercase tracking-wider\">Aprovado</span></div>\r\n                    <p className=\"mt-3 text-2xl font-bold text-sky-600\">{fmtBRL(overview.approved ?? 0)}</p>\r\n                    <p className=\"mt-1 text-xs text-surface-500\">{overview.total_rules ?? 0} regras ativas</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-emerald-600\"><TrendingUp className=\"h-5 w-5\" /><span className=\"text-xs font-semibold uppercase tracking-wider\">Pago (mês)</span></div>\r\n                    <p className=\"mt-3 text-2xl font-bold text-emerald-600\">{fmtBRL(overview.paid_this_month ?? 0)}</p>\r\n                    <div className=\"mt-1 flex items-center gap-1 text-xs\">\r\n                        {overview.variation_pct > 0\r\n                            ? <><ArrowUpRight className=\"h-3.5 w-3.5 text-emerald-500\" /><span className=\"text-emerald-600\">+{overview.variation_pct}%</span></>\r\n                            : <><ArrowDownRight className=\"h-3.5 w-3.5 text-red-500\" /><span className=\"text-red-600\">{overview.variation_pct}%</span></>\r\n                        }\r\n                        <span className=\"text-surface-400\">vs. mês anterior</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-surface-500\"><PieChart className=\"h-5 w-5\" /><span className=\"text-xs font-semibold uppercase tracking-wider\">Mês Anterior</span></div>\r\n                    <p className=\"mt-3 text-2xl font-bold text-surface-700\">{fmtBRL(overview.paid_last_month ?? 0)}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Evolution + Ranking */}\r\n            <div className=\"grid gap-4 lg:grid-cols-3\">\r\n                {/* Evolution Chart */}\r\n                <div className=\"lg:col-span-2 rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Evolução Mensal</h2>\r\n                        <select value={months} onChange={e => setMonths(+e.target.value)}\r\n                            className=\"rounded-lg border border-surface-300 px-2 py-1 text-xs\">\r\n                            <option value={3}>3 meses</option><option value={6}>6 meses</option><option value={12}>12 meses</option>\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"flex items-end gap-2\" style={{ height: 200 }}>\r\n                        {(evolution as any[]).map((e: any, i: number) => {\r\n                            const h = maxEvolution > 0 ? (e.total / maxEvolution) * 180 : 0\r\n                            return (\r\n                                <div key={i} className=\"flex flex-1 flex-col items-center gap-1\" title={fmtBRL(e.total)}>\r\n                                    <span className=\"text-[10px] text-surface-500 font-medium\">{fmtBRL(e.total).replace('R$\\u00a0', '')}</span>\r\n                                    <div className=\"w-full rounded-t-md bg-brand-500 transition-all hover:bg-brand-600\"\r\n                                        style={{ height: Math.max(h, 4) }} />\r\n                                    <span className=\"text-[10px] text-surface-500\">{e.label}</span>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                        {(evolution as any[]).length === 0 && <p className=\"w-full text-center text-sm text-surface-400 self-center\">Sem dados</p>}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Ranking */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <h2 className=\"mb-4 text-sm font-semibold text-surface-900 flex items-center gap-2\"><Trophy className=\"h-4 w-4 text-amber-500\" /> Ranking do Mês</h2>\r\n                    <div className=\"space-y-2.5\">\r\n                        {(ranking as any[]).map((r: any) => (\r\n                            <div key={r.id} className=\"flex items-center gap-3\">\r\n                                <span className=\"w-6 text-center text-lg\">{r.medal || r.position}</span>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <p className=\"text-sm font-medium text-surface-900 truncate\">{r.name}</p>\r\n                                    <p className=\"text-xs text-surface-500\">{r.events_count} eventos</p>\r\n                                </div>\r\n                                <span className=\"text-sm font-bold text-surface-900\">{fmtBRL(r.total)}</span>\r\n                            </div>\r\n                        ))}\r\n                        {(ranking as any[]).length === 0 && <p className=\"text-sm text-surface-400 text-center py-4\">Sem dados</p>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* By Rule + By Role */}\r\n            <div className=\"grid gap-4 lg:grid-cols-2\">\r\n                {/* By Rule */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <h2 className=\"mb-4 text-sm font-semibold text-surface-900\">Por Tipo de Cálculo</h2>\r\n                    <div className=\"space-y-3\">\r\n                        {(byRule as any[]).map((r: any, i: number) => {\r\n                            const pct = maxByRule > 0 ? (r.total / maxByRule) * 100 : 0\r\n                            const colors = ['bg-brand-500', 'bg-sky-500', 'bg-emerald-500', 'bg-amber-500', 'bg-rose-500']\r\n                            return (\r\n                                <div key={i}>\r\n                                    <div className=\"flex justify-between text-xs mb-1\">\r\n                                        <span className=\"font-medium text-surface-700\">{calcTypeLabels[r.calculation_type] ?? r.calculation_type}</span>\r\n                                        <span className=\"text-surface-500\">{fmtBRL(r.total)} ({r.count})</span>\r\n                                    </div>\r\n                                    <div className=\"h-2 rounded-full bg-surface-100\">\r\n                                        <div className={cn('h-full rounded-full transition-all', colors[i % colors.length])} style={{ width: `${Math.min(pct, 100)}%` }} />\r\n                                    </div>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                        {(byRule as any[]).length === 0 && <p className=\"text-sm text-surface-400 text-center py-4\">Sem dados</p>}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* By Role */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <h2 className=\"mb-4 text-sm font-semibold text-surface-900 flex items-center gap-2\"><Users className=\"h-4 w-4 text-brand-500\" /> Por Papel</h2>\r\n                    <div className=\"flex items-center justify-center\" style={{ height: 200 }}>\r\n                        {(byRole as any[]).length > 0 ? (\r\n                            <div className=\"flex items-end gap-6\">\r\n                                {(byRole as any[]).map((r: any, i: number) => {\r\n                                    const maxRole = Math.max(...(byRole as any[]).map((x: any) => +x.total), 1)\r\n                                    const h = (+r.total / maxRole) * 160\r\n                                    return (\r\n                                        <div key={i} className=\"flex flex-col items-center gap-2\">\r\n                                            <span className=\"text-xs font-bold text-surface-900\">{fmtBRL(r.total)}</span>\r\n                                            <div className=\"w-14 rounded-t-lg transition-all\" style={{ height: Math.max(h, 8), backgroundColor: roleColor[r.role] ?? '#6B7280' }} />\r\n                                            <div className=\"text-center\">\r\n                                                <p className=\"text-xs font-semibold\" style={{ color: roleColor[r.role] ?? '#6B7280' }}>{roleLabels[r.role] ?? r.role}</p>\r\n                                                <p className=\"text-[10px] text-surface-500\">{r.count} eventos</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    )\r\n                                })}\r\n                            </div>\r\n                        ) : <p className=\"text-sm text-surface-400\">Sem dados</p>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\CommissionsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Users' is defined but never used.","line":4,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":23,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[151,158],"text":""},"desc":"Remove unused variable \"Users\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":6,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[300,303],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RefreshCw' is defined but never used.","line":6,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"RefreshCw"},"fix":{"range":[303,314],"text":""},"desc":"Remove unused variable \"RefreshCw\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TrendingUp' is defined but never used.","line":6,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[314,326],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[683,686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[683,686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[991,994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[991,994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1230,1233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1230,1233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3252,3255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3252,3255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3418,3421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3418,3421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3541,3544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3541,3544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10224,10227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10224,10227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":276,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16009,16012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16009,16012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":295,"column":152,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":155,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17330,17333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17330,17333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":308,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18738,18741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18738,18741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22286,22289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22286,22289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":378,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24532,24535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24532,24535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":418,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27552,27555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27552,27555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27765,27768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27765,27768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27780,27783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27780,27783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":443,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":443,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29331,29334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29331,29334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":443,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":443,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29346,29349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29346,29349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":468,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":468,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31472,31475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31472,31475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":470,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31636,31639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31636,31639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":470,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31651,31654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31651,31654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":480,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":480,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32175,32178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32175,32178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":487,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32533,32536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32533,32536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":487,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32548,32551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32548,32551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":511,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":511,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34568,34571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34568,34571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":526,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":526,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35728,35731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35728,35731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":578,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":578,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40633,40636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40633,40636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":596,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":596,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42044,42047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42044,42047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":615,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":615,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43487,43490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43487,43490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":617,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":617,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43671,43674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43671,43674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":702,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":702,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49838,49841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49838,49841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Award, Plus, Users, Settings, FileText, Download, BarChart3, Target, Zap,\r\n    CheckCircle, Clock, Trash2, Percent, DollarSign, AlertTriangle, Split,\r\n    Check, X, RefreshCw, TrendingUp, Calendar,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\nconst eventStatusConfig: Record<string, { label: string; variant: any }> = {\r\n    pending: { label: 'Pendente', variant: 'warning' },\r\n    approved: { label: 'Aprovado', variant: 'info' },\r\n    paid: { label: 'Pago', variant: 'success' },\r\n    reversed: { label: 'Estornado', variant: 'danger' },\r\n}\r\n\r\nconst settlementStatusConfig: Record<string, { label: string; variant: any }> = {\r\n    open: { label: 'Aberto', variant: 'warning' },\r\n    closed: { label: 'Fechado', variant: 'info' },\r\n    paid: { label: 'Pago', variant: 'success' },\r\n}\r\n\r\nconst disputeStatusConfig: Record<string, { label: string; variant: any }> = {\r\n    open: { label: 'Aberta', variant: 'warning' },\r\n    accepted: { label: 'Aceita', variant: 'success' },\r\n    rejected: { label: 'Rejeitada', variant: 'danger' },\r\n}\r\n\r\nconst calcTypeLabels: Record<string, string> = {\r\n    percent_gross: '% Bruto', percent_net: '% Líquido',\r\n    percent_gross_minus_displacement: '% (Bruto−Desloc.)', percent_services_only: '% Serviços',\r\n    percent_products_only: '% Produtos', fixed_per_os: 'Fixo/OS',\r\n    percent_profit: '% Lucro', percent_gross_minus_expenses: '% (Bruto−Desp.)',\r\n    tiered_gross: '% Escalonado', custom_formula: 'Fórmula',\r\n}\r\n\r\nconst roleLabels: Record<string, string> = {\r\n    technician: 'Técnico', seller: 'Vendedor', driver: 'Motorista',\r\n}\r\n\r\nconst whenLabels: Record<string, string> = {\r\n    os_completed: 'OS Concluída', installment_paid: 'Parcela Paga', os_invoiced: 'OS Faturada',\r\n}\r\n\r\nconst fmtBRL = (val: string | number) => Number(val).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\ntype Tab = 'events' | 'rules' | 'settlements' | 'disputes' | 'goals' | 'campaigns'\r\n\r\nexport function CommissionsPage() {\r\n    const qc = useQueryClient()\r\n    const [tab, setTab] = useState<Tab>('events')\r\n    const [showRuleForm, setShowRuleForm] = useState(false)\r\n    const [ruleForm, setRuleForm] = useState({\r\n        user_id: '' as string | number, name: '', type: 'percentage', value: '', applies_to: 'all',\r\n        calculation_type: 'percent_gross', applies_to_role: 'technician', applies_when: 'os_completed',\r\n    })\r\n    const [userFilter, setUserFilter] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n    const [showGenerate, setShowGenerate] = useState(false)\r\n    const [genWoId, setGenWoId] = useState<string | number>('')\r\n    const [showClose, setShowClose] = useState(false)\r\n    const [closeForm, setCloseForm] = useState({ user_id: '' as string | number, period: '' })\r\n    const [selectedIds, setSelectedIds] = useState<number[]>([])\r\n    const [showSplit, setShowSplit] = useState<any>(null)\r\n    const [splits, setSplits] = useState<{ user_id: string; percentage: string; role: string }[]>([])\r\n    const [showDispute, setShowDispute] = useState<any>(null)\r\n    const [disputeReason, setDisputeReason] = useState('')\r\n    const [showResolve, setShowResolve] = useState<any>(null)\r\n    const [resolveForm, setResolveForm] = useState({ status: 'accepted', resolution_notes: '', new_amount: '' })\r\n    const [showGoalForm, setShowGoalForm] = useState(false)\r\n    const [goalForm, setGoalForm] = useState({ user_id: '' as string | number, period: '', target_amount: '' })\r\n    const [showCampaignForm, setShowCampaignForm] = useState(false)\r\n    const [campaignForm, setCampaignForm] = useState({ name: '', multiplier: '1.50', applies_to_role: '', starts_at: '', ends_at: '' })\r\n\r\n    // ── Queries ──\r\n    const { data: techsRes } = useQuery({ queryKey: ['technicians'], queryFn: () => api.get('/users', { params: { per_page: 50 } }) })\r\n    const technicians = techsRes?.data?.data ?? []\r\n\r\n    const { data: summaryRes } = useQuery({ queryKey: ['commission-summary'], queryFn: () => api.get('/commission-summary') })\r\n    const summary = summaryRes?.data ?? {}\r\n\r\n    const { data: rulesRes } = useQuery({\r\n        queryKey: ['commission-rules', userFilter],\r\n        queryFn: () => api.get('/commission-rules', { params: { user_id: userFilter || undefined } }),\r\n        enabled: tab === 'rules',\r\n    })\r\n    const rules = rulesRes?.data ?? []\r\n\r\n    const { data: eventsRes } = useQuery({\r\n        queryKey: ['commission-events', userFilter, statusFilter],\r\n        queryFn: () => api.get('/commission-events', { params: { user_id: userFilter || undefined, status: statusFilter || undefined, per_page: 50 } }),\r\n        enabled: tab === 'events',\r\n    })\r\n    const events = eventsRes?.data?.data ?? []\r\n\r\n    const { data: settRes } = useQuery({\r\n        queryKey: ['commission-settlements', userFilter],\r\n        queryFn: () => api.get('/commission-settlements', { params: { user_id: userFilter || undefined } }),\r\n        enabled: tab === 'settlements',\r\n    })\r\n    const settlements = settRes?.data ?? []\r\n\r\n    const { data: disputesRes } = useQuery({\r\n        queryKey: ['commission-disputes', statusFilter],\r\n        queryFn: () => api.get('/commission-disputes', { params: { status: statusFilter || undefined } }),\r\n        enabled: tab === 'disputes',\r\n    })\r\n    const disputes = disputesRes?.data ?? []\r\n\r\n    const { data: goalsRes } = useQuery({\r\n        queryKey: ['commission-goals', userFilter],\r\n        queryFn: () => api.get('/commission-goals', { params: { user_id: userFilter || undefined } }),\r\n        enabled: tab === 'goals',\r\n    })\r\n    const goals = goalsRes?.data ?? []\r\n\r\n    const { data: campaignsRes } = useQuery({\r\n        queryKey: ['commission-campaigns'],\r\n        queryFn: () => api.get('/commission-campaigns'),\r\n        enabled: tab === 'campaigns',\r\n    })\r\n    const campaigns = campaignsRes?.data ?? []\r\n\r\n    const { data: wosRes } = useQuery({\r\n        queryKey: ['work-orders-commission'],\r\n        queryFn: () => api.get('/work-orders', { params: { per_page: 50 } }),\r\n        enabled: showGenerate,\r\n    })\r\n\r\n    // ── Mutations ──\r\n    const inv = (...keys: string[]) => keys.forEach(k => qc.invalidateQueries({ queryKey: [k] }))\r\n\r\n    const saveRuleMut = useMutation({\r\n        mutationFn: (data: typeof ruleForm) => api.post('/commission-rules', data),\r\n        onSuccess: () => { inv('commission-rules'); setShowRuleForm(false) },\r\n    })\r\n    const delRuleMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/commission-rules/${id}`),\r\n        onSuccess: () => inv('commission-rules'),\r\n    })\r\n    const genMut = useMutation({\r\n        mutationFn: (woId: string | number) => api.post('/commission-events/generate', { work_order_id: woId }),\r\n        onSuccess: () => { inv('commission-events', 'commission-summary'); setShowGenerate(false) },\r\n    })\r\n    const updateStatusMut = useMutation({\r\n        mutationFn: ({ id, status }: { id: number; status: string }) => api.put(`/commission-events/${id}/status`, { status }),\r\n        onSuccess: () => inv('commission-events', 'commission-summary'),\r\n    })\r\n    const batchStatusMut = useMutation({\r\n        mutationFn: (status: string) => api.post('/commission-events/batch-status', { ids: selectedIds, status }),\r\n        onSuccess: () => { inv('commission-events', 'commission-summary'); setSelectedIds([]) },\r\n    })\r\n    const closeMut = useMutation({\r\n        mutationFn: (data: typeof closeForm) => api.post('/commission-settlements/close', data),\r\n        onSuccess: () => { inv('commission-settlements', 'commission-events', 'commission-summary'); setShowClose(false) },\r\n    })\r\n    const paySettMut = useMutation({\r\n        mutationFn: (id: number) => api.post(`/commission-settlements/${id}/pay`),\r\n        onSuccess: () => inv('commission-settlements', 'commission-summary'),\r\n    })\r\n    const splitMut = useMutation({\r\n        mutationFn: ({ eventId, splits: s }: { eventId: number; splits: typeof splits }) =>\r\n            api.post(`/commission-events/${eventId}/splits`, { splits: s }),\r\n        onSuccess: () => { inv('commission-events'); setShowSplit(null) },\r\n    })\r\n    const disputeMut = useMutation({\r\n        mutationFn: (data: { commission_event_id: number; reason: string }) => api.post('/commission-disputes', data),\r\n        onSuccess: () => { inv('commission-disputes'); setShowDispute(null); setDisputeReason('') },\r\n    })\r\n    const resolveMut = useMutation({\r\n        mutationFn: ({ id, ...data }: { id: number; status: string; resolution_notes: string; new_amount?: string }) =>\r\n            api.post(`/commission-disputes/${id}/resolve`, data),\r\n        onSuccess: () => { inv('commission-disputes', 'commission-events'); setShowResolve(null) },\r\n    })\r\n    const goalMut = useMutation({\r\n        mutationFn: (data: typeof goalForm) => api.post('/commission-goals', data),\r\n        onSuccess: () => { inv('commission-goals'); setShowGoalForm(false) },\r\n    })\r\n    const delGoalMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/commission-goals/${id}`),\r\n        onSuccess: () => inv('commission-goals'),\r\n    })\r\n    const campaignMut = useMutation({\r\n        mutationFn: (data: typeof campaignForm) => api.post('/commission-campaigns', data),\r\n        onSuccess: () => { inv('commission-campaigns'); setShowCampaignForm(false) },\r\n    })\r\n    const delCampaignMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/commission-campaigns/${id}`),\r\n        onSuccess: () => inv('commission-campaigns'),\r\n    })\r\n\r\n    const toggleSelect = useCallback((id: number) => {\r\n        setSelectedIds(p => p.includes(id) ? p.filter(x => x !== id) : [...p, id])\r\n    }, [])\r\n\r\n    const exportCSV = (type: 'events' | 'settlements') => {\r\n        window.open(`/api/v1/commission-${type}/export`, '_blank')\r\n    }\r\n\r\n    const tabs: { key: Tab; label: string; icon: any }[] = [\r\n        { key: 'events', label: 'Eventos', icon: FileText },\r\n        { key: 'rules', label: 'Regras', icon: Settings },\r\n        { key: 'settlements', label: 'Fechamento', icon: CheckCircle },\r\n        { key: 'disputes', label: 'Contestações', icon: AlertTriangle },\r\n        { key: 'goals', label: 'Metas', icon: Target },\r\n        { key: 'campaigns', label: 'Campanhas', icon: Zap },\r\n    ]\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Comissões</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Regras, eventos, disputas, metas e campanhas</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    {tab === 'rules' && <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setRuleForm({ user_id: '', name: '', type: 'percentage', value: '', applies_to: 'all', calculation_type: 'percent_gross', applies_to_role: 'technician', applies_when: 'os_completed' }); setShowRuleForm(true) }}>Nova Regra</Button>}\r\n                    {tab === 'events' && <>\r\n                        <Button icon={<Award className=\"h-4 w-4\" />} onClick={() => { setGenWoId(''); setShowGenerate(true) }}>Gerar da OS</Button>\r\n                        {selectedIds.length > 0 && <Button variant=\"outline\" icon={<Check className=\"h-4 w-4\" />} onClick={() => batchStatusMut.mutate('approved')} loading={batchStatusMut.isPending}>Aprovar ({selectedIds.length})</Button>}\r\n                        <Button variant=\"ghost\" icon={<Download className=\"h-4 w-4\" />} onClick={() => exportCSV('events')}>CSV</Button>\r\n                    </>}\r\n                    {tab === 'settlements' && <>\r\n                        <Button icon={<CheckCircle className=\"h-4 w-4\" />} onClick={() => { setCloseForm({ user_id: '', period: '' }); setShowClose(true) }}>Fechar Período</Button>\r\n                        <Button variant=\"ghost\" icon={<Download className=\"h-4 w-4\" />} onClick={() => exportCSV('settlements')}>CSV</Button>\r\n                    </>}\r\n                    {tab === 'goals' && <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setGoalForm({ user_id: '', period: '', target_amount: '' }); setShowGoalForm(true) }}>Nova Meta</Button>}\r\n                    {tab === 'campaigns' && <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setCampaignForm({ name: '', multiplier: '1.50', applies_to_role: '', starts_at: '', ends_at: '' }); setShowCampaignForm(true) }}>Nova Campanha</Button>}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid gap-3 sm:grid-cols-4\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-amber-600\"><Clock className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pendente</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-surface-900\">{fmtBRL(summary.pending ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-sky-600\"><CheckCircle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Aprovado</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-sky-600\">{fmtBRL(summary.approved ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-emerald-600\"><DollarSign className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pago (mês)</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-emerald-600\">{fmtBRL(summary.paid_this_month ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-brand-600\"><BarChart3 className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Tipos de Cálculo</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-brand-600\">{summary.calculation_types_count ?? 0}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs + Filter */}\r\n            <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n                <div className=\"flex flex-wrap rounded-lg border border-surface-200 bg-surface-50 p-0.5\">\r\n                    {tabs.map(t => {\r\n                        const Icon = t.icon\r\n                        return (\r\n                            <button key={t.key} onClick={() => { setTab(t.key); setSelectedIds([]) }}\r\n                                className={cn('flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all',\r\n                                    tab === t.key ? 'bg-white text-brand-700 shadow-sm' : 'text-surface-500 hover:text-surface-700')}>\r\n                                <Icon className=\"h-3.5 w-3.5\" />{t.label}\r\n                            </button>\r\n                        )\r\n                    })}\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <select value={userFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setUserFilter(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                        <option value=\"\">Todos</option>\r\n                        {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                    </select>\r\n                    {(tab === 'events' || tab === 'disputes') && (\r\n                        <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                            className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                            <option value=\"\">Todos</option>\r\n                            {Object.entries(tab === 'events' ? eventStatusConfig : disputeStatusConfig).map(([k, v]) =>\r\n                                <option key={k} value={k}>{v.label}</option>)}\r\n                        </select>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* ── Tab: Events ── */}\r\n            {tab === 'events' && (\r\n                <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <table className=\"w-full\">\r\n                        <thead>\r\n                            <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                <th className=\"w-10 px-4 py-3\"><input type=\"checkbox\" onChange={e => setSelectedIds(e.target.checked ? events.map((ev: any) => ev.id) : [])} checked={selectedIds.length === events.length && events.length > 0} /></th>\r\n                                <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Técnico</th>\r\n                                <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">OS</th>\r\n                                <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">Regra</th>\r\n                                <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Base</th>\r\n                                <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Comissão</th>\r\n                                <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Status</th>\r\n                                <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Ações</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-surface-100\">\r\n                            {events.length === 0 ? (\r\n                                <tr><td colSpan={8} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum evento</td></tr>\r\n                            ) : events.map((e: any) => (\r\n                                <tr key={e.id} className={cn('hover:bg-surface-50 transition-colors', selectedIds.includes(e.id) && 'bg-brand-50/50')}>\r\n                                    <td className=\"px-4 py-3\"><input type=\"checkbox\" checked={selectedIds.includes(e.id)} onChange={() => toggleSelect(e.id)} /></td>\r\n                                    <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{e.user?.name}</td>\r\n                                    <td className=\"px-4 py-3 text-xs text-brand-600 font-medium\">{e.work_order?.number}</td>\r\n                                    <td className=\"hidden px-4 py-3 text-xs text-surface-500 md:table-cell\">{e.rule?.name}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-sm text-surface-600\">{fmtBRL(e.base_amount)}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-sm font-semibold text-surface-900\">{fmtBRL(e.commission_amount)}</td>\r\n                                    <td className=\"px-4 py-3\"><Badge variant={eventStatusConfig[e.status]?.variant}>{eventStatusConfig[e.status]?.label}</Badge></td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <div className=\"flex items-center justify-end gap-1\">\r\n                                            {e.status === 'pending' && (\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => updateStatusMut.mutate({ id: e.id, status: 'approved' })} title=\"Aprovar\">\r\n                                                    <CheckCircle className=\"h-4 w-4 text-sky-500\" />\r\n                                                </Button>\r\n                                            )}\r\n                                            {e.status !== 'reversed' && e.status !== 'paid' && (\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => updateStatusMut.mutate({ id: e.id, status: 'reversed' })} title=\"Estornar\">\r\n                                                    <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                                </Button>\r\n                                            )}\r\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => { setShowSplit(e); setSplits([{ user_id: '', percentage: '50', role: 'technician' }, { user_id: '', percentage: '50', role: 'technician' }]) }} title=\"Dividir\">\r\n                                                <Split className=\"h-4 w-4 text-surface-500\" />\r\n                                            </Button>\r\n                                            {e.status === 'pending' && (\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => { setShowDispute(e); setDisputeReason('') }} title=\"Contestar\">\r\n                                                    <AlertTriangle className=\"h-4 w-4 text-amber-500\" />\r\n                                                </Button>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n\r\n            {/* ── Tab: Rules ── */}\r\n            {tab === 'rules' && (\r\n                <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\r\n                    {rules.map((r: any) => (\r\n                        <div key={r.id} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <h3 className=\"text-sm font-semibold text-surface-900\">{r.name}</h3>\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delRuleMut.mutate(r.id) }}>\r\n                                    <Trash2 className=\"h-3.5 w-3.5 text-red-500\" />\r\n                                </Button>\r\n                            </div>\r\n                            <p className=\"text-xs text-surface-500 mt-0.5\">{r.user?.name}</p>\r\n                            <div className=\"mt-3 flex flex-wrap items-center gap-1.5\">\r\n                                <div className=\"flex items-center gap-1 rounded-lg bg-brand-50 px-2 py-1\">\r\n                                    {r.calculation_type === 'fixed_per_os'\r\n                                        ? <><DollarSign className=\"h-3.5 w-3.5 text-brand-600\" /><span className=\"text-sm font-bold text-brand-700\">{fmtBRL(r.value)}</span></>\r\n                                        : <><Percent className=\"h-3.5 w-3.5 text-brand-600\" /><span className=\"text-sm font-bold text-brand-700\">{r.value}%</span></>\r\n                                    }\r\n                                </div>\r\n                                <Badge variant={r.active ? 'success' : 'default'}>{r.active ? 'Ativa' : 'Inativa'}</Badge>\r\n                                <Badge variant=\"brand\">{calcTypeLabels[r.calculation_type] ?? r.calculation_type}</Badge>\r\n                                <Badge variant=\"info\">{roleLabels[r.applies_to_role] ?? r.applies_to_role}</Badge>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                    {rules.length === 0 && <p className=\"col-span-full text-center text-sm text-surface-500 py-8\">Nenhuma regra cadastrada</p>}\r\n                </div>\r\n            )}\r\n\r\n            {/* ── Tab: Settlements ── */}\r\n            {tab === 'settlements' && (\r\n                <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\r\n                    {settlements.map((s: any) => (\r\n                        <div key={s.id} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div>\r\n                                    <h3 className=\"text-sm font-semibold text-surface-900\">{s.user?.name}</h3>\r\n                                    <p className=\"text-xs text-surface-500\">{s.period} • {s.events_count} eventos</p>\r\n                                </div>\r\n                                <Badge variant={settlementStatusConfig[s.status]?.variant}>{settlementStatusConfig[s.status]?.label}</Badge>\r\n                            </div>\r\n                            <p className=\"mt-2 text-xl font-bold text-surface-900\">{fmtBRL(s.total_amount)}</p>\r\n                            <div className=\"mt-2 flex gap-2\">\r\n                                {s.status === 'closed' && (\r\n                                    <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => paySettMut.mutate(s.id)} loading={paySettMut.isPending}>\r\n                                        Marcar como Pago\r\n                                    </Button>\r\n                                )}\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => window.open(`/api/v1/commission-statement/pdf?user_id=${s.user_id}&period=${s.period}`, '_blank')} title=\"PDF\">\r\n                                    <Download className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                    {settlements.length === 0 && <p className=\"col-span-full text-center text-sm text-surface-500 py-8\">Nenhum fechamento</p>}\r\n                </div>\r\n            )}\r\n\r\n            {/* ── Tab: Disputes ── */}\r\n            {tab === 'disputes' && (\r\n                <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <table className=\"w-full\">\r\n                        <thead>\r\n                            <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Solicitante</th>\r\n                                <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Motivo</th>\r\n                                <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Valor</th>\r\n                                <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Status</th>\r\n                                <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Ações</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-surface-100\">\r\n                            {(disputes as any[]).length === 0 ? (\r\n                                <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhuma contestação</td></tr>\r\n                            ) : (disputes as any[]).map((d: any) => (\r\n                                <tr key={d.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{d.user_name}</td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-600 max-w-xs truncate\">{d.reason}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-sm font-semibold\">{fmtBRL(d.commission_amount)}</td>\r\n                                    <td className=\"px-4 py-3\"><Badge variant={disputeStatusConfig[d.status]?.variant}>{disputeStatusConfig[d.status]?.label}</Badge></td>\r\n                                    <td className=\"px-4 py-3 text-right\">\r\n                                        {d.status === 'open' && (\r\n                                            <Button variant=\"outline\" size=\"sm\" onClick={() => { setShowResolve(d); setResolveForm({ status: 'accepted', resolution_notes: '', new_amount: '' }) }}>\r\n                                                Resolver\r\n                                            </Button>\r\n                                        )}\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n\r\n            {/* ── Tab: Goals ── */}\r\n            {tab === 'goals' && (\r\n                <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\r\n                    {(goals as any[]).map((g: any) => {\r\n                        const pct = g.achievement_pct ?? 0\r\n                        const color = pct >= 100 ? 'bg-emerald-500' : pct >= 70 ? 'bg-sky-500' : pct >= 40 ? 'bg-amber-500' : 'bg-red-400'\r\n                        return (\r\n                            <div key={g.id} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div>\r\n                                        <h3 className=\"text-sm font-semibold text-surface-900\">{g.user_name}</h3>\r\n                                        <p className=\"text-xs text-surface-500\">{g.period}</p>\r\n                                    </div>\r\n                                    <div className=\"flex gap-1\">\r\n                                        {pct >= 100 && <span className=\"text-lg\">🏆</span>}\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir meta?')) delGoalMut.mutate(g.id) }}><Trash2 className=\"h-3.5 w-3.5 text-red-500\" /></Button>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"mt-3\">\r\n                                    <div className=\"flex justify-between text-xs text-surface-500 mb-1\">\r\n                                        <span>{fmtBRL(g.achieved_amount)}</span>\r\n                                        <span>{fmtBRL(g.target_amount)}</span>\r\n                                    </div>\r\n                                    <div className=\"h-2.5 rounded-full bg-surface-100 overflow-hidden\">\r\n                                        <div className={cn('h-full rounded-full transition-all', color)} style={{ width: `${Math.min(pct, 100)}%` }} />\r\n                                    </div>\r\n                                    <p className=\"mt-1 text-right text-xs font-bold\" style={{ color: pct >= 100 ? '#059669' : '#6B7280' }}>{pct}%</p>\r\n                                </div>\r\n                                {g.bonus_rules && (g.bonus_rules as any[]).length > 0 && (\r\n                                    <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                                        {(g.bonus_rules as any[]).map((b: any, i: number) => (\r\n                                            <Badge key={i} variant={pct >= b.threshold_pct ? 'success' : 'default'}>\r\n                                                {b.threshold_pct}% → +{b.bonus_pct}%\r\n                                            </Badge>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )\r\n                    })}\r\n                    {(goals as any[]).length === 0 && <p className=\"col-span-full text-center text-sm text-surface-500 py-8\">Nenhuma meta cadastrada</p>}\r\n                </div>\r\n            )}\r\n\r\n            {/* ── Tab: Campaigns ── */}\r\n            {tab === 'campaigns' && (\r\n                <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\r\n                    {(campaigns as any[]).map((c: any) => {\r\n                        const isActive = c.active && new Date(c.starts_at) <= new Date() && new Date(c.ends_at) >= new Date()\r\n                        return (\r\n                            <div key={c.id} className={cn('rounded-xl border p-4 shadow-card', isActive ? 'border-emerald-300 bg-emerald-50/30' : 'border-surface-200 bg-white')}>\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <h3 className=\"text-sm font-semibold text-surface-900\">{c.name}</h3>\r\n                                    <div className=\"flex gap-1\">\r\n                                        <Badge variant={isActive ? 'success' : 'default'}>{isActive ? 'Ativa' : 'Inativa'}</Badge>\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delCampaignMut.mutate(c.id) }}><Trash2 className=\"h-3.5 w-3.5 text-red-500\" /></Button>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"mt-3 flex items-center gap-3\">\r\n                                    <div className=\"flex items-center gap-1 rounded-lg bg-amber-50 px-2.5 py-1.5\">\r\n                                        <Zap className=\"h-4 w-4 text-amber-600\" />\r\n                                        <span className=\"text-lg font-bold text-amber-700\">{c.multiplier}x</span>\r\n                                    </div>\r\n                                    <div className=\"text-xs text-surface-500\">\r\n                                        <p>{c.applies_to_role ? roleLabels[c.applies_to_role] : 'Todos os papéis'}</p>\r\n                                        <p className=\"flex items-center gap-1\"><Calendar className=\"h-3 w-3\" />{c.starts_at} → {c.ends_at}</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })}\r\n                    {(campaigns as any[]).length === 0 && <p className=\"col-span-full text-center text-sm text-surface-500 py-8\">Nenhuma campanha</p>}\r\n                </div>\r\n            )}\r\n\r\n            {/* ── Modals ── */}\r\n\r\n            {/* Rule Modal */}\r\n            <Modal open={showRuleForm} onOpenChange={setShowRuleForm} title=\"Nova Regra de Comissão\">\r\n                <form onSubmit={e => { e.preventDefault(); saveRuleMut.mutate(ruleForm) }} className=\"space-y-4\">\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Pessoa *</label>\r\n                            <select value={ruleForm.user_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setRuleForm(p => ({ ...p, user_id: e.target.value }))} required\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Selecionar</option>\r\n                                {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Papel</label>\r\n                            <select value={ruleForm.applies_to_role} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setRuleForm(p => ({ ...p, applies_to_role: e.target.value }))}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                {Object.entries(roleLabels).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <Input label=\"Nome da regra\" value={ruleForm.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setRuleForm(p => ({ ...p, name: e.target.value }))} required placeholder=\"Ex: 10% sobre serviços\" />\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Tipo de Cálculo *</label>\r\n                        <select value={ruleForm.calculation_type} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setRuleForm(p => ({ ...p, calculation_type: e.target.value }))}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                            {Object.entries(calcTypeLabels).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <Input label={ruleForm.calculation_type === 'fixed_per_os' ? 'Valor (R$)' : 'Percentual (%)'} type=\"number\" step=\"0.01\"\r\n                            value={ruleForm.value} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setRuleForm(p => ({ ...p, value: e.target.value }))} required />\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Quando</label>\r\n                            <select value={ruleForm.applies_when} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setRuleForm(p => ({ ...p, applies_when: e.target.value }))}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                {Object.entries(whenLabels).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Aplica a</label>\r\n                            <select value={ruleForm.applies_to} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setRuleForm(p => ({ ...p, applies_to: e.target.value }))}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"all\">Tudo</option><option value=\"products\">Produtos</option><option value=\"services\">Serviços</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowRuleForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveRuleMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Generate Modal */}\r\n            <Modal open={showGenerate} onOpenChange={setShowGenerate} title=\"Gerar Comissões da OS\">\r\n                <form onSubmit={e => { e.preventDefault(); genMut.mutate(genWoId) }} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">OS *</label>\r\n                        <select value={genWoId} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setGenWoId(e.target.value)} required\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                            <option value=\"\">Selecionar</option>\r\n                            {(wosRes?.data?.data ?? []).map((wo: any) => <option key={wo.id} value={wo.id}>{wo.number} — {wo.customer?.name} — {fmtBRL(wo.total)}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowGenerate(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={genMut.isPending}>Gerar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Close Settlement Modal */}\r\n            <Modal open={showClose} onOpenChange={setShowClose} title=\"Fechar Período\">\r\n                <form onSubmit={e => { e.preventDefault(); closeMut.mutate(closeForm) }} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Técnico *</label>\r\n                        <select value={closeForm.user_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setCloseForm(p => ({ ...p, user_id: e.target.value }))} required\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                            <option value=\"\">Selecionar</option>\r\n                            {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <Input label=\"Período (YYYY-MM)\" value={closeForm.period} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCloseForm(p => ({ ...p, period: e.target.value }))} required placeholder=\"2026-02\" />\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowClose(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={closeMut.isPending}>Fechar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Split Modal */}\r\n            <Modal open={!!showSplit} onOpenChange={() => setShowSplit(null)} title={`Dividir Comissão — ${fmtBRL(showSplit?.commission_amount ?? 0)}`}>\r\n                <div className=\"space-y-3\">\r\n                    {splits.map((s, i) => (\r\n                        <div key={i} className=\"grid grid-cols-3 gap-2\">\r\n                            <select value={s.user_id} onChange={e => { const n = [...splits]; n[i].user_id = e.target.value; setSplits(n) }}\r\n                                className=\"col-span-1 rounded-lg border border-surface-300 bg-white px-2 py-2 text-sm\">\r\n                                <option value=\"\">Pessoa</option>\r\n                                {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                            </select>\r\n                            <Input type=\"number\" value={s.percentage} onChange={(e: any) => { const n = [...splits]; n[i].percentage = e.target.value; setSplits(n) }} placeholder=\"%\" />\r\n                            <select value={s.role} onChange={e => { const n = [...splits]; n[i].role = e.target.value; setSplits(n) }}\r\n                                className=\"rounded-lg border border-surface-300 bg-white px-2 py-2 text-sm\">\r\n                                {Object.entries(roleLabels).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    ))}\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => setSplits([...splits, { user_id: '', percentage: '', role: 'technician' }])}>\r\n                        <Plus className=\"h-3 w-3 mr-1\" /> Adicionar\r\n                    </Button>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" onClick={() => setShowSplit(null)}>Cancelar</Button>\r\n                        <Button onClick={() => showSplit && splitMut.mutate({ eventId: showSplit.id, splits })} loading={splitMut.isPending}>Salvar Splits</Button>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n\r\n            {/* Dispute Modal */}\n            <Modal open={!!showDispute} onOpenChange={() => setShowDispute(null)} title=\"Contestar Comissão\">\n                <form\n                    onSubmit={e => {\n                        e.preventDefault()\n                        if (showDispute) {\n                            disputeMut.mutate({ commission_event_id: showDispute.id, reason: disputeReason })\n                        }\n                    }}\n                    className=\"space-y-4\"\n                >\n                    <div>\r\n                        <p className=\"text-sm text-surface-600 mb-2\">Comissão: <strong>{fmtBRL(showDispute?.commission_amount ?? 0)}</strong> — {showDispute?.user?.name}</p>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Motivo da contestação *</label>\r\n                        <textarea value={disputeReason} onChange={e => setDisputeReason(e.target.value)} required minLength={10}\r\n                            rows={3} className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                            placeholder=\"Descreva o motivo...\" />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowDispute(null)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={disputeMut.isPending}>Enviar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Resolve Dispute Modal */}\n            <Modal open={!!showResolve} onOpenChange={() => setShowResolve(null)} title=\"Resolver Contestação\">\n                <form\n                    onSubmit={e => {\n                        e.preventDefault()\n                        if (showResolve) {\n                            resolveMut.mutate({ id: showResolve.id, ...resolveForm })\n                        }\n                    }}\n                    className=\"space-y-4\"\n                >\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Decisão *</label>\r\n                        <select value={resolveForm.status} onChange={e => setResolveForm(p => ({ ...p, status: e.target.value }))}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none\">\r\n                            <option value=\"accepted\">Aceitar</option>\r\n                            <option value=\"rejected\">Rejeitar</option>\r\n                        </select>\r\n                    </div>\r\n                    {resolveForm.status === 'accepted' && (\r\n                        <Input label=\"Novo valor (R$)\" type=\"number\" step=\"0.01\" value={resolveForm.new_amount}\r\n                            onChange={(e: React.ChangeEvent<HTMLInputElement>) => setResolveForm(p => ({ ...p, new_amount: e.target.value }))} placeholder=\"Deixe vazio para manter\" />\r\n                    )}\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Notas de resolução *</label>\r\n                        <textarea value={resolveForm.resolution_notes} onChange={e => setResolveForm(p => ({ ...p, resolution_notes: e.target.value }))} required minLength={5}\r\n                            rows={3} className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowResolve(null)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={resolveMut.isPending}>Resolver</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Goal Modal */}\r\n            <Modal open={showGoalForm} onOpenChange={setShowGoalForm} title=\"Nova Meta\">\r\n                <form onSubmit={e => { e.preventDefault(); goalMut.mutate(goalForm) }} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Pessoa *</label>\r\n                        <select value={goalForm.user_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setGoalForm(p => ({ ...p, user_id: e.target.value }))} required\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                            <option value=\"\">Selecionar</option>\r\n                            {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Período (YYYY-MM)\" value={goalForm.period} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setGoalForm(p => ({ ...p, period: e.target.value }))} required placeholder=\"2026-02\" />\r\n                        <Input label=\"Meta (R$)\" type=\"number\" step=\"0.01\" value={goalForm.target_amount} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setGoalForm(p => ({ ...p, target_amount: e.target.value }))} required />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowGoalForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={goalMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Campaign Modal */}\r\n            <Modal open={showCampaignForm} onOpenChange={setShowCampaignForm} title=\"Nova Campanha\">\r\n                <form onSubmit={e => { e.preventDefault(); campaignMut.mutate(campaignForm) }} className=\"space-y-4\">\r\n                    <Input label=\"Nome\" value={campaignForm.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCampaignForm(p => ({ ...p, name: e.target.value }))} required placeholder=\"Ex: Campanha de Março\" />\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Multiplicador\" type=\"number\" step=\"0.01\" min=\"1.01\" max=\"5\" value={campaignForm.multiplier}\r\n                            onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCampaignForm(p => ({ ...p, multiplier: e.target.value }))} required />\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Papel (opcional)</label>\r\n                            <select value={campaignForm.applies_to_role} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setCampaignForm(p => ({ ...p, applies_to_role: e.target.value }))}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none\">\r\n                                <option value=\"\">Todos</option>\r\n                                {Object.entries(roleLabels).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Início\" type=\"date\" value={campaignForm.starts_at} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCampaignForm(p => ({ ...p, starts_at: e.target.value }))} required />\r\n                        <Input label=\"Fim\" type=\"date\" value={campaignForm.ends_at} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCampaignForm(p => ({ ...p, ends_at: e.target.value }))} required />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowCampaignForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={campaignMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\ExpensesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[266,298],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[553,556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[553,556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8449,8452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8449,8452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":235,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15077,15080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15077,15080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15854,15857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15854,15857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Receipt, Plus, Search, CheckCircle, XCircle,\r\n    Clock, Eye, Trash2, Tag, RefreshCw,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any }> = {\r\n    pending: { label: 'Pendente', variant: 'warning' },\r\n    approved: { label: 'Aprovado', variant: 'info' },\r\n    rejected: { label: 'Rejeitado', variant: 'danger' },\r\n    reimbursed: { label: 'Reembolsado', variant: 'success' },\r\n}\r\n\r\nconst paymentMethods: Record<string, string> = {\r\n    dinheiro: 'Dinheiro', pix: 'PIX', cartao_credito: 'Cartão Crédito',\r\n    cartao_debito: 'Cartão Débito', boleto: 'Boleto', transferencia: 'Transferência',\r\n}\r\n\r\ninterface Exp {\r\n    id: number; description: string; amount: string\r\n    expense_date: string; status: string; payment_method: string | null\r\n    notes: string | null; receipt_path: string | null\r\n    category: { id: number; name: string; color: string } | null\r\n    creator: { id: number; name: string }\r\n    work_order: { id: number; number: string } | null\r\n    approver?: { id: number; name: string } | null\r\n}\r\n\r\nconst fmtBRL = (val: string | number) => Number(val).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\nconst fmtDate = (d: string) => new Date(d + 'T00:00:00').toLocaleDateString('pt-BR')\r\n\r\nexport function ExpensesPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n    const [catFilter, setCatFilter] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [showDetail, setShowDetail] = useState<Exp | null>(null)\r\n    const [showCatForm, setShowCatForm] = useState(false)\r\n    const [catForm, setCatForm] = useState({ name: '', color: '#6b7280' })\r\n    const [form, setForm] = useState({\r\n        expense_category_id: '' as string | number, work_order_id: '' as string | number,\r\n        description: '', amount: '', expense_date: '', payment_method: '', notes: '',\r\n    })\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['expenses', search, statusFilter, catFilter],\r\n        queryFn: () => api.get('/expenses', {\r\n            params: { search: search || undefined, status: statusFilter || undefined, expense_category_id: catFilter || undefined, per_page: 50 },\r\n        }),\r\n    })\r\n    const records: Exp[] = res?.data?.data ?? []\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['expense-summary'],\r\n        queryFn: () => api.get('/expense-summary'),\r\n    })\r\n    const summary = summaryRes?.data ?? {}\r\n\r\n    const { data: catsRes } = useQuery({\r\n        queryKey: ['expense-categories'],\r\n        queryFn: () => api.get('/expense-categories'),\r\n    })\r\n    const categories = catsRes?.data ?? []\r\n\r\n    const { data: wosRes } = useQuery({\r\n        queryKey: ['work-orders-expense'],\r\n        queryFn: () => api.get('/work-orders', { params: { per_page: 50 } }),\r\n        enabled: showForm,\r\n    })\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) => api.post('/expenses', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['expenses'] }); qc.invalidateQueries({ queryKey: ['expense-summary'] }); setShowForm(false) },\r\n    })\r\n\r\n    const statusMut = useMutation({\r\n        mutationFn: ({ id, status }: { id: number; status: string }) => api.put(`/expenses/${id}/status`, { status }),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['expenses'] }); qc.invalidateQueries({ queryKey: ['expense-summary'] }) },\r\n    })\r\n\r\n    const delMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/expenses/${id}`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['expenses'] }); qc.invalidateQueries({ queryKey: ['expense-summary'] }) },\r\n    })\r\n\r\n    const saveCatMut = useMutation({\r\n        mutationFn: (data: typeof catForm) => api.post('/expense-categories', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['expense-categories'] }); setShowCatForm(false) },\r\n    })\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) => setForm(p => ({ ...p, [k]: v }))\r\n\r\n    const loadDetail = async (exp: Exp) => {\r\n        const { data } = await api.get(`/expenses/${exp.id}`)\r\n        setShowDetail(data)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Despesas</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Controle de despesas e aprovações</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <Button variant=\"outline\" icon={<Tag className=\"h-4 w-4\" />} onClick={() => { setCatForm({ name: '', color: '#6b7280' }); setShowCatForm(true) }}>\r\n                        Nova Categoria\r\n                    </Button>\r\n                    <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setForm({ expense_category_id: '', work_order_id: '', description: '', amount: '', expense_date: '', payment_method: '', notes: '' }); setShowForm(true) }}>\r\n                        Nova Despesa\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid gap-3 sm:grid-cols-3\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-amber-600\"><Clock className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pendente Aprovação</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-surface-900\">{fmtBRL(summary.pending ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-sky-600\"><CheckCircle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Aprovado</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-sky-600\">{fmtBRL(summary.approved ?? 0)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-surface-600\"><Receipt className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Total do Mês</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-surface-900\">{fmtBRL(summary.month_total ?? 0)}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <div className=\"relative flex-1 max-w-sm\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)} placeholder=\"Buscar descrição\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                </div>\r\n                <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todos os status</option>\r\n                    {Object.entries(statusConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                </select>\r\n                <select value={catFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setCatFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todas categorias</option>\r\n                    {categories.map((c: any) => <option key={c.id} value={c.id}>{c.name}</option>)}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Descrição</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 sm:table-cell\">Categoria</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">Responsável</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600 md:table-cell\">Data</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Status</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Valor</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : records.length === 0 ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhuma despesa encontrada</td></tr>\r\n                        ) : records.map(r => (\r\n                            <tr key={r.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                <td className=\"px-4 py-3\">\r\n                                    <p className=\"text-sm font-medium text-surface-900\">{r.description}</p>\r\n                                    {r.work_order && <p className=\"text-xs text-brand-500\">{r.work_order.number}</p>}\r\n                                </td>\r\n                                <td className=\"hidden px-4 py-3 sm:table-cell\">\r\n                                    {r.category ? (\r\n                                        <span className=\"inline-flex items-center gap-1.5 text-xs font-medium\">\r\n                                            <span className=\"h-2.5 w-2.5 rounded-full\" style={{ backgroundColor: r.category.color }} />\r\n                                            {r.category.name}\r\n                                        </span>\r\n                                    ) : '—'}\r\n                                </td>\r\n                                <td className=\"hidden px-4 py-3 text-sm text-surface-600 md:table-cell\">{r.creator.name}</td>\r\n                                <td className=\"hidden px-4 py-3 text-sm text-surface-500 md:table-cell\">{fmtDate(r.expense_date)}</td>\r\n                                <td className=\"px-4 py-3\"><Badge variant={statusConfig[r.status]?.variant}>{statusConfig[r.status]?.label}</Badge></td>\r\n                                <td className=\"px-4 py-3 text-right text-sm font-semibold text-surface-900\">{fmtBRL(r.amount)}</td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center justify-end gap-1\">\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => loadDetail(r)}><Eye className=\"h-4 w-4\" /></Button>\r\n                                        {r.status === 'pending' && (\r\n                                            <>\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => statusMut.mutate({ id: r.id, status: 'approved' })}>\r\n                                                    <CheckCircle className=\"h-4 w-4 text-sky-500\" />\r\n                                                </Button>\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => statusMut.mutate({ id: r.id, status: 'rejected' })}>\r\n                                                    <XCircle className=\"h-4 w-4 text-red-500\" />\r\n                                                </Button>\r\n                                            </>\r\n                                        )}\r\n                                        {r.status === 'approved' && (\r\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => statusMut.mutate({ id: r.id, status: 'reimbursed' })}>\r\n                                                <RefreshCw className=\"h-4 w-4 text-emerald-500\" />\r\n                                            </Button>\r\n                                        )}\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delMut.mutate(r.id) }}>\r\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Create Expense Modal */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title=\"Nova Despesa\" size=\"lg\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <Input label=\"Descrição\" value={form.description} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('description', e.target.value)} required />\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Categoria</label>\r\n                            <select value={form.expense_category_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('expense_category_id', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Sem categoria</option>\r\n                                {categories.map((c: any) => <option key={c.id} value={c.id}>{c.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Vinculada à OS</label>\r\n                            <select value={form.work_order_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('work_order_id', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Nenhuma</option>\r\n                                {(wosRes?.data?.data ?? []).map((wo: any) => <option key={wo.id} value={wo.id}>{wo.number} — {wo.customer?.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <Input label=\"Valor (R$)\" type=\"number\" step=\"0.01\" value={form.amount} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('amount', e.target.value)} required />\r\n                        <Input label=\"Data\" type=\"date\" value={form.expense_date} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('expense_date', e.target.value)} required />\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Forma Pgto</label>\r\n                            <select value={form.payment_method} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('payment_method', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Não definido</option>\r\n                                {Object.entries(paymentMethods).map(([k, v]) => <option key={k} value={k}>{v}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Observações</label>\r\n                        <textarea value={form.notes} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('notes', e.target.value)} rows={2}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Category Modal */}\r\n            <Modal open={showCatForm} onOpenChange={setShowCatForm} title=\"Nova Categoria de Despesa\">\r\n                <form onSubmit={e => { e.preventDefault(); saveCatMut.mutate(catForm) }} className=\"space-y-4\">\r\n                    <Input label=\"Nome\" value={catForm.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCatForm(p => ({ ...p, name: e.target.value }))} required />\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Cor</label>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <input type=\"color\" value={catForm.color} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCatForm(p => ({ ...p, color: e.target.value }))}\r\n                                className=\"h-10 w-14 cursor-pointer rounded-lg border border-surface-300\" />\r\n                            <span className=\"text-sm text-surface-500\">{catForm.color}</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowCatForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveCatMut.isPending}>Criar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Detail Modal */}\r\n            <Modal open={!!showDetail} onOpenChange={() => setShowDetail(null)} title=\"Detalhes da Despesa\" size=\"lg\">\r\n                {showDetail && (\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                            <div><span className=\"text-xs text-surface-500\">Descrição</span><p className=\"text-sm font-medium\">{showDetail.description}</p></div>\r\n                            <div>\r\n                                <span className=\"text-xs text-surface-500\">Categoria</span>\r\n                                {showDetail.category ? (\r\n                                    <p className=\"flex items-center gap-1.5 text-sm font-medium\">\r\n                                        <span className=\"h-2.5 w-2.5 rounded-full\" style={{ backgroundColor: showDetail.category.color }} />\r\n                                        {showDetail.category.name}\r\n                                    </p>\r\n                                ) : <p className=\"text-sm text-surface-400\">Sem categoria</p>}\r\n                            </div>\r\n                            <div><span className=\"text-xs text-surface-500\">Valor</span><p className=\"text-lg font-bold\">{fmtBRL(showDetail.amount)}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Status</span><Badge variant={statusConfig[showDetail.status]?.variant}>{statusConfig[showDetail.status]?.label}</Badge></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Responsável</span><p className=\"text-sm\">{showDetail.creator.name}</p></div>\r\n                            <div><span className=\"text-xs text-surface-500\">Data</span><p className=\"text-sm\">{fmtDate(showDetail.expense_date)}</p></div>\r\n                            {showDetail.approver && <div><span className=\"text-xs text-surface-500\">Aprovado por</span><p className=\"text-sm\">{showDetail.approver.name}</p></div>}\r\n                            {showDetail.work_order && <div><span className=\"text-xs text-surface-500\">OS</span><p className=\"text-sm text-brand-600 font-medium\">{showDetail.work_order.number}</p></div>}\r\n                            {showDetail.notes && <div className=\"col-span-2\"><span className=\"text-xs text-surface-500\">Obs</span><p className=\"text-sm text-surface-600\">{showDetail.notes}</p></div>}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\InvoicesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit' is defined but never used.","line":3,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":54,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Edit"},"fix":{"range":[160,166],"text":""},"desc":"Remove unused variable \"Edit\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[973,976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[973,976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7027,7030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7027,7030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":191,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":194,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10918,10921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10918,10921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12586,12589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12586,12589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { FileText, Plus, Search, X, Eye, Trash2, Edit } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nconst statusMap: Record<string, { label: string; variant: string }> = {\r\n    draft: { label: 'Rascunho', variant: 'default' },\r\n    issued: { label: 'Emitida', variant: 'info' },\r\n    paid: { label: 'Paga', variant: 'success' },\r\n    cancelled: { label: 'Cancelada', variant: 'danger' },\r\n}\r\n\r\ninterface Invoice {\r\n    id: number\r\n    invoice_number: string\r\n    customer?: { id: number; name: string }\r\n    work_order?: { id: number; number: string }\r\n    type: string\r\n    status: string\r\n    total: number\r\n    issued_at: string | null\r\n    due_date: string | null\r\n    notes: string | null\r\n    items: any[] | null\r\n    created_at: string\r\n}\r\n\r\nexport function InvoicesPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n    const [showModal, setShowModal] = useState(false)\r\n    const [detailInvoice, setDetailInvoice] = useState<Invoice | null>(null)\r\n    const [form, setForm] = useState({\r\n        customer_id: '',\r\n        work_order_id: '',\r\n        type: 'nf_servico',\r\n        notes: '',\r\n    })\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['invoices', search, statusFilter],\r\n        queryFn: () => api.get('/invoices', {\r\n            params: { search, status: statusFilter || undefined },\r\n        }),\r\n    })\r\n\r\n    const invoices: Invoice[] = res?.data?.data ?? res?.data ?? []\r\n\r\n    const createMut = useMutation({\r\n        mutationFn: (data: typeof form) => api.post('/invoices', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['invoices'] }); closeModal() },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/invoices/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['invoices'] }),\r\n    })\r\n\r\n    function closeModal() {\r\n        setShowModal(false)\r\n        setForm({ customer_id: '', work_order_id: '', type: 'nf_servico', notes: '' })\r\n    }\r\n\r\n    function handleSubmit(e: React.FormEvent) {\r\n        e.preventDefault()\r\n        createMut.mutate(form)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Faturamento / NF</h1>\r\n                <button\r\n                    onClick={() => setShowModal(true)}\r\n                    className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-brand-700 transition-colors\"\r\n                >\r\n                    <Plus size={16} /> Nova Fatura\r\n                </button>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap items-center gap-3\">\r\n                <div className=\"relative flex-1 min-w-[200px]\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-surface-400\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Buscar por nº ou cliente...\"\r\n                        value={search}\r\n                        onChange={e => setSearch(e.target.value)}\r\n                        className=\"w-full rounded-lg border border-surface-200 bg-white pl-10 pr-4 py-2.5 text-sm shadow-sm focus:border-brand-500 focus:ring-2 focus:ring-brand-100 outline-none\"\r\n                    />\r\n                </div>\r\n                <select\r\n                    value={statusFilter}\r\n                    onChange={e => setStatusFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-200 bg-white px-3 py-2.5 text-sm shadow-sm\"\r\n                >\r\n                    <option value=\"\">Todos os status</option>\r\n                    {Object.entries(statusMap).map(([k, v]) => (\r\n                        <option key={k} value={k}>{v.label}</option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm\">\r\n                        <thead className=\"bg-surface-50 text-surface-600\">\r\n                            <tr>\r\n                                <th className=\"px-4 py-3 text-left font-medium\">Nº NF</th>\r\n                                <th className=\"px-4 py-3 text-left font-medium\">Cliente</th>\r\n                                <th className=\"px-4 py-3 text-left font-medium\">OS</th>\r\n                                <th className=\"px-4 py-3 text-left font-medium\">Tipo</th>\r\n                                <th className=\"px-4 py-3 text-left font-medium\">Status</th>\r\n                                <th className=\"px-4 py-3 text-right font-medium\">Total</th>\r\n                                <th className=\"px-4 py-3 text-left font-medium\">Emissão</th>\r\n                                <th className=\"px-4 py-3 text-center font-medium\">Ações</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-surface-100\">\r\n                            {isLoading ? (\r\n                                <tr><td colSpan={8} className=\"px-4 py-8 text-center text-surface-400\">Carregando...</td></tr>\r\n                            ) : invoices.length === 0 ? (\r\n                                <tr><td colSpan={8} className=\"px-4 py-12 text-center text-surface-400\">\r\n                                    <FileText className=\"mx-auto h-8 w-8 mb-2 text-surface-300\" />\r\n                                    Nenhuma fatura encontrada\r\n                                </td></tr>\r\n                            ) : invoices.map(inv => (\r\n                                <tr key={inv.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 font-bold text-brand-600\">{inv.invoice_number}</td>\r\n                                    <td className=\"px-4 py-3 text-surface-700\">{inv.customer?.name ?? '—'}</td>\r\n                                    <td className=\"px-4 py-3 text-surface-500\">{inv.work_order?.number ?? '—'}</td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <span className=\"text-xs font-medium text-surface-600 uppercase\">{inv.type?.replace('_', ' ')}</span>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <Badge variant={(statusMap[inv.status]?.variant ?? 'default') as any}>\r\n                                            {statusMap[inv.status]?.label ?? inv.status}\r\n                                        </Badge>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-right font-semibold text-surface-900\">\r\n                                        {fmtBRL(parseFloat(String(inv.total ?? 0)))}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-surface-500\">\r\n                                        {inv.issued_at ? new Date(inv.issued_at).toLocaleDateString('pt-BR') : '—'}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <div className=\"flex items-center justify-center gap-1\">\r\n                                            <button\r\n                                                onClick={() => setDetailInvoice(inv)}\r\n                                                className=\"rounded p-1.5 text-surface-400 hover:bg-surface-100 hover:text-brand-600\"\r\n                                                title=\"Ver detalhes\"\r\n                                            >\r\n                                                <Eye size={16} />\r\n                                            </button>\r\n                                            {inv.status === 'draft' && (\r\n                                                <button\r\n                                                    onClick={() => { if (confirm('Excluir esta fatura?')) deleteMut.mutate(inv.id) }}\r\n                                                    className=\"rounded p-1.5 text-surface-400 hover:bg-red-50 hover:text-red-600\"\r\n                                                    title=\"Excluir\"\r\n                                                >\r\n                                                    <Trash2 size={16} />\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Detail Modal */}\r\n            {detailInvoice && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n                    <div className=\"w-full max-w-lg rounded-2xl bg-white p-6 shadow-2xl\">\r\n                        <div className=\"mb-4 flex items-center justify-between\">\r\n                            <h2 className=\"text-lg font-bold text-surface-900\">Fatura {detailInvoice.invoice_number}</h2>\r\n                            <button onClick={() => setDetailInvoice(null)} className=\"rounded-lg p-1.5 hover:bg-surface-100\">\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"space-y-3 text-sm\">\r\n                            <div className=\"flex justify-between\"><span className=\"text-surface-500\">Cliente:</span><span className=\"font-medium\">{detailInvoice.customer?.name ?? '—'}</span></div>\r\n                            <div className=\"flex justify-between\"><span className=\"text-surface-500\">OS:</span><span className=\"font-medium\">{detailInvoice.work_order?.number ?? '—'}</span></div>\r\n                            <div className=\"flex justify-between\"><span className=\"text-surface-500\">Tipo:</span><span className=\"font-medium uppercase\">{detailInvoice.type?.replace('_', ' ')}</span></div>\r\n                            <div className=\"flex justify-between\"><span className=\"text-surface-500\">Status:</span><Badge variant={(statusMap[detailInvoice.status]?.variant ?? 'default') as any}>{statusMap[detailInvoice.status]?.label ?? detailInvoice.status}</Badge></div>\r\n                            <div className=\"flex justify-between\"><span className=\"text-surface-500\">Total:</span><span className=\"font-bold text-lg\">{fmtBRL(parseFloat(String(detailInvoice.total ?? 0)))}</span></div>\r\n                            {detailInvoice.notes && (\r\n                                <div><span className=\"text-surface-500\">Observações:</span><p className=\"mt-1 text-surface-700\">{detailInvoice.notes}</p></div>\r\n                            )}\r\n                            {detailInvoice.items && detailInvoice.items.length > 0 && (\r\n                                <div>\r\n                                    <span className=\"text-surface-500 font-medium\">Itens:</span>\r\n                                    <div className=\"mt-2 rounded-lg border border-surface-200 overflow-hidden\">\r\n                                        <table className=\"w-full text-xs\">\r\n                                            <thead className=\"bg-surface-50\"><tr>\r\n                                                <th className=\"px-3 py-2 text-left\">Descrição</th>\r\n                                                <th className=\"px-3 py-2 text-right\">Qtd</th>\r\n                                                <th className=\"px-3 py-2 text-right\">Unit</th>\r\n                                                <th className=\"px-3 py-2 text-right\">Total</th>\r\n                                            </tr></thead>\r\n                                            <tbody className=\"divide-y divide-surface-100\">\r\n                                                {detailInvoice.items.map((it: any, idx: number) => (\r\n                                                    <tr key={idx}>\r\n                                                        <td className=\"px-3 py-2\">{it.description}</td>\r\n                                                        <td className=\"px-3 py-2 text-right\">{it.quantity}</td>\r\n                                                        <td className=\"px-3 py-2 text-right\">{fmtBRL(it.unit_price)}</td>\r\n                                                        <td className=\"px-3 py-2 text-right font-medium\">{fmtBRL(it.total)}</td>\r\n                                                    </tr>\r\n                                                ))}\r\n                                            </tbody>\r\n                                        </table>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Create Modal */}\r\n            {showModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n                    <div className=\"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\">\r\n                        <div className=\"mb-4 flex items-center justify-between\">\r\n                            <h2 className=\"text-lg font-bold text-surface-900\">Nova Fatura</h2>\r\n                            <button onClick={closeModal} className=\"rounded-lg p-1.5 hover:bg-surface-100\">\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-surface-700 mb-1\">ID do Cliente</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    required\r\n                                    value={form.customer_id}\r\n                                    onChange={e => setForm(p => ({ ...p, customer_id: e.target.value }))}\r\n                                    className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm focus:border-brand-500 focus:ring-2 focus:ring-brand-100 outline-none\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-surface-700 mb-1\">ID da OS (opcional)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={form.work_order_id}\r\n                                    onChange={e => setForm(p => ({ ...p, work_order_id: e.target.value }))}\r\n                                    className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm focus:border-brand-500 focus:ring-2 focus:ring-brand-100 outline-none\"\r\n                                    placeholder=\"Copiar itens da OS automaticamente\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-surface-700 mb-1\">Tipo</label>\r\n                                <select\r\n                                    value={form.type}\r\n                                    onChange={e => setForm(p => ({ ...p, type: e.target.value }))}\r\n                                    className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm\"\r\n                                >\r\n                                    <option value=\"nf_servico\">NF Serviço</option>\r\n                                    <option value=\"nf_produto\">NF Produto</option>\r\n                                    <option value=\"recibo\">Recibo</option>\r\n                                </select>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-surface-700 mb-1\">Observações</label>\r\n                                <textarea\r\n                                    value={form.notes}\r\n                                    onChange={e => setForm(p => ({ ...p, notes: e.target.value }))}\r\n                                    className=\"w-full rounded-lg border border-surface-200 px-3 py-2.5 text-sm focus:border-brand-500 focus:ring-2 focus:ring-brand-100 outline-none\"\r\n                                    rows={3}\r\n                                />\r\n                            </div>\r\n                            <div className=\"flex gap-3 justify-end pt-2\">\r\n                                <button type=\"button\" onClick={closeModal} className=\"rounded-lg border border-surface-200 px-4 py-2.5 text-sm hover:bg-surface-50\">\r\n                                    Cancelar\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={createMut.isPending}\r\n                                    className=\"rounded-lg bg-brand-600 px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-brand-700 disabled:opacity-50\"\r\n                                >\r\n                                    {createMut.isPending ? 'Criando...' : 'Criar Fatura'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\PaymentMethodsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\financeiro\\PaymentsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Search' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[93,100],"text":""},"desc":"Remove unused variable \"Search\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getTypeLabel' is assigned a value but never used.","line":63,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5509,5512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5509,5512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { Search, DollarSign, ArrowUpCircle, ArrowDownCircle, Calendar } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\ninterface Payment {\r\n    id: number; payable_type: string; payable_id: number\r\n    amount: string; payment_method: string | null; paid_at: string\r\n    notes: string | null; created_at: string\r\n}\r\n\r\ninterface PaymentSummary {\r\n    total_received: number; total_paid: number; net: number; count: number\r\n}\r\n\r\nexport function PaymentsPage() {\r\n    const [type, setType] = useState<string>('')\r\n    const [method, setMethod] = useState('')\r\n    const [dateFrom, setDateFrom] = useState('')\r\n    const [dateTo, setDateTo] = useState('')\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['payments', type, method, dateFrom, dateTo],\r\n        queryFn: () => api.get('/payments', {\r\n            params: {\r\n                type: type || undefined,\r\n                payment_method: method || undefined,\r\n                date_from: dateFrom || undefined,\r\n                date_to: dateTo || undefined,\r\n                per_page: 50,\r\n            },\r\n        }),\r\n    })\r\n    const payments: Payment[] = res?.data?.data ?? []\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['payments-summary', type, method, dateFrom, dateTo],\r\n        queryFn: () => api.get('/payments-summary', {\r\n            params: {\r\n                type: type || undefined,\r\n                payment_method: method || undefined,\r\n                date_from: dateFrom || undefined,\r\n                date_to: dateTo || undefined,\r\n            },\r\n        }),\r\n    })\r\n    const summary: PaymentSummary = summaryRes?.data ?? { total_received: 0, total_paid: 0, net: 0, count: 0 }\r\n\r\n    const { data: methodsRes } = useQuery({\r\n        queryKey: ['payment-methods'],\r\n        queryFn: () => api.get('/payment-methods'),\r\n    })\r\n    const methods = methodsRes?.data ?? []\r\n\r\n    const formatBRL = (v: number | string) => {\r\n        const n = typeof v === 'string' ? parseFloat(v) : v\r\n        return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n    }\r\n\r\n    const formatDate = (d: string) => new Date(d).toLocaleDateString('pt-BR')\r\n\r\n    const getTypeLabel = (t: string) => {\r\n        if (t.includes('AccountReceivable')) return 'Recebimento'\r\n        if (t.includes('AccountPayable')) return 'Pagamento'\r\n        return t.split('\\\\').pop() ?? t\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Pagamentos</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Histórico consolidado de todos os pagamentos</p>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-sm text-surface-500\"><DollarSign className=\"h-4 w-4\" /> Movimentações</div>\r\n                    <p className=\"mt-1 text-2xl font-bold text-surface-900\">{summary.count}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-sm text-emerald-600\"><ArrowDownCircle className=\"h-4 w-4\" /> Recebido</div>\r\n                    <p className=\"mt-1 text-2xl font-bold text-emerald-700\">{formatBRL(summary.total_received)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-sm text-red-600\"><ArrowUpCircle className=\"h-4 w-4\" /> Pago</div>\r\n                    <p className=\"mt-1 text-2xl font-bold text-red-700\">{formatBRL(summary.total_paid)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-sm text-surface-500\"><DollarSign className=\"h-4 w-4\" /> Saldo</div>\r\n                    <p className={`mt-1 text-2xl font-bold ${summary.net >= 0 ? 'text-emerald-700' : 'text-red-700'}`}>\r\n                        {formatBRL(summary.net)}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <select value={type} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setType(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                    <option value=\"\">Todos os tipos</option>\r\n                    <option value=\"receivable\">Recebimentos</option>\r\n                    <option value=\"payable\">Pagamentos</option>\r\n                </select>\r\n                <select value={method} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setMethod(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                    <option value=\"\">Todos os métodos</option>\r\n                    {methods.map((m: any) => <option key={m.id} value={m.name}>{m.name}</option>)}\r\n                </select>\r\n                <div className=\"flex items-center gap-1.5\">\r\n                    <Calendar className=\"h-4 w-4 text-surface-400\" />\r\n                    <input type=\"date\" value={dateFrom} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDateFrom(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    <span className=\"text-surface-400\">—</span>\r\n                    <input type=\"date\" value={dateTo} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDateTo(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Data</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Tipo</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 md:table-cell\">Método</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Valor</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 lg:table-cell\">Observações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : payments.length === 0 ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum pagamento encontrado</td></tr>\r\n                        ) : payments.map(p => {\r\n                            const isReceivable = p.payable_type.includes('AccountReceivable')\r\n                            return (\r\n                                <tr key={p.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-700\">{formatDate(p.paid_at)}</td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <Badge variant={isReceivable ? 'success' : 'danger'}>\r\n                                            {isReceivable ? '↓ Recebimento' : '↑ Pagamento'}\r\n                                        </Badge>\r\n                                    </td>\r\n                                    <td className=\"hidden px-4 py-3 text-sm text-surface-600 md:table-cell\">\r\n                                        {p.payment_method || '—'}\r\n                                    </td>\r\n                                    <td className={`px-4 py-3 text-right text-sm font-semibold ${isReceivable ? 'text-emerald-700' : 'text-red-700'}`}>\r\n                                        {isReceivable ? '+' : '-'}{formatBRL(p.amount)}\r\n                                    </td>\r\n                                    <td className=\"hidden max-w-xs truncate px-4 py-3 text-sm text-surface-500 lg:table-cell\">\r\n                                        {p.notes || '—'}\r\n                                    </td>\r\n                                </tr>\r\n                            )\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\iam\\PermissionsMatrixPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[128,160],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3291,3294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3291,3294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4044,4047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4044,4047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\r\nimport { Check, X, Shield } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nexport function PermissionsMatrixPage() {\r\n    const { data: matrixData, isLoading } = useQuery({\r\n        queryKey: ['permissions-matrix'],\r\n        queryFn: () => api.get('/permissions/matrix'),\r\n    })\r\n\r\n    const matrix = matrixData?.data?.matrix ?? []\r\n    const roleNames: string[] = matrixData?.data?.roles ?? []\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center py-20 text-sm text-surface-500\">\r\n                Carregando matriz de permissões...\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Matriz de Permissões</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">\r\n                    Visualização de todas as permissões atribuídas a cada role\r\n                </p>\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            <div className=\"flex items-center gap-4 text-xs text-surface-500\">\r\n                <span className=\"flex items-center gap-1.5\">\r\n                    <span className=\"h-4 w-4 rounded bg-emerald-100 flex items-center justify-center\">\r\n                        <Check className=\"h-3 w-3 text-emerald-600\" />\r\n                    </span>\r\n                    Concedida\r\n                </span>\r\n                <span className=\"flex items-center gap-1.5\">\r\n                    <span className=\"h-4 w-4 rounded bg-surface-100 flex items-center justify-center\">\r\n                        <X className=\"h-3 w-3 text-surface-400\" />\r\n                    </span>\r\n                    Negada\r\n                </span>\r\n                <span className=\"flex items-center gap-1.5\">\r\n                    <Badge variant=\"danger\">HIGH</Badge> Criticidade alta\r\n                </span>\r\n            </div>\r\n\r\n            {/* Matrix Table */}\r\n            <div className=\"overflow-x-auto rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full min-w-[800px]\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"sticky left-0 z-10 bg-surface-50 px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 min-w-[240px]\">\r\n                                Permissão\r\n                            </th>\r\n                            {roleNames.map(role => (\r\n                                <th key={role} className=\"px-3 py-3 text-center text-xs font-semibold uppercase tracking-wider text-surface-600 min-w-[100px]\">\r\n                                    <div className=\"flex items-center justify-center gap-1.5\">\r\n                                        <Shield className=\"h-3 w-3\" />\r\n                                        {role}\r\n                                    </div>\r\n                                </th>\r\n                            ))}\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {matrix.map((group: any, gi: number) => (\r\n                            <>\r\n                                {/* Group header */}\r\n                                <tr key={`g-${gi}`} className=\"bg-surface-50/50\">\r\n                                    <td\r\n                                        colSpan={roleNames.length + 1}\r\n                                        className=\"sticky left-0 z-10 bg-surface-50/50 px-4 py-2 text-xs font-bold uppercase tracking-wider text-brand-700\"\r\n                                    >\r\n                                        {group.group}\r\n                                    </td>\r\n                                </tr>\r\n                                {/* Permissions */}\r\n                                {group.permissions.map((perm: any) => (\r\n                                    <tr key={perm.id} className=\"border-t border-surface-100 hover:bg-surface-50/50 transition-colors\">\r\n                                        <td className=\"sticky left-0 z-10 bg-white px-4 py-2\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <span className=\"text-sm text-surface-700\">\r\n                                                    {perm.name.split('.').slice(1).join('.')}\r\n                                                </span>\r\n                                                {perm.criticality === 'HIGH' && (\r\n                                                    <Badge variant=\"danger\" className=\"text-[10px]\">HIGH</Badge>\r\n                                                )}\r\n                                            </div>\r\n                                        </td>\r\n                                        {roleNames.map((role) => (\r\n                                            <td key={role} className=\"px-3 py-2 text-center\">\r\n                                                {perm.roles[role] ? (\r\n                                                    <span className=\"inline-flex h-6 w-6 items-center justify-center rounded-md bg-emerald-100\">\r\n                                                        <Check className=\"h-3.5 w-3.5 text-emerald-600\" />\r\n                                                    </span>\r\n                                                ) : (\r\n                                                    <span className=\"inline-flex h-6 w-6 items-center justify-center rounded-md bg-surface-100\">\r\n                                                        <X className=\"h-3.5 w-3.5 text-surface-400\" />\r\n                                                    </span>\r\n                                                )}\r\n                                            </td>\r\n                                        ))}\r\n                                    </tr>\r\n                                ))}\r\n                            </>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\iam\\RolesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Badge' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[332,377],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2291,2294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2291,2294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7065,7068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7065,7068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7868,7871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7868,7871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8188,8191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8188,8191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Plus, Shield, Users, Trash2 } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\ninterface Role {\r\n    id: number\r\n    name: string\r\n    permissions_count: number\r\n    users_count: number\r\n    permissions?: { id: number; name: string }[]\r\n}\r\n\r\nexport function RolesPage() {\r\n    const queryClient = useQueryClient()\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editingRole, setEditingRole] = useState<Role | null>(null)\r\n    const [roleName, setRoleName] = useState('')\r\n    const [selectedPermissions, setSelectedPermissions] = useState<number[]>([])\r\n\r\n    const { data: rolesData, isLoading } = useQuery({\r\n        queryKey: ['roles'],\r\n        queryFn: () => api.get('/roles'),\r\n    })\r\n\r\n    const { data: permissionsData } = useQuery({\r\n        queryKey: ['permissions'],\r\n        queryFn: () => api.get('/permissions'),\r\n    })\r\n\r\n    const roles: Role[] = rolesData?.data ?? []\r\n    const permissionGroups = permissionsData?.data ?? []\r\n\r\n    const saveMutation = useMutation({\r\n        mutationFn: (data: { name: string; permissions: number[] }) =>\r\n            editingRole\r\n                ? api.put(`/roles/${editingRole.id}`, data)\r\n                : api.post('/roles', data),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['roles'] })\r\n            setShowForm(false)\r\n        },\r\n    })\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/roles/${id}`),\r\n        onSuccess: () => queryClient.invalidateQueries({ queryKey: ['roles'] }),\r\n    })\r\n\r\n    const openCreate = () => {\r\n        setEditingRole(null)\r\n        setRoleName('')\r\n        setSelectedPermissions([])\r\n        setShowForm(true)\r\n    }\r\n\r\n    const openEdit = async (role: Role) => {\r\n        const { data } = await api.get(`/roles/${role.id}`)\r\n        setEditingRole(data)\r\n        setRoleName(data.name)\r\n        setSelectedPermissions(data.permissions?.map((p: any) => p.id) ?? [])\r\n        setShowForm(true)\r\n    }\r\n\r\n    const togglePermission = (id: number) => {\r\n        setSelectedPermissions(prev =>\r\n            prev.includes(id) ? prev.filter(p => p !== id) : [...prev, id]\r\n        )\r\n    }\r\n\r\n    const toggleGroup = (groupPerms: { id: number }[]) => {\r\n        const ids = groupPerms.map(p => p.id)\r\n        const allSelected = ids.every(id => selectedPermissions.includes(id))\r\n        setSelectedPermissions(prev =>\r\n            allSelected ? prev.filter(id => !ids.includes(id)) : [...new Set([...prev, ...ids])]\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Roles</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Gerencie os perfis de acesso</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={openCreate}>Nova Role</Button>\r\n            </div>\r\n\r\n            {/* Roles Grid */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n                {isLoading ? (\r\n                    <p className=\"col-span-full text-center text-sm text-surface-500 py-12\">Carregando...</p>\r\n                ) : roles.map((role) => (\r\n                    <div\r\n                        key={role.id}\r\n                        className=\"group rounded-xl border border-surface-200 bg-white p-5 shadow-card hover:shadow-elevated transition-all duration-200\"\r\n                    >\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"rounded-lg bg-brand-50 p-2.5\">\r\n                                    <Shield className=\"h-5 w-5 text-brand-600\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"font-semibold text-surface-900\">{role.name}</h3>\r\n                                    <div className=\"mt-1 flex gap-3 text-xs text-surface-500\">\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            <Users className=\"h-3 w-3\" /> {role.users_count} usuários\r\n                                        </span>\r\n                                        <span>{role.permissions_count} permissões</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 flex items-center gap-2\">\r\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => openEdit(role)} className=\"flex-1\">\r\n                                Editar\r\n                            </Button>\r\n                            {!['super_admin', 'admin'].includes(role.name) && (\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    onClick={() => { if (confirm('Excluir esta role?')) deleteMutation.mutate(role.id) }}\r\n                                >\r\n                                    <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Modal Form */}\r\n            <Modal\r\n                open={showForm}\r\n                onOpenChange={setShowForm}\r\n                title={editingRole ? `Editar: ${editingRole.name}` : 'Nova Role'}\r\n                size=\"xl\"\r\n            >\r\n                <form\r\n                    onSubmit={(e) => { e.preventDefault(); saveMutation.mutate({ name: roleName, permissions: selectedPermissions }) }}\r\n                    className=\"space-y-4\"\r\n                >\r\n                    <Input\r\n                        label=\"Nome da Role\"\r\n                        value={roleName}\r\n                        onChange={(e) => setRoleName(e.target.value)}\r\n                        placeholder=\"ex: supervisor\"\r\n                        required\r\n                        disabled={editingRole?.name === 'super_admin'}\r\n                    />\r\n\r\n                    {/* Permission groups */}\r\n                    <div>\r\n                        <label className=\"mb-3 block text-sm font-semibold text-surface-900\">Permissões</label>\r\n                        <div className=\"max-h-96 overflow-y-auto space-y-4 rounded-lg border border-surface-200 p-4\">\r\n                            {permissionGroups.map((group: any) => (\r\n                                <div key={group.id}>\r\n                                    <div className=\"flex items-center justify-between mb-2\">\r\n                                        <h4 className=\"text-xs font-semibold uppercase tracking-wider text-surface-600\">\r\n                                            {group.name}\r\n                                        </h4>\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => toggleGroup(group.permissions)}\r\n                                            className=\"text-xs text-brand-600 hover:text-brand-700\"\r\n                                        >\r\n                                            {group.permissions.every((p: any) => selectedPermissions.includes(p.id)) ? 'Desmarcar' : 'Marcar'} todos\r\n                                        </button>\r\n                                    </div>\r\n                                    <div className=\"flex flex-wrap gap-1.5\">\r\n                                        {group.permissions.map((perm: any) => (\r\n                                            <button\r\n                                                key={perm.id}\r\n                                                type=\"button\"\r\n                                                onClick={() => togglePermission(perm.id)}\r\n                                                className={cn(\r\n                                                    'rounded-md border px-2.5 py-1 text-xs font-medium transition-all',\r\n                                                    selectedPermissions.includes(perm.id)\r\n                                                        ? 'border-brand-400 bg-brand-50 text-brand-700'\r\n                                                        : 'border-surface-200 bg-white text-surface-500 hover:border-surface-300'\r\n                                                )}\r\n                                            >\r\n                                                {perm.name.split('.').slice(1).join('.')}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <p className=\"mt-2 text-xs text-surface-500\">\r\n                            {selectedPermissions.length} permissões selecionadas\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-end gap-3 border-t border-surface-200 pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMutation.isPending}>\r\n                            {editingRole ? 'Salvar' : 'Criar Role'}\r\n                        </Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\iam\\UsersPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MoreHorizontal' is defined but never used.","line":3,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MoreHorizontal"},"fix":{"range":[134,150],"text":""},"desc":"Remove unused variable \"MoreHorizontal\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'KeyRound' is defined but never used.","line":3,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":66,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"KeyRound"},"fix":{"range":[168,178],"text":""},"desc":"Remove unused variable \"KeyRound\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2119,2122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2119,2122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":261,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12225,12228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12225,12228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Search, Plus, MoreHorizontal, UserCheck, UserX, KeyRound, Trash2 } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\ninterface User {\r\n    id: number\r\n    name: string\r\n    email: string\r\n    phone: string | null\r\n    is_active: boolean\r\n    roles: { id: number; name: string }[]\r\n    created_at: string\r\n}\r\n\r\ninterface UserFormData {\r\n    name: string\r\n    email: string\r\n    phone: string\r\n    password: string\r\n    roles: number[]\r\n    is_active: boolean\r\n}\r\n\r\nexport function UsersPage() {\r\n    const queryClient = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editingUser, setEditingUser] = useState<User | null>(null)\r\n    const [formData, setFormData] = useState<UserFormData>({\r\n        name: '', email: '', phone: '', password: '', roles: [], is_active: true,\r\n    })\r\n    const [formErrors, setFormErrors] = useState<Record<string, string>>({})\r\n\r\n    // Queries\r\n    const { data: usersResponse, isLoading } = useQuery({\r\n        queryKey: ['users', search],\r\n        queryFn: () => api.get('/users', { params: { search, per_page: 50 } }),\r\n    })\r\n\r\n    const { data: rolesResponse } = useQuery({\r\n        queryKey: ['roles'],\r\n        queryFn: () => api.get('/roles'),\r\n    })\r\n\r\n    const users: User[] = usersResponse?.data?.data ?? []\r\n    const roles = rolesResponse?.data ?? []\r\n\r\n    // Mutations\r\n    const saveMutation = useMutation({\r\n        mutationFn: (data: UserFormData) =>\r\n            editingUser\r\n                ? api.put(`/users/${editingUser.id}`, data)\r\n                : api.post('/users', data),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['users'] })\r\n            closeForm()\r\n        },\r\n        onError: (err: any) => {\r\n            setFormErrors(err.response?.data?.errors ?? {})\r\n        },\r\n    })\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/users/${id}`),\r\n        onSuccess: () => queryClient.invalidateQueries({ queryKey: ['users'] }),\r\n    })\r\n\r\n    const toggleMutation = useMutation({\r\n        mutationFn: (id: number) => api.post(`/users/${id}/toggle-active`),\r\n        onSuccess: () => queryClient.invalidateQueries({ queryKey: ['users'] }),\r\n    })\r\n\r\n    const openCreate = () => {\r\n        setEditingUser(null)\r\n        setFormData({ name: '', email: '', phone: '', password: '', roles: [], is_active: true })\r\n        setFormErrors({})\r\n        setShowForm(true)\r\n    }\r\n\r\n    const openEdit = (user: User) => {\r\n        setEditingUser(user)\r\n        setFormData({\r\n            name: user.name,\r\n            email: user.email,\r\n            phone: user.phone ?? '',\r\n            password: '',\r\n            roles: user.roles.map(r => r.id),\r\n            is_active: user.is_active,\r\n        })\r\n        setFormErrors({})\r\n        setShowForm(true)\r\n    }\r\n\r\n    const closeForm = () => {\r\n        setShowForm(false)\r\n        setEditingUser(null)\r\n    }\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        saveMutation.mutate(formData)\r\n    }\r\n\r\n    const toggleRole = (roleId: number) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            roles: prev.roles.includes(roleId)\r\n                ? prev.roles.filter(r => r !== roleId)\r\n                : [...prev.roles, roleId],\r\n        }))\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Usuários</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Gerencie os usuários do sistema</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={openCreate}>\r\n                    Novo Usuário\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"max-w-sm\">\r\n                <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        value={search}\r\n                        onChange={(e) => setSearch(e.target.value)}\r\n                        placeholder=\"Buscar por nome ou email...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Nome</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">E-mail</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Roles</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Status</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : users.length === 0 ? (\r\n                            <tr><td colSpan={5} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum usuário encontrado</td></tr>\r\n                        ) : users.map((user) => (\r\n                            <tr key={user.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"flex h-9 w-9 items-center justify-center rounded-full bg-brand-100 text-brand-700 text-sm font-bold\">\r\n                                            {user.name.charAt(0).toUpperCase()}\r\n                                        </div>\r\n                                        <div>\r\n                                            <p className=\"text-sm font-medium text-surface-900\">{user.name}</p>\r\n                                            <p className=\"text-xs text-surface-500\">{user.phone ?? '—'}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-4 py-3 text-sm text-surface-600\">{user.email}</td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex flex-wrap gap-1\">\r\n                                        {user.roles.map(role => (\r\n                                            <Badge key={role.id} variant=\"brand\">{role.name}</Badge>\r\n                                        ))}\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <Badge variant={user.is_active ? 'success' : 'danger'} dot>\r\n                                        {user.is_active ? 'Ativo' : 'Inativo'}\r\n                                    </Badge>\r\n                                </td>\r\n                                <td className=\"px-4 py-3\">\r\n                                    <div className=\"flex items-center justify-end gap-1\">\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => openEdit(user)}>\r\n                                            Editar\r\n                                        </Button>\r\n                                        <Button\r\n                                            variant=\"ghost\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => toggleMutation.mutate(user.id)}\r\n                                            title={user.is_active ? 'Desativar' : 'Ativar'}\r\n                                        >\r\n                                            {user.is_active ? <UserX className=\"h-4 w-4 text-red-500\" /> : <UserCheck className=\"h-4 w-4 text-emerald-500\" />}\r\n                                        </Button>\r\n                                        <Button\r\n                                            variant=\"ghost\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => { if (confirm('Excluir este usuário?')) deleteMutation.mutate(user.id) }}\r\n                                        >\r\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Modal Form */}\r\n            <Modal\r\n                open={showForm}\r\n                onOpenChange={setShowForm}\r\n                title={editingUser ? 'Editar Usuário' : 'Novo Usuário'}\r\n                size=\"lg\"\r\n            >\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input\r\n                            label=\"Nome\"\r\n                            value={formData.name}\r\n                            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\r\n                            error={formErrors.name}\r\n                            required\r\n                        />\r\n                        <Input\r\n                            label=\"E-mail\"\r\n                            type=\"email\"\r\n                            value={formData.email}\r\n                            onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\r\n                            error={formErrors.email}\r\n                            required\r\n                        />\r\n                        <Input\r\n                            label=\"Telefone\"\r\n                            value={formData.phone}\r\n                            onChange={(e) => setFormData(prev => ({ ...prev, phone: e.target.value }))}\r\n                            placeholder=\"(00) 00000-0000\"\r\n                        />\r\n                        <Input\r\n                            label={editingUser ? 'Nova Senha (deixe vazio para manter)' : 'Senha'}\r\n                            type=\"password\"\r\n                            value={formData.password}\r\n                            onChange={(e) => setFormData(prev => ({ ...prev, password: e.target.value }))}\r\n                            error={formErrors.password}\r\n                            required={!editingUser}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Roles */}\r\n                    <div>\r\n                        <label className=\"mb-2 block text-sm font-medium text-surface-700\">Roles</label>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {roles.map((role: any) => (\r\n                                <button\r\n                                    key={role.id}\r\n                                    type=\"button\"\r\n                                    onClick={() => toggleRole(role.id)}\r\n                                    className={cn(\r\n                                        'rounded-full border px-3 py-1.5 text-xs font-medium transition-all',\r\n                                        formData.roles.includes(role.id)\r\n                                            ? 'border-brand-500 bg-brand-50 text-brand-700'\r\n                                            : 'border-surface-300 bg-white text-surface-600 hover:border-surface-400'\r\n                                    )}\r\n                                >\r\n                                    {role.name}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-end gap-3 border-t border-surface-200 pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={closeForm}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button type=\"submit\" loading={saveMutation.isPending}>\r\n                            {editingUser ? 'Salvar' : 'Criar Usuário'}\r\n                        </Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\importacao\\ImportPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Download' is defined but never used.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Download"},"fix":{"range":[240,255],"text":""},"desc":"Remove unused variable \"Download\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2042,2045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2042,2045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5157,5160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5157,5160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7199,7202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7199,7202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13961,13964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13961,13964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":325,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14478,14481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14478,14481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27932,27935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27932,27935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback } from 'react'\r\nimport { useMutation, useQuery } from '@tanstack/react-query'\r\nimport {\r\n    Upload, FileSpreadsheet, ArrowRight, ArrowLeft, Check,\r\n    AlertCircle, CheckCircle2, AlertTriangle, Loader2,\r\n    Download, History, Save, X\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\ntype Entity = 'customers' | 'products' | 'services' | 'equipments'\r\ntype Step = 0 | 1 | 2 | 3\r\ntype DuplicateStrategy = 'skip' | 'update' | 'create'\r\n\r\ninterface FieldDef {\r\n    key: string\r\n    label: string\r\n    required: boolean\r\n}\r\n\r\ninterface UploadResult {\r\n    file_path: string\r\n    file_name: string\r\n    encoding: string\r\n    separator: string\r\n    headers: string[]\r\n    total_rows: number\r\n    entity_type: string\r\n    available_fields: FieldDef[]\r\n}\r\n\r\ninterface PreviewRow {\r\n    line: number\r\n    data: Record<string, string>\r\n    status: 'valid' | 'warning' | 'error'\r\n    messages: string[]\r\n}\r\n\r\nconst entities: { key: Entity; label: string }[] = [\r\n    { key: 'customers', label: 'Clientes' },\r\n    { key: 'products', label: 'Produtos' },\r\n    { key: 'services', label: 'Serviços' },\r\n    { key: 'equipments', label: 'Equipamentos' },\r\n]\r\n\r\nconst stepLabels = ['Upload', 'Mapeamento', 'Validação', 'Resultado']\r\nconst strategyLabels: Record<DuplicateStrategy, string> = {\r\n    skip: 'Pular duplicatas',\r\n    update: 'Atualizar existentes',\r\n    create: 'Criar novo mesmo assim',\r\n}\r\n\r\nexport default function ImportPage() {\r\n    const [step, setStep] = useState<Step>(0)\r\n    const [entity, setEntity] = useState<Entity>('customers')\r\n    const [uploadData, setUploadData] = useState<UploadResult | null>(null)\r\n    const [mapping, setMapping] = useState<Record<string, string>>({})\r\n    const [previewRows, setPreviewRows] = useState<PreviewRow[]>([])\r\n    const [previewStats, setPreviewStats] = useState({ valid: 0, warnings: 0, errors: 0 })\r\n    const [strategy, setStrategy] = useState<DuplicateStrategy>('skip')\r\n    const [result, setResult] = useState<any>(null)\r\n    const [showHistory, setShowHistory] = useState(false)\r\n\r\n    // Templates\r\n    const { data: templates } = useQuery({\r\n        queryKey: ['import-templates', entity],\r\n        queryFn: () => api.get(`/import/templates?entity_type=${entity}`).then(r => r.data.templates),\r\n    })\r\n\r\n    // Histórico\r\n    const { data: history } = useQuery({\r\n        queryKey: ['import-history'],\r\n        queryFn: () => api.get('/import/history').then(r => r.data.data),\r\n        enabled: showHistory,\r\n    })\r\n\r\n    // Upload\r\n    const uploadMutation = useMutation({\r\n        mutationFn: async (file: File) => {\r\n            const fd = new FormData()\r\n            fd.append('file', file)\r\n            fd.append('entity_type', entity)\r\n            return api.post('/import/upload', fd, {\r\n                headers: { 'Content-Type': 'multipart/form-data' },\r\n            }).then(r => r.data as UploadResult)\r\n        },\r\n        onSuccess: (data) => {\r\n            setUploadData(data)\r\n            // Auto-map por nome similar\r\n            const autoMap: Record<string, string> = {}\r\n            data.available_fields.forEach(f => {\r\n                const match = data.headers.find(h =>\r\n                    h.toLowerCase().includes(f.key.toLowerCase()) ||\r\n                    f.label.toLowerCase().includes(h.toLowerCase()) ||\r\n                    h.toLowerCase().includes(f.label.toLowerCase())\r\n                )\r\n                if (match) autoMap[f.key] = match\r\n            })\r\n            setMapping(autoMap)\r\n            setStep(1)\r\n        },\r\n    })\r\n\r\n    // Preview\r\n    const previewMutation = useMutation({\r\n        mutationFn: () => api.post('/import/preview', {\r\n            file_path: uploadData?.file_path,\r\n            entity_type: entity,\r\n            mapping,\r\n            separator: uploadData?.separator,\r\n        }).then(r => r.data),\r\n        onSuccess: (data) => {\r\n            setPreviewRows(data.rows)\r\n            setPreviewStats(data.stats)\r\n            setStep(2)\r\n        },\r\n    })\r\n\r\n    // Execute\r\n    const executeMutation = useMutation({\r\n        mutationFn: () => api.post('/import/execute', {\r\n            file_path: uploadData?.file_path,\r\n            entity_type: entity,\r\n            mapping,\r\n            separator: uploadData?.separator,\r\n            duplicate_strategy: strategy,\r\n        }).then(r => r.data),\r\n        onSuccess: (data) => {\r\n            setResult(data)\r\n            setStep(3)\r\n        },\r\n    })\r\n\r\n    // Save template\r\n    const saveTemplateMutation = useMutation({\r\n        mutationFn: (name: string) => api.post('/import/templates', {\r\n            entity_type: entity,\r\n            name,\r\n            mapping,\r\n        }),\r\n    })\r\n\r\n    const handleDrop = useCallback((e: React.DragEvent) => {\n        e.preventDefault()\n        const file = e.dataTransfer.files[0]\n        if (file) uploadMutation.mutate(file)\n    }, [uploadMutation])\n\r\n    const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0]\r\n        if (file) uploadMutation.mutate(file)\r\n    }\r\n\r\n    const applyTemplate = (t: any) => {\r\n        setMapping(t.mapping)\r\n    }\r\n\r\n    const reset = () => {\r\n        setStep(0)\r\n        setUploadData(null)\r\n        setMapping({})\r\n        setPreviewRows([])\r\n        setResult(null)\r\n    }\r\n\r\n    const mappedCount = Object.values(mapping).filter(Boolean).length\r\n    const requiredFields = uploadData?.available_fields.filter(f => f.required) ?? []\r\n    const requiredMapped = requiredFields.every(f => mapping[f.key])\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Importação de Dados</h1>\r\n                    <p className=\"text-sm text-surface-500\">\r\n                        Importe clientes, produtos, serviços e equipamentos via CSV\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={() => setShowHistory(!showHistory)}\r\n                    className=\"flex items-center gap-2 rounded-lg border border-surface-200 bg-white px-4 py-2 text-sm font-medium hover:bg-surface-50\"\r\n                >\r\n                    <History size={16} />\r\n                    Histórico\r\n                </button>\r\n            </div>\r\n\r\n            {/* Histórico */}\r\n            {showHistory && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <div className=\"mb-3 flex items-center justify-between\">\r\n                        <h3 className=\"font-semibold text-surface-900\">Histórico de Importações</h3>\r\n                        <button onClick={() => setShowHistory(false)}><X size={16} /></button>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        {(history ?? []).length === 0 && (\r\n                            <p className=\"text-sm text-surface-500\">Nenhuma importação realizada</p>\r\n                        )}\r\n                        {(history ?? []).map((h: any) => (\r\n                            <div key={h.id} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3 text-sm\">\r\n                                <div>\r\n                                    <span className=\"font-medium\">{h.file_name}</span>\r\n                                    <span className=\"ml-2 text-surface-500\">{h.entity_type}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-emerald-600\">+{h.inserted}</span>\r\n                                    <span className=\"text-blue-600\">↻{h.updated}</span>\r\n                                    <span className=\"text-surface-400\">⊘{h.skipped}</span>\r\n                                    {h.errors > 0 && <span className=\"text-red-600\">✕{h.errors}</span>}\r\n                                    <span className=\"text-surface-400 text-xs\">\r\n                                        {new Date(h.created_at).toLocaleDateString('pt-BR')}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Stepper */}\r\n            <div className=\"flex items-center justify-center gap-2\">\r\n                {stepLabels.map((label, i) => (\r\n                    <div key={label} className=\"flex items-center gap-2\">\r\n                        <div className={cn(\r\n                            'flex h-8 w-8 items-center justify-center rounded-full text-sm font-bold transition-colors',\r\n                            i <= step ? 'bg-brand-600 text-white' : 'bg-surface-200 text-surface-500'\r\n                        )}>\r\n                            {i < step ? <Check size={16} /> : i + 1}\r\n                        </div>\r\n                        <span className={cn(\r\n                            'text-sm font-medium',\r\n                            i <= step ? 'text-surface-900' : 'text-surface-400'\r\n                        )}>{label}</span>\r\n                        {i < 3 && <ArrowRight size={16} className=\"text-surface-300 mx-1\" />}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Step 0: Upload */}\r\n            {step === 0 && (\r\n                <div className=\"space-y-4\">\r\n                    {/* Seletor de entidade */}\r\n                    <div className=\"grid grid-cols-4 gap-3\">\r\n                        {entities.map(e => (\r\n                            <button\r\n                                key={e.key}\r\n                                onClick={() => setEntity(e.key)}\r\n                                className={cn(\r\n                                    'rounded-xl border-2 p-4 text-center font-medium transition-all',\r\n                                    entity === e.key\r\n                                        ? 'border-brand-500 bg-brand-50 text-brand-700'\r\n                                        : 'border-surface-200 bg-white text-surface-600 hover:border-surface-300'\r\n                                )}\r\n                            >\r\n                                {e.label}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Área de drop */}\r\n                    <div\r\n                        onDragOver={e => e.preventDefault()}\r\n                        onDrop={handleDrop}\r\n                        className=\"flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-surface-300 bg-surface-50 p-12 transition-colors hover:border-brand-400 hover:bg-brand-50/30\"\r\n                    >\r\n                        {uploadMutation.isPending ? (\r\n                            <Loader2 size={48} className=\"animate-spin text-brand-500\" />\r\n                        ) : (\r\n                            <>\r\n                                <Upload size={48} className=\"mb-4 text-surface-400\" />\r\n                                <p className=\"mb-2 text-lg font-medium text-surface-700\">\r\n                                    Arraste um arquivo CSV ou XLSX aqui\r\n                                </p>\r\n                                <p className=\"mb-4 text-sm text-surface-500\">\r\n                                    ou clique para selecionar\r\n                                </p>\r\n                                <label className=\"cursor-pointer rounded-lg bg-brand-600 px-6 py-2.5 text-sm font-medium text-white hover:bg-brand-700\">\r\n                                    Selecionar Arquivo\r\n                                    <input\r\n                                        type=\"file\"\r\n                                        accept=\".csv,.txt,.xlsx\"\r\n                                        onChange={handleFileSelect}\r\n                                        className=\"hidden\"\r\n                                    />\r\n                                </label>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n\r\n                    {uploadMutation.isError && (\r\n                        <div className=\"rounded-lg bg-red-50 p-3 text-sm text-red-700\">\r\n                            <AlertCircle size={16} className=\"mr-1 inline\" />\r\n                            Erro ao processar arquivo. Verifique o formato.\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Step 1: Mapeamento */}\r\n            {step === 1 && uploadData && (\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <div className=\"mb-4 flex items-center justify-between\">\r\n                            <div>\r\n                                <h3 className=\"font-semibold text-surface-900\">\r\n                                    <FileSpreadsheet size={18} className=\"mr-2 inline text-brand-500\" />\r\n                                    {uploadData.file_name}\r\n                                </h3>\r\n                                <p className=\"text-sm text-surface-500\">\r\n                                    {uploadData.total_rows} linhas • Encoding: {uploadData.encoding} • Separador: {uploadData.separator === 'tab' ? 'TAB' : uploadData.separator}\r\n                                </p>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                                {(templates ?? []).length > 0 && (\r\n                                    <select\r\n                                        onChange={(e: React.ChangeEvent<HTMLSelectElement>) => {\r\n                                            const t = templates?.find((t: any) => t.id === +e.target.value)\r\n                                            if (t) applyTemplate(t)\r\n                                        }}\r\n                                        className=\"rounded-lg border border-surface-200 px-3 py-1.5 text-sm\"\r\n                                        defaultValue=\"\"\r\n                                    >\r\n                                        <option value=\"\" disabled>Aplicar template...</option>\r\n                                        {(templates ?? []).map((t: any) => (\r\n                                            <option key={t.id} value={t.id}>{t.name}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            {uploadData.available_fields.map(field => (\r\n                                <div key={field.key} className=\"flex items-center gap-4\">\r\n                                    <div className=\"w-52\">\r\n                                        <span className=\"text-sm font-medium\">{field.label}</span>\r\n                                        {field.required && (\r\n                                            <span className=\"ml-1 text-xs text-red-500\">*</span>\r\n                                        )}\r\n                                    </div>\r\n                                    <ArrowLeft size={16} className=\"text-surface-400\" />\r\n                                    <select\r\n                                        value={mapping[field.key] || ''}\r\n                                        onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setMapping(prev => ({\r\n                                            ...prev,\r\n                                            [field.key]: e.target.value,\r\n                                        }))}\r\n                                        className={cn(\r\n                                            'flex-1 rounded-lg border px-3 py-2 text-sm',\r\n                                            field.required && !mapping[field.key]\r\n                                                ? 'border-red-300 bg-red-50'\r\n                                                : 'border-surface-200 bg-white'\r\n                                        )}\r\n                                    >\r\n                                        <option value=\"\">— Não importar —</option>\r\n                                        {uploadData.headers.map(h => (\r\n                                            <option key={h} value={h}>{h}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 flex items-center justify-between border-t border-surface-100 pt-4\">\r\n                            <span className=\"text-sm text-surface-500\">\r\n                                {mappedCount} de {uploadData.available_fields.length} campos mapeados\r\n                            </span>\r\n                            <div className=\"flex gap-2\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        const name = prompt('Nome do template:')\r\n                                        if (name) saveTemplateMutation.mutate(name)\r\n                                    }}\r\n                                    className=\"flex items-center gap-1 rounded-lg border border-surface-200 px-3 py-1.5 text-sm hover:bg-surface-50\"\r\n                                >\r\n                                    <Save size={14} />\r\n                                    Salvar Template\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Estratégia de duplicatas */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <h4 className=\"mb-3 text-sm font-semibold text-surface-700\">Duplicatas encontradas</h4>\r\n                        <div className=\"flex gap-3\">\r\n                            {(Object.entries(strategyLabels) as [DuplicateStrategy, string][]).map(([key, label]) => (\r\n                                <label key={key} className={cn(\r\n                                    'flex cursor-pointer items-center gap-2 rounded-lg border-2 px-4 py-2.5 text-sm transition-all',\r\n                                    strategy === key\r\n                                        ? 'border-brand-500 bg-brand-50'\r\n                                        : 'border-surface-200'\r\n                                )}>\r\n                                    <input\r\n                                        type=\"radio\"\r\n                                        name=\"strategy\"\r\n                                        checked={strategy === key}\r\n                                        onChange={() => setStrategy(key)}\r\n                                        className=\"accent-brand-600\"\r\n                                    />\r\n                                    {label}\r\n                                </label>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between\">\r\n                        <button onClick={reset} className=\"rounded-lg border border-surface-200 px-4 py-2 text-sm hover:bg-surface-50\">\r\n                            ← Voltar\r\n                        </button>\r\n                        <button\r\n                            onClick={() => previewMutation.mutate()}\r\n                            disabled={!requiredMapped || previewMutation.isPending}\r\n                            className=\"flex items-center gap-2 rounded-lg bg-brand-600 px-6 py-2.5 text-sm font-medium text-white hover:bg-brand-700 disabled:opacity-50\"\r\n                        >\r\n                            {previewMutation.isPending ? <Loader2 size={16} className=\"animate-spin\" /> : <ArrowRight size={16} />}\r\n                            Validar Preview\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Step 2: Preview */}\r\n            {step === 2 && (\r\n                <div className=\"space-y-4\">\r\n                    {/* Stats */}\r\n                    <div className=\"grid grid-cols-3 gap-3\">\r\n                        <div className=\"rounded-xl border border-emerald-200 bg-emerald-50 p-4 text-center\">\r\n                            <CheckCircle2 size={20} className=\"mx-auto mb-1 text-emerald-600\" />\r\n                            <p className=\"text-2xl font-bold text-emerald-700\">{previewStats.valid}</p>\r\n                            <p className=\"text-xs text-emerald-600\">Válidas</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-amber-200 bg-amber-50 p-4 text-center\">\r\n                            <AlertTriangle size={20} className=\"mx-auto mb-1 text-amber-600\" />\r\n                            <p className=\"text-2xl font-bold text-amber-700\">{previewStats.warnings}</p>\r\n                            <p className=\"text-xs text-amber-600\">Duplicatas</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-red-200 bg-red-50 p-4 text-center\">\r\n                            <AlertCircle size={20} className=\"mx-auto mb-1 text-red-600\" />\r\n                            <p className=\"text-2xl font-bold text-red-700\">{previewStats.errors}</p>\r\n                            <p className=\"text-xs text-red-600\">Erros</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Tabela preview */}\r\n                    <div className=\"overflow-auto rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                        <table className=\"w-full text-sm\">\r\n                            <thead>\r\n                                <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                    <th className=\"px-3 py-2 text-left font-semibold text-surface-600\">Linha</th>\r\n                                    <th className=\"px-3 py-2 text-left font-semibold text-surface-600\">Status</th>\r\n                                    {Object.keys(mapping).filter(k => mapping[k]).map(k => (\r\n                                        <th key={k} className=\"px-3 py-2 text-left font-semibold text-surface-600\">{k}</th>\r\n                                    ))}\r\n                                    <th className=\"px-3 py-2 text-left font-semibold text-surface-600\">Mensagens</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-surface-100\">\r\n                                {previewRows.map(row => (\r\n                                    <tr key={row.line} className={cn(\r\n                                        'transition-colors',\r\n                                        row.status === 'error' && 'bg-red-50/50',\r\n                                        row.status === 'warning' && 'bg-amber-50/50',\r\n                                    )}>\r\n                                        <td className=\"px-3 py-2 text-surface-500\">{row.line}</td>\r\n                                        <td className=\"px-3 py-2\">\r\n                                            {row.status === 'valid' && <CheckCircle2 size={16} className=\"text-emerald-500\" />}\r\n                                            {row.status === 'warning' && <AlertTriangle size={16} className=\"text-amber-500\" />}\r\n                                            {row.status === 'error' && <AlertCircle size={16} className=\"text-red-500\" />}\r\n                                        </td>\r\n                                        {Object.keys(mapping).filter(k => mapping[k]).map(k => (\r\n                                            <td key={k} className=\"max-w-[200px] truncate px-3 py-2\">\r\n                                                {row.data[k] || '—'}\r\n                                            </td>\r\n                                        ))}\r\n                                        <td className=\"px-3 py-2 text-xs text-surface-500\">\r\n                                            {row.messages.join('; ')}\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between\">\r\n                        <button onClick={() => setStep(1)} className=\"rounded-lg border border-surface-200 px-4 py-2 text-sm hover:bg-surface-50\">\r\n                            ← Ajustar Mapeamento\r\n                        </button>\r\n                        <button\r\n                            onClick={() => executeMutation.mutate()}\r\n                            disabled={executeMutation.isPending}\r\n                            className=\"flex items-center gap-2 rounded-lg bg-emerald-600 px-6 py-2.5 text-sm font-medium text-white hover:bg-emerald-700 disabled:opacity-50\"\r\n                        >\r\n                            {executeMutation.isPending ? <Loader2 size={16} className=\"animate-spin\" /> : <Check size={16} />}\r\n                            Importar {uploadData?.total_rows} linhas\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Step 3: Resultado */}\r\n            {step === 3 && result && (\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"rounded-xl border border-emerald-200 bg-emerald-50 p-8 text-center\">\r\n                        <CheckCircle2 size={48} className=\"mx-auto mb-3 text-emerald-500\" />\r\n                        <h2 className=\"text-xl font-bold text-emerald-800\">Importação Concluída!</h2>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-4 gap-3\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 text-center shadow-card\">\r\n                            <p className=\"text-3xl font-bold text-surface-900\">{result.total_rows}</p>\r\n                            <p className=\"text-xs text-surface-500\">Total</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 text-center shadow-card\">\r\n                            <p className=\"text-3xl font-bold text-emerald-600\">{result.inserted}</p>\r\n                            <p className=\"text-xs text-surface-500\">Inseridos</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 text-center shadow-card\">\r\n                            <p className=\"text-3xl font-bold text-blue-600\">{result.updated}</p>\r\n                            <p className=\"text-xs text-surface-500\">Atualizados</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 text-center shadow-card\">\r\n                            <p className=\"text-3xl font-bold text-red-600\">{result.errors}</p>\r\n                            <p className=\"text-xs text-surface-500\">Erros</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {result.error_log?.length > 0 && (\r\n                        <div className=\"rounded-xl border border-red-200 bg-red-50 p-5\">\r\n                            <h3 className=\"mb-3 font-semibold text-red-800\">Erros encontrados</h3>\r\n                            <div className=\"max-h-60 space-y-1 overflow-auto text-sm\">\r\n                                {result.error_log.map((e: any, i: number) => (\r\n                                    <div key={i} className=\"rounded bg-white p-2\">\r\n                                        <span className=\"font-medium text-red-700\">Linha {e.line}:</span>{' '}\r\n                                        <span className=\"text-surface-700\">{e.message}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex justify-center\">\r\n                        <button onClick={reset} className=\"rounded-lg bg-brand-600 px-6 py-2.5 text-sm font-medium text-white hover:bg-brand-700\">\r\n                            Nova Importação\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\notificacoes\\NotificationsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash2' is defined but never used.","line":3,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":41,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Trash2"},"fix":{"range":[145,153],"text":""},"desc":"Remove unused variable \"Trash2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FileText' is defined but never used.","line":3,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":72,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[174,184],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[431,434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[431,434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Bell, Check, CheckCheck, Trash2, AlertTriangle, Info, FileText, DollarSign, Wrench } from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport api from '@/lib/api'\r\n\r\ninterface Notification {\r\n    id: number\r\n    type: string\r\n    title: string\r\n    message: string\r\n    read_at: string | null\r\n    data: any\r\n    created_at: string\r\n}\r\n\r\nconst typeIcons: Record<string, React.ElementType> = {\r\n    work_order: Wrench,\r\n    financial: DollarSign,\r\n    alert: AlertTriangle,\r\n    info: Info,\r\n    default: Bell,\r\n}\r\n\r\nconst typeColors: Record<string, string> = {\r\n    work_order: 'text-blue-600 bg-blue-50',\r\n    financial: 'text-emerald-600 bg-emerald-50',\r\n    alert: 'text-red-600 bg-red-50',\r\n    info: 'text-sky-600 bg-sky-50',\r\n    default: 'text-surface-600 bg-surface-100',\r\n}\r\n\r\nexport function NotificationsPage() {\r\n    const qc = useQueryClient()\r\n    const [filter, setFilter] = useState<string>('')\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['notifications-full'],\r\n        queryFn: () => api.get('/notifications?limit=100'),\r\n    })\r\n    const allNotifications: Notification[] = res?.data?.notifications ?? []\r\n    const unreadCount: number = res?.data?.unread_count ?? 0\r\n\r\n    const notifications = filter\r\n        ? allNotifications.filter(n => n.type === filter)\r\n        : allNotifications\r\n\r\n    const markReadMut = useMutation({\r\n        mutationFn: (id: number) => api.patch(`/notifications/${id}/read`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['notifications-full'] }),\r\n    })\r\n\r\n    const markAllMut = useMutation({\r\n        mutationFn: () => api.post('/notifications/read-all'),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['notifications-full'] }),\r\n    })\r\n\r\n    const fmtDate = (d: string) => {\r\n        const dt = new Date(d)\r\n        const now = new Date()\r\n        const diff = now.getTime() - dt.getTime()\r\n        if (diff < 60000) return 'agora'\r\n        if (diff < 3600000) return `${Math.floor(diff / 60000)}min`\r\n        if (diff < 86400000) return `${Math.floor(diff / 3600000)}h`\r\n        return dt.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })\r\n    }\r\n\r\n    const filterTypes = [\r\n        { key: '', label: 'Todos', count: allNotifications.length },\r\n        { key: 'work_order', label: 'OS', count: allNotifications.filter(n => n.type === 'work_order').length },\r\n        { key: 'financial', label: 'Financeiro', count: allNotifications.filter(n => n.type === 'financial').length },\r\n        { key: 'alert', label: 'Alertas', count: allNotifications.filter(n => n.type === 'alert').length },\r\n        { key: 'info', label: 'Info', count: allNotifications.filter(n => n.type === 'info').length },\r\n    ].filter(f => f.key === '' || f.count > 0)\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Notificações</h1>\r\n                    <p className=\"text-sm text-surface-500 mt-1\">\r\n                        {unreadCount > 0 ? `${unreadCount} não lida${unreadCount > 1 ? 's' : ''}` : 'Todas lidas'}\r\n                    </p>\r\n                </div>\r\n                {unreadCount > 0 && (\r\n                    <button\r\n                        onClick={() => markAllMut.mutate()}\r\n                        disabled={markAllMut.isPending}\r\n                        className=\"inline-flex items-center gap-2 rounded-lg border border-surface-300 px-4 py-2 text-sm font-medium text-surface-700 hover:bg-surface-50 transition-colors\"\r\n                    >\r\n                        <CheckCheck className=\"h-4 w-4\" /> Marcar todas como lidas\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Filter pills */}\r\n            <div className=\"flex flex-wrap gap-2\">\r\n                {filterTypes.map(f => (\r\n                    <button\r\n                        key={f.key}\r\n                        onClick={() => setFilter(f.key)}\r\n                        className={cn(\r\n                            'inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-medium transition-all',\r\n                            filter === f.key\r\n                                ? 'bg-brand-600 text-white shadow-sm'\r\n                                : 'bg-surface-100 text-surface-600 hover:bg-surface-200'\r\n                        )}\r\n                    >\r\n                        {f.label}\r\n                        <span className={cn(\r\n                            'rounded-full px-1.5 py-0.5 text-[10px] font-bold',\r\n                            filter === f.key ? 'bg-white/20' : 'bg-surface-200'\r\n                        )}>{f.count}</span>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden divide-y divide-surface-100\">\r\n                {isLoading ? (\r\n                    <div className=\"p-12 text-center text-surface-400\">Carregando...</div>\r\n                ) : notifications.length === 0 ? (\r\n                    <div className=\"p-12 text-center text-surface-400\">\r\n                        <Bell className=\"h-10 w-10 mx-auto mb-3 text-surface-300\" />\r\n                        Nenhuma notificação encontrada.\r\n                    </div>\r\n                ) : (\r\n                    notifications.map(n => {\r\n                        const Icon = typeIcons[n.type] ?? typeIcons.default\r\n                        const color = typeColors[n.type] ?? typeColors.default\r\n                        const isUnread = !n.read_at\r\n\r\n                        return (\r\n                            <div\r\n                                key={n.id}\r\n                                className={cn(\r\n                                    'flex items-start gap-4 px-5 py-4 transition-colors',\r\n                                    isUnread ? 'bg-brand-50/30' : 'hover:bg-surface-50',\r\n                                )}\r\n                            >\r\n                                <div className={cn('rounded-lg p-2 flex-shrink-0', color)}>\r\n                                    <Icon className=\"h-4 w-4\" />\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <p className={cn('text-sm', isUnread ? 'font-semibold text-surface-900' : 'text-surface-700')}>\r\n                                            {n.title}\r\n                                        </p>\r\n                                        {isUnread && <span className=\"h-2 w-2 rounded-full bg-brand-500 flex-shrink-0\" />}\r\n                                    </div>\r\n                                    <p className=\"text-sm text-surface-500 mt-0.5 line-clamp-2\">{n.message}</p>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2 flex-shrink-0\">\r\n                                    <span className=\"text-xs text-surface-400\">{fmtDate(n.created_at)}</span>\r\n                                    {isUnread && (\r\n                                        <button\r\n                                            onClick={() => markReadMut.mutate(n.id)}\r\n                                            className=\"text-brand-600 hover:text-brand-700 p-1 rounded\"\r\n                                            title=\"Marcar como lida\"\r\n                                        >\r\n                                            <Check className=\"h-4 w-4\" />\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\orcamentos\\QuoteCreatePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Plus' is defined but never used.","line":5,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plus"},"fix":{"range":[187,193],"text":""},"desc":"Remove unused variable \"Plus\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2721,2724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2721,2724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3345,3348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3345,3348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7347,7350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7347,7350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8199,8202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8199,8202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8328,8331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8328,8331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9392,9395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9392,9395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":131,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":134,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11463,11466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11463,11466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":202,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11831,11834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11831,11834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":131,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":134,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12103,12106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12103,12106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":207,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12471,12474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12471,12474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport { useQuery, useMutation } from '@tanstack/react-query'\r\nimport {\r\n    ArrowLeft, ArrowRight, Plus, Trash2, Search, Package, Wrench, Save,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\ntype Step = 'customer' | 'equipments' | 'review'\r\n\r\ninterface EquipmentBlock {\r\n    equipment_id: number; equipmentName: string; description: string\r\n    items: ItemRow[]\r\n}\r\ninterface ItemRow {\r\n    type: 'product' | 'service'; product_id?: number; service_id?: number\r\n    name: string; quantity: number; original_price: number; unit_price: number; discount_percentage: number\r\n}\r\n\r\nexport function QuoteCreatePage() {\r\n    const navigate = useNavigate()\r\n    const [step, setStep] = useState<Step>('customer')\r\n    const [customerId, setCustomerId] = useState<number | null>(null)\r\n    const [customerSearch, setCustomerSearch] = useState('')\r\n    const [validUntil, setValidUntil] = useState('')\r\n    const [discountPercentage, setDiscountPercentage] = useState(0)\r\n    const [observations, setObservations] = useState('')\r\n    const [blocks, setBlocks] = useState<EquipmentBlock[]>([])\r\n\r\n    // Lookups\r\n    const { data: customersRes } = useQuery({\r\n        queryKey: ['customers-search', customerSearch],\r\n        queryFn: () => api.get('/customers', { params: { search: customerSearch, per_page: 10 } }),\r\n        enabled: customerSearch.length > 1,\r\n    })\r\n    const customers = customersRes?.data?.data ?? []\r\n\r\n    const { data: equipmentsRes } = useQuery({\r\n        queryKey: ['equipments-for-customer', customerId],\r\n        queryFn: () => api.get(`/customers/${customerId}`),\r\n        enabled: !!customerId,\r\n    })\r\n    const customerEquipments = equipmentsRes?.data?.equipments ?? []\r\n\r\n    const { data: productsRes } = useQuery({\r\n        queryKey: ['products-all'],\r\n        queryFn: () => api.get('/products', { params: { per_page: 200 } }),\r\n    })\r\n    const products = productsRes?.data?.data ?? []\r\n\r\n    const { data: servicesRes } = useQuery({\r\n        queryKey: ['services-all'],\r\n        queryFn: () => api.get('/services', { params: { per_page: 200 } }),\r\n    })\r\n    const services = servicesRes?.data?.data ?? []\r\n\r\n    const addBlock = (eqId: number, eqName: string) => {\r\n        if (blocks.find(b => b.equipment_id === eqId)) return\r\n        setBlocks(p => [...p, { equipment_id: eqId, equipmentName: eqName, description: '', items: [] }])\r\n    }\r\n\r\n    const removeBlock = (idx: number) => setBlocks(p => p.filter((_, i) => i !== idx))\r\n\r\n    const updateBlock = (idx: number, field: string, value: any) =>\r\n        setBlocks(p => p.map((b, i) => i === idx ? { ...b, [field]: value } : b))\r\n\r\n    const addItem = (blockIdx: number, type: 'product' | 'service', id: number, name: string, price: number) => {\r\n        setBlocks(p => p.map((b, i) => i === blockIdx ? {\r\n            ...b, items: [...b.items, {\r\n                type, ...(type === 'product' ? { product_id: id } : { service_id: id }),\r\n                name, quantity: 1, original_price: price, unit_price: price, discount_percentage: 0,\r\n            }]\r\n        } : b))\r\n    }\r\n\r\n    const updateItem = (blockIdx: number, itemIdx: number, field: string, value: any) =>\r\n        setBlocks(p => p.map((b, bi) => bi === blockIdx ? {\r\n            ...b, items: b.items.map((it, ii) => ii === itemIdx ? { ...it, [field]: value } : it)\r\n        } : b))\r\n\r\n    const removeItem = (blockIdx: number, itemIdx: number) =>\r\n        setBlocks(p => p.map((b, bi) => bi === blockIdx ? { ...b, items: b.items.filter((_, ii) => ii !== itemIdx) } : b))\r\n\r\n    const subtotal = blocks.reduce((acc, b) => acc + b.items.reduce((a, it) => {\r\n        const price = it.unit_price * (1 - it.discount_percentage / 100)\r\n        return a + price * it.quantity\r\n    }, 0), 0)\r\n    const discountAmount = discountPercentage > 0 ? subtotal * (discountPercentage / 100) : 0\r\n    const total = subtotal - discountAmount\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: () => api.post('/quotes', {\r\n            customer_id: customerId,\r\n            seller_id: 1, // TODO: current user\r\n            valid_until: validUntil || null,\r\n            discount_percentage: discountPercentage,\r\n            observations,\r\n            equipments: blocks.map(b => ({\r\n                equipment_id: b.equipment_id,\r\n                description: b.description,\r\n                items: b.items.map(it => ({\r\n                    type: it.type, product_id: it.product_id, service_id: it.service_id,\r\n                    quantity: it.quantity, original_price: it.original_price,\r\n                    unit_price: it.unit_price, discount_percentage: it.discount_percentage,\r\n                })),\r\n            })),\r\n        }),\r\n        onSuccess: () => navigate('/orcamentos'),\r\n    })\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center gap-3\">\r\n                <button onClick={() => navigate('/orcamentos')} className=\"rounded-lg p-1.5 text-surface-500 hover:bg-surface-100\">\r\n                    <ArrowLeft className=\"h-5 w-5\" />\r\n                </button>\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Novo Orçamento</h1>\r\n                    <p className=\"text-sm text-surface-500\">Preencha as informações do orçamento</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Steps indicator */}\r\n            <div className=\"flex gap-2\">\r\n                {(['customer', 'equipments', 'review'] as const).map((s, i) => (\r\n                    <button key={s} onClick={() => setStep(s)}\r\n                        className={`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${step === s ? 'bg-brand-500 text-white shadow' : 'bg-surface-100 text-surface-600 hover:bg-surface-200'}`}>\r\n                        <span className=\"flex h-5 w-5 items-center justify-center rounded-full bg-white/20 text-xs font-bold\">{i + 1}</span>\r\n                        {s === 'customer' ? 'Cliente' : s === 'equipments' ? 'Equipamentos e Itens' : 'Revisão'}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Step 1: Customer */}\r\n            {step === 'customer' && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card space-y-4\">\r\n                    <h3 className=\"text-lg font-semibold text-surface-900\">Selecionar Cliente</h3>\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                        <input value={customerSearch} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCustomerSearch(e.target.value)}\r\n                            placeholder=\"Pesquisar cliente por nome, CPF/CNPJ...\"\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-3 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    {customers.length > 0 && (\r\n                        <div className=\"space-y-2\">\r\n                            {customers.map((c: any) => (\r\n                                <button key={c.id} onClick={() => { setCustomerId(c.id); setCustomerSearch(c.name) }}\r\n                                    className={`w-full rounded-lg border p-3 text-left transition-all ${customerId === c.id ? 'border-brand-500 bg-brand-50 ring-2 ring-brand-500/20' : 'border-surface-200 hover:border-surface-300'}`}>\r\n                                    <p className=\"font-medium text-surface-900\">{c.name}</p>\r\n                                    <p className=\"text-xs text-surface-500\">{c.document} • {c.email}</p>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <Input label=\"Validade\" type=\"date\" value={validUntil} onChange={(e: any) => setValidUntil(e.target.value)} />\r\n                        <Input label=\"Observações\" value={observations} onChange={(e: any) => setObservations(e.target.value)} />\r\n                    </div>\r\n                    <div className=\"flex justify-end\">\r\n                        <Button icon={<ArrowRight className=\"h-4 w-4\" />} onClick={() => setStep('equipments')} disabled={!customerId}>Próximo</Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Step 2: Equipments + Items */}\r\n            {step === 'equipments' && (\r\n                <div className=\"space-y-4\">\r\n                    {/* Equipment selector */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <h3 className=\"mb-3 text-lg font-semibold text-surface-900\">Equipamentos do Cliente</h3>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {customerEquipments.length === 0 ? (\r\n                                <p className=\"text-sm text-surface-500\">Nenhum equipamento cadastrado para este cliente</p>\r\n                            ) : customerEquipments.map((eq: any) => (\r\n                                <button key={eq.id} onClick={() => addBlock(eq.id, eq.name || `${eq.brand} ${eq.model}`)}\r\n                                    className={`rounded-lg border px-3 py-2 text-sm transition-all ${blocks.find(b => b.equipment_id === eq.id) ? 'border-brand-500 bg-brand-50 text-brand-700' : 'border-surface-200 hover:border-brand-300'}`}>\r\n                                    {eq.name || `${eq.brand} ${eq.model}`} {eq.serial_number && `(${eq.serial_number})`}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Blocks per equipment */}\r\n                    {blocks.map((block, bi) => (\r\n                        <div key={bi} className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden\">\r\n                            <div className=\"flex items-center justify-between border-b border-surface-200 bg-surface-50 px-5 py-3\">\r\n                                <h4 className=\"font-semibold text-surface-900\">{block.equipmentName}</h4>\r\n                                <button onClick={() => removeBlock(bi)} className=\"text-red-500 hover:text-red-700\"><Trash2 className=\"h-4 w-4\" /></button>\r\n                            </div>\r\n                            <div className=\"p-5 space-y-4\">\r\n                                <textarea value={block.description} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => updateBlock(bi, 'description', e.target.value)}\r\n                                    placeholder=\"Descrição do que será feito neste equipamento...\"\r\n                                    className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2 text-sm focus:border-brand-500 focus:outline-none resize-none\" rows={2} />\r\n\r\n                                {/* Add item buttons */}\r\n                                <div className=\"flex gap-2\">\r\n                                    <select onChange={(e: React.ChangeEvent<HTMLSelectElement>) => { const p = products.find((pr: any) => pr.id === +e.target.value); if (p) addItem(bi, 'product', p.id, p.name, +p.price); e.target.value = '' }}\r\n                                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm\">\r\n                                        <option value=\"\">+ Produto</option>\r\n                                        {products.map((p: any) => <option key={p.id} value={p.id}>{p.name} — R$ {Number(p.price).toFixed(2)}</option>)}\r\n                                    </select>\r\n                                    <select onChange={(e: React.ChangeEvent<HTMLSelectElement>) => { const s = services.find((sv: any) => sv.id === +e.target.value); if (s) addItem(bi, 'service', s.id, s.name, +s.price); e.target.value = '' }}\r\n                                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm\">\r\n                                        <option value=\"\">+ Serviço</option>\r\n                                        {services.map((s: any) => <option key={s.id} value={s.id}>{s.name} — R$ {Number(s.price).toFixed(2)}</option>)}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                {/* Items table */}\r\n                                {block.items.length > 0 && (\r\n                                    <table className=\"w-full text-sm\">\r\n                                        <thead>\r\n                                            <tr className=\"border-b text-left text-xs text-surface-500\">\r\n                                                <th className=\"pb-2\">Tipo</th><th className=\"pb-2\">Item</th><th className=\"pb-2 w-20\">Qtd</th>\r\n                                                <th className=\"pb-2 w-28\">Preço Unit.</th><th className=\"pb-2 w-20\">Desc %</th>\r\n                                                <th className=\"pb-2 w-28 text-right\">Subtotal</th><th className=\"pb-2 w-8\"></th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-surface-100\">\r\n                                            {block.items.map((it, ii) => {\r\n                                                const price = it.unit_price * (1 - it.discount_percentage / 100)\r\n                                                const sub = price * it.quantity\r\n                                                return (\r\n                                                    <tr key={ii}>\r\n                                                        <td className=\"py-2\">\r\n                                                            {it.type === 'product' ? <Package className=\"h-4 w-4 text-blue-500\" /> : <Wrench className=\"h-4 w-4 text-emerald-500\" />}\r\n                                                        </td>\r\n                                                        <td className=\"py-2 font-medium\">{it.name}</td>\r\n                                                        <td className=\"py-2\"><input type=\"number\" value={it.quantity} min={0.01} step={0.01} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(bi, ii, 'quantity', +e.target.value)}\r\n                                                            className=\"w-full rounded border border-surface-300 px-2 py-1 text-sm\" /></td>\r\n                                                        <td className=\"py-2\"><input type=\"number\" value={it.unit_price} min={0} step={0.01} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(bi, ii, 'unit_price', +e.target.value)}\r\n                                                            className=\"w-full rounded border border-surface-300 px-2 py-1 text-sm\" /></td>\r\n                                                        <td className=\"py-2\"><input type=\"number\" value={it.discount_percentage} min={0} max={100} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(bi, ii, 'discount_percentage', +e.target.value)}\r\n                                                            className=\"w-full rounded border border-surface-300 px-2 py-1 text-sm\" /></td>\r\n                                                        <td className=\"py-2 text-right font-semibold\">{sub.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>\r\n                                                        <td className=\"py-2\"><button onClick={() => removeItem(bi, ii)} className=\"text-red-400 hover:text-red-600\"><Trash2 className=\"h-3.5 w-3.5\" /></button></td>\r\n                                                    </tr>\r\n                                                )\r\n                                            })}\r\n                                        </tbody>\r\n                                    </table>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n\r\n                    <div className=\"flex justify-between\">\r\n                        <Button variant=\"outline\" onClick={() => setStep('customer')}>Voltar</Button>\r\n                        <Button icon={<ArrowRight className=\"h-4 w-4\" />} onClick={() => setStep('review')} disabled={blocks.length === 0}>Revisão</Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Step 3: Review */}\r\n            {step === 'review' && (\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card space-y-4\">\r\n                        <h3 className=\"text-lg font-semibold text-surface-900\">Resumo do Orçamento</h3>\r\n                        <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                            <div><span className=\"text-surface-500\">Cliente:</span> <span className=\"font-medium\">{customerSearch}</span></div>\r\n                            <div><span className=\"text-surface-500\">Validade:</span> <span className=\"font-medium\">{validUntil || 'Não definida'}</span></div>\r\n                            <div><span className=\"text-surface-500\">Equipamentos:</span> <span className=\"font-medium\">{blocks.length}</span></div>\r\n                            <div><span className=\"text-surface-500\">Total de itens:</span> <span className=\"font-medium\">{blocks.reduce((a, b) => a + b.items.length, 0)}</span></div>\r\n                        </div>\r\n\r\n                        {/* Discount */}\r\n                        <div className=\"flex items-center gap-4 border-t border-surface-200 pt-4\">\r\n                            <label className=\"text-sm text-surface-600\">Desconto global (%)</label>\r\n                            <input type=\"number\" value={discountPercentage} min={0} max={100} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDiscountPercentage(+e.target.value)}\r\n                                className=\"w-24 rounded-lg border border-surface-300 px-3 py-1.5 text-sm\" />\r\n                        </div>\r\n\r\n                        {/* Totals */}\r\n                        <div className=\"rounded-lg bg-surface-50 p-4 space-y-2\">\r\n                            <div className=\"flex justify-between text-sm\"><span className=\"text-surface-500\">Subtotal</span>\r\n                                <span className=\"font-medium\">{subtotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span></div>\r\n                            {discountAmount > 0 && (\r\n                                <div className=\"flex justify-between text-sm\"><span className=\"text-red-500\">Desconto ({discountPercentage}%)</span>\r\n                                    <span className=\"font-medium text-red-500\">-{discountAmount.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span></div>\r\n                            )}\r\n                            <div className=\"flex justify-between border-t border-surface-200 pt-2 text-lg font-bold\">\r\n                                <span>Total</span>\r\n                                <span className=\"text-brand-700\">{total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between\">\r\n                        <Button variant=\"outline\" onClick={() => setStep('equipments')}>Voltar</Button>\r\n                        <Button icon={<Save className=\"h-4 w-4\" />} onClick={() => saveMut.mutate()} loading={saveMut.isPending}>Salvar Orçamento</Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\orcamentos\\QuoteDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":5,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":23,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[239,249],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[506,509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[506,509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7974,7977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7974,7977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9191,9194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9191,9194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useParams, useNavigate } from 'react-router-dom'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    ArrowLeft, Send, CheckCircle, XCircle, Copy, ArrowRight, Package, Wrench,\r\n    FileText, Calendar, User, DollarSign, MessageSquare, Download,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any }> = {\r\n    draft: { label: 'Rascunho', variant: 'default' },\r\n    sent: { label: 'Enviado', variant: 'info' },\r\n    approved: { label: 'Aprovado', variant: 'success' },\r\n    rejected: { label: 'Rejeitado', variant: 'danger' },\r\n    expired: { label: 'Expirado', variant: 'warning' },\r\n    invoiced: { label: 'Faturado', variant: 'info' },\r\n}\r\n\r\nexport function QuoteDetailPage() {\r\n    const { id } = useParams()\r\n    const navigate = useNavigate()\r\n    const qc = useQueryClient()\r\n\r\n    const { data: quoteRes, isLoading } = useQuery({\r\n        queryKey: ['quote', id],\r\n        queryFn: () => api.get(`/quotes/${id}`),\r\n        enabled: !!id,\r\n    })\r\n    const quote = quoteRes?.data\r\n\r\n    const sendMut = useMutation({ mutationFn: () => api.post(`/quotes/${id}/send`), onSuccess: () => qc.invalidateQueries({ queryKey: ['quote', id] }) })\r\n    const approveMut = useMutation({ mutationFn: () => api.post(`/quotes/${id}/approve`), onSuccess: () => qc.invalidateQueries({ queryKey: ['quote', id] }) })\r\n    const rejectMut = useMutation({ mutationFn: () => api.post(`/quotes/${id}/reject`), onSuccess: () => qc.invalidateQueries({ queryKey: ['quote', id] }) })\r\n    const duplicateMut = useMutation({\r\n        mutationFn: () => api.post(`/quotes/${id}/duplicate`),\r\n        onSuccess: (res) => navigate(`/orcamentos/${res.data.id}`),\r\n    })\r\n    const convertMut = useMutation({\r\n        mutationFn: () => api.post(`/quotes/${id}/convert-to-os`),\r\n        onSuccess: (res) => { qc.invalidateQueries({ queryKey: ['quote', id] }); navigate(`/ordens-de-servico/${res.data.id}`) },\r\n    })\r\n\r\n    if (isLoading || !quote) return <div className=\"flex items-center justify-center h-64 text-surface-500\">Carregando...</div>\r\n\r\n    const sc = statusConfig[quote.status] ?? statusConfig.draft\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button onClick={() => navigate('/orcamentos')} className=\"rounded-lg p-1.5 text-surface-500 hover:bg-surface-100\">\r\n                        <ArrowLeft className=\"h-5 w-5\" />\r\n                    </button>\r\n                    <div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <h1 className=\"text-2xl font-bold text-surface-900\">{quote.quote_number}</h1>\r\n                            <Badge variant={sc.variant}>{sc.label}</Badge>\r\n                        </div>\r\n                        <p className=\"text-sm text-surface-500\">Criado em {new Date(quote.created_at).toLocaleDateString('pt-BR')}</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    {quote.status === 'draft' && <Button variant=\"outline\" icon={<Send className=\"h-4 w-4\" />} onClick={() => sendMut.mutate()}>Enviar</Button>}\r\n                    {quote.status === 'sent' && (\r\n                        <>\r\n                            <Button variant=\"outline\" icon={<XCircle className=\"h-4 w-4\" />} onClick={() => rejectMut.mutate()} className=\"text-red-600\">Rejeitar</Button>\r\n                            <Button icon={<CheckCircle className=\"h-4 w-4\" />} onClick={() => approveMut.mutate()}>Aprovar</Button>\r\n                        </>\r\n                    )}\r\n                    {quote.status === 'approved' && <Button icon={<ArrowRight className=\"h-4 w-4\" />} onClick={() => convertMut.mutate()}>Converter em OS</Button>}\r\n                    <Button variant=\"outline\" icon={<Download className=\"h-4 w-4\" />}\r\n                        onClick={() => window.open(`${api.defaults.baseURL}/quotes/${id}/pdf`, '_blank')}>\r\n                        Baixar PDF\r\n                    </Button>\r\n                    <Button variant=\"outline\" icon={<Copy className=\"h-4 w-4\" />} onClick={() => duplicateMut.mutate()}>Duplicar</Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Info cards */}\r\n            <div className=\"grid grid-cols-1 gap-4 lg:grid-cols-3\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-3\">\r\n                    <h3 className=\"flex items-center gap-2 text-sm font-semibold text-surface-700\"><User className=\"h-4 w-4 text-brand-500\" />Cliente</h3>\r\n                    <p className=\"text-lg font-semibold text-surface-900\">{quote.customer?.name}</p>\r\n                    <p className=\"text-sm text-surface-500\">{quote.customer?.document}</p>\r\n                    {quote.customer?.contacts?.[0] && <p className=\"text-sm text-surface-500\">{quote.customer.contacts[0].phone}</p>}\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-3\">\r\n                    <h3 className=\"flex items-center gap-2 text-sm font-semibold text-surface-700\"><FileText className=\"h-4 w-4 text-brand-500\" />Detalhes</h3>\r\n                    <div className=\"space-y-1 text-sm\">\r\n                        <div className=\"flex justify-between\"><span className=\"text-surface-500\">Vendedor</span><span className=\"font-medium\">{quote.seller?.name}</span></div>\r\n                        <div className=\"flex justify-between\"><span className=\"text-surface-500\">Validade</span><span className=\"font-medium\">{quote.valid_until ? new Date(quote.valid_until).toLocaleDateString('pt-BR') : '—'}</span></div>\r\n                        <div className=\"flex justify-between\"><span className=\"text-surface-500\">Equipamentos</span><span className=\"font-medium\">{quote.equipments?.length ?? 0}</span></div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-3\">\r\n                    <h3 className=\"flex items-center gap-2 text-sm font-semibold text-surface-700\"><DollarSign className=\"h-4 w-4 text-brand-500\" />Valores</h3>\r\n                    <div className=\"space-y-1 text-sm\">\r\n                        <div className=\"flex justify-between\"><span className=\"text-surface-500\">Subtotal</span><span>{Number(quote.subtotal).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span></div>\r\n                        {Number(quote.discount_amount) > 0 && (\r\n                            <div className=\"flex justify-between\"><span className=\"text-red-500\">Desconto</span><span className=\"text-red-500\">-{Number(quote.discount_amount).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span></div>\r\n                        )}\r\n                        <div className=\"flex justify-between border-t pt-1 text-lg font-bold\"><span>Total</span><span className=\"text-brand-700\">{Number(quote.total).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Observations */}\r\n            {quote.observations && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                    <h3 className=\"flex items-center gap-2 mb-2 text-sm font-semibold text-surface-700\"><MessageSquare className=\"h-4 w-4 text-brand-500\" />Observações</h3>\r\n                    <p className=\"text-sm text-surface-600 whitespace-pre-wrap\">{quote.observations}</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Equipments + Items */}\r\n            {quote.equipments?.map((eq: any) => (\r\n                <div key={eq.id} className=\"rounded-xl border border-surface-200 bg-white shadow-card overflow-hidden\">\r\n                    <div className=\"border-b border-surface-200 bg-surface-50 px-5 py-3\">\r\n                        <h4 className=\"font-semibold text-surface-900\">{eq.equipment?.name || eq.equipment?.model || `Equip. #${eq.equipment_id}`}</h4>\r\n                        {eq.description && <p className=\"mt-1 text-sm text-surface-500\">{eq.description}</p>}\r\n                    </div>\r\n                    <table className=\"w-full text-sm\">\r\n                        <thead>\r\n                            <tr className=\"border-b text-left text-xs text-surface-500\">\r\n                                <th className=\"px-5 py-2\">Tipo</th><th className=\"px-5 py-2\">Item</th><th className=\"px-5 py-2 text-right\">Qtd</th>\r\n                                <th className=\"px-5 py-2 text-right\">Preço Unit.</th><th className=\"px-5 py-2 text-right\">Desc.</th><th className=\"px-5 py-2 text-right\">Subtotal</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-surface-100\">\r\n                            {eq.items?.map((it: any) => (\r\n                                <tr key={it.id}>\r\n                                    <td className=\"px-5 py-3\">{it.type === 'product' ? <Package className=\"h-4 w-4 text-blue-500\" /> : <Wrench className=\"h-4 w-4 text-emerald-500\" />}</td>\r\n                                    <td className=\"px-5 py-3 font-medium text-surface-900\">{it.product?.name || it.service?.name || it.custom_description}</td>\r\n                                    <td className=\"px-5 py-3 text-right\">{Number(it.quantity).toFixed(2)}</td>\r\n                                    <td className=\"px-5 py-3 text-right\">{Number(it.unit_price).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>\r\n                                    <td className=\"px-5 py-3 text-right\">{Number(it.discount_percentage) > 0 ? `${it.discount_percentage}%` : '—'}</td>\r\n                                    <td className=\"px-5 py-3 text-right font-semibold\">{Number(it.subtotal).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            ))}\r\n\r\n            {/* Rejection reason */}\r\n            {quote.status === 'rejected' && quote.rejection_reason && (\r\n                <div className=\"rounded-xl border border-red-200 bg-red-50 p-5\">\r\n                    <h4 className=\"text-sm font-semibold text-red-700\">Motivo da Rejeição</h4>\r\n                    <p className=\"mt-1 text-sm text-red-600\">{quote.rejection_reason}</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\orcamentos\\QuotesListPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[250,265],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[544,547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[544,547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[555,558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[555,558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9482,9485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9482,9485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport {\r\n    Plus, Search, FileText, Send, CheckCircle, XCircle, Copy, ArrowRight,\r\n    Calendar, DollarSign, TrendingUp, Clock,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any; icon: any }> = {\r\n    draft: { label: 'Rascunho', variant: 'default', icon: FileText },\r\n    sent: { label: 'Enviado', variant: 'info', icon: Send },\r\n    approved: { label: 'Aprovado', variant: 'success', icon: CheckCircle },\r\n    rejected: { label: 'Rejeitado', variant: 'danger', icon: XCircle },\r\n    expired: { label: 'Expirado', variant: 'warning', icon: Clock },\r\n    invoiced: { label: 'Faturado', variant: 'info', icon: DollarSign },\r\n}\r\n\r\nexport function QuotesListPage() {\r\n    const navigate = useNavigate()\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['quotes-summary'],\r\n        queryFn: () => api.get('/quotes-summary'),\r\n    })\r\n    const summary = summaryRes?.data ?? {}\r\n\r\n    const { data: quotesRes } = useQuery({\r\n        queryKey: ['quotes', search, statusFilter],\r\n        queryFn: () => api.get('/quotes', { params: { search: search || undefined, status: statusFilter || undefined, per_page: 50 } }),\r\n    })\r\n    const quotes = quotesRes?.data?.data ?? []\r\n\r\n    const sendMut = useMutation({\r\n        mutationFn: (id: number) => api.post(`/quotes/${id}/send`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['quotes'] }),\r\n    })\r\n    const approveMut = useMutation({\r\n        mutationFn: (id: number) => api.post(`/quotes/${id}/approve`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['quotes'] }),\r\n    })\r\n    const duplicateMut = useMutation({\r\n        mutationFn: (id: number) => api.post(`/quotes/${id}/duplicate`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['quotes'] }),\r\n    })\r\n    const convertMut = useMutation({\r\n        mutationFn: (id: number) => api.post(`/quotes/${id}/convert-to-os`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['quotes'] }),\r\n    })\r\n\r\n    const stats = [\r\n        { label: 'Rascunhos', value: summary.draft ?? 0, icon: FileText, color: 'text-surface-600' },\r\n        { label: 'Enviados', value: summary.sent ?? 0, icon: Send, color: 'text-blue-600' },\r\n        { label: 'Aprovados', value: summary.approved ?? 0, icon: CheckCircle, color: 'text-emerald-600' },\r\n        { label: 'Taxa Conversão', value: `${summary.conversion_rate ?? 0}%`, icon: TrendingUp, color: 'text-brand-600' },\r\n    ]\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Orçamentos</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Gerencie e acompanhe seus orçamentos</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => navigate('/orcamentos/novo')}>Novo Orçamento</Button>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-2 gap-4 lg:grid-cols-4\">\r\n                {stats.map(s => {\r\n                    const Icon = s.icon\r\n                    return (\r\n                        <div key={s.label} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className={cn('rounded-lg bg-surface-50 p-2', s.color)}><Icon className=\"h-5 w-5\" /></div>\r\n                                <div>\r\n                                    <p className=\"text-xs text-surface-500\">{s.label}</p>\r\n                                    <p className=\"text-xl font-bold text-surface-900\">{s.value}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                })}\r\n            </div>\r\n\r\n            {/* Conversion Funnel */}\r\n            {(() => {\r\n                const stages = [\r\n                    { key: 'draft', label: 'Rascunho', count: summary.draft ?? 0, color: 'bg-surface-400' },\r\n                    { key: 'sent', label: 'Enviado', count: summary.sent ?? 0, color: 'bg-blue-500' },\r\n                    { key: 'approved', label: 'Aprovado', count: summary.approved ?? 0, color: 'bg-emerald-500' },\r\n                    { key: 'invoiced', label: 'Faturado', count: summary.invoiced ?? 0, color: 'bg-brand-500' },\r\n                ]\r\n                const maxCount = Math.max(...stages.map(s => s.count), 1)\r\n                return (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <h3 className=\"text-sm font-semibold text-surface-900 mb-4\">Funil de Conversão</h3>\r\n                        <div className=\"space-y-2\">\r\n                            {stages.map((stage, i) => (\r\n                                <div key={stage.key} className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-xs font-medium text-surface-600 w-20 text-right\">{stage.label}</span>\r\n                                    <div className=\"flex-1 h-7 bg-surface-100 rounded-md overflow-hidden relative\">\r\n                                        <div className={cn('h-full rounded-md transition-all duration-700', stage.color)}\r\n                                            style={{ width: `${Math.max((stage.count / maxCount) * 100, 2)}%` }} />\r\n                                        <span className=\"absolute inset-y-0 left-2 flex items-center text-xs font-bold text-white drop-shadow-sm\">\r\n                                            {stage.count > 0 ? stage.count : ''}\r\n                                        </span>\r\n                                    </div>\r\n                                    {i > 0 && stages[i - 1].count > 0 && (\r\n                                        <span className=\"text-[10px] font-semibold text-surface-400 w-12\">\r\n                                            {((stage.count / stages[i - 1].count) * 100).toFixed(0)}%\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )\r\n            })()}\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <div className=\"relative flex-1 min-w-[200px]\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)} placeholder=\"Buscar por número ou cliente...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2 pl-10 pr-3 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                </div>\r\n                <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todos os status</option>\r\n                    {Object.entries(statusConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Número</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Cliente</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Vendedor</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Status</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Validade</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Valor</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {quotes.length === 0 ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum orçamento encontrado</td></tr>\r\n                        ) : quotes.map((q: any) => {\r\n                            const sc = statusConfig[q.status] ?? statusConfig.draft\r\n                            return (\r\n                                <tr key={q.id} className=\"hover:bg-surface-50 transition-colors cursor-pointer\" onClick={() => navigate(`/orcamentos/${q.id}`)}>\r\n                                    <td className=\"px-4 py-3 text-sm font-mono font-semibold text-brand-700\">{q.quote_number}</td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-900\">{q.customer?.name}</td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-600\">{q.seller?.name}</td>\r\n                                    <td className=\"px-4 py-3\"><Badge variant={sc.variant}>{sc.label}</Badge></td>\r\n                                    <td className=\"px-4 py-3 text-sm text-surface-500\">{q.valid_until ? new Date(q.valid_until).toLocaleDateString('pt-BR') : '—'}</td>\r\n                                    <td className=\"px-4 py-3 text-right text-sm font-semibold text-surface-900\">\r\n                                        {Number(q.total).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-right\" onClick={e => e.stopPropagation()}>\r\n                                        <div className=\"flex justify-end gap-1\">\r\n                                            {q.status === 'draft' && (\r\n                                                <button onClick={() => sendMut.mutate(q.id)} title=\"Enviar\"\r\n                                                    className=\"rounded p-1.5 text-blue-600 hover:bg-blue-50\"><Send className=\"h-4 w-4\" /></button>\r\n                                            )}\r\n                                            {q.status === 'sent' && (\r\n                                                <button onClick={() => approveMut.mutate(q.id)} title=\"Aprovar\"\r\n                                                    className=\"rounded p-1.5 text-emerald-600 hover:bg-emerald-50\"><CheckCircle className=\"h-4 w-4\" /></button>\r\n                                            )}\r\n                                            {q.status === 'approved' && (\r\n                                                <button onClick={() => convertMut.mutate(q.id)} title=\"Converter em OS\"\r\n                                                    className=\"rounded p-1.5 text-brand-600 hover:bg-brand-50\"><ArrowRight className=\"h-4 w-4\" /></button>\r\n                                            )}\r\n                                            <button onClick={() => duplicateMut.mutate(q.id)} title=\"Duplicar\"\r\n                                                className=\"rounded p-1.5 text-surface-500 hover:bg-surface-100\"><Copy className=\"h-4 w-4\" /></button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            )\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\RecurringContractsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'priorityVariant' is assigned a value but never used.","line":43,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2395,2398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2395,2398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2651,2654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2651,2654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    RefreshCw, Plus, Pencil, Trash2, Play, Calendar, Search,\r\n    ChevronDown, ChevronUp, Package, Wrench\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\ninterface ContractItem {\r\n    id?: number\r\n    type: string\r\n    description: string\r\n    quantity: number\r\n    unit_price: number\r\n}\r\n\r\ninterface Contract {\r\n    id: number\r\n    name: string\r\n    description: string | null\r\n    frequency: string\r\n    start_date: string\r\n    end_date: string | null\r\n    next_run_date: string\r\n    priority: string\r\n    is_active: boolean\r\n    generated_count: number\r\n    customer: { id: number; name: string } | null\r\n    equipment: { id: number; type: string; brand: string; model: string } | null\r\n    assignee: { id: number; name: string } | null\r\n    items: ContractItem[]\r\n}\r\n\r\nconst freqLabels: Record<string, string> = {\r\n    weekly: 'Semanal', biweekly: 'Quinzenal', monthly: 'Mensal',\r\n    bimonthly: 'Bimestral', quarterly: 'Trimestral',\r\n    semiannual: 'Semestral', annual: 'Anual',\r\n}\r\n\r\nconst priorityVariant: Record<string, 'default' | 'info' | 'warning' | 'danger'> = {\r\n    low: 'default', normal: 'info', high: 'warning', urgent: 'danger',\r\n}\r\n\r\nconst fmtDate = (d: string) => new Date(d + 'T12:00:00').toLocaleDateString('pt-BR')\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nconst emptyForm = {\r\n    name: '', description: '', customer_id: '', equipment_id: '',\r\n    assigned_to: '', frequency: 'monthly', start_date: '', end_date: '',\r\n    priority: 'normal',\r\n    items: [] as ContractItem[],\r\n}\r\n\r\nexport function RecurringContractsPage() {\r\n    const qc = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editing, setEditing] = useState<Contract | null>(null)\r\n    const [form, setForm] = useState(emptyForm)\r\n    const [expanded, setExpanded] = useState<number | null>(null)\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['recurring-contracts', search],\r\n        queryFn: () => api.get('/recurring-contracts', { params: { search } }).then((r: any) => r.data),\r\n    })\r\n\r\n    const contracts: Contract[] = res?.data ?? res ?? []\r\n\r\n    const { data: customers } = useQuery({\r\n        queryKey: ['customers-list'],\r\n        queryFn: () => api.get('/customers', { params: { per_page: 200 } }).then((r: any) => r.data.data ?? r.data),\r\n    })\r\n\r\n    const save = useMutation({\r\n        mutationFn: (data: typeof form) =>\r\n            editing\r\n                ? api.put(`/recurring-contracts/${editing.id}`, data)\r\n                : api.post('/recurring-contracts', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['recurring-contracts'] }); closeForm() },\r\n    })\r\n\r\n    const remove = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/recurring-contracts/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['recurring-contracts'] }),\r\n    })\r\n\r\n    const generate = useMutation({\r\n        mutationFn: (id: number) => api.post(`/recurring-contracts/${id}/generate`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['recurring-contracts'] }),\r\n    })\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n        setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n    function openEdit(c: Contract) {\r\n        setEditing(c)\r\n        setForm({\r\n            name: c.name, description: c.description ?? '',\r\n            customer_id: String(c.customer?.id ?? ''),\r\n            equipment_id: String(c.equipment?.id ?? ''),\r\n            assigned_to: String(c.assignee?.id ?? ''),\r\n            frequency: c.frequency, start_date: c.start_date?.slice(0, 10) ?? '',\r\n            end_date: c.end_date?.slice(0, 10) ?? '', priority: c.priority,\r\n            items: c.items?.map(i => ({ ...i })) ?? [],\r\n        })\r\n        setShowForm(true)\r\n    }\r\n\r\n    function closeForm() {\r\n        setShowForm(false); setEditing(null); setForm(emptyForm)\r\n    }\r\n\r\n    function addItem() {\r\n        set('items', [...form.items, { type: 'service', description: '', quantity: 1, unit_price: 0 }])\r\n    }\r\n\r\n    function updateItem(idx: number, field: string, val: string | number) {\r\n        const items = [...form.items]\r\n        items[idx] = { ...items[idx], [field]: val }\r\n        set('items', items)\r\n    }\r\n\r\n    function removeItem(idx: number) {\r\n        set('items', form.items.filter((_, i) => i !== idx))\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-zinc-100\">Contratos Recorrentes</h1>\r\n                    <p className=\"text-sm text-zinc-400 mt-1\">Manutenções preventivas e contratos periódicos</p>\r\n                </div>\r\n                <Button onClick={() => { closeForm(); setShowForm(true) }}>\r\n                    <Plus className=\"h-4 w-4 mr-2\" /> Novo Contrato\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"relative max-w-sm\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400\" />\r\n                <Input\r\n                    className=\"pl-10\"\r\n                    placeholder=\"Buscar contratos...\"\r\n                    value={search}\r\n                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)}\r\n                />\r\n            </div>\r\n\r\n            {/* Form */}\r\n            {showForm && (\r\n                <div className=\"bg-zinc-800/50 border border-zinc-700 rounded-xl p-6 space-y-4\">\r\n                    <h3 className=\"text-lg font-semibold text-zinc-100\">\r\n                        {editing ? 'Editar Contrato' : 'Novo Contrato'}\r\n                    </h3>\r\n\r\n                    <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n                        <Input label=\"Nome\" value={form.name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('name', e.target.value)} required />\r\n                        <div className=\"space-y-1.5\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Cliente</label>\r\n                            <select className=\"w-full rounded-lg bg-zinc-900 border border-zinc-700 px-3 py-2 text-sm text-zinc-100\"\r\n                                value={form.customer_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('customer_id', e.target.value)}>\r\n                                <option value=\"\">Selecione</option>\r\n                                {(customers ?? []).map((c: { id: number; name: string }) => (\r\n                                    <option key={c.id} value={c.id}>{c.name}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                        <div className=\"space-y-1.5\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Frequência</label>\r\n                            <select className=\"w-full rounded-lg bg-zinc-900 border border-zinc-700 px-3 py-2 text-sm text-zinc-100\"\r\n                                value={form.frequency} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('frequency', e.target.value)}>\r\n                                {Object.entries(freqLabels).map(([k, v]) => (\r\n                                    <option key={k} value={k}>{v}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                        <Input label=\"Data Início\" type=\"date\" value={form.start_date} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('start_date', e.target.value)} required />\r\n                        <Input label=\"Data Fim (opcional)\" type=\"date\" value={form.end_date} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('end_date', e.target.value)} />\r\n                        <div className=\"space-y-1.5\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Prioridade</label>\r\n                            <select className=\"w-full rounded-lg bg-zinc-900 border border-zinc-700 px-3 py-2 text-sm text-zinc-100\"\r\n                                value={form.priority} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('priority', e.target.value)}>\r\n                                <option value=\"low\">Baixa</option>\r\n                                <option value=\"normal\">Normal</option>\r\n                                <option value=\"high\">Alta</option>\r\n                                <option value=\"urgent\">Urgente</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-1.5\">\r\n                        <label className=\"text-sm font-medium text-zinc-300\">Descrição</label>\r\n                        <textarea className=\"w-full rounded-lg bg-zinc-900 border border-zinc-700 px-3 py-2 text-sm text-zinc-100 min-h-[80px]\"\r\n                            value={form.description} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('description', e.target.value)} />\r\n                    </div>\r\n\r\n                    {/* Items template */}\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Itens Template</label>\r\n                            <Button size=\"sm\" variant=\"secondary\" onClick={addItem}>\r\n                                <Plus className=\"h-3 w-3 mr-1\" /> Item\r\n                            </Button>\r\n                        </div>\r\n                        {form.items.map((item, idx) => (\r\n                            <div key={idx} className=\"flex items-center gap-2\">\r\n                                <select className=\"rounded-lg bg-zinc-900 border border-zinc-700 px-2 py-1.5 text-sm text-zinc-100 w-28\"\r\n                                    value={item.type} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => updateItem(idx, 'type', e.target.value)}>\r\n                                    <option value=\"product\">Produto</option>\r\n                                    <option value=\"service\">Serviço</option>\r\n                                </select>\r\n                                <input className=\"flex-1 rounded-lg bg-zinc-900 border border-zinc-700 px-2 py-1.5 text-sm text-zinc-100\"\r\n                                    placeholder=\"Descrição\" value={item.description}\r\n                                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(idx, 'description', e.target.value)} />\r\n                                <input className=\"w-20 rounded-lg bg-zinc-900 border border-zinc-700 px-2 py-1.5 text-sm text-zinc-100\"\r\n                                    type=\"number\" placeholder=\"Qtd\" value={item.quantity}\r\n                                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(idx, 'quantity', Number(e.target.value))} />\r\n                                <input className=\"w-28 rounded-lg bg-zinc-900 border border-zinc-700 px-2 py-1.5 text-sm text-zinc-100\"\r\n                                    type=\"number\" step=\"0.01\" placeholder=\"Vlr Unit\" value={item.unit_price}\r\n                                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(idx, 'unit_price', Number(e.target.value))} />\r\n                                <button onClick={() => removeItem(idx)} className=\"text-red-400 hover:text-red-300 p-1\">\r\n                                    <Trash2 className=\"h-4 w-4\" />\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-2 pt-2\">\r\n                        <Button onClick={() => save.mutate(form)} disabled={save.isPending}>\r\n                            {save.isPending ? 'Salvando...' : editing ? 'Atualizar' : 'Criar'}\r\n                        </Button>\r\n                        <Button variant=\"secondary\" onClick={closeForm}>Cancelar</Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Table */}\r\n            {isLoading ? (\r\n                <div className=\"text-center py-12 text-zinc-400\">Carregando...</div>\r\n            ) : contracts.length === 0 ? (\r\n                <div className=\"text-center py-12\">\r\n                    <RefreshCw className=\"h-12 w-12 text-zinc-600 mx-auto mb-3\" />\r\n                    <p className=\"text-zinc-400\">Nenhum contrato recorrente</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"border border-zinc-700 rounded-xl overflow-hidden\">\r\n                    <table className=\"w-full text-sm\">\r\n                        <thead className=\"bg-zinc-800/50\">\r\n                            <tr>\r\n                                <th className=\"text-left px-4 py-3 text-zinc-400 font-medium\">Contrato</th>\r\n                                <th className=\"text-left px-4 py-3 text-zinc-400 font-medium\">Cliente</th>\r\n                                <th className=\"text-left px-4 py-3 text-zinc-400 font-medium\">Frequência</th>\r\n                                <th className=\"text-left px-4 py-3 text-zinc-400 font-medium\">Próxima OS</th>\r\n                                <th className=\"text-center px-4 py-3 text-zinc-400 font-medium\">Geradas</th>\r\n                                <th className=\"text-center px-4 py-3 text-zinc-400 font-medium\">Status</th>\r\n                                <th className=\"text-right px-4 py-3 text-zinc-400 font-medium\">Ações</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-zinc-700/50\">\r\n                            {contracts.map((c: Contract) => (\r\n                                <React.Fragment key={c.id}>\r\n                                    <tr className=\"hover:bg-zinc-800/30 transition-colors\">\r\n                                        <td className=\"px-4 py-3\">\r\n                                            <button onClick={() => setExpanded(expanded === c.id ? null : c.id)}\r\n                                                className=\"flex items-center gap-2 text-zinc-100 hover:text-blue-400 font-medium\">\r\n                                                {expanded === c.id ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\r\n                                                {c.name}\r\n                                            </button>\r\n                                        </td>\r\n                                        <td className=\"px-4 py-3 text-zinc-300\">{c.customer?.name ?? '—'}</td>\r\n                                        <td className=\"px-4 py-3\">\r\n                                            <Badge variant=\"info\">{freqLabels[c.frequency] ?? c.frequency}</Badge>\r\n                                        </td>\r\n                                        <td className=\"px-4 py-3 text-zinc-300\">\r\n                                            <Calendar className=\"h-3.5 w-3.5 inline mr-1\" />\r\n                                            {fmtDate(c.next_run_date)}\r\n                                        </td>\r\n                                        <td className=\"px-4 py-3 text-center text-zinc-300\">{c.generated_count}</td>\r\n                                        <td className=\"px-4 py-3 text-center\">\r\n                                            <Badge variant={c.is_active ? 'success' : 'default'}>\r\n                                                {c.is_active ? 'Ativo' : 'Inativo'}\r\n                                            </Badge>\r\n                                        </td>\r\n                                        <td className=\"px-4 py-3\">\r\n                                            <div className=\"flex justify-end gap-1\">\r\n                                                <button title=\"Gerar OS agora\"\r\n                                                    onClick={() => { if (confirm('Gerar OS manualmente?')) generate.mutate(c.id) }}\r\n                                                    className=\"p-1.5 rounded-lg hover:bg-emerald-500/10 text-emerald-400\">\r\n                                                    <Play className=\"h-4 w-4\" />\r\n                                                </button>\r\n                                                <button onClick={() => openEdit(c)}\r\n                                                    className=\"p-1.5 rounded-lg hover:bg-blue-500/10 text-blue-400\">\r\n                                                    <Pencil className=\"h-4 w-4\" />\r\n                                                </button>\r\n                                                <button onClick={() => { if (confirm('Excluir contrato?')) remove.mutate(c.id) }}\r\n                                                    className=\"p-1.5 rounded-lg hover:bg-red-500/10 text-red-400\">\r\n                                                    <Trash2 className=\"h-4 w-4\" />\r\n                                                </button>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                    {expanded === c.id && c.items?.length > 0 && (\r\n                                        <tr>\r\n                                            <td colSpan={7} className=\"px-8 py-3 bg-zinc-800/30\">\r\n                                                <div className=\"space-y-1\">\r\n                                                    <p className=\"text-xs font-medium text-zinc-400 mb-2\">Itens Template:</p>\r\n                                                    {c.items.map((item, i) => (\r\n                                                        <div key={i} className=\"flex items-center gap-3 text-sm\">\r\n                                                            {item.type === 'product' ? <Package className=\"h-3.5 w-3.5 text-amber-400\" /> : <Wrench className=\"h-3.5 w-3.5 text-blue-400\" />}\r\n                                                            <span className=\"text-zinc-300 flex-1\">{item.description}</span>\r\n                                                            <span className=\"text-zinc-400\">{item.quantity}x</span>\r\n                                                            <span className=\"text-zinc-300 font-mono\">{fmtBRL(Number(item.unit_price))}</span>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    )}\r\n                                </React.Fragment>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\ServiceChecklistsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1438,1441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1438,1441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2757,2760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2757,2760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2833,2836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2833,2836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Plus, ClipboardList, Trash2, Edit, CheckSquare, ToggleLeft, ToggleRight, GripVertical } from 'lucide-react'\r\nimport api from '@/lib/api'\r\n\r\nconst itemTypes = [\r\n    { value: 'check', label: 'Checkbox' },\r\n    { value: 'text', label: 'Texto' },\r\n    { value: 'number', label: 'Número' },\r\n    { value: 'photo', label: 'Foto' },\r\n    { value: 'yes_no', label: 'Sim/Não' },\r\n]\r\n\r\ninterface ChecklistItem {\r\n    id?: number\r\n    description: string\r\n    type: string\r\n    is_required: boolean\r\n    order_index: number\r\n}\r\n\r\ninterface Checklist {\r\n    id: number\r\n    name: string\r\n    description: string | null\r\n    is_active: boolean\r\n    items: ChecklistItem[]\r\n}\r\n\r\nexport function ServiceChecklistsPage() {\r\n    const qc = useQueryClient()\r\n    const [editing, setEditing] = useState<Checklist | null>(null)\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [formName, setFormName] = useState('')\r\n    const [formDesc, setFormDesc] = useState('')\r\n    const [formItems, setFormItems] = useState<ChecklistItem[]>([])\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['service-checklists'],\r\n        queryFn: () => api.get('/service-checklists'),\r\n    })\r\n    const checklists: Checklist[] = res?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (payload: any) =>\r\n            editing\r\n                ? api.put(`/service-checklists/${editing.id}`, payload)\r\n                : api.post('/service-checklists', payload),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['service-checklists'] })\r\n            resetForm()\r\n        },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/service-checklists/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['service-checklists'] }),\r\n    })\r\n\r\n    const resetForm = () => {\r\n        setShowForm(false)\r\n        setEditing(null)\r\n        setFormName('')\r\n        setFormDesc('')\r\n        setFormItems([])\r\n    }\r\n\r\n    const openEdit = (c: Checklist) => {\r\n        setEditing(c)\r\n        setFormName(c.name)\r\n        setFormDesc(c.description ?? '')\r\n        setFormItems(c.items.map((it, i) => ({ ...it, order_index: i })))\r\n        setShowForm(true)\r\n    }\r\n\r\n    const openNew = () => {\r\n        resetForm()\r\n        setShowForm(true)\r\n    }\r\n\r\n    const addItem = () => setFormItems([...formItems, { description: '', type: 'check', is_required: true, order_index: formItems.length }])\r\n\r\n    const removeItem = (idx: number) => setFormItems(formItems.filter((_, i) => i !== idx))\r\n\r\n    const updateItem = (idx: number, key: string, val: any) => {\r\n        const copy = [...formItems]\r\n            ; (copy[idx] as any)[key] = val\r\n        setFormItems(copy)\r\n    }\r\n\r\n    const handleSave = () => {\r\n        if (!formName.trim()) return\r\n        saveMut.mutate({\r\n            name: formName,\r\n            description: formDesc || null,\r\n            is_active: true,\r\n            items: formItems.map((it, i) => ({ ...it, order_index: i })),\r\n        })\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Checklists de Serviço</h1>\r\n                <button onClick={openNew} className=\"inline-flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700 transition-colors\">\r\n                    <Plus className=\"h-4 w-4\" /> Novo Checklist\r\n                </button>\r\n            </div>\r\n\r\n            {/* Form */}\r\n            {showForm && (\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card space-y-4\">\r\n                    <h2 className=\"font-semibold text-surface-900\">{editing ? 'Editar' : 'Novo'} Checklist</h2>\r\n                    <div className=\"grid sm:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-surface-700 mb-1\">Nome</label>\r\n                            <input value={formName} onChange={e => setFormName(e.target.value)} className=\"w-full rounded-lg border border-surface-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-surface-700 mb-1\">Descrição</label>\r\n                            <input value={formDesc} onChange={e => setFormDesc(e.target.value)} className=\"w-full rounded-lg border border-surface-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500\" />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-700\">Itens</h3>\r\n                            <button onClick={addItem} className=\"text-xs text-brand-600 hover:text-brand-700 font-medium\">+ Adicionar Item</button>\r\n                        </div>\r\n                        {formItems.map((item, idx) => (\r\n                            <div key={idx} className=\"flex items-center gap-3 p-3 bg-surface-50 rounded-lg\">\r\n                                <GripVertical className=\"h-4 w-4 text-surface-400 flex-shrink-0\" />\r\n                                <input\r\n                                    value={item.description}\r\n                                    onChange={e => updateItem(idx, 'description', e.target.value)}\r\n                                    placeholder=\"Descrição do item...\"\r\n                                    className=\"flex-1 rounded border border-surface-300 px-2 py-1.5 text-sm\"\r\n                                />\r\n                                <select\r\n                                    value={item.type}\r\n                                    onChange={e => updateItem(idx, 'type', e.target.value)}\r\n                                    className=\"rounded border border-surface-300 px-2 py-1.5 text-sm\"\r\n                                >\r\n                                    {itemTypes.map(t => <option key={t.value} value={t.value}>{t.label}</option>)}\r\n                                </select>\r\n                                <label className=\"flex items-center gap-1 text-xs text-surface-600 whitespace-nowrap\">\r\n                                    <input type=\"checkbox\" checked={item.is_required} onChange={e => updateItem(idx, 'is_required', e.target.checked)} />\r\n                                    Obrig.\r\n                                </label>\r\n                                <button onClick={() => removeItem(idx)} className=\"text-red-500 hover:text-red-700\"><Trash2 className=\"h-4 w-4\" /></button>\r\n                            </div>\r\n                        ))}\r\n                        {formItems.length === 0 && <p className=\"text-sm text-surface-400\">Nenhum item adicionado.</p>}\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-3 justify-end\">\r\n                        <button onClick={resetForm} className=\"px-4 py-2 text-sm text-surface-600 hover:text-surface-800\">Cancelar</button>\r\n                        <button onClick={handleSave} disabled={saveMut.isPending} className=\"px-4 py-2 text-sm font-medium rounded-lg bg-brand-600 text-white hover:bg-brand-700 disabled:opacity-50\">\r\n                            {saveMut.isPending ? 'Salvando...' : 'Salvar'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* List */}\r\n            {isLoading ? (\r\n                <div className=\"text-center text-surface-400 py-12\">Carregando...</div>\r\n            ) : checklists.length === 0 ? (\r\n                <div className=\"text-center text-surface-400 py-12\">Nenhum checklist cadastrado.</div>\r\n            ) : (\r\n                <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n                    {checklists.map(c => (\r\n                        <div key={c.id} className=\"rounded-xl border border-surface-200 bg-white shadow-card p-5 space-y-3\">\r\n                            <div className=\"flex items-start justify-between\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <ClipboardList className=\"h-5 w-5 text-brand-600\" />\r\n                                    <h3 className=\"font-semibold text-surface-900\">{c.name}</h3>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-1\">\r\n                                    {c.is_active ? <ToggleRight className=\"h-5 w-5 text-emerald-500\" /> : <ToggleLeft className=\"h-5 w-5 text-surface-300\" />}\r\n                                </div>\r\n                            </div>\r\n                            {c.description && <p className=\"text-sm text-surface-500\">{c.description}</p>}\r\n\r\n                            <div className=\"space-y-1\">\r\n                                {c.items.slice(0, 4).map((it, i) => (\r\n                                    <div key={i} className=\"flex items-center gap-2 text-sm text-surface-600\">\r\n                                        <CheckSquare className=\"h-3.5 w-3.5 text-surface-400\" />\r\n                                        <span>{it.description}</span>\r\n                                        <span className=\"ml-auto text-xs text-surface-400\">{itemTypes.find(t => t.value === it.type)?.label}</span>\r\n                                    </div>\r\n                                ))}\r\n                                {c.items.length > 4 && <p className=\"text-xs text-surface-400\">+{c.items.length - 4} itens</p>}\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-2 pt-2 border-t border-surface-100\">\r\n                                <button onClick={() => openEdit(c)} className=\"flex-1 text-sm text-brand-600 hover:text-brand-700 font-medium flex items-center justify-center gap-1\">\r\n                                    <Edit className=\"h-3.5 w-3.5\" /> Editar\r\n                                </button>\r\n                                <button onClick={() => deleteMut.mutate(c.id)} className=\"flex-1 text-sm text-red-500 hover:text-red-700 font-medium flex items-center justify-center gap-1\">\r\n                                    <Trash2 className=\"h-3.5 w-3.5\" /> Excluir\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\SlaDashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3046,3049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3046,3049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6352,6355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6352,6355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\r\nimport { Shield, AlertTriangle, CheckCircle, Clock, TrendingUp } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst priorityConfig: Record<string, { label: string; icon: string; color: string }> = {\r\n    low: { label: 'Baixa', icon: '🟢', color: 'text-surface-600' },\r\n    medium: { label: 'Média', icon: '🟡', color: 'text-amber-600' },\r\n    high: { label: 'Alta', icon: '🟠', color: 'text-orange-600' },\r\n    critical: { label: 'Crítica', icon: '🔴', color: 'text-red-600' },\r\n}\r\n\r\nexport function SlaDashboardPage() {\r\n    const { data: overview, isLoading } = useQuery({\r\n        queryKey: ['sla-dashboard-overview'],\r\n        queryFn: () => api.get('/sla-dashboard/overview'),\r\n    })\r\n    const { data: byPolicy } = useQuery({\r\n        queryKey: ['sla-dashboard-by-policy'],\r\n        queryFn: () => api.get('/sla-dashboard/by-policy'),\r\n    })\r\n    const { data: breached } = useQuery({\r\n        queryKey: ['sla-dashboard-breached'],\r\n        queryFn: () => api.get('/sla-dashboard/breached'),\r\n    })\r\n\r\n    const ov = overview?.data\r\n    const policies = byPolicy?.data ?? []\r\n    const breachedOrders = breached?.data?.data ?? []\r\n\r\n    if (isLoading) return <p className=\"text-center py-12 text-surface-400\">Carregando...</p>\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Dashboard SLA</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Acompanhamento de cumprimento de SLA em tempo real</p>\r\n            </div>\r\n\r\n            {/* KPIs */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n                <KpiCard icon={<Shield className=\"h-5 w-5 text-brand-500\" />} label=\"Total com SLA\" value={ov?.total_com_sla ?? 0} />\r\n                <KpiCard icon={<CheckCircle className=\"h-5 w-5 text-emerald-500\" />} label=\"Resposta OK\" value={`${ov?.response?.taxa ?? 0}%`} sub={`${ov?.response?.cumprido ?? 0} de ${(ov?.response?.cumprido ?? 0) + (ov?.response?.estourado ?? 0)}`} />\r\n                <KpiCard icon={<AlertTriangle className=\"h-5 w-5 text-red-500\" />} label=\"Resposta Estourada\" value={ov?.response?.estourado ?? 0} danger />\r\n                <KpiCard icon={<TrendingUp className=\"h-5 w-5 text-emerald-500\" />} label=\"Resolução OK\" value={`${ov?.resolution?.taxa ?? 0}%`} sub={`${ov?.resolution?.cumprido ?? 0} resolvidas`} />\r\n                <KpiCard icon={<Clock className=\"h-5 w-5 text-amber-500\" />} label=\"Em Risco\" value={ov?.em_risco ?? 0} warning />\r\n            </div>\r\n\r\n            {/* Por Política */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <div className=\"border-b border-surface-100 px-5 py-3\">\r\n                    <h2 className=\"text-sm font-bold text-surface-900\">Compliance por Política</h2>\r\n                </div>\r\n                <div className=\"divide-y divide-surface-50\">\r\n                    {policies.map((p: any) => {\r\n                        const pri = priorityConfig[p.priority] ?? priorityConfig.medium\r\n                        return (\r\n                            <div key={p.id} className=\"flex items-center justify-between px-5 py-3\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-lg\">{pri.icon}</span>\r\n                                    <div>\r\n                                        <p className=\"text-sm font-medium text-surface-900\">{p.name}</p>\r\n                                        <p className=\"text-xs text-surface-500\">{p.total} OS • {p.breached} estouradas</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"w-32 h-2 rounded-full bg-surface-100 overflow-hidden\">\r\n                                        <div className={cn('h-full rounded-full transition-all', p.compliance_rate >= 90 ? 'bg-emerald-500' : p.compliance_rate >= 70 ? 'bg-amber-500' : 'bg-red-500')}\r\n                                            style={{ width: `${p.compliance_rate}%` }} />\r\n                                    </div>\r\n                                    <span className={cn('text-sm font-bold w-14 text-right', p.compliance_rate >= 90 ? 'text-emerald-600' : p.compliance_rate >= 70 ? 'text-amber-600' : 'text-red-600')}>\r\n                                        {p.compliance_rate}%\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })}\r\n                    {policies.length === 0 && (\r\n                        <p className=\"px-5 py-6 text-sm text-surface-400 text-center\">Nenhuma política com OS associadas</p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* OS com SLA estourado */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <div className=\"border-b border-surface-100 px-5 py-3\">\r\n                    <h2 className=\"text-sm font-bold text-surface-900\">OS com SLA Estourado</h2>\r\n                </div>\r\n                {breachedOrders.length === 0 ? (\r\n                    <p className=\"px-5 py-8 text-sm text-surface-400 text-center\">🎉 Nenhuma OS com SLA estourado!</p>\r\n                ) : (\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full text-sm\">\r\n                            <thead><tr className=\"bg-surface-50 text-surface-500\">\r\n                                <th className=\"px-4 py-2 text-left font-medium\">OS</th>\r\n                                <th className=\"px-4 py-2 text-left font-medium\">Cliente</th>\r\n                                <th className=\"px-4 py-2 text-left font-medium\">Técnico</th>\r\n                                <th className=\"px-4 py-2 text-left font-medium\">SLA</th>\r\n                                <th className=\"px-4 py-2 text-left font-medium\">Breach</th>\r\n                            </tr></thead>\r\n                            <tbody className=\"divide-y divide-surface-50\">\r\n                                {breachedOrders.map((wo: any) => (\r\n                                    <tr key={wo.id} className=\"hover:bg-red-50/30\">\r\n                                        <td className=\"px-4 py-2 font-mono text-brand-600\">{wo.number}</td>\r\n                                        <td className=\"px-4 py-2\">{wo.customer?.name ?? '—'}</td>\r\n                                        <td className=\"px-4 py-2\">{wo.assignee?.name ?? '—'}</td>\r\n                                        <td className=\"px-4 py-2\">{wo.sla_policy?.name ?? '—'}</td>\r\n                                        <td className=\"px-4 py-2\">\r\n                                            {wo.sla_response_breached && <span className=\"inline-flex mr-1 rounded-full bg-red-100 px-2 py-0.5 text-xs text-red-700\">Resposta</span>}\r\n                                            {wo.sla_resolution_breached && <span className=\"inline-flex rounded-full bg-orange-100 px-2 py-0.5 text-xs text-orange-700\">Resolução</span>}\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction KpiCard({ icon, label, value, sub, danger, warning }: { icon: React.ReactNode; label: string; value: string | number; sub?: string; danger?: boolean; warning?: boolean }) {\r\n    return (\r\n        <div className={cn('rounded-xl border bg-white p-4 shadow-card', danger && 'border-red-200', warning && 'border-amber-200')}>\r\n            <div className=\"flex items-center gap-2 mb-2\">{icon}<span className=\"text-xs text-surface-500\">{label}</span></div>\r\n            <p className={cn('text-2xl font-bold', danger ? 'text-red-600' : warning ? 'text-amber-600' : 'text-surface-900')}>{value}</p>\r\n            {sub && <p className=\"text-xs text-surface-400 mt-0.5\">{sub}</p>}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\SlaPoliciesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1334,1337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1334,1337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Plus, Edit2, Trash2, Shield, Clock, X, AlertTriangle } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface SlaPolicy {\r\n    id: number\r\n    name: string\r\n    description: string | null\r\n    priority: string\r\n    response_time_hours: number\r\n    resolution_time_hours: number\r\n    is_active: boolean\r\n}\r\n\r\nconst priorityConfig: Record<string, { label: string; color: string; icon: string }> = {\r\n    low: { label: 'Baixa', color: 'text-surface-600 bg-surface-100', icon: '🟢' },\r\n    medium: { label: 'Média', color: 'text-amber-700 bg-amber-50', icon: '🟡' },\r\n    high: { label: 'Alta', color: 'text-orange-700 bg-orange-50', icon: '🟠' },\r\n    critical: { label: 'Crítica', color: 'text-red-700 bg-red-50', icon: '🔴' },\r\n}\r\n\r\nexport function SlaPoliciesPage() {\r\n    const qc = useQueryClient()\r\n    const [modal, setModal] = useState<{ mode: 'create' | 'edit'; policy?: SlaPolicy } | null>(null)\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['sla-policies'],\r\n        queryFn: () => api.get('/sla-policies'),\r\n    })\r\n    const policies: SlaPolicy[] = res?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: any) =>\r\n            data.id ? api.put(`/sla-policies/${data.id}`, data) : api.post('/sla-policies', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['sla-policies'] }); setModal(null) },\r\n    })\r\n\r\n    const deleteMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/sla-policies/${id}`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['sla-policies'] }) },\r\n    })\r\n\r\n    const fmtHours = (h: number) => h >= 24 ? `${Math.floor(h / 24)}d ${h % 24}h` : `${h}h`\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Políticas de SLA</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Defina tempos de resposta e resolução por prioridade</p>\r\n                </div>\r\n                <button onClick={() => setModal({ mode: 'create' })}\r\n                    className=\"flex items-center gap-2 rounded-xl bg-brand-500 px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-brand-600 transition-colors\">\r\n                    <Plus className=\"h-4 w-4\" /> Nova Política\r\n                </button>\r\n            </div>\r\n\r\n            {isLoading && <p className=\"text-sm text-surface-400 text-center py-8\">Carregando...</p>}\r\n\r\n            {!isLoading && policies.length === 0 && (\r\n                <div className=\"rounded-xl border border-dashed border-surface-300 bg-white p-12 text-center\">\r\n                    <Shield className=\"mx-auto h-12 w-12 text-surface-300\" />\r\n                    <p className=\"mt-3 text-sm text-surface-500\">Nenhuma política de SLA cadastrada</p>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\r\n                {policies.map(p => {\r\n                    const pri = priorityConfig[p.priority] ?? priorityConfig.medium\r\n                    return (\r\n                        <div key={p.id} className={cn(\r\n                            'rounded-xl border bg-white shadow-card p-5 transition-all hover:shadow-lg group',\r\n                            !p.is_active && 'opacity-60'\r\n                        )}>\r\n                            <div className=\"flex items-start justify-between\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-lg\">{pri.icon}</span>\r\n                                    <div>\r\n                                        <h3 className=\"text-sm font-bold text-surface-900\">{p.name}</h3>\r\n                                        <span className={cn('inline-flex rounded-full px-2 py-0.5 text-xs font-medium mt-1', pri.color)}>\r\n                                            {pri.label}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                    <button onClick={() => setModal({ mode: 'edit', policy: p })} className=\"rounded-lg p-1.5 hover:bg-surface-100\">\r\n                                        <Edit2 className=\"h-3.5 w-3.5 text-surface-500\" />\r\n                                    </button>\r\n                                    <button onClick={() => { if (confirm('Excluir esta política?')) deleteMut.mutate(p.id) }} className=\"rounded-lg p-1.5 hover:bg-red-50\">\r\n                                        <Trash2 className=\"h-3.5 w-3.5 text-red-500\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {p.description && (\r\n                                <p className=\"mt-2 text-xs text-surface-500 line-clamp-2\">{p.description}</p>\r\n                            )}\r\n\r\n                            <div className=\"mt-4 grid grid-cols-2 gap-3\">\r\n                                <div className=\"rounded-lg bg-blue-50 p-3 text-center\">\r\n                                    <Clock className=\"mx-auto h-4 w-4 text-blue-500 mb-1\" />\r\n                                    <p className=\"text-xs text-blue-600 font-medium\">Resposta</p>\r\n                                    <p className=\"text-lg font-bold text-blue-700\">{fmtHours(p.response_time_hours)}</p>\r\n                                </div>\r\n                                <div className=\"rounded-lg bg-emerald-50 p-3 text-center\">\r\n                                    <AlertTriangle className=\"mx-auto h-4 w-4 text-emerald-500 mb-1\" />\r\n                                    <p className=\"text-xs text-emerald-600 font-medium\">Resolução</p>\r\n                                    <p className=\"text-lg font-bold text-emerald-700\">{fmtHours(p.resolution_time_hours)}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {!p.is_active && (\r\n                                <p className=\"mt-3 text-xs text-surface-400 text-center\">Inativa</p>\r\n                            )}\r\n                        </div>\r\n                    )\r\n                })}\r\n            </div>\r\n\r\n            {/* Modal CRUD */}\r\n            {modal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\" onClick={() => setModal(null)}>\r\n                    <div className=\"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\" onClick={e => e.stopPropagation()}>\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h3 className=\"text-lg font-bold text-surface-900\">{modal.mode === 'edit' ? 'Editar Política' : 'Nova Política SLA'}</h3>\r\n                            <button onClick={() => setModal(null)}><X className=\"h-5 w-5 text-surface-400\" /></button>\r\n                        </div>\r\n                        <form onSubmit={e => {\r\n                            e.preventDefault()\r\n                            const fd = new FormData(e.currentTarget)\r\n                            saveMut.mutate({\r\n                                id: modal.policy?.id,\r\n                                name: fd.get('name'),\r\n                                description: fd.get('description') || null,\r\n                                priority: fd.get('priority'),\r\n                                response_time_hours: Number(fd.get('response_time_hours')),\r\n                                resolution_time_hours: Number(fd.get('resolution_time_hours')),\r\n                                is_active: fd.get('is_active') === 'on',\r\n                            })\r\n                        }} className=\"mt-4 space-y-3\">\r\n                            <div>\r\n                                <label className=\"text-xs font-medium text-surface-700\">Nome</label>\r\n                                <input name=\"name\" required defaultValue={modal.policy?.name} className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-medium text-surface-700\">Descrição</label>\r\n                                <textarea name=\"description\" rows={2} defaultValue={modal.policy?.description ?? ''} className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs font-medium text-surface-700\">Prioridade</label>\r\n                                <select name=\"priority\" required defaultValue={modal.policy?.priority ?? 'medium'} className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\">\r\n                                    {Object.entries(priorityConfig).map(([k, v]) => <option key={k} value={k}>{v.icon} {v.label}</option>)}\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <div>\r\n                                    <label className=\"text-xs font-medium text-surface-700\">Resposta (horas)</label>\r\n                                    <input name=\"response_time_hours\" type=\"number\" min={1} required defaultValue={modal.policy?.response_time_hours ?? 4}\r\n                                        className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-xs font-medium text-surface-700\">Resolução (horas)</label>\r\n                                    <input name=\"resolution_time_hours\" type=\"number\" min={1} required defaultValue={modal.policy?.resolution_time_hours ?? 24}\r\n                                        className=\"mt-1 block w-full rounded-lg border border-surface-300 px-3 py-2 text-sm\" />\r\n                                </div>\r\n                            </div>\r\n                            <label className=\"flex items-center gap-2 text-sm text-surface-700\">\r\n                                <input name=\"is_active\" type=\"checkbox\" defaultChecked={modal.policy?.is_active ?? true} className=\"rounded\" />\r\n                                Ativa\r\n                            </label>\r\n                            <div className=\"flex gap-2 pt-2\">\r\n                                <button type=\"button\" onClick={() => setModal(null)} className=\"flex-1 rounded-xl border border-surface-300 px-4 py-2 text-sm font-medium\">Cancelar</button>\r\n                                <button type=\"submit\" disabled={saveMut.isPending}\r\n                                    className=\"flex-1 rounded-xl bg-brand-500 px-4 py-2 text-sm font-semibold text-white hover:bg-brand-600 disabled:opacity-50\">\r\n                                    {saveMut.isPending ? 'Salvando...' : 'Salvar'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\WorkOrderCreatePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[17,28],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setSelectedEquipIds' is assigned a value but never used.","line":47,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3132,3135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3132,3135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3600,3603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3600,3603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3972,3975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3972,3975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5001,5004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5001,5004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7472,7475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7472,7475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9999,10002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9999,10002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":231,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13008,13011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13008,13011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13818,13821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13818,13821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":247,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14282,14285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14282,14285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":308,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19573,19576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19573,19576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react'\r\nimport { useNavigate, useSearchParams } from 'react-router-dom'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { ArrowLeft, Plus, Trash2, Package, Briefcase, Users, Truck } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\ninterface ItemForm {\r\n    type: 'product' | 'service'\r\n    reference_id: number | ''\r\n    description: string\r\n    quantity: string\r\n    unit_price: string\r\n    discount: string\r\n}\r\n\r\nconst emptyItem: ItemForm = {\r\n    type: 'product', reference_id: '', description: '',\r\n    quantity: '1', unit_price: '0', discount: '0',\r\n}\r\n\r\nexport function WorkOrderCreatePage() {\r\n    const navigate = useNavigate()\r\n    const qc = useQueryClient()\r\n    const [searchParams] = useSearchParams()\r\n\r\n    const [form, setForm] = useState({\r\n        customer_id: '' as string | number,\r\n        equipment_id: '' as string | number,\r\n        assigned_to: '' as string | number,\r\n        priority: 'normal',\r\n        description: '',\r\n        internal_notes: '',\r\n        discount: '0',\r\n        // Novos campos v2\r\n        os_number: '',\r\n        seller_id: '' as string | number,\r\n        driver_id: '' as string | number,\r\n        origin_type: (searchParams.get('origin') || 'direct') as string,\r\n        quote_id: searchParams.get('quote_id') || '',\r\n        service_call_id: searchParams.get('service_call_id') || '',\r\n        discount_percentage: '0',\r\n    })\r\n    const [selectedTechIds, setSelectedTechIds] = useState<number[]>([])\r\n    const [selectedEquipIds, setSelectedEquipIds] = useState<number[]>([])\r\n    const [newEquip, setNewEquip] = useState({ type: '', brand: '', model: '', serial_number: '' })\r\n    const [showNewEquip, setShowNewEquip] = useState(false)\r\n    const [items, setItems] = useState<ItemForm[]>([])\r\n    const [customerSearch, setCustomerSearch] = useState('')\r\n\r\n    // Queries\r\n    const { data: customersRes } = useQuery({\r\n        queryKey: ['customers-select', customerSearch],\r\n        queryFn: () => api.get('/customers', { params: { search: customerSearch, per_page: 20, is_active: true } }),\r\n        enabled: customerSearch.length >= 2,\r\n    })\r\n\r\n    const { data: productsRes } = useQuery({\r\n        queryKey: ['products-select'],\r\n        queryFn: () => api.get('/products', { params: { per_page: 100, is_active: true } }),\r\n    })\r\n\r\n    const { data: servicesRes } = useQuery({\r\n        queryKey: ['services-select'],\r\n        queryFn: () => api.get('/services', { params: { per_page: 100, is_active: true } }),\r\n    })\r\n\r\n    const { data: techsRes } = useQuery({\r\n        queryKey: ['technicians'],\r\n        queryFn: () => api.get('/users', { params: { per_page: 50 } }),\r\n    })\r\n\r\n    const customers = customersRes?.data?.data ?? []\r\n    const products = productsRes?.data?.data ?? []\r\n    const services = servicesRes?.data?.data ?? []\r\n    const technicians = techsRes?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: any) => api.post('/work-orders', data),\r\n        onSuccess: (res) => {\r\n            qc.invalidateQueries({ queryKey: ['work-orders'] })\r\n            navigate(`/os/${res.data.id}`)\r\n        },\r\n    })\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n        setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n    const addItem = () => setItems(prev => [...prev, { ...emptyItem }])\r\n\r\n    const updateItem = (i: number, field: keyof ItemForm, val: any) => {\r\n        setItems(prev => prev.map((item, idx) => {\r\n            if (idx !== i) return item\r\n            const updated = { ...item, [field]: val }\r\n            // Auto-fill from reference\r\n            if (field === 'reference_id' && val) {\r\n                const list = updated.type === 'product' ? products : services\r\n                const ref = list.find((r: any) => r.id === Number(val))\r\n                if (ref) {\r\n                    updated.description = ref.name\r\n                    updated.unit_price = updated.type === 'product' ? ref.sell_price : ref.default_price\r\n                }\r\n            }\r\n            return updated\r\n        }))\r\n    }\r\n\r\n    const removeItem = (i: number) => setItems(prev => prev.filter((_, idx) => idx !== i))\r\n\r\n    const itemTotal = (it: ItemForm) => Math.max(0, (parseFloat(it.quantity) || 0) * (parseFloat(it.unit_price) || 0) - (parseFloat(it.discount) || 0))\r\n    const subtotal = items.reduce((sum, it) => sum + itemTotal(it), 0)\r\n    const discountFixed = parseFloat(form.discount) || 0\r\n    const discountPercent = parseFloat(form.discount_percentage) || 0\r\n    const afterFixed = Math.max(0, subtotal - discountFixed)\r\n    const grandTotal = Math.max(0, afterFixed - (discountPercent > 0 ? afterFixed * discountPercent / 100 : 0))\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        const payload: any = {\r\n            ...form,\r\n            technician_ids: selectedTechIds.length > 0 ? selectedTechIds : undefined,\r\n            equipment_ids: selectedEquipIds.length > 0 ? selectedEquipIds : undefined,\r\n            items: items.map(it => ({\r\n                ...it,\r\n                reference_id: it.reference_id || null,\r\n            })),\r\n        }\r\n        if (showNewEquip && newEquip.type) {\r\n            payload.new_equipment = newEquip\r\n        }\r\n        saveMut.mutate(payload)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-3\">\r\n                <button onClick={() => navigate('/os')} className=\"rounded-lg p-1.5 hover:bg-surface-100\">\r\n                    <ArrowLeft className=\"h-5 w-5 text-surface-500\" />\r\n                </button>\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Nova Ordem de Serviço</h1>\r\n                    <p className=\"text-sm text-surface-500\">Preencha os dados para abrir uma OS</p>\r\n                </div>\r\n            </div>\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n                {/* Cliente + Prioridade */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-4\">\r\n                    <h2 className=\"text-sm font-semibold text-surface-900\">Dados Gerais</h2>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Cliente *</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={customerSearch}\r\n                                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCustomerSearch(e.target.value)}\r\n                                placeholder=\"Digite para buscar cliente...\"\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                            />\r\n                            {customers.length > 0 && !form.customer_id && (\r\n                                <div className=\"mt-1 max-h-32 overflow-y-auto rounded-lg border border-surface-200 bg-white shadow-lg\">\r\n                                    {customers.map((c: any) => (\r\n                                        <button key={c.id} type=\"button\"\r\n                                            onClick={() => { set('customer_id', c.id); setCustomerSearch(c.name) }}\r\n                                            className=\"w-full px-3 py-2 text-left text-sm hover:bg-surface-50\">\r\n                                            <span className=\"font-medium\">{c.name}</span>\r\n                                            {c.document && <span className=\"ml-2 text-xs text-surface-400\">{c.document}</span>}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                            {form.customer_id && (\r\n                                <button type=\"button\" onClick={() => { set('customer_id', ''); setCustomerSearch('') }}\r\n                                    className=\"mt-1 text-xs text-red-500 hover:underline\">Limpar seleção</button>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Prioridade</label>\r\n                            <select value={form.priority} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('priority', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"low\">Baixa</option>\r\n                                <option value=\"normal\">Normal</option>\r\n                                <option value=\"high\">Alta</option>\r\n                                <option value=\"urgent\">Urgente</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Técnico</label>\r\n                            <select value={form.assigned_to} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('assigned_to', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Sem atribuição</option>\r\n                                {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Defeito Relatado / Descrição *</label>\r\n                        <textarea value={form.description} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('description', e.target.value)}\r\n                            rows={3} required placeholder=\"Descreva o problema...\"\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Observações Internas</label>\r\n                        <textarea value={form.internal_notes} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('internal_notes', e.target.value)}\r\n                            rows={2} placeholder=\"Notas internas...\"\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Campos v2: Vendedor, Motorista, Nº Manual, Multi-Técnico */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-4\">\r\n                    <h2 className=\"text-sm font-semibold text-surface-900 flex items-center gap-2\"><Users className=\"h-4 w-4 text-brand-500\" />Equipe e Origem</h2>\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Nº OS (manual)</label>\r\n                            <input value={form.os_number} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('os_number', e.target.value)} placeholder=\"Ex: 001234\"\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Vendedor</label>\r\n                            <select value={form.seller_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('seller_id', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Nenhum</option>\r\n                                {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700 flex items-center gap-1\"><Truck className=\"h-3.5 w-3.5\" />Motorista (UMC)</label>\r\n                            <select value={form.driver_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('driver_id', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Nenhum</option>\r\n                                {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    {/* Multi-técnico */}\r\n                    <div>\r\n                        <label className=\"mb-2 block text-sm font-medium text-surface-700\">Técnicos (múltiplos)</label>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {technicians.map((t: any) => (\r\n                                <button key={t.id} type=\"button\" onClick={() => setSelectedTechIds(prev => prev.includes(t.id) ? prev.filter(id => id !== t.id) : [...prev, t.id])}\r\n                                    className={`rounded-lg border px-3 py-1.5 text-xs font-medium transition-all ${selectedTechIds.includes(t.id) ? 'border-brand-500 bg-brand-50 text-brand-700' : 'border-surface-200 text-surface-600 hover:border-surface-300'}`}>\r\n                                    {t.name}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Equipamento */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Equipamento</h2>\r\n                        <Button variant=\"ghost\" size=\"sm\" type=\"button\" onClick={() => setShowNewEquip(!showNewEquip)}>\r\n                            {showNewEquip ? 'Cancelar' : '+ Novo Equipamento'}\r\n                        </Button>\r\n                    </div>\r\n                    {showNewEquip && (\r\n                        <div className=\"grid gap-3 sm:grid-cols-4\">\r\n                            <Input label=\"Tipo *\" value={newEquip.type} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewEquip(p => ({ ...p, type: e.target.value }))} placeholder=\"Ex: Impressora\" />\r\n                            <Input label=\"Marca\" value={newEquip.brand} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewEquip(p => ({ ...p, brand: e.target.value }))} />\r\n                            <Input label=\"Modelo\" value={newEquip.model} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewEquip(p => ({ ...p, model: e.target.value }))} />\r\n                            <Input label=\"Nº Série\" value={newEquip.serial_number} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewEquip(p => ({ ...p, serial_number: e.target.value }))} />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Itens */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <h2 className=\"text-sm font-semibold text-surface-900\">Itens (Produtos & Serviços)</h2>\r\n                        <Button variant=\"ghost\" size=\"sm\" type=\"button\" onClick={addItem} icon={<Plus className=\"h-4 w-4\" />}>\r\n                            Adicionar\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {items.length === 0 ? (\r\n                        <p className=\"py-6 text-center text-sm text-surface-400\">Nenhum item adicionado</p>\r\n                    ) : (\r\n                        <div className=\"space-y-3\">\r\n                            {items.map((item, i) => (\r\n                                <div key={i} className=\"rounded-lg border border-surface-200 p-3 space-y-3\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        {/* Tipo toggle */}\r\n                                        <div className=\"flex rounded-lg border border-surface-200 overflow-hidden\">\r\n                                            <button type=\"button\" onClick={() => updateItem(i, 'type', 'product')}\r\n                                                className={cn('flex items-center gap-1 px-3 py-1.5 text-xs font-medium transition-colors',\r\n                                                    item.type === 'product' ? 'bg-brand-50 text-brand-700' : 'text-surface-500 hover:bg-surface-50')}>\r\n                                                <Package className=\"h-3 w-3\" /> Produto\r\n                                            </button>\r\n                                            <button type=\"button\" onClick={() => updateItem(i, 'type', 'service')}\r\n                                                className={cn('flex items-center gap-1 px-3 py-1.5 text-xs font-medium transition-colors',\r\n                                                    item.type === 'service' ? 'bg-emerald-50 text-emerald-700' : 'text-surface-500 hover:bg-surface-50')}>\r\n                                                <Briefcase className=\"h-3 w-3\" /> Serviço\r\n                                            </button>\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <select value={item.reference_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => updateItem(i, 'reference_id', e.target.value)}\r\n                                                className=\"w-full rounded-lg border border-surface-200 bg-white px-2.5 py-1.5 text-xs focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                                <option value=\"\">— Selecionar {item.type === 'product' ? 'produto' : 'serviço'} —</option>\r\n                                                {(item.type === 'product' ? products : services).map((r: any) => (\r\n                                                    <option key={r.id} value={r.id}>{r.name} — R$ {item.type === 'product' ? r.sell_price : r.default_price}</option>\r\n                                                ))}\r\n                                            </select>\r\n                                        </div>\r\n                                        <Button variant=\"ghost\" size=\"sm\" type=\"button\" onClick={() => removeItem(i)}>\r\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                    <div className=\"grid gap-3 sm:grid-cols-4\">\r\n                                        <Input label=\"Descrição\" value={item.description} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(i, 'description', e.target.value)} />\r\n                                        <Input label=\"Qtd\" type=\"number\" step=\"0.01\" value={item.quantity} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(i, 'quantity', e.target.value)} />\r\n                                        <Input label=\"Preço Unitário\" type=\"number\" step=\"0.01\" value={item.unit_price} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(i, 'unit_price', e.target.value)} />\r\n                                        <div>\r\n                                            <Input label=\"Desconto\" type=\"number\" step=\"0.01\" value={item.discount} onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateItem(i, 'discount', e.target.value)} />\r\n                                            <p className=\"mt-1 text-right text-xs font-medium text-surface-600\">\r\n                                                Subtotal: {itemTotal(item).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Totais */}\r\n                    <div className=\"border-t border-surface-200 pt-4 space-y-2\">\r\n                        <div className=\"flex items-center justify-between text-sm\">\r\n                            <span className=\"text-surface-600\">Subtotal</span>\r\n                            <span className=\"font-medium\">{subtotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>\r\n                        </div>\r\n                        <div className=\"flex items-center justify-between gap-4 text-sm\">\r\n                            <span className=\"text-surface-600\">Desconto Fixo (R$)</span>\r\n                            <input type=\"number\" step=\"0.01\" value={form.discount} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('discount', e.target.value)}\r\n                                className=\"w-28 rounded-lg border border-surface-200 px-2.5 py-1.5 text-right text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                        </div>\r\n                        <div className=\"flex items-center justify-between gap-4 text-sm\">\r\n                            <span className=\"text-surface-600\">Desconto Global (%)</span>\r\n                            <input type=\"number\" step=\"0.01\" min=\"0\" max=\"100\" value={form.discount_percentage} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('discount_percentage', e.target.value)}\r\n                                className=\"w-28 rounded-lg border border-surface-200 px-2.5 py-1.5 text-right text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                        </div>\r\n                        <div className=\"flex items-center justify-between text-base border-t border-surface-200 pt-2\">\r\n                            <span className=\"font-semibold text-surface-900\">Total</span>\r\n                            <span className=\"font-bold text-brand-600\">{grandTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Ações */}\r\n                <div className=\"flex items-center justify-end gap-3\">\r\n                    <Button variant=\"outline\" type=\"button\" onClick={() => navigate('/os')}>Cancelar</Button>\r\n                    <Button type=\"submit\" loading={saveMut.isPending} disabled={!form.customer_id || !form.description}>\r\n                        Abrir OS\r\n                    </Button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\WorkOrderDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":5,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[202,208],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MapPin' is defined but never used.","line":5,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapPin"},"fix":{"range":[221,229],"text":""},"desc":"Remove unused variable \"MapPin\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DollarSign' is defined but never used.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DollarSign"},"fix":{"range":[373,390],"text":""},"desc":"Remove unused variable \"DollarSign\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CalendarDays' is defined but never used.","line":8,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CalendarDays"},"fix":{"range":[390,404],"text":""},"desc":"Remove unused variable \"CalendarDays\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[824,827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[824,827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[835,838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[835,838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1447,1450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1447,1450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3238,3241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3238,3241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'saveChecklistMut' is assigned a value but never used.","line":76,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3356,3359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3356,3359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4051,4054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4051,4054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4544,4547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4544,4547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StatusIcon' is assigned a value but never used.","line":131,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5898,5901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5898,5901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16117,16120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16117,16120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":345,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19064,19067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19064,19067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19319,19322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19319,19322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":368,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20791,20794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20791,20794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":453,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26966,26969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26966,26969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":582,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":582,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35797,35800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35797,35800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useParams, useNavigate } from 'react-router-dom'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    ArrowLeft, Clock, User, Phone, Mail, MapPin, ClipboardList,\r\n    Briefcase, Package, Plus, Trash2, Pencil, Download, Save, X,\r\n    CheckCircle2, AlertTriangle, Play, Pause, Truck, XCircle,\r\n    DollarSign, CalendarDays, LinkIcon,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\nimport { SignaturePad } from '@/components/signature/SignaturePad'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any; icon: any }> = {\r\n    open: { label: 'Aberta', variant: 'info', icon: Clock },\r\n    in_progress: { label: 'Em Andamento', variant: 'warning', icon: Play },\r\n    waiting_parts: { label: 'Aguard. Peças', variant: 'warning', icon: Pause },\r\n    waiting_approval: { label: 'Aguard. Aprovação', variant: 'brand', icon: Pause },\r\n    completed: { label: 'Concluída', variant: 'success', icon: CheckCircle2 },\r\n    delivered: { label: 'Entregue', variant: 'success', icon: Truck },\r\n    cancelled: { label: 'Cancelada', variant: 'danger', icon: XCircle },\r\n}\r\n\r\nconst priorityConfig: Record<string, { label: string; variant: any }> = {\r\n    low: { label: 'Baixa', variant: 'default' },\r\n    normal: { label: 'Normal', variant: 'info' },\r\n    high: { label: 'Alta', variant: 'warning' },\r\n    urgent: { label: 'Urgente', variant: 'danger' },\r\n}\r\n\r\nexport function WorkOrderDetailPage() {\r\n    const { id } = useParams()\r\n    const navigate = useNavigate()\r\n    const qc = useQueryClient()\r\n    const [showStatusModal, setShowStatusModal] = useState(false)\r\n    const [newStatus, setNewStatus] = useState('')\r\n    const [statusNotes, setStatusNotes] = useState('')\r\n    const [showItemModal, setShowItemModal] = useState(false)\r\n    const [itemForm, setItemForm] = useState({\r\n        type: 'service' as 'product' | 'service',\r\n        reference_id: '' as string | number, description: '',\r\n        quantity: '1', unit_price: '0', discount: '0',\r\n    })\r\n\r\n    // Inline editing states\r\n    const [isEditing, setIsEditing] = useState(false)\r\n    const [editForm, setEditForm] = useState({\r\n        description: '', priority: '', technical_report: '', internal_notes: '',\r\n    })\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['work-order', id],\r\n        queryFn: () => api.get(`/ work - orders / ${id} `),\r\n    })\r\n\r\n    const { data: productsRes } = useQuery({\r\n        queryKey: ['products-select'],\r\n        queryFn: () => api.get('/products', { params: { per_page: 100, is_active: true } }),\r\n    })\r\n\r\n    const { data: servicesRes } = useQuery({\r\n        queryKey: ['services-select'],\r\n        queryFn: () => api.get('/services', { params: { per_page: 100, is_active: true } }),\r\n    })\r\n\r\n    const { data: checklistRes } = useQuery({\r\n        queryKey: ['wo-checklist', id],\r\n        queryFn: () => api.get(`/work-orders/${id}/checklist-responses`),\r\n    })\r\n    const checklistItems: any[] = checklistRes?.data?.data ?? []\r\n\r\n    const saveChecklistMut = useMutation({\r\n        mutationFn: (responses: any[]) => api.post(`/work-orders/${id}/checklist-responses`, { responses }),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['wo-checklist', id] }),\r\n    })\r\n\r\n    const order = res?.data\r\n    const products = productsRes?.data?.data ?? []\r\n    const services = servicesRes?.data?.data ?? []\r\n\r\n    const statusMut = useMutation({\r\n        mutationFn: (data: { status: string; notes: string }) =>\r\n            api.post(`/ work - orders / ${id}/status`, data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['work-order', id] })\r\n            setShowStatusModal(false)\r\n        },\r\n    })\r\n\r\n    const addItemMut = useMutation({\r\n        mutationFn: (data: any) => api.post(`/work-orders/${id}/items`, data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['work-order', id] })\r\n            setShowItemModal(false)\r\n        },\r\n    })\r\n\r\n    const delItemMut = useMutation({\r\n        mutationFn: (itemId: number) => api.delete(`/work-orders/${id}/items/${itemId}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['work-order', id] }),\r\n    })\r\n\r\n    const updateMut = useMutation({\r\n        mutationFn: (data: any) => api.put(`/work-orders/${id}`, data),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['work-order', id] }),\r\n    })\r\n\r\n    const signMut = useMutation({\r\n        mutationFn: (data: { signature: string; signer_name: string }) =>\r\n            api.post(`/work-orders/${id}/signature`, data),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['work-order', id] }),\r\n    })\r\n\r\n    if (isLoading || !order) {\r\n        return <div className=\"py-16 text-center text-sm text-surface-500\">Carregando...</div>\r\n    }\r\n\r\n    const formatBRL = (v: string | number) =>\r\n        parseFloat(String(v)).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\n    const formatDate = (d: string | null) =>\r\n        d ? new Date(d).toLocaleDateString('pt-BR', {\r\n            day: '2-digit', month: '2-digit', year: '2-digit', hour: '2-digit', minute: '2-digit',\r\n        }) : '—'\r\n\r\n    const sc = statusConfig[order.status] ?? statusConfig.open\r\n    const StatusIcon = sc.icon\r\n\r\n    const openItemForm = () => {\r\n        setItemForm({ type: 'service', reference_id: '', description: '', quantity: '1', unit_price: '0', discount: '0' })\r\n        setShowItemModal(true)\r\n    }\r\n\r\n    const handleRefChange = (val: string) => {\r\n        const list = itemForm.type === 'product' ? products : services\r\n        const ref = list.find((r: any) => r.id === Number(val))\r\n        setItemForm(prev => ({\r\n            ...prev,\r\n            reference_id: val,\r\n            description: ref?.name ?? prev.description,\r\n            unit_price: itemForm.type === 'product' ? (ref?.sell_price ?? '0') : (ref?.default_price ?? '0'),\r\n        }))\r\n    }\r\n\r\n    const startEditing = () => {\r\n        setEditForm({\r\n            description: order.description ?? '',\r\n            priority: order.priority ?? 'normal',\r\n            technical_report: order.technical_report ?? '',\r\n            internal_notes: order.internal_notes ?? '',\r\n        })\r\n        setIsEditing(true)\r\n    }\r\n\r\n    const cancelEditing = () => setIsEditing(false)\r\n\r\n    const saveEditing = () => {\r\n        updateMut.mutate(editForm, { onSuccess: () => setIsEditing(false) })\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button onClick={() => navigate('/os')} className=\"rounded-lg p-1.5 hover:bg-surface-100\">\r\n                        <ArrowLeft className=\"h-5 w-5 text-surface-500\" />\r\n                    </button>\r\n                    <div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <h1 className=\"text-2xl font-bold text-surface-900\">{order.number}</h1>\r\n                            <Badge variant={sc.variant} dot>{sc.label}</Badge>\r\n                            {order.priority !== 'normal' && (\r\n                                <Badge variant={priorityConfig[order.priority]?.variant}>\r\n                                    {order.priority === 'urgent' && <AlertTriangle className=\"h-3 w-3 mr-0.5\" />}\r\n                                    {priorityConfig[order.priority]?.label}\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n                        <p className=\"text-sm text-surface-500\">Criada em {formatDate(order.created_at)}</p>\r\n                        {/* Rastreabilidade */}\r\n                        <div className=\"mt-1 flex items-center gap-2\">\r\n                            {order.quote_id && (\r\n                                <button onClick={() => navigate(`/orcamentos/${order.quote_id}`)}\r\n                                    className=\"inline-flex items-center gap-1 rounded-md bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700 hover:bg-amber-100 transition-colors\">\r\n                                    <LinkIcon className=\"h-3 w-3\" /> Orçamento #{order.quote?.number ?? order.quote_id}\r\n                                </button>\r\n                            )}\r\n                            {order.service_call_id && (\r\n                                <button onClick={() => navigate(`/chamados/${order.service_call_id}`)}\r\n                                    className=\"inline-flex items-center gap-1 rounded-md bg-sky-50 px-2 py-0.5 text-xs font-medium text-sky-700 hover:bg-sky-100 transition-colors\">\r\n                                    <LinkIcon className=\"h-3 w-3\" /> Chamado #{order.service_call_id}\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    {!isEditing ? (\r\n                        <Button variant=\"outline\" icon={<Pencil className=\"h-4 w-4\" />} onClick={startEditing}>\r\n                            Editar\r\n                        </Button>\r\n                    ) : (\r\n                        <>\r\n                            <Button variant=\"outline\" icon={<X className=\"h-4 w-4\" />} onClick={cancelEditing}>\r\n                                Cancelar\r\n                            </Button>\r\n                            <Button icon={<Save className=\"h-4 w-4\" />} onClick={saveEditing} loading={updateMut.isPending}>\r\n                                Salvar\r\n                            </Button>\r\n                        </>\r\n                    )}\r\n                    <Button variant=\"outline\" icon={<Download className=\"h-4 w-4\" />}\r\n                        onClick={() => window.open(`${api.defaults.baseURL}/work-orders/${id}/pdf`, '_blank')}>\r\n                        Baixar PDF\r\n                    </Button>\r\n                    <Button onClick={() => { setNewStatus(order.status); setStatusNotes(''); setShowStatusModal(true) }}>\r\n                        Alterar Status\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid gap-6 lg:grid-cols-3\">\r\n                {/* Main Content */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    {/* Descrição */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <h3 className=\"text-sm font-semibold text-surface-900 mb-2\">Defeito Relatado</h3>\r\n                        {isEditing ? (\r\n                            <textarea\r\n                                value={editForm.description}\r\n                                onChange={e => setEditForm(p => ({ ...p, description: e.target.value }))}\r\n                                rows={4}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                            />\r\n                        ) : (\r\n                            <p className=\"text-sm text-surface-700 whitespace-pre-wrap\">{order.description}</p>\r\n                        )}\r\n\r\n                        {isEditing && (\r\n                            <div className=\"mt-4 border-t border-surface-200 pt-4\">\r\n                                <h3 className=\"text-sm font-semibold text-surface-900 mb-2\">Prioridade</h3>\r\n                                <div className=\"flex gap-2\">\r\n                                    {Object.entries(priorityConfig).map(([key, conf]) => (\r\n                                        <button key={key} type=\"button\" onClick={() => setEditForm(p => ({ ...p, priority: key }))}\r\n                                            className={cn('rounded-lg border px-3 py-1.5 text-xs font-medium transition-all',\r\n                                                editForm.priority === key\r\n                                                    ? 'border-brand-500 bg-brand-50 text-brand-700'\r\n                                                    : 'border-surface-200 text-surface-600 hover:border-surface-300')}>\r\n                                            {conf.label}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"mt-4 border-t border-surface-200 pt-4\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-900 mb-2\">Laudo Técnico</h3>\r\n                            {isEditing ? (\r\n                                <textarea\r\n                                    value={editForm.technical_report}\r\n                                    onChange={e => setEditForm(p => ({ ...p, technical_report: e.target.value }))}\r\n                                    rows={3}\r\n                                    placeholder=\"Escreva o laudo técnico...\"\r\n                                    className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                                />\r\n                            ) : (\r\n                                order.technical_report\r\n                                    ? <p className=\"text-sm text-surface-700 whitespace-pre-wrap\">{order.technical_report}</p>\r\n                                    : <p className=\"text-sm text-surface-400 italic\">Nenhum laudo registrado</p>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 border-t border-surface-200 pt-4\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-500 mb-1\">Observações Internas</h3>\r\n                            {isEditing ? (\r\n                                <textarea\r\n                                    value={editForm.internal_notes}\r\n                                    onChange={e => setEditForm(p => ({ ...p, internal_notes: e.target.value }))}\r\n                                    rows={2}\r\n                                    placeholder=\"Notas internas...\"\r\n                                    className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\"\r\n                                />\r\n                            ) : (\r\n                                order.internal_notes\r\n                                    ? <p className=\"text-xs text-surface-500 italic\">{order.internal_notes}</p>\r\n                                    : <p className=\"text-xs text-surface-400 italic\">Nenhuma observação interna</p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Itens */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <h3 className=\"text-sm font-semibold text-surface-900\">Itens</h3>\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={openItemForm} icon={<Plus className=\"h-4 w-4\" />}>\r\n                                Adicionar\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {order.items?.length === 0 ? (\r\n                            <p className=\"py-6 text-center text-sm text-surface-400\">Nenhum item</p>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                {order.items?.map((item: any) => (\r\n                                    <div key={item.id} className=\"flex items-center gap-3 rounded-lg border border-surface-100 p-3 hover:bg-surface-50\">\r\n                                        <div className={cn('rounded-md p-1.5', item.type === 'product' ? 'bg-brand-50' : 'bg-emerald-50')}>\r\n                                            {item.type === 'product'\r\n                                                ? <Package className=\"h-4 w-4 text-brand-600\" />\r\n                                                : <Briefcase className=\"h-4 w-4 text-emerald-600\" />}\r\n                                        </div>\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <p className=\"text-sm font-medium text-surface-800\">{item.description}</p>\r\n                                            <p className=\"text-xs text-surface-400\">{item.quantity} × {formatBRL(item.unit_price)}</p>\r\n                                        </div>\r\n                                        <span className=\"text-sm font-semibold text-surface-900\">{formatBRL(item.total)}</span>\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Remover?')) delItemMut.mutate(item.id) }}>\r\n                                            <Trash2 className=\"h-3.5 w-3.5 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                ))}\r\n                                <div className=\"flex items-center justify-between border-t border-surface-200 pt-3 mt-3\">\r\n                                    <span className=\"text-sm font-medium text-surface-600\">Desconto</span>\r\n                                    <span className=\"text-sm text-surface-600\">{formatBRL(order.discount)}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <span className=\"text-base font-bold text-surface-900\">Total</span>\r\n                                    <span className=\"text-base font-bold text-brand-600\">{formatBRL(order.total)}</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Checklist */}\r\n                    {checklistItems.length > 0 && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <div className=\"flex items-center gap-2 mb-4\">\r\n                                <ClipboardList className=\"h-4 w-4 text-brand-600\" />\r\n                                <h3 className=\"text-sm font-semibold text-surface-900\">Checklist</h3>\r\n                                <span className=\"ml-auto text-xs text-surface-400\">\r\n                                    {checklistItems.filter((c: any) => c.value).length}/{checklistItems.length} preenchidos\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                {checklistItems.map((item: any) => (\r\n                                    <div key={item.id} className=\"flex items-center gap-3 rounded-lg bg-surface-50 p-3\">\r\n                                        <div className={cn('h-2 w-2 rounded-full flex-shrink-0', item.value ? 'bg-emerald-500' : 'bg-surface-300')} />\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <p className=\"text-sm font-medium text-surface-800\">{item.item?.description ?? `Item #${item.checklist_item_id}`}</p>\r\n                                            {item.value && <p className=\"text-xs text-surface-500 mt-0.5\">{item.value}</p>}\r\n                                            {item.notes && <p className=\"text-xs text-surface-400 italic\">{item.notes}</p>}\r\n                                        </div>\r\n                                        <span className=\"text-xs text-surface-400\">{item.item?.type}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Timeline */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                        <h3 className=\"text-sm font-semibold text-surface-900 mb-4\">Timeline</h3>\r\n                        <div className=\"relative ml-3 space-y-0\">\r\n                            {order.status_history?.map((entry: any, i: number) => {\r\n                                const entryConf = statusConfig[entry.to_status] ?? statusConfig.open\r\n                                const EntryIcon = entryConf.icon\r\n                                return (\r\n                                    <div key={entry.id} className=\"relative pb-6 pl-6\">\r\n                                        {i < order.status_history.length - 1 && (\r\n                                            <span className=\"absolute left-[7px] top-5 bottom-0 w-px bg-surface-200\" />\r\n                                        )}\r\n                                        <div className={cn('absolute left-0 top-0.5 flex h-4 w-4 items-center justify-center rounded-full',\r\n                                            `bg-${entryConf.variant === 'info' ? 'sky' : entryConf.variant === 'warning' ? 'amber' : entryConf.variant === 'success' ? 'emerald' : entryConf.variant === 'danger' ? 'red' : 'surface'}-100`)}>\r\n                                            <EntryIcon className=\"h-2.5 w-2.5 text-surface-600\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Badge variant={entryConf.variant} className=\"text-[10px]\">{entryConf.label}</Badge>\r\n                                                <span className=\"text-xs text-surface-400\">{formatDate(entry.created_at)}</span>\r\n                                            </div>\r\n                                            <p className=\"mt-0.5 text-xs text-surface-500\">\r\n                                                por <span className=\"font-medium\">{entry.user?.name}</span>\r\n                                                {entry.notes && <> — {entry.notes}</>}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Sidebar Info */}\r\n                <div className=\"space-y-4\">\r\n                    {/* Cliente */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <h3 className=\"text-xs font-semibold uppercase tracking-wider text-surface-500 mb-3\">Cliente</h3>\r\n                        <p className=\"text-sm font-medium text-surface-900\">{order.customer?.name}</p>\r\n                        {order.customer?.phone && (\r\n                            <p className=\"mt-1 flex items-center gap-1.5 text-xs text-surface-500\"><Phone className=\"h-3 w-3\" />{order.customer.phone}</p>\r\n                        )}\r\n                        {order.customer?.email && (\r\n                            <p className=\"mt-0.5 flex items-center gap-1.5 text-xs text-surface-500\"><Mail className=\"h-3 w-3\" />{order.customer.email}</p>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Equipamento */}\r\n                    {order.equipment && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <h3 className=\"text-xs font-semibold uppercase tracking-wider text-surface-500 mb-3\">Equipamento</h3>\r\n                            <p className=\"text-sm font-medium text-surface-900\">{order.equipment.type}</p>\r\n                            {order.equipment.brand && <p className=\"text-xs text-surface-500\">{order.equipment.brand} {order.equipment.model}</p>}\r\n                            {order.equipment.serial_number && <p className=\"text-xs text-surface-400 mt-1\">S/N: {order.equipment.serial_number}</p>}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Responsáveis */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <h3 className=\"text-xs font-semibold uppercase tracking-wider text-surface-500 mb-3\">Responsáveis</h3>\r\n                        <div className=\"space-y-2 text-sm\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <span className=\"text-surface-500\">Criada por</span>\r\n                                <span className=\"font-medium text-surface-700\">{order.creator?.name}</span>\r\n                            </div>\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <span className=\"text-surface-500\">Técnico</span>\r\n                                <span className=\"font-medium text-surface-700\">{order.assignee?.name ?? '—'}</span>\r\n                            </div>\r\n                            {order.seller && (\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <span className=\"text-surface-500\">Vendedor</span>\r\n                                    <span className=\"font-medium text-surface-700\">{order.seller.name}</span>\r\n                                </div>\r\n                            )}\r\n                            {order.driver && (\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <span className=\"text-surface-500\">Motorista</span>\r\n                                    <span className=\"font-medium text-surface-700\">{order.driver.name}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Técnicos N:N */}\r\n                    {order.technicians?.length > 0 && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <h3 className=\"text-xs font-semibold uppercase tracking-wider text-surface-500 mb-3\">Técnicos Atribuídos</h3>\r\n                            <div className=\"flex flex-wrap gap-1.5\">\r\n                                {order.technicians.map((t: any) => (\r\n                                    <Badge key={t.id} variant=\"info\">{t.name}{t.pivot?.role === 'driver' ? ' (Mot.)' : ''}</Badge>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Origem */}\r\n                    {(order.quote || order.service_call || order.os_number) && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <h3 className=\"text-xs font-semibold uppercase tracking-wider text-surface-500 mb-3\">Origem</h3>\r\n                            <div className=\"space-y-2 text-sm\">\r\n                                {order.os_number && (\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-surface-500\">Nº Manual</span>\r\n                                        <span className=\"font-mono font-medium text-surface-700\">{order.os_number}</span>\r\n                                    </div>\r\n                                )}\r\n                                {order.origin_type && (\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-surface-500\">Tipo</span>\r\n                                        <Badge variant={order.origin_type === 'quote' ? 'brand' : order.origin_type === 'service_call' ? 'warning' : 'default'}>\r\n                                            {order.origin_type === 'quote' ? 'Orçamento' : order.origin_type === 'service_call' ? 'Chamado' : 'Direto'}\r\n                                        </Badge>\r\n                                    </div>\r\n                                )}\r\n                                {order.quote && (\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-surface-500\">Orçamento</span>\r\n                                        <button onClick={() => navigate(`/orcamentos/${order.quote_id}`)} className=\"text-xs font-medium text-brand-600 hover:underline\">\r\n                                            {order.quote.quote_number}\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                                {order.service_call && (\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-surface-500\">Chamado</span>\r\n                                        <span className=\"text-xs font-medium text-surface-700\">{order.service_call.call_number}</span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Datas */}\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <h3 className=\"text-xs font-semibold uppercase tracking-wider text-surface-500 mb-3\">Datas</h3>\r\n                        <div className=\"space-y-1.5 text-xs\">\r\n                            {[\r\n                                ['Criada', order.created_at],\r\n                                ['Recebido', order.received_at],\r\n                                ['Iniciada', order.started_at],\r\n                                ['Concluída', order.completed_at],\r\n                                ['Entregue', order.delivered_at],\r\n                            ].map(([label, date]) => (\r\n                                <div key={label as string} className=\"flex items-center justify-between\">\r\n                                    <span className=\"text-surface-500\">{label}</span>\r\n                                    <span className=\"text-surface-700\">{formatDate(date as string)}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white rounded-xl shadow-card\">\r\n                        <SignaturePad\r\n                            onSave={signMut.mutate}\r\n                            disabled={signMut.isPending || !!order.signature_path}\r\n                            existingSignature={order.signature_path}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Status Modal */}\r\n            <Modal open={showStatusModal} onOpenChange={setShowStatusModal} title=\"Alterar Status\" size=\"sm\">\r\n                <form onSubmit={e => { e.preventDefault(); statusMut.mutate({ status: newStatus, notes: statusNotes }) }} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"mb-2 block text-sm font-medium text-surface-700\">Novo Status</label>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            {Object.entries(statusConfig).map(([key, conf]) => {\r\n                                const Icon = conf.icon\r\n                                return (\r\n                                    <button key={key} type=\"button\" onClick={() => setNewStatus(key)}\r\n                                        className={cn('flex items-center gap-2 rounded-lg border p-2.5 text-xs font-medium transition-all',\r\n                                            newStatus === key\r\n                                                ? 'border-brand-500 bg-brand-50 text-brand-700'\r\n                                                : 'border-surface-200 text-surface-600 hover:border-surface-300')}>\r\n                                        <Icon className=\"h-3.5 w-3.5\" />\r\n                                        {conf.label}\r\n                                    </button>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Observação</label>\r\n                        <textarea value={statusNotes} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setStatusNotes(e.target.value)} rows={2}\r\n                            placeholder=\"Motivo da mudança...\"\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowStatusModal(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={statusMut.isPending}>Confirmar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Add Item Modal */}\r\n            <Modal open={showItemModal} onOpenChange={setShowItemModal} title=\"Adicionar Item\">\r\n                <form onSubmit={e => {\r\n                    e.preventDefault()\r\n                    addItemMut.mutate({ ...itemForm, reference_id: itemForm.reference_id || null })\r\n                }} className=\"space-y-4\">\r\n                    <div className=\"flex rounded-lg border border-surface-200 overflow-hidden\">\r\n                        {(['product', 'service'] as const).map(t => (\r\n                            <button key={t} type=\"button\" onClick={() => setItemForm(p => ({ ...p, type: t, reference_id: '' }))}\r\n                                className={cn('flex-1 py-2 text-sm font-medium transition-colors',\r\n                                    itemForm.type === t ? (t === 'product' ? 'bg-brand-50 text-brand-700' : 'bg-emerald-50 text-emerald-700') : 'text-surface-500')}>\r\n                                {t === 'product' ? 'Produto' : 'Serviço'}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">\r\n                            {itemForm.type === 'product' ? 'Produto' : 'Serviço'}\r\n                        </label>\r\n                        <select value={itemForm.reference_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => handleRefChange(e.target.value)}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                            <option value=\"\">— Selecionar —</option>\r\n                            {(itemForm.type === 'product' ? products : services).map((r: any) => (\r\n                                <option key={r.id} value={r.id}>{r.name}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <Input label=\"Descrição\" value={itemForm.description}\r\n                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => setItemForm(p => ({ ...p, description: e.target.value }))} required />\r\n                    <div className=\"grid grid-cols-3 gap-3\">\r\n                        <Input label=\"Qtd\" type=\"number\" step=\"0.01\" value={itemForm.quantity}\r\n                            onChange={(e: React.ChangeEvent<HTMLInputElement>) => setItemForm(p => ({ ...p, quantity: e.target.value }))} />\r\n                        <Input label=\"Preço Un.\" type=\"number\" step=\"0.01\" value={itemForm.unit_price}\r\n                            onChange={(e: React.ChangeEvent<HTMLInputElement>) => setItemForm(p => ({ ...p, unit_price: e.target.value }))} />\r\n                        <Input label=\"Desconto\" type=\"number\" step=\"0.01\" value={itemForm.discount}\r\n                            onChange={(e: React.ChangeEvent<HTMLInputElement>) => setItemForm(p => ({ ...p, discount: e.target.value }))} />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowItemModal(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={addItemMut.isPending}>Adicionar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\WorkOrderKanbanPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'arrayMove' is defined but never used.","line":17,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"arrayMove"},"fix":{"range":[366,376],"text":""},"desc":"Remove unused variable \"arrayMove\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[655,663],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":26,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[669,676],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1279,1282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1279,1282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1837,1840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1837,1840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'event' is defined but never used.","line":181,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":181,"endColumn":34}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react'\r\nimport {\r\n    DndContext,\r\n    DragOverlay,\r\n    closestCorners,\r\n    KeyboardSensor,\r\n    PointerSensor,\r\n    useSensor,\r\n    useSensors,\r\n    type DragStartEvent,\r\n    type DragOverEvent,\r\n    type DragEndEvent,\r\n    defaultDropAnimationSideEffects,\r\n    type DropAnimation,\r\n} from '@dnd-kit/core'\r\nimport {\r\n    arrayMove,\r\n    SortableContext,\r\n    sortableKeyboardCoordinates,\r\n    verticalListSortingStrategy,\r\n    useSortable,\r\n} from '@dnd-kit/sortable'\r\nimport { CSS } from '@dnd-kit/utilities'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Search, Filter, Plus, Clock, User, AlertTriangle\r\n} from 'lucide-react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\n// --- Types ---\r\ninterface WorkOrder {\r\n    id: number\r\n    number: string\r\n    status: string\r\n    priority: string\r\n    description: string\r\n    total: string\r\n    created_at: string\r\n    customer: { id: number; name: string }\r\n    assignee: { id: number; name: string } | null\r\n}\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any; dot?: boolean }> = {\r\n    open: { label: 'Aberta', variant: 'info', dot: true },\r\n    in_progress: { label: 'Em Andamento', variant: 'warning', dot: true },\r\n    waiting_parts: { label: 'Aguard. Peças', variant: 'warning' },\r\n    waiting_approval: { label: 'Aguard. Aprovação', variant: 'brand' },\r\n    completed: { label: 'Concluída', variant: 'success', dot: true },\r\n    delivered: { label: 'Entregue', variant: 'success' },\r\n    invoiced: { label: 'Faturada', variant: 'brand' },\r\n}\r\n\r\nconst priorityConfig: Record<string, { label: string; variant: any }> = {\r\n    low: { label: 'Baixa', variant: 'default' },\r\n    normal: { label: 'Normal', variant: 'info' },\r\n    high: { label: 'Alta', variant: 'warning' },\r\n    urgent: { label: 'Urgente', variant: 'danger' },\r\n}\r\n\r\nconst columns = Object.keys(statusConfig)\r\n\r\n// --- Sortable Item Component ---\r\nfunction SortableItem({ id, workOrder, onClick }: { id: number; workOrder: WorkOrder; onClick: () => void }) {\r\n    const {\r\n        attributes,\r\n        listeners,\r\n        setNodeRef,\r\n        transform,\r\n        transition,\r\n        isDragging,\r\n    } = useSortable({ id })\r\n\r\n    const style = {\r\n        transform: CSS.Transform.toString(transform),\r\n        transition,\r\n        opacity: isDragging ? 0.5 : 1,\r\n    }\r\n\r\n    const formatBRL = (v: string) => parseFloat(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\n    return (\r\n        <div\r\n            ref={setNodeRef}\r\n            style={style}\r\n            {...attributes}\r\n            {...listeners}\r\n            onClick={onClick}\r\n            className={cn(\r\n                \"bg-white p-3 rounded-lg border border-surface-200 shadow-sm hover:shadow-md transition-all cursor-grab active:cursor-grabbing mb-2\",\r\n                isDragging && \"ring-2 ring-brand-500 ring-opacity-50 z-50\"\r\n            )}\r\n        >\r\n            <div className=\"flex justify-between items-start mb-2\">\r\n                <span className=\"text-xs font-bold text-brand-600\">{workOrder.number}</span>\r\n                {workOrder.priority !== 'normal' && (\r\n                    <Badge variant={priorityConfig[workOrder.priority]?.variant ?? 'default'} className=\"px-1.5 py-0 text-[10px]\">\r\n                        {workOrder.priority === 'urgent' && <AlertTriangle className=\"h-3 w-3 mr-0.5 inline\" />}\r\n                        {priorityConfig[workOrder.priority]?.label}\r\n                    </Badge>\r\n                )}\r\n            </div>\r\n            <p className=\"text-sm font-medium text-surface-900 mb-2 line-clamp-2\">{workOrder.description}</p>\r\n            <div className=\"flex items-center gap-1.5 text-xs text-surface-500 mb-2\">\r\n                <User className=\"h-3 w-3\" />\r\n                <span className=\"truncate\">{workOrder.customer.name}</span>\r\n            </div>\r\n            <div className=\"flex justify-between items-center text-xs pt-2 border-t border-surface-100\">\r\n                <span className=\"font-semibold text-surface-700\">{formatBRL(workOrder.total)}</span>\r\n                {workOrder.assignee && (\r\n                    <span className=\"bg-surface-100 px-1.5 py-0.5 rounded text-surface-600 truncate max-w-[80px]\">\r\n                        {workOrder.assignee.name.split(' ')[0]}\r\n                    </span>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n// --- Main Page Component ---\r\nexport function WorkOrderKanbanPage() {\r\n    const navigate = useNavigate()\r\n    const queryClient = useQueryClient()\r\n    const [search, setSearch] = useState('')\r\n    const [priorityFilter, setPriorityFilter] = useState('')\r\n    const [activeId, setActiveId] = useState<number | null>(null)\r\n\r\n    // Fetch Data\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['work-orders', 'kanban', search],\r\n        queryFn: () => api.get('/work-orders', {\r\n            params: { search, per_page: 100, status: columns.join(',') }, // Fetch mostly everything\r\n        }),\r\n    })\r\n\r\n    // Process Data into Columns\r\n    const items = useMemo(() => {\r\n        const raw = (res?.data?.data ?? []) as WorkOrder[]\r\n        const filtered = priorityFilter ? raw.filter(wo => wo.priority === priorityFilter) : raw\r\n        const grouped: Record<string, WorkOrder[]> = {}\r\n        columns.forEach(col => grouped[col] = [])\r\n        filtered.forEach(wo => {\r\n            if (grouped[wo.status]) {\r\n                grouped[wo.status].push(wo)\r\n            }\r\n        })\r\n        return grouped\r\n    }, [res, priorityFilter])\r\n\r\n    const totalByCol = useMemo(() => {\r\n        const totals: Record<string, number> = {}\r\n        columns.forEach(col => {\r\n            totals[col] = (items[col] ?? []).reduce((acc, wo) => acc + parseFloat(wo.total || '0'), 0)\r\n        })\r\n        return totals\r\n    }, [items])\r\n\r\n    // Mutation for status update\r\n    const updateStatusMutation = useMutation({\r\n        mutationFn: ({ id, status }: { id: number; status: string }) =>\r\n            api.patch(`/work-orders/${id}/status`, { status }),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['work-orders'] })\r\n        },\r\n    })\r\n\r\n    // Drag & Drop Sensors\r\n    const sensors = useSensors(\r\n        useSensor(PointerSensor, { activationConstraint: { distance: 5 } }),\r\n        useSensor(KeyboardSensor, { coordinateGetter: sortableKeyboardCoordinates })\r\n    )\r\n\r\n    // Drag Handlers\r\n    const handleDragStart = (event: DragStartEvent) => {\r\n        setActiveId(event.active.id as number)\r\n    }\r\n\r\n    const handleDragOver = (event: DragOverEvent) => {\r\n        // Optimization: We could handle optimistic UI updates here for smoother sorting\r\n    }\r\n\r\n    const handleDragEnd = (event: DragEndEvent) => {\r\n        const { active, over } = event\r\n\r\n        if (!over) return\r\n\r\n        const activeId = active.id as number\r\n        const overId = over.id\r\n\r\n        // Find the work order and its current status\r\n        let activeWorkOrder: WorkOrder | undefined\r\n        let currentStatus = ''\r\n\r\n        for (const col of columns) {\r\n            const found = items[col].find(i => i.id === activeId)\r\n            if (found) {\r\n                activeWorkOrder = found\r\n                currentStatus = col\r\n                break\r\n            }\r\n        }\r\n\r\n        if (!activeWorkOrder) return\r\n\r\n        // Check if dropped on a column container\r\n        if (columns.includes(overId as string)) {\r\n            const newStatus = overId as string\r\n            if (newStatus !== currentStatus) {\r\n                updateStatusMutation.mutate({ id: activeId, status: newStatus })\r\n            }\r\n        }\r\n        // Check if dropped on another item\r\n        else {\r\n            // Find which column the \"over\" item belongs to\r\n            let newStatus = ''\r\n            for (const col of columns) {\r\n                if (items[col].find(i => i.id === overId)) {\r\n                    newStatus = col\r\n                    break\r\n                }\r\n            }\r\n            if (newStatus && newStatus !== currentStatus) {\r\n                updateStatusMutation.mutate({ id: activeId, status: newStatus })\r\n            }\r\n        }\r\n\r\n        setActiveId(null)\r\n    }\r\n\r\n    const dropAnimation: DropAnimation = {\r\n        sideEffects: defaultDropAnimationSideEffects({\r\n            styles: {\r\n                active: { opacity: '0.5' },\r\n            },\r\n        }),\r\n    }\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col overflow-hidden\">\r\n            {/* Header */}\r\n            <div className=\"flex-none px-6 py-4 flex items-center justify-between border-b border-surface-200 bg-white\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Kanban de OS</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Visualize e gerencie o fluxo de trabalho</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"relative w-64\">\r\n                        <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            value={search}\r\n                            onChange={(e) => setSearch(e.target.value)}\r\n                            placeholder=\"Buscar...\"\r\n                            className=\"w-full rounded-lg border border-surface-300 pl-9 pr-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500\"\r\n                        />\r\n                    </div>\r\n                    <select value={priorityFilter} onChange={(e) => setPriorityFilter(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                        <option value=\"\">Todas prioridades</option>\r\n                        <option value=\"low\">Baixa</option>\r\n                        <option value=\"normal\">Normal</option>\r\n                        <option value=\"high\">Alta</option>\r\n                        <option value=\"urgent\">Urgente</option>\r\n                    </select>\r\n                    <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => navigate('/os/nova')}>\r\n                        Nova OS\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Kanban Board */}\r\n            <div className=\"flex-1 overflow-x-auto overflow-y-hidden bg-surface-50 p-6\">\r\n                <DndContext\r\n                    sensors={sensors}\r\n                    collisionDetection={closestCorners}\r\n                    onDragStart={handleDragStart}\r\n                    onDragOver={handleDragOver}\r\n                    onDragEnd={handleDragEnd}\r\n                >\r\n                    <div className=\"flex h-full gap-4 min-w-max\">\r\n                        {columns.map(colId => (\r\n                            <div key={colId} className=\"w-72 flex flex-col rounded-xl bg-surface-100 border border-surface-200 h-full max-h-full\">\r\n                                {/* Column Header */}\r\n                                <div className={cn(\r\n                                    \"p-3 rounded-t-xl border-b border-surface-200 bg-white sticky top-0 z-10\",\r\n                                    statusConfig[colId].variant === 'success' && \"border-t-4 border-t-green-500\",\r\n                                    statusConfig[colId].variant === 'warning' && \"border-t-4 border-t-amber-500\",\r\n                                    statusConfig[colId].variant === 'danger' && \"border-t-4 border-t-red-500\",\r\n                                    statusConfig[colId].variant === 'info' && \"border-t-4 border-t-sky-500\",\r\n                                    statusConfig[colId].variant === 'brand' && \"border-t-4 border-t-brand-500\",\r\n                                )}>\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <h3 className=\"font-semibold text-surface-700 text-sm\">{statusConfig[colId].label}</h3>\r\n                                        <Badge variant=\"outline\" className=\"bg-surface-50 text-surface-600 border-surface-200\">\r\n                                            {items[colId]?.length ?? 0}\r\n                                        </Badge>\r\n                                    </div>\r\n                                    {(totalByCol[colId] ?? 0) > 0 && (\r\n                                        <p className=\"text-[10px] text-surface-400 mt-1 font-medium\">\r\n                                            {Number(totalByCol[colId]).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Droppable Area */}\r\n                                <SortableContext\r\n                                    id={colId} // Column ID acts as droppable container\r\n                                    items={items[colId]?.map(i => i.id) ?? []}\r\n                                    strategy={verticalListSortingStrategy}\r\n                                >\r\n                                    <div className=\"flex-1 overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-surface-300 scrollbar-track-transparent\">\r\n                                        {isLoading ? (\r\n                                            <div className=\"p-4 text-center text-xs text-surface-400\">Carregando...</div>\r\n                                        ) : items[colId]?.length === 0 ? (\r\n                                            <div className=\"p-4 text-center text-xs text-surface-400 border-2 border-dashed border-surface-200 rounded-lg m-2\">\r\n                                                Vazio\r\n                                            </div>\r\n                                        ) : (\r\n                                            items[colId]?.map(wo => (\r\n                                                <SortableItem\r\n                                                    key={wo.id}\r\n                                                    id={wo.id}\r\n                                                    workOrder={wo}\r\n                                                    onClick={() => navigate(`/os/${wo.id}`)}\r\n                                                />\r\n                                            ))\r\n                                        )}\r\n                                    </div>\r\n                                </SortableContext>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Drag Overlay */}\r\n                    <DragOverlay dropAnimation={dropAnimation}>\r\n                        {activeId ? (\r\n                            <div className=\"bg-white p-3 rounded-lg border border-brand-200 shadow-xl opacity-90 w-72 rotate-2 cursor-grabbing ring-2 ring-brand-500\">\r\n                                {/* We could render SortableItem content here but simpler for now */}\r\n                                <div className=\"h-24 bg-surface-50 rounded animate-pulse\"></div>\r\n                            </div>\r\n                        ) : null}\r\n                    </DragOverlay>\r\n                </DndContext>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\os\\WorkOrdersListPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMutation' is defined but never used.","line":2,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMutation"},"fix":{"range":[58,71],"text":""},"desc":"Remove unused variable \"useMutation\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useQueryClient' is defined but never used.","line":2,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":47,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useQueryClient"},"fix":{"range":[71,87],"text":""},"desc":"Remove unused variable \"useQueryClient\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[238,251],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronDown' is defined but never used.","line":6,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronDown"},"fix":{"range":[251,264],"text":""},"desc":"Remove unused variable \"ChevronDown\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[512,515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[512,515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1073,1076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1073,1076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'showFilters' is assigned a value but never used.","line":42,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setShowFilters' is assigned a value but never used.","line":42,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2634,2637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2634,2637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2718,2721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2718,2721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2808,2811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2808,2811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Link, useNavigate } from 'react-router-dom'\r\nimport {\r\n    Search, Plus, FileText, Clock, User, AlertTriangle,\r\n    Filter, ChevronDown,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any; dot?: boolean }> = {\r\n    open: { label: 'Aberta', variant: 'info', dot: true },\r\n    in_progress: { label: 'Em Andamento', variant: 'warning', dot: true },\r\n    waiting_parts: { label: 'Aguard. Peças', variant: 'warning' },\r\n    waiting_approval: { label: 'Aguard. Aprovação', variant: 'brand' },\r\n    completed: { label: 'Concluída', variant: 'success', dot: true },\r\n    delivered: { label: 'Entregue', variant: 'success' },\r\n    cancelled: { label: 'Cancelada', variant: 'danger' },\r\n}\r\n\r\nconst priorityConfig: Record<string, { label: string; variant: any }> = {\r\n    low: { label: 'Baixa', variant: 'default' },\r\n    normal: { label: 'Normal', variant: 'info' },\r\n    high: { label: 'Alta', variant: 'warning' },\r\n    urgent: { label: 'Urgente', variant: 'danger' },\r\n}\r\n\r\ninterface WorkOrder {\r\n    id: number; number: string; status: string; priority: string\r\n    description: string; total: string; created_at: string\r\n    customer: { id: number; name: string; phone: string | null }\r\n    assignee: { id: number; name: string } | null\r\n    equipment: { id: number; type: string; brand: string | null; model: string | null } | null\r\n}\r\n\r\nexport function WorkOrdersListPage() {\r\n    const navigate = useNavigate()\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n    const [showFilters, setShowFilters] = useState(false)\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['work-orders', search, statusFilter],\r\n        queryFn: () => api.get('/work-orders', {\r\n            params: { search, status: statusFilter || undefined, per_page: 50 },\r\n        }),\r\n    })\r\n    const orders: WorkOrder[] = res?.data?.data ?? []\r\n\r\n    const formatDate = (d: string) => new Date(d).toLocaleDateString('pt-BR', {\r\n        day: '2-digit', month: '2-digit', year: '2-digit', hour: '2-digit', minute: '2-digit',\r\n    })\r\n\r\n    const formatBRL = (v: string) => parseFloat(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\n    // Status stats\r\n    const allOrders = res?.data?.data ?? []\r\n    const openCount = allOrders.filter((o: any) => o.status === 'open').length\r\n    const progressCount = allOrders.filter((o: any) => o.status === 'in_progress').length\r\n    const waitingCount = allOrders.filter((o: any) => ['waiting_parts', 'waiting_approval'].includes(o.status)).length\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Ordens de Serviço</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Gerencie suas ordens de serviço</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => navigate('/os/nova')}>\r\n                    Nova OS\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Quick Stats */}\r\n            <div className=\"grid grid-cols-2 gap-3 sm:grid-cols-4\">\r\n                {[\r\n                    { label: 'Abertas', value: openCount, color: 'bg-sky-50 text-sky-700 border-sky-200' },\r\n                    { label: 'Em Andamento', value: progressCount, color: 'bg-amber-50 text-amber-700 border-amber-200' },\r\n                    { label: 'Aguardando', value: waitingCount, color: 'bg-brand-50 text-brand-700 border-brand-200' },\r\n                    { label: 'Total', value: orders.length, color: 'bg-surface-50 text-surface-700 border-surface-200' },\r\n                ].map(s => (\r\n                    <div key={s.label} className={cn('rounded-xl border p-3 text-center', s.color)}>\r\n                        <p className=\"text-2xl font-bold\">{s.value}</p>\r\n                        <p className=\"text-xs font-medium mt-0.5\">{s.label}</p>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Status flow bar */}\r\n            {orders.length > 0 && (() => {\r\n                const groups = Object.entries(statusConfig).map(([k, v]) => ({\r\n                    key: k, label: v.label, count: orders.filter(o => o.status === k).length,\r\n                })).filter(g => g.count > 0)\r\n                const gtotal = groups.reduce((s, g) => s + g.count, 0)\r\n                const colors: Record<string, string> = {\r\n                    open: 'bg-sky-500', in_progress: 'bg-amber-500', waiting_parts: 'bg-amber-300',\r\n                    waiting_approval: 'bg-brand-400', completed: 'bg-emerald-500', delivered: 'bg-emerald-300', cancelled: 'bg-red-400',\r\n                }\r\n                return (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <div className=\"flex h-5 overflow-hidden rounded-full\">\r\n                            {groups.map(g => (\r\n                                <div key={g.key} className={cn('transition-all', colors[g.key] ?? 'bg-surface-300')}\r\n                                    style={{ width: `${(g.count / gtotal) * 100}%` }} />\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"mt-2 flex flex-wrap gap-3\">\r\n                            {groups.map(g => (\r\n                                <span key={g.key} className=\"flex items-center gap-1 text-xs text-surface-600\">\r\n                                    <span className={cn('h-2 w-2 rounded-full', colors[g.key] ?? 'bg-surface-300')} />\r\n                                    {g.label}: <strong>{g.count}</strong> ({Math.round((g.count / gtotal) * 100)}%)\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )\r\n            })()}\r\n\r\n            {/* Search & Filters */}\r\n            <div className=\"flex flex-col gap-3 sm:flex-row\">\r\n                <div className=\"relative flex-1 max-w-md\">\r\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                    <input type=\"text\" value={search} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearch(e.target.value)}\r\n                        placeholder=\"Buscar OS, cliente...\"\r\n                        className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <select value={statusFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setStatusFilter(e.target.value)}\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                        <option value=\"\">Todos os status</option>\r\n                        {Object.entries(statusConfig).map(([k, v]) => (\r\n                            <option key={k} value={k}>{v.label}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* OS Cards/List */}\r\n            <div className=\"space-y-3\">\r\n                {isLoading ? (\r\n                    <div className=\"py-16 text-center text-sm text-surface-500\">Carregando...</div>\r\n                ) : orders.length === 0 ? (\r\n                    <div className=\"py-16 text-center\">\r\n                        <FileText className=\"mx-auto h-12 w-12 text-surface-300\" />\r\n                        <p className=\"mt-3 text-sm text-surface-500\">Nenhuma OS encontrada</p>\r\n                        <Button className=\"mt-3\" onClick={() => navigate('/os/nova')}>Criar primeira OS</Button>\r\n                    </div>\r\n                ) : orders.map(order => (\r\n                    <Link\r\n                        key={order.id}\r\n                        to={`/os/${order.id}`}\r\n                        className=\"group block rounded-xl border border-surface-200 bg-white p-4 shadow-card hover:shadow-elevated hover:border-brand-200 transition-all duration-200\"\r\n                    >\r\n                        <div className=\"flex items-start justify-between gap-4\">\r\n                            {/* Left */}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"flex items-center gap-2 flex-wrap\">\r\n                                    <span className=\"text-sm font-bold text-brand-600\">{order.number}</span>\r\n                                    <Badge variant={statusConfig[order.status]?.variant ?? 'default'} dot={statusConfig[order.status]?.dot}>\r\n                                        {statusConfig[order.status]?.label ?? order.status}\r\n                                    </Badge>\r\n                                    {order.priority !== 'normal' && (\r\n                                        <Badge variant={priorityConfig[order.priority]?.variant ?? 'default'}>\r\n                                            {order.priority === 'urgent' && <AlertTriangle className=\"h-3 w-3 mr-0.5\" />}\r\n                                            {priorityConfig[order.priority]?.label}\r\n                                        </Badge>\r\n                                    )}\r\n                                </div>\r\n                                <p className=\"mt-1.5 text-sm text-surface-700 truncate\">{order.description}</p>\r\n                                <div className=\"mt-2 flex items-center gap-4 text-xs text-surface-500\">\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <User className=\"h-3 w-3\" /> {order.customer.name}\r\n                                    </span>\r\n                                    {order.equipment && (\r\n                                        <span>{order.equipment.type} {order.equipment.brand ?? ''}</span>\r\n                                    )}\r\n                                    {order.assignee && (\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            → {order.assignee.name}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                            {/* Right */}\r\n                            <div className=\"text-right shrink-0\">\r\n                                <p className=\"text-sm font-semibold text-surface-900\">{formatBRL(order.total)}</p>\r\n                                <p className=\"mt-1 flex items-center justify-end gap-1 text-xs text-surface-400\">\r\n                                    <Clock className=\"h-3 w-3\" /> {formatDate(order.created_at)}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </Link>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\portal\\PortalDashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1539,1542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1539,1542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1592,1595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1592,1595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1639,1642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1639,1642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'pendingFinancials' is assigned a value but never used.","line":45,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2052,2055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2052,2055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5437,5440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5437,5440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport {\r\n    FileText, DollarSign, Clock, CheckCircle, AlertCircle,\r\n    ArrowRight, Package, TrendingUp,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst statusConfig: Record<string, { label: string; color: string; bg: string }> = {\r\n    open: { label: 'Aberta', color: 'text-sky-600', bg: 'bg-sky-100' },\r\n    in_progress: { label: 'Em Andamento', color: 'text-amber-600', bg: 'bg-amber-100' },\r\n    waiting_parts: { label: 'Aguardando', color: 'text-orange-600', bg: 'bg-orange-100' },\r\n    completed: { label: 'Concluída', color: 'text-emerald-600', bg: 'bg-emerald-100' },\r\n    cancelled: { label: 'Cancelada', color: 'text-red-600', bg: 'bg-red-100' },\r\n}\r\n\r\nconst fmtBRL = (v: number) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nexport function PortalDashboardPage() {\r\n    const navigate = useNavigate()\r\n\r\n    const { data: workOrders } = useQuery({\r\n        queryKey: ['portal-dashboard-os'],\r\n        queryFn: () => api.get('/portal/work-orders').then(res => res.data),\r\n    })\r\n\r\n    const { data: quotes } = useQuery({\r\n        queryKey: ['portal-dashboard-quotes'],\r\n        queryFn: () => api.get('/portal/quotes').then(res => res.data),\r\n    })\r\n\r\n    const { data: financials } = useQuery({\r\n        queryKey: ['portal-dashboard-financials'],\r\n        queryFn: () => api.get('/portal/financials').then(res => res.data),\r\n    })\r\n\r\n    const osList: any[] = workOrders?.data ?? []\r\n    const quoteList: any[] = quotes?.data ?? []\r\n    const finList: any[] = financials ?? []\r\n\r\n    const openOS = osList.filter(os => os.status !== 'completed' && os.status !== 'cancelled').length\r\n    const completedOS = osList.filter(os => os.status === 'completed').length\r\n    const pendingQuotes = quoteList.filter(q => q.status === 'sent' || q.status === 'open').length\r\n    const pendingFinancials = finList.length\r\n    const totalPending = finList.reduce((acc: number, f: any) => acc + parseFloat(f.amount ?? 0), 0)\r\n\r\n    const cards = [\r\n        { label: 'OS Abertas', value: openOS, icon: FileText, color: 'text-brand-600 bg-brand-50', link: '/portal/os' },\r\n        { label: 'OS Concluídas', value: completedOS, icon: CheckCircle, color: 'text-emerald-600 bg-emerald-50', link: '/portal/os' },\r\n        { label: 'Orçamentos', value: pendingQuotes, icon: Package, color: 'text-amber-600 bg-amber-50', link: '/portal/orcamentos' },\r\n        { label: 'Faturas', value: fmtBRL(totalPending), icon: DollarSign, color: 'text-red-600 bg-red-50', link: '/portal/financeiro' },\r\n    ]\r\n\r\n    // Recent 5 OS\r\n    const recentOS = osList.slice(0, 5)\r\n\r\n    // Status tracking steps\r\n    const trackingSteps = ['open', 'in_progress', 'completed']\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Portal do Cliente</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Acompanhe suas ordens de serviço, orçamentos e faturas.</p>\r\n            </div>\r\n\r\n            {/* KPI Cards */}\r\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n                {cards.map(c => (\r\n                    <button key={c.label} onClick={() => navigate(c.link)}\r\n                        className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-left transition-all hover:shadow-elevated hover:-translate-y-0.5 group\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-xs font-medium text-surface-500 uppercase tracking-wider\">{c.label}</p>\r\n                                <p className=\"mt-2 text-2xl font-bold text-surface-900\">{c.value}</p>\r\n                            </div>\r\n                            <div className={cn('rounded-lg p-2.5', c.color)}>\r\n                                <c.icon className=\"h-5 w-5\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-3 flex items-center text-xs text-brand-600 font-medium group-hover:underline\">\r\n                            Ver detalhes <ArrowRight className=\"h-3 w-3 ml-1\" />\r\n                        </div>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Recent OS with Status Tracking */}\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <div className=\"flex items-center justify-between border-b border-surface-200 px-5 py-3\">\r\n                    <h2 className=\"text-sm font-semibold text-surface-900\">Últimas Ordens de Serviço</h2>\r\n                    <button onClick={() => navigate('/portal/os')} className=\"text-xs text-brand-600 font-medium hover:underline\">\r\n                        Ver todas →\r\n                    </button>\r\n                </div>\r\n                {recentOS.length === 0 ? (\r\n                    <div className=\"py-12 text-center\">\r\n                        <AlertCircle className=\"mx-auto h-8 w-8 text-surface-300\" />\r\n                        <p className=\"mt-2 text-sm text-surface-400\">Nenhuma OS encontrada</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {recentOS.map((os: any) => {\r\n                            const currentIdx = trackingSteps.indexOf(\r\n                                os.status === 'completed' ? 'completed' :\r\n                                    os.status === 'in_progress' || os.status === 'waiting_parts' ? 'in_progress' : 'open'\r\n                            )\r\n                            return (\r\n                                <div key={os.id} className=\"px-5 py-4 hover:bg-surface-50 transition-colors\">\r\n                                    <div className=\"flex items-center justify-between mb-3\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <span className=\"text-sm font-bold text-brand-600\">{os.number}</span>\r\n                                            <span className=\"text-sm text-surface-700 truncate max-w-xs\">{os.description}</span>\r\n                                        </div>\r\n                                        <span className={cn('text-xs font-semibold px-2.5 py-1 rounded-full',\r\n                                            statusConfig[os.status]?.bg ?? 'bg-surface-100',\r\n                                            statusConfig[os.status]?.color ?? 'text-surface-600'\r\n                                        )}>\r\n                                            {statusConfig[os.status]?.label ?? os.status}\r\n                                        </span>\r\n                                    </div>\r\n                                    {/* Tracking Progress */}\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        {trackingSteps.map((step, i) => (\r\n                                            <div key={step} className=\"flex items-center flex-1\">\r\n                                                <div className={cn(\r\n                                                    'h-2 w-2 rounded-full flex-shrink-0 transition-colors',\r\n                                                    i <= currentIdx ? 'bg-brand-500' : 'bg-surface-300'\r\n                                                )} />\r\n                                                <div className={cn(\r\n                                                    'flex-1 h-0.5 mx-1',\r\n                                                    i < currentIdx ? 'bg-brand-500' : 'bg-surface-200',\r\n                                                    i === trackingSteps.length - 1 && 'hidden'\r\n                                                )} />\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                    <div className=\"flex items-center justify-between mt-2 text-[10px] text-surface-400\">\r\n                                        <span>Aberta</span>\r\n                                        <span>Em Andamento</span>\r\n                                        <span>Concluída</span>\r\n                                    </div>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Quick Links */}\r\n            <div className=\"grid gap-3 sm:grid-cols-3\">\r\n                <button onClick={() => navigate('/portal/chamados')} className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-left hover:shadow-elevated transition-all group\">\r\n                    <Clock className=\"h-6 w-6 text-sky-500 mb-2\" />\r\n                    <p className=\"font-semibold text-surface-900 text-sm\">Abrir Chamado</p>\r\n                    <p className=\"text-xs text-surface-400 mt-0.5\">Solicite assistência técnica</p>\r\n                </button>\r\n                <button onClick={() => navigate('/portal/orcamentos')} className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-left hover:shadow-elevated transition-all group\">\r\n                    <TrendingUp className=\"h-6 w-6 text-amber-500 mb-2\" />\r\n                    <p className=\"font-semibold text-surface-900 text-sm\">Orçamentos</p>\r\n                    <p className=\"text-xs text-surface-400 mt-0.5\">Veja propostas e aprove</p>\r\n                </button>\r\n                <button onClick={() => navigate('/portal/financeiro')} className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-left hover:shadow-elevated transition-all group\">\r\n                    <DollarSign className=\"h-6 w-6 text-emerald-500 mb-2\" />\r\n                    <p className=\"font-semibold text-surface-900 text-sm\">Financeiro</p>\r\n                    <p className=\"text-xs text-surface-400 mt-0.5\">Faturas e pagamentos</p>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\portal\\PortalFinancialsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[519,522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[519,522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'financials' logical expression could make the dependencies of useMemo Hook (at line 37) change on every render. To fix this, wrap the initialization of 'financials' in its own useMemo() Hook.","line":23,"column":11,"nodeType":"VariableDeclarator","endLine":23,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1160,1163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1160,1163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3827,3830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3827,3830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { DollarSign, Clock, CheckCircle, AlertTriangle, Receipt } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst fmtBRL = (v: string | number) => Number(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\nconst fmtDate = (d: string) => new Date(d + 'T00:00:00').toLocaleDateString('pt-BR')\r\n\r\nconst statusCfg: Record<string, { label: string; color: string; bg: string; icon: any }> = {\r\n    pending: { label: 'Pendente', color: 'text-amber-600', bg: 'bg-amber-100', icon: Clock },\r\n    partial: { label: 'Parcial', color: 'text-sky-600', bg: 'bg-sky-100', icon: DollarSign },\r\n    paid: { label: 'Pago', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: CheckCircle },\r\n    overdue: { label: 'Atrasado', color: 'text-red-600', bg: 'bg-red-100', icon: AlertTriangle },\r\n}\r\n\r\nexport function PortalFinancialsPage() {\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['portal-financials'],\r\n        queryFn: () => api.get('/portal/financials').then(res => res.data),\r\n    })\r\n\r\n    const financials: any[] = data ?? []\r\n\r\n    const summary = useMemo(() => {\r\n        let pending = 0, paid = 0, overdue = 0\r\n        financials.forEach(f => {\r\n            const amt = parseFloat(f.amount ?? 0)\r\n            if (f.status === 'paid') paid += amt\r\n            else {\r\n                const isOverdue = new Date(f.due_date) < new Date()\r\n                if (isOverdue) overdue += amt\r\n                else pending += amt\r\n            }\r\n        })\r\n        return { pending, paid, overdue, total: pending + paid + overdue }\r\n    }, [financials])\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Financeiro</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Suas faturas e pagamentos</p>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid gap-3 sm:grid-cols-3\">\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-amber-600\"><Clock className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pendente</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-surface-900\">{fmtBRL(summary.pending)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-red-600\"><AlertTriangle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Atrasado</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-red-600\">{fmtBRL(summary.overdue)}</p>\r\n                </div>\r\n                <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                    <div className=\"flex items-center gap-2 text-emerald-600\"><CheckCircle className=\"h-4 w-4\" /><span className=\"text-xs font-medium\">Pago</span></div>\r\n                    <p className=\"mt-1 text-xl font-bold text-emerald-600\">{fmtBRL(summary.paid)}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Financials List */}\r\n            {isLoading ? (\r\n                <div className=\"text-center text-surface-400 py-12\">Carregando...</div>\r\n            ) : financials.length === 0 ? (\r\n                <div className=\"text-center py-12\">\r\n                    <Receipt className=\"mx-auto h-10 w-10 text-surface-300\" />\r\n                    <p className=\"mt-2 text-sm text-surface-400\">Nenhuma fatura encontrada</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-2\">\r\n                    {financials.map((item: any) => {\r\n                        const isOverdue = item.status !== 'paid' && new Date(item.due_date) < new Date()\r\n                        const effectiveStatus = isOverdue ? 'overdue' : item.status\r\n                        const cfg = statusCfg[effectiveStatus] ?? statusCfg.pending\r\n                        const StatusIcon = cfg.icon\r\n                        return (\r\n                            <div key={item.id} className={cn(\r\n                                'rounded-xl border bg-white p-4 shadow-card flex items-center gap-4 transition-all hover:shadow-elevated',\r\n                                isOverdue ? 'border-red-200' : 'border-surface-200'\r\n                            )}>\r\n                                <div className={cn('rounded-lg p-2.5 flex-shrink-0', cfg.bg)}>\r\n                                    <StatusIcon className={cn('h-4 w-4', cfg.color)} />\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <p className=\"text-sm font-medium text-surface-900\">{item.description || `Fatura #${item.id}`}</p>\r\n                                    <p className=\"text-xs text-surface-400 mt-0.5\">Vencimento: {fmtDate(item.due_date)}</p>\r\n                                </div>\r\n                                <div className=\"text-right flex-shrink-0\">\r\n                                    <p className=\"text-sm font-bold text-surface-900\">{fmtBRL(item.amount)}</p>\r\n                                    <span className={cn('text-[10px] font-semibold px-2 py-0.5 rounded-full', cfg.bg, cfg.color)}>\r\n                                        {cfg.label}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\portal\\PortalLoginPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":37,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1320,1323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1320,1323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport { useForm } from 'react-hook-form'\r\nimport { z } from 'zod'\r\nimport { zodResolver } from '@hookform/resolvers/zod'\r\nimport { Loader2, LogIn } from 'lucide-react'\r\nimport { usePortalAuthStore } from '@/stores/portal-auth-store'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\n\r\nconst loginSchema = z.object({\r\n    email: z.string().email('E-mail inválido'),\r\n    password: z.string().min(1, 'Senha é obrigatória'),\r\n    tenant_id: z.string().min(1, 'ID da empresa é obrigatório'), // Simple input for now, could be improved\r\n})\r\n\r\ntype LoginFormData = z.infer<typeof loginSchema>\r\n\r\nexport function PortalLoginPage() {\r\n    const navigate = useNavigate()\r\n    const login = usePortalAuthStore((state) => state.login)\r\n    const [error, setError] = useState('')\r\n\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n        formState: { errors, isSubmitting },\r\n    } = useForm<LoginFormData>({\r\n        resolver: zodResolver(loginSchema),\r\n    })\r\n\r\n    const onSubmit = async (data: LoginFormData) => {\r\n        try {\r\n            setError('')\r\n            await login(data.email, data.password, parseInt(data.tenant_id))\r\n            navigate('/portal')\r\n        } catch (err: any) {\r\n            setError('Credenciais inválidas ou conta inativa.')\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-surface-50 px-4 sm:px-6 lg:px-8\">\r\n            <div className=\"max-w-md w-full space-y-8 bg-white p-8 rounded-xl shadow-card border border-surface-200\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"mx-auto h-12 w-12 bg-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-xl\">\r\n                        PC\r\n                    </div>\r\n                    <h2 className=\"mt-6 text-3xl font-extrabold text-surface-900\">Portal do Cliente</h2>\r\n                    <p className=\"mt-2 text-sm text-surface-600\">\r\n                        Acesse suas ordens de serviço e faturas\r\n                    </p>\r\n                </div>\r\n\r\n                <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit(onSubmit)}>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label htmlFor=\"tenant_id\" className=\"block text-sm font-medium text-surface-700\">\r\n                                Código da Empresa\r\n                            </label>\r\n                            <Input\r\n                                id=\"tenant_id\"\r\n                                type=\"number\"\r\n                                {...register('tenant_id')}\r\n                                error={errors.tenant_id?.message}\r\n                                placeholder=\"Ex: 1\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label htmlFor=\"email\" className=\"block text-sm font-medium text-surface-700\">\r\n                                E-mail\r\n                            </label>\r\n                            <Input\r\n                                id=\"email\"\r\n                                type=\"email\"\r\n                                {...register('email')}\r\n                                error={errors.email?.message}\r\n                                placeholder=\"seu@email.com\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label htmlFor=\"password\" className=\"block text-sm font-medium text-surface-700\">\r\n                                Senha\r\n                            </label>\r\n                            <Input\r\n                                id=\"password\"\r\n                                type=\"password\"\r\n                                {...register('password')}\r\n                                error={errors.password?.message}\r\n                                placeholder=\"••••••••\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <div className=\"rounded-md bg-red-50 p-4\">\r\n                            <div className=\"flex\">\r\n                                <div className=\"ml-3\">\r\n                                    <h3 className=\"text-sm font-medium text-red-800\">{error}</h3>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <Button\r\n                        type=\"submit\"\r\n                        className=\"w-full flex justify-center py-2.5\"\r\n                        disabled={isSubmitting}\r\n                    >\r\n                        {isSubmitting ? (\r\n                            <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                        ) : (\r\n                            <>\r\n                                <LogIn className=\"h-4 w-4 mr-2\" />\r\n                                Entrar\r\n                            </>\r\n                        )}\r\n                    </Button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\portal\\PortalQuotesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DollarSign' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DollarSign"},"fix":{"range":[88,99],"text":""},"desc":"Remove unused variable \"DollarSign\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[506,509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[506,509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1442,1445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1442,1445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2585,2588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2585,2588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4536,4539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4536,4539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { DollarSign, Check, X, FileText, Clock, CheckCircle, XCircle } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst fmtBRL = (v: string | number) => Number(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\nconst fmtDate = (d: string) => new Date(d).toLocaleDateString('pt-BR')\r\n\r\nconst statusCfg: Record<string, { label: string; color: string; bg: string; icon: any }> = {\r\n    open: { label: 'Pendente', color: 'text-amber-600', bg: 'bg-amber-100', icon: Clock },\r\n    sent: { label: 'Enviado', color: 'text-sky-600', bg: 'bg-sky-100', icon: FileText },\r\n    approved: { label: 'Aprovado', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: CheckCircle },\r\n    rejected: { label: 'Rejeitado', color: 'text-red-600', bg: 'bg-red-100', icon: XCircle },\r\n}\r\n\r\nexport function PortalQuotesPage() {\r\n    const qc = useQueryClient()\r\n\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['portal-quotes'],\r\n        queryFn: () => api.get('/portal/quotes').then(res => res.data),\r\n    })\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: ({ id, action }: { id: number; action: 'approve' | 'reject' }) =>\r\n            api.post(`/portal/quotes/${id}/status`, { action }),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['portal-quotes'] }),\r\n    })\r\n\r\n    const quotes: any[] = data?.data ?? []\r\n    const pendingCount = quotes.filter(q => q.status === 'open' || q.status === 'sent').length\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Orçamentos</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">\r\n                        {pendingCount > 0 ? `${pendingCount} orçamento(s) aguardando aprovação` : 'Todos os orçamentos'}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {isLoading ? (\r\n                <div className=\"text-center text-surface-400 py-12\">Carregando...</div>\r\n            ) : quotes.length === 0 ? (\r\n                <div className=\"text-center py-12\">\r\n                    <FileText className=\"mx-auto h-10 w-10 text-surface-300\" />\r\n                    <p className=\"mt-2 text-sm text-surface-400\">Nenhum orçamento encontrado</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                    {quotes.map((q: any) => {\r\n                        const cfg = statusCfg[q.status] ?? statusCfg.open\r\n                        const StatusIcon = cfg.icon\r\n                        const isPending = q.status === 'open' || q.status === 'sent'\r\n                        return (\r\n                            <div key={q.id} className={cn(\r\n                                'rounded-xl border bg-white shadow-card overflow-hidden transition-all hover:shadow-elevated',\r\n                                isPending ? 'border-brand-200' : 'border-surface-200'\r\n                            )}>\r\n                                <div className=\"p-5\">\r\n                                    <div className=\"flex items-start justify-between mb-3\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className={cn('rounded-lg p-2', cfg.bg)}>\r\n                                                <StatusIcon className={cn('h-4 w-4', cfg.color)} />\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"text-sm font-bold text-surface-900\">Orçamento #{q.number ?? q.id}</p>\r\n                                                <p className=\"text-xs text-surface-400\">{fmtDate(q.created_at)}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                        <span className={cn('text-xs font-semibold px-2.5 py-1 rounded-full', cfg.bg, cfg.color)}>\r\n                                            {cfg.label}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    {q.items && q.items.length > 0 && (\r\n                                        <div className=\"mb-3 space-y-1\">\r\n                                            {q.items.slice(0, 3).map((item: any, i: number) => (\r\n                                                <div key={i} className=\"flex items-center justify-between text-xs\">\r\n                                                    <span className=\"text-surface-600 truncate max-w-[60%]\">{item.description}</span>\r\n                                                    <span className=\"text-surface-500 font-medium\">{fmtBRL(item.total ?? item.price ?? 0)}</span>\r\n                                                </div>\r\n                                            ))}\r\n                                            {q.items.length > 3 && (\r\n                                                <p className=\"text-[10px] text-surface-400 italic\">+{q.items.length - 3} item(ns)</p>\r\n                                            )}\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <div className=\"border-t border-surface-200 pt-3 flex items-center justify-between\">\r\n                                        <span className=\"text-xs text-surface-500\">Total</span>\r\n                                        <span className=\"text-lg font-bold text-surface-900\">{fmtBRL(q.total_amount ?? q.total ?? 0)}</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {isPending && (\r\n                                    <div className=\"border-t border-surface-200 bg-surface-50 px-5 py-3 flex gap-2 justify-end\">\r\n                                        <button\r\n                                            onClick={() => mutation.mutate({ id: q.id, action: 'reject' })}\r\n                                            disabled={mutation.isPending}\r\n                                            className=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium text-red-600 hover:bg-red-50 transition-colors disabled:opacity-50\"\r\n                                        >\r\n                                            <X className=\"h-3.5 w-3.5\" /> Rejeitar\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => mutation.mutate({ id: q.id, action: 'approve' })}\r\n                                            disabled={mutation.isPending}\r\n                                            className=\"inline-flex items-center gap-1.5 px-4 py-1.5 rounded-lg text-xs font-medium bg-brand-600 text-white hover:bg-brand-700 transition-colors disabled:opacity-50\"\r\n                                        >\r\n                                            <Check className=\"h-3.5 w-3.5\" /> Aprovar\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\portal\\PortalServiceCallPage.tsx","messages":[{"ruleId":"react-hooks/incompatible-library","severity":1,"message":"Compilation Skipped: Use of incompatible library\n\nThis API returns functions which cannot be memoized without leading to stale UI. To prevent this, by default React Compiler will skip memoizing this component/hook. However, you may see issues if values from this API are passed to other components/hooks that are memoized.\n\nC:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\portal\\PortalServiceCallPage.tsx:39:30\n  37 |     })\n  38 |\n> 39 |     const selectedPriority = watch('priority')\n     |                              ^^^^^ React Hook Form's `useForm()` API returns a `watch()` function which cannot be memoized safely.\n  40 |\n  41 |     const onSubmit = async (data: ServiceCallFormData) => {\n  42 |         try {","line":39,"column":30,"nodeType":null,"endLine":39,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4467,4470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4467,4470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom'\r\nimport { useForm } from 'react-hook-form'\r\nimport { z } from 'zod'\r\nimport { zodResolver } from '@hookform/resolvers/zod'\r\nimport { Loader2, Send, ArrowLeft, AlertTriangle, Clock, Zap, Shield } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { toast } from 'sonner'\r\n\r\nconst serviceCallSchema = z.object({\r\n    description: z.string().min(10, 'Descrição deve ter pelo menos 10 caracteres'),\r\n    priority: z.enum(['low', 'normal', 'high', 'urgent']),\r\n    equipment_id: z.string().optional(),\r\n})\r\n\r\ntype ServiceCallFormData = z.infer<typeof serviceCallSchema>\r\n\r\nconst priorityOptions = [\r\n    { value: 'low', label: 'Baixa', desc: 'Pode aguardar', icon: Shield, color: 'border-surface-300 bg-surface-50 text-surface-600' },\r\n    { value: 'normal', label: 'Normal', desc: 'Prazo padrão', icon: Clock, color: 'border-sky-300 bg-sky-50 text-sky-600' },\r\n    { value: 'high', label: 'Alta', desc: 'Prioridade elevada', icon: AlertTriangle, color: 'border-amber-300 bg-amber-50 text-amber-600' },\r\n    { value: 'urgent', label: 'Urgente', desc: 'Atenção imediata', icon: Zap, color: 'border-red-300 bg-red-50 text-red-600' },\r\n]\r\n\r\nexport function PortalServiceCallPage() {\r\n    const navigate = useNavigate()\r\n\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n        watch,\r\n        setValue,\r\n        formState: { errors, isSubmitting },\r\n    } = useForm<ServiceCallFormData>({\r\n        resolver: zodResolver(serviceCallSchema),\r\n        defaultValues: { priority: 'normal' }\r\n    })\r\n\r\n    const selectedPriority = watch('priority')\r\n\r\n    const onSubmit = async (data: ServiceCallFormData) => {\r\n        try {\r\n            await api.post('/portal/service-calls', data)\r\n            toast.success('Chamado aberto com sucesso!')\r\n            navigate('/portal/os')\r\n        } catch {\r\n            toast.error('Erro ao abrir chamado.')\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto space-y-6\">\r\n            <div>\r\n                <button onClick={() => navigate('/portal')} className=\"flex items-center gap-1.5 text-sm text-surface-500 hover:text-brand-600 transition-colors mb-4\">\r\n                    <ArrowLeft className=\"h-4 w-4\" /> Voltar\r\n                </button>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Abrir Novo Chamado</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Descreva o problema e nossa equipe entrará em contato</p>\r\n            </div>\r\n\r\n            <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <form onSubmit={handleSubmit(onSubmit)}>\r\n                    <div className=\"p-6 space-y-6\">\r\n                        {/* Description */}\r\n                        <div>\r\n                            <label htmlFor=\"description\" className=\"block text-sm font-semibold text-surface-700 mb-2\">\r\n                                Descrição do Problema\r\n                            </label>\r\n                            <textarea\r\n                                id=\"description\"\r\n                                rows={5}\r\n                                placeholder=\"Descreva detalhadamente o que está acontecendo...\"\r\n                                className=\"w-full rounded-lg border border-surface-300 px-4 py-3 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 resize-none\"\r\n                                {...register('description')}\r\n                            />\r\n                            {errors.description && (\r\n                                <p className=\"mt-1.5 text-xs text-red-600\">{errors.description.message}</p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Priority cards */}\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-surface-700 mb-3\">Prioridade</label>\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                {priorityOptions.map(opt => {\r\n                                    const Icon = opt.icon\r\n                                    const isSelected = selectedPriority === opt.value\r\n                                    return (\r\n                                        <button key={opt.value} type=\"button\"\r\n                                            onClick={() => setValue('priority', opt.value as any)}\r\n                                            className={cn(\r\n                                                'rounded-lg border-2 p-3.5 text-left transition-all',\r\n                                                isSelected ? opt.color + ' ring-2 ring-offset-1 ring-current' : 'border-surface-200 bg-white hover:bg-surface-50'\r\n                                            )}>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Icon className={cn('h-4 w-4', isSelected ? '' : 'text-surface-400')} />\r\n                                                <span className={cn('text-sm font-semibold', isSelected ? '' : 'text-surface-700')}>{opt.label}</span>\r\n                                            </div>\r\n                                            <p className={cn('text-xs mt-1', isSelected ? 'opacity-80' : 'text-surface-400')}>{opt.desc}</p>\r\n                                        </button>\r\n                                    )\r\n                                })}\r\n                            </div>\r\n                            <input type=\"hidden\" {...register('priority')} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Footer */}\r\n                    <div className=\"border-t border-surface-200 bg-surface-50 px-6 py-4 flex items-center justify-end gap-3 rounded-b-xl\">\r\n                        <button type=\"button\" onClick={() => navigate('/portal')}\r\n                            className=\"px-4 py-2 rounded-lg text-sm font-medium text-surface-600 hover:bg-surface-100 transition-colors\">\r\n                            Cancelar\r\n                        </button>\r\n                        <button type=\"submit\" disabled={isSubmitting}\r\n                            className=\"inline-flex items-center gap-2 px-5 py-2 rounded-lg bg-brand-600 text-white text-sm font-medium hover:bg-brand-700 transition-colors disabled:opacity-50\">\r\n                            {isSubmitting ? <Loader2 className=\"animate-spin h-4 w-4\" /> : <Send className=\"h-4 w-4\" />}\r\n                            Enviar Chamado\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\portal\\PortalWorkOrdersPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[342,345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[342,345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'all' logical expression could make the dependencies of useMemo Hook (at line 42) change on every render. To fix this, wrap the initialization of 'all' in its own useMemo() Hook.","line":29,"column":11,"nodeType":"VariableDeclarator","endLine":29,"endColumn":40},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'all' logical expression could make the dependencies of useMemo Hook (at line 49) change on every render. To fix this, wrap the initialization of 'all' in its own useMemo() Hook.","line":29,"column":11,"nodeType":"VariableDeclarator","endLine":29,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1574,1577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1574,1577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5058,5061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5058,5061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { FileText, Search, Clock, CheckCircle, AlertCircle, Wrench, Package } from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst statusConfig: Record<string, { label: string; color: string; bg: string; icon: any }> = {\r\n    open: { label: 'Aberta', color: 'text-sky-600', bg: 'bg-sky-100', icon: Clock },\r\n    in_progress: { label: 'Em Andamento', color: 'text-amber-600', bg: 'bg-amber-100', icon: Wrench },\r\n    waiting_parts: { label: 'Aguard. Peças', color: 'text-orange-600', bg: 'bg-orange-100', icon: Package },\r\n    waiting_approval: { label: 'Aguard. Aprovação', color: 'text-violet-600', bg: 'bg-violet-100', icon: AlertCircle },\r\n    completed: { label: 'Concluída', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: CheckCircle },\r\n    cancelled: { label: 'Cancelada', color: 'text-red-600', bg: 'bg-red-100', icon: AlertCircle },\r\n}\r\n\r\nconst trackingSteps = ['open', 'in_progress', 'completed']\r\nconst fmtDate = (d: string) => new Date(d).toLocaleDateString('pt-BR')\r\nconst fmtBRL = (v: string | number) => Number(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\nexport function PortalWorkOrdersPage() {\r\n    const [search, setSearch] = useState('')\r\n    const [statusFilter, setStatusFilter] = useState('')\r\n\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['portal-work-orders'],\r\n        queryFn: () => api.get('/portal/work-orders').then(res => res.data),\r\n    })\r\n\r\n    const all: any[] = data?.data ?? []\r\n\r\n    const filtered = useMemo(() => {\r\n        let list = all\r\n        if (statusFilter) list = list.filter(os => os.status === statusFilter)\r\n        if (search) {\r\n            const q = search.toLowerCase()\r\n            list = list.filter(os =>\r\n                (os.number ?? '').toLowerCase().includes(q) ||\r\n                (os.description ?? '').toLowerCase().includes(q)\r\n            )\r\n        }\r\n        return list\r\n    }, [all, statusFilter, search])\r\n\r\n    const counts = useMemo(() => {\r\n        const c: Record<string, number> = {}\r\n        Object.keys(statusConfig).forEach(k => c[k] = 0)\r\n        all.forEach(os => { if (c[os.status] !== undefined) c[os.status]++ })\r\n        return c\r\n    }, [all])\r\n\r\n    const getStepIndex = (status: string) => {\r\n        if (status === 'completed') return 2\r\n        if (status === 'in_progress' || status === 'waiting_parts' || status === 'waiting_approval') return 1\r\n        return 0\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Minhas Ordens de Serviço</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Acompanhe o progresso dos seus serviços</p>\r\n            </div>\r\n\r\n            {/* Status KPI Chips */}\r\n            <div className=\"flex flex-wrap gap-2\">\r\n                <button onClick={() => setStatusFilter('')}\r\n                    className={cn('px-3 py-1.5 rounded-full text-xs font-medium border transition-colors',\r\n                        !statusFilter ? 'bg-brand-600 text-white border-brand-600' : 'bg-white text-surface-600 border-surface-300 hover:bg-surface-50'\r\n                    )}>\r\n                    Todas ({all.length})\r\n                </button>\r\n                {Object.entries(statusConfig).map(([key, cfg]) => (\r\n                    counts[key] > 0 && (\r\n                        <button key={key} onClick={() => setStatusFilter(statusFilter === key ? '' : key)}\r\n                            className={cn('px-3 py-1.5 rounded-full text-xs font-medium border transition-colors',\r\n                                statusFilter === key ? `${cfg.bg} ${cfg.color} border-current` : 'bg-white text-surface-600 border-surface-300 hover:bg-surface-50'\r\n                            )}>\r\n                            {cfg.label} ({counts[key]})\r\n                        </button>\r\n                    )\r\n                ))}\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"relative max-w-sm\">\r\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-surface-400\" />\r\n                <input value={search} onChange={e => setSearch(e.target.value)} placeholder=\"Buscar OS...\"\r\n                    className=\"w-full rounded-lg border border-surface-300 bg-white py-2.5 pl-10 pr-4 text-sm focus:border-brand-500 focus:outline-none\" />\r\n            </div>\r\n\r\n            {/* OS Cards */}\r\n            {isLoading ? (\r\n                <div className=\"text-center text-surface-400 py-12\">Carregando...</div>\r\n            ) : filtered.length === 0 ? (\r\n                <div className=\"text-center py-12\">\r\n                    <FileText className=\"mx-auto h-10 w-10 text-surface-300\" />\r\n                    <p className=\"mt-2 text-sm text-surface-400\">Nenhuma OS encontrada</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-3\">\r\n                    {filtered.map((os: any) => {\r\n                        const cfg = statusConfig[os.status] ?? statusConfig.open\r\n                        const stepIdx = getStepIndex(os.status)\r\n                        const StatusIcon = cfg.icon\r\n                        return (\r\n                            <div key={os.id} className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card hover:shadow-elevated transition-all\">\r\n                                <div className=\"flex items-start justify-between mb-3\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className={cn('rounded-lg p-2', cfg.bg)}>\r\n                                            <StatusIcon className={cn('h-4 w-4', cfg.color)} />\r\n                                        </div>\r\n                                        <div>\r\n                                            <p className=\"text-sm font-bold text-brand-600\">{os.number ?? `#${os.id}`}</p>\r\n                                            <p className=\"text-xs text-surface-400\">{fmtDate(os.created_at)}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <span className={cn('text-xs font-semibold px-2.5 py-1 rounded-full', cfg.bg, cfg.color)}>\r\n                                        {cfg.label}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                {os.description && (\r\n                                    <p className=\"text-sm text-surface-700 mb-3 line-clamp-2\">{os.description}</p>\r\n                                )}\r\n\r\n                                {/* Info Row */}\r\n                                <div className=\"flex flex-wrap gap-4 text-xs text-surface-500 mb-4\">\r\n                                    {os.assignee?.name && <span>Técnico: <strong className=\"text-surface-700\">{os.assignee.name}</strong></span>}\r\n                                    {os.total && parseFloat(os.total) > 0 && <span>Valor: <strong className=\"text-surface-700\">{fmtBRL(os.total)}</strong></span>}\r\n                                </div>\r\n\r\n                                {/* Progress Tracker */}\r\n                                {os.status !== 'cancelled' && (\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-1\">\r\n                                            {trackingSteps.map((step, i) => (\r\n                                                <div key={step} className=\"flex items-center flex-1\">\r\n                                                    <div className={cn(\r\n                                                        'h-2.5 w-2.5 rounded-full flex-shrink-0 transition-colors border-2',\r\n                                                        i <= stepIdx ? 'bg-brand-500 border-brand-500' : 'bg-white border-surface-300'\r\n                                                    )} />\r\n                                                    {i < trackingSteps.length - 1 && (\r\n                                                        <div className={cn(\r\n                                                            'flex-1 h-0.5 mx-1',\r\n                                                            i < stepIdx ? 'bg-brand-500' : 'bg-surface-200'\r\n                                                        )} />\r\n                                                    )}\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                        <div className=\"flex justify-between mt-1.5 text-[10px] text-surface-400\">\r\n                                            <span>Aberta</span>\r\n                                            <span>Em Andamento</span>\r\n                                            <span>Concluída</span>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\relatorios\\ReportsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Input' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[322,367],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Badge' is defined but never used.","line":10,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[369,414],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[797,800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[797,800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5862,5865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5862,5865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6830,6833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6830,6833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8369,8372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8369,8372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":126,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":129,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8931,8934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8931,8934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11083,11086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11083,11086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12439,12442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12439,12442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16417,16420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16417,16420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":265,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18104,18107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18104,18107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":287,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19471,19474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19471,19474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21440,21443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21440,21443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":418,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29338,29341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29338,29341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":429,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30277,30280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30277,30280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":458,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32268,32271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32268,32271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":466,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":466,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32919,32922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32919,32922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":474,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":474,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33577,33580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33577,33580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":513,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":513,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36547,36550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36547,36550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":531,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":531,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37645,37648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37645,37648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":543,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":543,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38600,38603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38600,38603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":555,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39700,39703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39700,39703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":607,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":607,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43683,43686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43683,43686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":619,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":619,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44681,44684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44681,44684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":633,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":633,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45758,45761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45758,45761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":25,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport {\r\n    ClipboardList, Users, DollarSign, Award, TrendingUp,\r\n    Calendar, ArrowRight, FileText, Phone, Wallet, Target, Scale, Download,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Badge } from '@/components/ui/Badge'\r\n\r\nconst fmtBRL = (val: number) => val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\nconst fmtHours = (min: number) => `${Math.floor(min / 60)}h ${min % 60}m`\r\n\r\ntype Tab = 'os' | 'productivity' | 'financial' | 'commissions' | 'profitability' | 'quotes' | 'service_calls' | 'technician_cash' | 'crm' | 'equipments'\r\n\r\nconst tabs: { key: Tab; label: string; icon: any }[] = [\r\n    { key: 'os', label: 'Ordens', icon: ClipboardList },\r\n    { key: 'productivity', label: 'Produtividade', icon: Users },\r\n    { key: 'financial', label: 'Financeiro', icon: DollarSign },\r\n    { key: 'commissions', label: 'Comissões', icon: Award },\r\n    { key: 'profitability', label: 'Margem', icon: TrendingUp },\r\n    { key: 'quotes', label: 'Orçamentos', icon: FileText },\r\n    { key: 'service_calls', label: 'Chamados', icon: Phone },\r\n    { key: 'technician_cash', label: 'Caixa', icon: Wallet },\r\n    { key: 'crm', label: 'CRM', icon: Target },\r\n    { key: 'equipments', label: 'Equipamentos', icon: Scale },\r\n]\r\n\r\nconst statusLabels: Record<string, string> = {\r\n    open: 'Aberta', in_progress: 'Em Andamento', waiting_parts: 'Aguardando Peças',\r\n    waiting_approval: 'Aguardando Aprovação', completed: 'Concluída', delivered: 'Entregue', cancelled: 'Cancelada',\r\n    pending: 'Pendente', approved: 'Aprovado', paid: 'Pago', reversed: 'Estornado',\r\n}\r\n\r\nconst priorityLabels: Record<string, string> = {\r\n    low: 'Baixa', normal: 'Normal', high: 'Alta', urgent: 'Urgente',\r\n}\r\n\r\nexport function ReportsPage() {\r\n    const [tab, setTab] = useState<Tab>('os')\r\n    const today = new Date().toISOString().split('T')[0]\r\n    const monthStart = today.slice(0, 7) + '-01'\r\n    const [from, setFrom] = useState(monthStart)\r\n    const [to, setTo] = useState(today)\r\n\r\n    const endpoint: Record<Tab, string> = {\r\n        os: '/reports/work-orders',\r\n        productivity: '/reports/productivity',\r\n        financial: '/reports/financial',\r\n        commissions: '/reports/commissions',\r\n        profitability: '/reports/profitability',\r\n        quotes: '/reports/quotes',\r\n        service_calls: '/reports/service-calls',\r\n        technician_cash: '/reports/technician-cash',\r\n        crm: '/reports/crm',\r\n        equipments: '/reports/equipments',\r\n    }\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['report', tab, from, to],\r\n        queryFn: () => api.get(endpoint[tab], { params: { from, to } }),\r\n    })\r\n    const data = res?.data ?? {}\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-surface-900\">Relatórios</h1>\r\n                <p className=\"mt-1 text-sm text-surface-500\">Análise de desempenho e resultados</p>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between\">\r\n                <div className=\"flex flex-wrap rounded-lg border border-surface-200 bg-surface-50 p-0.5\">\r\n                    {tabs.map(t => {\r\n                        const Icon = t.icon\r\n                        return (\r\n                            <button key={t.key} onClick={() => setTab(t.key)}\r\n                                className={cn('flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all',\r\n                                    tab === t.key ? 'bg-white text-brand-700 shadow-sm' : 'text-surface-500 hover:text-surface-700')}>\r\n                                <Icon className=\"h-3.5 w-3.5\" />{t.label}\r\n                            </button>\r\n                        )\r\n                    })}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Calendar className=\"h-4 w-4 text-surface-400\" />\r\n                    <input type=\"date\" value={from} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setFrom(e.target.value)} aria-label=\"Data início\"\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-1.5 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                    <ArrowRight className=\"h-3.5 w-3.5 text-surface-400\" />\r\n                    <input type=\"date\" value={to} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setTo(e.target.value)} aria-label=\"Data fim\"\r\n                        className=\"rounded-lg border border-surface-300 bg-white px-3 py-1.5 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                    <button\r\n                        onClick={() => window.open(`${api.defaults.baseURL}/reports/${tab}/export?from=${from}&to=${to}`, '_blank')}\r\n                        title=\"Exportar CSV\"\r\n                        className=\"flex items-center gap-1.5 rounded-lg border border-surface-300 bg-white px-3 py-1.5 text-sm font-medium text-surface-600 hover:bg-surface-50 transition-colors\"\r\n                    >\r\n                        <Download className=\"h-3.5 w-3.5\" />\r\n                        CSV\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {isLoading && <div className=\"py-12 text-center text-sm text-surface-500\">Carregando relatório...</div>}\r\n\r\n            {/* OS Report */}\r\n            {tab === 'os' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-4\">\r\n                        {(data.by_status ?? []).map((s: any) => (\r\n                            <div key={s.status} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                                <span className=\"text-xs font-medium text-surface-500\">{statusLabels[s.status] ?? s.status}</span>\r\n                                <p className=\"text-2xl font-bold text-surface-900\">{s.count}</p>\r\n                                <p className=\"text-xs text-surface-400\">{fmtBRL(Number(s.total ?? 0))}</p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Prioridade</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.by_priority ?? []).map((p: any) => (\r\n                                    <div key={p.priority} className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-sm\">{priorityLabels[p.priority] ?? p.priority}</span>\r\n                                        <span className=\"text-sm font-bold\">{p.count}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Métricas</h3>\r\n                            <div className=\"space-y-3\">\r\n                                <div>\r\n                                    <span className=\"text-xs text-surface-500\">Tempo médio de conclusão</span>\r\n                                    <p className=\"text-lg font-bold text-surface-900\">{data.avg_completion_hours ?? 0}h</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    {(data.monthly ?? []).length > 0 && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Evolução Mensal</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {data.monthly.map((m: any) => (\r\n                                    <div key={m.period} className=\"flex items-center gap-3\">\r\n                                        <span className=\"w-16 text-xs font-medium text-surface-500\">{m.period}</span>\r\n                                        <div className=\"flex-1 rounded-full bg-surface-100 h-5\">\r\n                                            <div className=\"h-5 rounded-full bg-brand-500 flex items-center px-2\"\r\n                                                style={{ width: `${Math.min(100, (m.count / Math.max(...data.monthly.map((x: any) => x.count))) * 100)}%` }}>\r\n                                                <span className=\"text-[10px] font-bold text-white\">{m.count}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <span className=\"text-xs font-medium text-surface-600\">{fmtBRL(Number(m.total))}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Productivity Report */}\r\n            {tab === 'productivity' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                        <table className=\"w-full\">\r\n                            <thead>\r\n                                <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Técnico</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Trabalho</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Deslocamento</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Espera</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">OS Atend.</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-surface-100\">\r\n                                {(data.technicians ?? []).length === 0 ? (\r\n                                    <tr><td colSpan={5} className=\"px-4 py-8 text-center text-sm text-surface-500\">Sem dados</td></tr>\r\n                                ) : (data.technicians ?? []).map((t: any) => (\r\n                                    <tr key={t.id} className=\"hover:bg-surface-50\">\r\n                                        <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{t.name}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm text-emerald-600 font-semibold\">{fmtHours(t.work_minutes ?? 0)}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm text-sky-600\">{fmtHours(t.travel_minutes ?? 0)}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm text-amber-600\">{fmtHours(t.waiting_minutes ?? 0)}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm font-bold\">{t.os_count}</td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                    {(data.completed_by_tech ?? []).length > 0 && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">OS Concluídas por Técnico</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {data.completed_by_tech.map((t: any) => (\r\n                                    <div key={t.assignee_id} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium\">{t.assignee?.name ?? `#${t.assignee_id}`}</span>\r\n                                        <div className=\"text-right\">\r\n                                            <span className=\"text-sm font-bold\">{t.count} OS</span>\r\n                                            <span className=\"ml-2 text-xs text-surface-500\">{fmtBRL(Number(t.total))}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Financial Report */}\r\n            {tab === 'financial' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-2\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 flex items-center gap-2 text-sm font-semibold text-emerald-700\">\r\n                                <DollarSign className=\"h-4 w-4\" /> Contas a Receber\r\n                            </h3>\r\n                            <div className=\"space-y-2\">\r\n                                <div className=\"flex justify-between\"><span className=\"text-sm text-surface-500\">Total</span><span className=\"text-sm font-bold\">{fmtBRL(Number(data.receivable?.total ?? 0))}</span></div>\r\n                                <div className=\"flex justify-between\"><span className=\"text-sm text-surface-500\">Recebido</span><span className=\"text-sm font-bold text-emerald-600\">{fmtBRL(Number(data.receivable?.total_paid ?? 0))}</span></div>\r\n                                <div className=\"flex justify-between\"><span className=\"text-sm text-surface-500\">Vencido</span><span className=\"text-sm font-bold text-red-600\">{fmtBRL(Number(data.receivable?.overdue ?? 0))}</span></div>\r\n                                <div className=\"flex justify-between\"><span className=\"text-sm text-surface-500\">Títulos</span><span className=\"text-sm font-bold\">{data.receivable?.count ?? 0}</span></div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 flex items-center gap-2 text-sm font-semibold text-red-700\">\r\n                                <DollarSign className=\"h-4 w-4\" /> Contas a Pagar\r\n                            </h3>\r\n                            <div className=\"space-y-2\">\r\n                                <div className=\"flex justify-between\"><span className=\"text-sm text-surface-500\">Total</span><span className=\"text-sm font-bold\">{fmtBRL(Number(data.payable?.total ?? 0))}</span></div>\r\n                                <div className=\"flex justify-between\"><span className=\"text-sm text-surface-500\">Pago</span><span className=\"text-sm font-bold text-emerald-600\">{fmtBRL(Number(data.payable?.total_paid ?? 0))}</span></div>\r\n                                <div className=\"flex justify-between\"><span className=\"text-sm text-surface-500\">Contas</span><span className=\"text-sm font-bold\">{data.payable?.count ?? 0}</span></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    {(data.expenses_by_category ?? []).length > 0 && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Despesas por Categoria</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {data.expenses_by_category.map((c: any, i: number) => (\r\n                                    <div key={i} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium\">{c.category ?? 'Sem categoria'}</span>\r\n                                        <span className=\"text-sm font-bold\">{fmtBRL(Number(c.total))}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    {(data.monthly_flow ?? []).length > 0 && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Fluxo de Caixa Mensal</h3>\r\n                            <div className=\"overflow-x-auto\">\r\n                                <table className=\"w-full\">\r\n                                    <thead>\r\n                                        <tr className=\"text-xs text-surface-500\">\r\n                                            <th className=\"py-2 text-left\">Período</th>\r\n                                            <th className=\"py-2 text-right\">Entradas</th>\r\n                                            <th className=\"py-2 text-right\">Saídas</th>\r\n                                            <th className=\"py-2 text-right\">Saldo</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"divide-y divide-surface-100\">\r\n                                        {data.monthly_flow.map((m: any) => (\r\n                                            <tr key={m.period}>\r\n                                                <td className=\"py-2 text-sm font-medium\">{m.period}</td>\r\n                                                <td className=\"py-2 text-right text-sm text-emerald-600 font-semibold\">{fmtBRL(Number(m.income))}</td>\r\n                                                <td className=\"py-2 text-right text-sm text-red-600\">{fmtBRL(Number(m.expense))}</td>\r\n                                                <td className={cn('py-2 text-right text-sm font-bold', Number(m.balance) >= 0 ? 'text-emerald-600' : 'text-red-600')}>\r\n                                                    {fmtBRL(Number(m.balance))}\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Commissions Report */}\r\n            {tab === 'commissions' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-4\">\r\n                        {(data.by_status ?? []).map((s: any) => (\r\n                            <div key={s.status} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                                <span className=\"text-xs font-medium text-surface-500\">{statusLabels[s.status] ?? s.status}</span>\r\n                                <p className=\"text-2xl font-bold text-surface-900\">{s.count}</p>\r\n                                <p className=\"text-xs text-surface-400\">{fmtBRL(Number(s.total))}</p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                    <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                        <table className=\"w-full\">\r\n                            <thead>\r\n                                <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Técnico</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Eventos</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Total</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Pendente</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Pago</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-surface-100\">\r\n                                {(data.by_technician ?? []).length === 0 ? (\r\n                                    <tr><td colSpan={5} className=\"px-4 py-8 text-center text-sm text-surface-500\">Sem dados</td></tr>\r\n                                ) : (data.by_technician ?? []).map((t: any) => (\r\n                                    <tr key={t.id} className=\"hover:bg-surface-50\">\r\n                                        <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{t.name}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm\">{t.events_count}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm font-bold\">{fmtBRL(Number(t.total_commission))}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm text-amber-600\">{fmtBRL(Number(t.pending))}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm text-emerald-600\">{fmtBRL(Number(t.paid))}</td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Profitability Report */}\r\n            {tab === 'profitability' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-6 shadow-card\">\r\n                        <div className=\"grid gap-6 sm:grid-cols-2 lg:grid-cols-4\">\r\n                            <div>\r\n                                <span className=\"text-xs font-medium text-surface-500\">Receita</span>\r\n                                <p className=\"text-2xl font-bold text-emerald-600\">{fmtBRL(data.revenue ?? 0)}</p>\r\n                            </div>\r\n                            <div>\r\n                                <span className=\"text-xs font-medium text-surface-500\">Custos (AP)</span>\r\n                                <p className=\"text-2xl font-bold text-red-600\">{fmtBRL(data.costs ?? 0)}</p>\r\n                            </div>\r\n                            <div>\r\n                                <span className=\"text-xs font-medium text-surface-500\">Despesas</span>\r\n                                <p className=\"text-2xl font-bold text-amber-600\">{fmtBRL(data.expenses ?? 0)}</p>\r\n                            </div>\r\n                            <div>\r\n                                <span className=\"text-xs font-medium text-surface-500\">Comissões</span>\r\n                                <p className=\"text-2xl font-bold text-sky-600\">{fmtBRL(data.commissions ?? 0)}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-6 border-t border-surface-200 pt-6\">\r\n                            <div className=\"grid gap-6 sm:grid-cols-3\">\r\n                                <div>\r\n                                    <span className=\"text-xs font-medium text-surface-500\">Total Custos</span>\r\n                                    <p className=\"text-xl font-bold text-red-600\">{fmtBRL(data.total_costs ?? 0)}</p>\r\n                                </div>\r\n                                <div>\r\n                                    <span className=\"text-xs font-medium text-surface-500\">Lucro</span>\r\n                                    <p className={cn('text-xl font-bold', (data.profit ?? 0) >= 0 ? 'text-emerald-600' : 'text-red-600')}>\r\n                                        {fmtBRL(data.profit ?? 0)}\r\n                                    </p>\r\n                                </div>\r\n                                <div>\r\n                                    <span className=\"text-xs font-medium text-surface-500\">Margem</span>\r\n                                    <p className={cn('text-3xl font-bold', (data.margin_pct ?? 0) >= 0 ? 'text-emerald-600' : 'text-red-600')}>\r\n                                        {data.margin_pct ?? 0}%\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Visual breakdown bar */}\r\n                    {(data.revenue ?? 0) > 0 && (\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Composição dos Custos</h3>\r\n                            <div className=\"flex h-8 overflow-hidden rounded-full bg-surface-100\">\r\n                                {data.costs > 0 && (\r\n                                    <div className=\"flex items-center justify-center bg-red-500 text-[10px] font-bold text-white\"\r\n                                        style={{ width: `${(data.costs / data.total_costs) * 100}%` }}>AP</div>\r\n                                )}\r\n                                {data.expenses > 0 && (\r\n                                    <div className=\"flex items-center justify-center bg-amber-500 text-[10px] font-bold text-white\"\r\n                                        style={{ width: `${(data.expenses / data.total_costs) * 100}%` }}>Desp</div>\r\n                                )}\r\n                                {data.commissions > 0 && (\r\n                                    <div className=\"flex items-center justify-center bg-sky-500 text-[10px] font-bold text-white\"\r\n                                        style={{ width: `${(data.commissions / data.total_costs) * 100}%` }}>Com</div>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"mt-2 flex gap-4 text-xs text-surface-500\">\r\n                                <span className=\"flex items-center gap-1\"><span className=\"h-2 w-2 rounded-full bg-red-500\" />AP {((data.costs / data.total_costs) * 100).toFixed(0)}%</span>\r\n                                <span className=\"flex items-center gap-1\"><span className=\"h-2 w-2 rounded-full bg-amber-500\" />Despesas {((data.expenses / data.total_costs) * 100).toFixed(0)}%</span>\r\n                                <span className=\"flex items-center gap-1\"><span className=\"h-2 w-2 rounded-full bg-sky-500\" />Comissões {((data.commissions / data.total_costs) * 100).toFixed(0)}%</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Quotes Report */}\r\n            {tab === 'quotes' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-3\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Total</span>\r\n                            <p className=\"text-3xl font-bold text-surface-900\">{data.total ?? 0}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Aprovados</span>\r\n                            <p className=\"text-3xl font-bold text-emerald-600\">{data.approved ?? 0}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Taxa de Conversão</span>\r\n                            <p className=\"text-3xl font-bold text-brand-600\">{data.conversion_rate ?? 0}%</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Status</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.by_status ?? []).map((s: any) => (\r\n                                    <div key={s.status} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium\">{statusLabels[s.status] ?? s.status}</span>\r\n                                        <div><span className=\"text-sm font-bold\">{s.count}</span><span className=\"ml-2 text-xs text-surface-500\">{fmtBRL(Number(s.total ?? 0))}</span></div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Vendedor</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.by_seller ?? []).map((s: any) => (\r\n                                    <div key={s.id} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium\">{s.name}</span>\r\n                                        <div><span className=\"text-sm font-bold\">{s.count}</span><span className=\"ml-2 text-xs text-surface-500\">{fmtBRL(Number(s.total ?? 0))}</span></div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Service Calls Report */}\r\n            {tab === 'service_calls' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-2\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Total Chamados</span>\r\n                            <p className=\"text-3xl font-bold text-surface-900\">{data.total ?? 0}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Concluídos</span>\r\n                            <p className=\"text-3xl font-bold text-emerald-600\">{data.completed ?? 0}</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Status</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.by_status ?? []).map((s: any) => (\r\n                                    <div key={s.status} className=\"flex justify-between text-sm\"><span>{statusLabels[s.status] ?? s.status}</span><span className=\"font-bold\">{s.count}</span></div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Prioridade</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.by_priority ?? []).map((p: any) => (\r\n                                    <div key={p.priority} className=\"flex justify-between text-sm\"><span>{priorityLabels[p.priority] ?? p.priority}</span><span className=\"font-bold\">{p.count}</span></div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Técnico</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.by_technician ?? []).map((t: any) => (\r\n                                    <div key={t.id} className=\"flex justify-between text-sm\"><span>{t.name}</span><span className=\"font-bold\">{t.count}</span></div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Technician Cash Report */}\r\n            {tab === 'technician_cash' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-3\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Saldo Total</span>\r\n                            <p className=\"text-2xl font-bold text-surface-900\">{fmtBRL(data.total_balance ?? 0)}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Créditos (período)</span>\r\n                            <p className=\"text-2xl font-bold text-emerald-600\">{fmtBRL(data.total_credits ?? 0)}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Débitos (período)</span>\r\n                            <p className=\"text-2xl font-bold text-red-600\">{fmtBRL(data.total_debits ?? 0)}</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                        <table className=\"w-full\">\r\n                            <thead>\r\n                                <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-surface-600\">Técnico</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Saldo</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Créditos</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-surface-600\">Débitos</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-surface-100\">\r\n                                {(data.funds ?? []).length === 0 ? (\r\n                                    <tr><td colSpan={4} className=\"px-4 py-8 text-center text-sm text-surface-500\">Sem dados</td></tr>\r\n                                ) : (data.funds ?? []).map((f: any) => (\r\n                                    <tr key={f.user_id} className=\"hover:bg-surface-50\">\r\n                                        <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{f.user_name}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm font-bold\">{fmtBRL(f.balance)}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm text-emerald-600\">{fmtBRL(f.credits_period)}</td>\r\n                                        <td className=\"px-4 py-3 text-right text-sm text-red-600\">{fmtBRL(f.debits_period)}</td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* CRM Report */}\r\n            {tab === 'crm' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-4\">\r\n                        {(data.deals_by_status ?? []).map((s: any) => (\r\n                            <div key={s.status} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                                <span className=\"text-xs font-medium text-surface-500 capitalize\">{s.status}</span>\r\n                                <p className=\"text-2xl font-bold text-surface-900\">{s.count}</p>\r\n                                <p className=\"text-xs text-surface-400\">{fmtBRL(Number(s.value ?? 0))}</p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Vendedor</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.deals_by_seller ?? []).map((s: any) => (\r\n                                    <div key={s.owner_id} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium\">{s.owner_name ?? `#${s.owner_id}`}</span>\r\n                                        <div><span className=\"text-sm font-bold\">{s.count}</span><span className=\"ml-2 text-xs text-surface-500\">{fmtBRL(Number(s.value ?? 0))}</span></div>\r\n                                    </div>\r\n                                ))}\r\n                                {(data.deals_by_seller ?? []).length === 0 && <p className=\"py-4 text-center text-sm text-surface-400\">Sem dados</p>}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Health Score</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.health_distribution ?? []).map((h: any) => (\r\n                                    <div key={h.range} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium\">{h.range}</span>\r\n                                        <span className=\"text-sm font-bold\">{h.count}</span>\r\n                                    </div>\r\n                                ))}\r\n                                {(data.health_distribution ?? []).length === 0 && <p className=\"py-4 text-center text-sm text-surface-400\">Sem dados</p>}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-3\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Receita (Won)</span>\r\n                            <p className=\"text-2xl font-bold text-emerald-600\">{fmtBRL(data.revenue ?? 0)}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Taxa de Conversão</span>\r\n                            <p className=\"text-2xl font-bold text-brand-600\">{data.conversion_rate ?? 0}%</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card text-center\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Ticket Médio</span>\r\n                            <p className=\"text-2xl font-bold text-surface-900\">{fmtBRL(data.avg_deal_value ?? 0)}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Equipments Report */}\r\n            {tab === 'equipments' && !isLoading && (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-4\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Ativos</span>\r\n                            <p className=\"text-2xl font-bold text-emerald-600\">{data.total_active ?? 0}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Inativos</span>\r\n                            <p className=\"text-2xl font-bold text-surface-400\">{data.total_inactive ?? 0}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Custo Calibrações</span>\r\n                            <p className=\"text-2xl font-bold text-surface-900\">{fmtBRL(data.total_calibration_cost ?? 0)}</p>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <span className=\"text-xs font-medium text-surface-500\">Alertas Vencidos</span>\r\n                            <p className=\"text-2xl font-bold text-red-600\">{data.overdue_calibrations ?? 0}</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Por Classe de Precisão</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.by_class ?? []).map((c: any) => (\r\n                                    <div key={c.precision_class} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium capitalize\">{c.precision_class ?? 'N/A'}</span>\r\n                                        <span className=\"text-sm font-bold\">{c.count}</span>\r\n                                    </div>\r\n                                ))}\r\n                                {(data.by_class ?? []).length === 0 && <p className=\"py-4 text-center text-sm text-surface-400\">Sem dados</p>}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"rounded-xl border border-surface-200 bg-white p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-surface-700\">Top Marcas</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {(data.top_brands ?? []).map((b: any, i: number) => (\r\n                                    <div key={i} className=\"flex items-center justify-between rounded-lg bg-surface-50 p-3\">\r\n                                        <span className=\"text-sm font-medium\">{b.brand ?? 'N/A'}</span>\r\n                                        <span className=\"text-sm font-bold\">{b.count}</span>\r\n                                    </div>\r\n                                ))}\r\n                                {(data.top_brands ?? []).length === 0 && <p className=\"py-4 text-center text-sm text-surface-400\">Sem dados</p>}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    {(data.due_alerts ?? []).length > 0 && (\r\n                        <div className=\"rounded-xl border border-amber-200 bg-amber-50 p-5 shadow-card\">\r\n                            <h3 className=\"mb-3 text-sm font-semibold text-amber-800\">⚠ Calibrações a Vencer (30 dias)</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {data.due_alerts.map((a: any) => (\r\n                                    <div key={a.id} className=\"flex items-center justify-between text-sm\">\r\n                                        <span className=\"font-medium text-amber-900\">{a.brand} {a.model} — {a.code}</span>\r\n                                        <span className=\"text-amber-700\">{a.next_calibration_at ? new Date(a.next_calibration_at).toLocaleDateString('pt-BR') : '—'}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\tecnicos\\SchedulesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":4,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[127,136],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":4,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":26,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[141,148],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MapPin' is defined but never used.","line":4,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":40,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MapPin"},"fix":{"range":[154,162],"text":""},"desc":"Remove unused variable \"MapPin\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FileText' is defined but never used.","line":4,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[162,172],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Pencil' is defined but never used.","line":5,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Pencil"},"fix":{"range":[204,212],"text":""},"desc":"Remove unused variable \"Pencil\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[562,565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[562,565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isLoading' is assigned a value but never used.","line":61,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":61,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7029,7032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7029,7032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12555,12558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12555,12558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":240,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13314,13317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13314,13317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Calendar, Plus, Clock, User, MapPin, FileText,\r\n    ChevronLeft, ChevronRight, Pencil, Trash2,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\nconst statusConfig: Record<string, { label: string; variant: any }> = {\r\n    scheduled: { label: 'Agendado', variant: 'info' },\r\n    confirmed: { label: 'Confirmado', variant: 'brand' },\r\n    completed: { label: 'Concluído', variant: 'success' },\r\n    cancelled: { label: 'Cancelado', variant: 'danger' },\r\n}\r\n\r\ninterface Schedule {\r\n    id: number; title: string; notes: string | null; status: string\r\n    scheduled_start: string; scheduled_end: string; address: string | null\r\n    technician: { id: number; name: string }\r\n    customer: { id: number; name: string } | null\r\n    work_order: { id: number; number: string; status: string } | null\r\n}\r\n\r\nconst emptyForm = {\r\n    title: '', technician_id: '' as string | number, customer_id: '' as string | number,\r\n    work_order_id: '' as string | number, scheduled_start: '', scheduled_end: '',\r\n    notes: '', address: '', status: 'scheduled',\r\n}\r\n\r\nfunction getWeekDays(date: Date) {\r\n    const start = new Date(date)\r\n    start.setDate(start.getDate() - start.getDay() + 1) // Monday\r\n    return Array.from({ length: 7 }, (_, i) => {\r\n        const d = new Date(start)\r\n        d.setDate(start.getDate() + i)\r\n        return d\r\n    })\r\n}\r\n\r\nconst fmt = (d: Date) => d.toISOString().split('T')[0]\r\nconst fmtShort = (d: Date) => d.toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: '2-digit' })\r\nconst fmtTime = (s: string) => new Date(s).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })\r\n\r\nexport function SchedulesPage() {\r\n    const qc = useQueryClient()\r\n    const [weekOf, setWeekOf] = useState(() => new Date())\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editing, setEditing] = useState<Schedule | null>(null)\r\n    const [form, setForm] = useState(emptyForm)\r\n    const [techFilter, setTechFilter] = useState('')\r\n\r\n    const days = getWeekDays(weekOf)\r\n    const from = fmt(days[0])\r\n    const to = fmt(days[6]) + 'T23:59:59'\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['schedules', from, to, techFilter],\r\n        queryFn: () => api.get('/schedules', {\r\n            params: { from, to, technician_id: techFilter || undefined, per_page: 200 },\r\n        }),\r\n    })\r\n    const schedules: Schedule[] = res?.data?.data ?? []\r\n\r\n    const { data: techsRes } = useQuery({\r\n        queryKey: ['technicians'],\r\n        queryFn: () => api.get('/users', { params: { per_page: 50 } }),\r\n    })\r\n    const technicians = techsRes?.data?.data ?? []\r\n\r\n    const { data: wosRes } = useQuery({\r\n        queryKey: ['work-orders-select'],\r\n        queryFn: () => api.get('/work-orders', { params: { per_page: 50, status: 'open' } }),\r\n        enabled: showForm,\r\n    })\r\n    const workOrders = wosRes?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) =>\r\n            editing ? api.put(`/schedules/${editing.id}`, data) : api.post('/schedules', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['schedules'] }); setShowForm(false) },\r\n    })\r\n\r\n    const delMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/schedules/${id}`),\r\n        onSuccess: () => qc.invalidateQueries({ queryKey: ['schedules'] }),\r\n    })\r\n\r\n    const prevWeek = () => setWeekOf(d => { const n = new Date(d); n.setDate(n.getDate() - 7); return n })\r\n    const nextWeek = () => setWeekOf(d => { const n = new Date(d); n.setDate(n.getDate() + 7); return n })\r\n    const today = () => setWeekOf(new Date())\r\n\r\n    const openCreate = (day?: Date) => {\r\n        setEditing(null)\r\n        const start = day ? `${fmt(day)}T09:00` : ''\r\n        const end = day ? `${fmt(day)}T10:00` : ''\r\n        setForm({ ...emptyForm, scheduled_start: start, scheduled_end: end })\r\n        setShowForm(true)\r\n    }\r\n\r\n    const openEdit = (s: Schedule) => {\r\n        setEditing(s)\r\n        setForm({\r\n            title: s.title, technician_id: s.technician.id,\r\n            customer_id: s.customer?.id ?? '', work_order_id: s.work_order?.id ?? '',\r\n            scheduled_start: s.scheduled_start.replace(' ', 'T').slice(0, 16),\r\n            scheduled_end: s.scheduled_end.replace(' ', 'T').slice(0, 16),\r\n            notes: s.notes ?? '', address: s.address ?? '', status: s.status,\r\n        })\r\n        setShowForm(true)\r\n    }\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n        setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n    const getSchedulesForDay = (day: Date) =>\r\n        schedules.filter(s => s.scheduled_start.startsWith(fmt(day)))\r\n\r\n    const isToday = (d: Date) => fmt(d) === fmt(new Date())\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Agenda</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Agendamentos e visitas dos técnicos</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => openCreate()}>Novo Agendamento</Button>\r\n            </div>\r\n\r\n            {/* Week Nav + Filters */}\r\n            <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={prevWeek}><ChevronLeft className=\"h-4 w-4\" /></Button>\r\n                    <button onClick={today} className=\"rounded-lg bg-brand-50 px-3 py-1.5 text-sm font-medium text-brand-700 hover:bg-brand-100 transition-colors\">\r\n                        Hoje\r\n                    </button>\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={nextWeek}><ChevronRight className=\"h-4 w-4\" /></Button>\r\n                    <span className=\"ml-2 text-sm font-medium text-surface-600\">\r\n                        {days[0].toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' })} — {days[6].toLocaleDateString('pt-BR', { day: '2-digit', month: 'short', year: 'numeric' })}\r\n                    </span>\r\n                </div>\r\n                <select value={techFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setTechFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                    <option value=\"\">Todos os técnicos</option>\r\n                    {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                </select>\r\n            </div>\r\n\r\n            {/* Weekly summary */}\r\n            {schedules.length > 0 && (() => {\r\n                const groups = Object.entries(statusConfig).map(([k, v]) => ({\r\n                    key: k, label: v.label, count: schedules.filter(s => s.status === k).length,\r\n                })).filter(g => g.count > 0)\r\n                const statusColors: Record<string, string> = {\r\n                    scheduled: 'bg-sky-500', confirmed: 'bg-brand-500', completed: 'bg-emerald-500', cancelled: 'bg-red-400',\r\n                }\r\n                const total = schedules.length\r\n                return (\r\n                    <div className=\"flex items-center gap-4 rounded-xl border border-surface-200 bg-white px-5 py-3 shadow-card\">\r\n                        <span className=\"text-xs font-medium text-surface-500\">Semana:</span>\r\n                        <span className=\"text-lg font-bold text-surface-900\">{total} agendamentos</span>\r\n                        <div className=\"flex-1\" />\r\n                        {groups.map(g => (\r\n                            <span key={g.key} className=\"flex items-center gap-1.5 text-xs text-surface-600\">\r\n                                <span className={cn('h-2.5 w-2.5 rounded-full', statusColors[g.key] ?? 'bg-surface-300')} />\r\n                                {g.label}: <strong>{g.count}</strong>\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                )\r\n            })()}\r\n\r\n            {/* Week Grid */}\r\n            <div className=\"grid grid-cols-7 gap-2\">\r\n                {days.map(day => (\r\n                    <div key={fmt(day)} className={cn(\r\n                        'min-h-[200px] rounded-xl border p-2 transition-colors',\r\n                        isToday(day) ? 'border-brand-300 bg-brand-50/50' : 'border-surface-200 bg-white',\r\n                    )}>\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                            <span className={cn(\r\n                                'text-xs font-semibold uppercase',\r\n                                isToday(day) ? 'text-brand-700' : 'text-surface-500',\r\n                            )}>\r\n                                {fmtShort(day)}\r\n                            </span>\r\n                            <button onClick={() => openCreate(day)}\r\n                                className=\"rounded p-0.5 text-surface-400 hover:bg-surface-100 hover:text-surface-600\">\r\n                                <Plus className=\"h-3 w-3\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"space-y-1.5\">\r\n                            {getSchedulesForDay(day).map(s => (\r\n                                <button key={s.id} onClick={() => openEdit(s)}\r\n                                    className=\"w-full rounded-lg border border-surface-100 bg-white p-2 text-left shadow-sm hover:shadow-card transition-all group\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-[10px] font-medium text-surface-400\">{fmtTime(s.scheduled_start)}</span>\r\n                                        <Badge variant={statusConfig[s.status]?.variant ?? 'default'} className=\"text-[9px] px-1 py-0\">\r\n                                            {statusConfig[s.status]?.label}\r\n                                        </Badge>\r\n                                    </div>\r\n                                    <p className=\"mt-0.5 text-xs font-medium text-surface-800 truncate\">{s.title}</p>\r\n                                    <p className=\"text-[10px] text-surface-500 truncate flex items-center gap-0.5\">\r\n                                        <User className=\"h-2.5 w-2.5\" />{s.technician.name}\r\n                                    </p>\r\n                                    {s.work_order && (\r\n                                        <p className=\"text-[10px] text-brand-500 truncate\">{s.work_order.number}</p>\r\n                                    )}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Form Modal */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title={editing ? 'Editar Agendamento' : 'Novo Agendamento'} size=\"lg\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <Input label=\"Título\" value={form.title} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('title', e.target.value)} required placeholder=\"Ex: Manutenção preventiva\" />\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Técnico *</label>\r\n                            <select value={form.technician_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('technician_id', e.target.value)} required\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Selecionar</option>\r\n                                {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">OS Vinculada</label>\r\n                            <select value={form.work_order_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('work_order_id', e.target.value)}\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Nenhuma</option>\r\n                                {workOrders.map((wo: any) => <option key={wo.id} value={wo.id}>{wo.number} — {wo.customer?.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Início\" type=\"datetime-local\" value={form.scheduled_start} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('scheduled_start', e.target.value)} required />\r\n                        <Input label=\"Fim\" type=\"datetime-local\" value={form.scheduled_end} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('scheduled_end', e.target.value)} required />\r\n                    </div>\r\n                    <Input label=\"Endereço\" value={form.address} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('address', e.target.value)} placeholder=\"Local da visita\" />\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Observações</label>\r\n                        <textarea value={form.notes} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('notes', e.target.value)} rows={2}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    {editing && (\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Status</label>\r\n                            <div className=\"flex gap-2\">\r\n                                {Object.entries(statusConfig).map(([k, v]) => (\r\n                                    <button key={k} type=\"button\" onClick={() => set('status', k)}\r\n                                        className={cn('rounded-lg border px-3 py-1.5 text-xs font-medium transition-all',\r\n                                            form.status === k ? 'border-brand-500 bg-brand-50 text-brand-700' : 'border-surface-200 text-surface-500')}>\r\n                                        {v.label}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"flex items-center justify-between border-t border-surface-200 pt-4\">\r\n                        <div>\r\n                            {editing && (\r\n                                <Button variant=\"ghost\" size=\"sm\" type=\"button\"\r\n                                    onClick={() => { if (confirm('Excluir?')) { delMut.mutate(editing.id); setShowForm(false) } }}>\r\n                                    <Trash2 className=\"h-4 w-4 text-red-500\" /> Excluir\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                            <Button type=\"submit\" loading={saveMut.isPending}>{editing ? 'Salvar' : 'Agendar'}</Button>\r\n                        </div>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\tecnicos\\TechnicianCashPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Search' is defined but never used.","line":5,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[209,217],"text":""},"desc":"Remove unused variable \"Search\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":5,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Calendar"},"fix":{"range":[217,227],"text":""},"desc":"Remove unused variable \"Calendar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Badge' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[295,340],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1463,1466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1463,1466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1877,1880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1877,1880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2281,2284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2281,2284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5764,5767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5764,5767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8876,8879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8876,8879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11764,11767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11764,11767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":221,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13715,13718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13715,13718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Wallet, TrendingUp, TrendingDown, ArrowUpCircle, ArrowDownCircle,\r\n    User, Search, Calendar, Plus, Minus,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\nexport function TechnicianCashPage() {\r\n    const qc = useQueryClient()\r\n    const [selectedTech, setSelectedTech] = useState<number | null>(null)\r\n    const [showCreditModal, setShowCreditModal] = useState(false)\r\n    const [showDebitModal, setShowDebitModal] = useState(false)\r\n    const [txForm, setTxForm] = useState({ user_id: '', amount: '', description: '' })\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['tech-cash-summary'],\r\n        queryFn: () => api.get('/technician-cash-summary'),\r\n    })\r\n\r\n    const { data: fundsRes } = useQuery({\r\n        queryKey: ['tech-cash-funds'],\r\n        queryFn: () => api.get('/technician-cash'),\r\n    })\r\n\r\n    const { data: detailRes, isLoading: detailLoading } = useQuery({\r\n        queryKey: ['tech-cash-detail', selectedTech],\r\n        queryFn: () => api.get(`/technician-cash/${selectedTech}`),\r\n        enabled: !!selectedTech,\r\n    })\r\n\r\n    const creditMut = useMutation({\r\n        mutationFn: (data: any) => api.post('/technician-cash/credit', data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['tech-cash-funds'] })\r\n            qc.invalidateQueries({ queryKey: ['tech-cash-summary'] })\r\n            qc.invalidateQueries({ queryKey: ['tech-cash-detail'] })\r\n            setShowCreditModal(false)\r\n        },\r\n    })\r\n\r\n    const debitMut = useMutation({\r\n        mutationFn: (data: any) => api.post('/technician-cash/debit', data),\r\n        onSuccess: () => {\r\n            qc.invalidateQueries({ queryKey: ['tech-cash-funds'] })\r\n            qc.invalidateQueries({ queryKey: ['tech-cash-summary'] })\r\n            qc.invalidateQueries({ queryKey: ['tech-cash-detail'] })\r\n            setShowDebitModal(false)\r\n        },\r\n    })\r\n\r\n    const summary = summaryRes?.data\r\n    const funds: any[] = fundsRes?.data ?? []\r\n    const detail = detailRes?.data\r\n    const transactions = detail?.transactions?.data ?? []\r\n\r\n    const formatBRL = (v: string | number) =>\r\n        parseFloat(String(v)).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n\r\n    const openCreditModal = (userId?: number) => {\r\n        setTxForm({ user_id: userId ? String(userId) : '', amount: '', description: '' })\r\n        setShowCreditModal(true)\r\n    }\r\n\r\n    const openDebitModal = (userId?: number) => {\r\n        setTxForm({ user_id: userId ? String(userId) : '', amount: '', description: '' })\r\n        setShowDebitModal(true)\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Caixa do Técnico</h1>\r\n                    <p className=\"text-sm text-surface-500\">Controle de verba rotativa por técnico</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <Button variant=\"outline\" onClick={() => openCreditModal()} icon={<Plus className=\"h-4 w-4\" />}>Crédito</Button>\r\n                    <Button variant=\"outline\" onClick={() => openDebitModal()} icon={<Minus className=\"h-4 w-4\" />}>Débito</Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            {summary && (\r\n                <div className=\"grid gap-4 sm:grid-cols-4\">\r\n                    {[\r\n                        { label: 'Saldo Total', value: formatBRL(summary.total_balance), icon: Wallet, color: 'text-brand-600 bg-brand-50' },\r\n                        { label: 'Créditos (Mês)', value: formatBRL(summary.month_credits), icon: TrendingUp, color: 'text-emerald-600 bg-emerald-50' },\r\n                        { label: 'Débitos (Mês)', value: formatBRL(summary.month_debits), icon: TrendingDown, color: 'text-red-600 bg-red-50' },\r\n                        { label: 'Técnicos', value: summary.funds_count, icon: User, color: 'text-sky-600 bg-sky-50' },\r\n                    ].map(s => (\r\n                        <div key={s.label} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className={`rounded-lg p-2.5 ${s.color}`}><s.icon className=\"h-5 w-5\" /></div>\r\n                                <div>\r\n                                    <p className=\"text-xs text-surface-500\">{s.label}</p>\r\n                                    <p className=\"text-lg font-bold text-surface-900\">{s.value}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"grid gap-6 lg:grid-cols-3\">\r\n                {/* Fundos (lista) */}\r\n                <div className=\"rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"border-b border-surface-200 px-5 py-3\">\r\n                        <h3 className=\"text-sm font-semibold text-surface-900\">Saldos por Técnico</h3>\r\n                    </div>\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {funds.length === 0 ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Nenhum fundo cadastrado</p>\r\n                        ) : funds.map((f: any) => (\r\n                            <button key={f.id} onClick={() => setSelectedTech(f.user_id)}\r\n                                className={`flex w-full items-center justify-between px-5 py-3 text-left transition-colors hover:bg-surface-50 ${selectedTech === f.user_id ? 'bg-brand-50/50' : ''}`}>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-surface-100\">\r\n                                        <User className=\"h-4 w-4 text-surface-500\" />\r\n                                    </div>\r\n                                    <span className=\"text-sm font-medium text-surface-800\">{f.technician?.name}</span>\r\n                                </div>\r\n                                <span className={`text-sm font-bold ${parseFloat(f.balance) >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>\r\n                                    {formatBRL(f.balance)}\r\n                                </span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Extrato */}\r\n                <div className=\"lg:col-span-2 rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                    <div className=\"border-b border-surface-200 px-5 py-3 flex items-center justify-between\">\r\n                        <h3 className=\"text-sm font-semibold text-surface-900\">\r\n                            {selectedTech ? `Extrato — ${detail?.fund?.technician?.name ?? ''}` : 'Selecione um técnico'}\r\n                        </h3>\r\n                        {selectedTech && detail?.fund && (\r\n                            <div className=\"flex gap-1.5\">\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => openCreditModal(selectedTech)}\r\n                                    icon={<ArrowUpCircle className=\"h-3.5 w-3.5 text-emerald-600\" />}>Crédito</Button>\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => openDebitModal(selectedTech)}\r\n                                    icon={<ArrowDownCircle className=\"h-3.5 w-3.5 text-red-600\" />}>Débito</Button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"divide-y divide-surface-100\">\r\n                        {!selectedTech ? (\r\n                            <div className=\"py-16 text-center\">\r\n                                <Wallet className=\"mx-auto h-10 w-10 text-surface-300\" />\r\n                                <p className=\"mt-2 text-sm text-surface-400\">Clique em um técnico para ver o extrato</p>\r\n                            </div>\r\n                        ) : detailLoading ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Carregando...</p>\r\n                        ) : transactions.length === 0 ? (\r\n                            <p className=\"py-8 text-center text-sm text-surface-400\">Nenhuma movimentação</p>\r\n                        ) : transactions.map((tx: any) => (\r\n                            <div key={tx.id} className=\"flex items-center gap-3 px-5 py-3\">\r\n                                <div className={`rounded-full p-1.5 ${tx.type === 'credit' ? 'bg-emerald-50' : 'bg-red-50'}`}>\r\n                                    {tx.type === 'credit'\r\n                                        ? <ArrowUpCircle className=\"h-4 w-4 text-emerald-600\" />\r\n                                        : <ArrowDownCircle className=\"h-4 w-4 text-red-600\" />}\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <p className=\"text-sm font-medium text-surface-800 truncate\">{tx.description}</p>\r\n                                    <div className=\"flex items-center gap-2 text-xs text-surface-400\">\r\n                                        <span>{new Date(tx.transaction_date).toLocaleDateString('pt-BR')}</span>\r\n                                        {tx.work_order && <span>· OS {tx.work_order.number}</span>}\r\n                                        {tx.expense && <span>· Desp. {tx.expense.description}</span>}\r\n                                        {tx.creator && <span>· {tx.creator.name}</span>}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <p className={`text-sm font-bold ${tx.type === 'credit' ? 'text-emerald-600' : 'text-red-600'}`}>\r\n                                        {tx.type === 'credit' ? '+' : '-'}{formatBRL(tx.amount)}\r\n                                    </p>\r\n                                    <p className=\"text-[10px] text-surface-400\">Saldo: {formatBRL(tx.balance_after)}</p>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Credit Modal */}\r\n            <Modal open={showCreditModal} onOpenChange={setShowCreditModal} title=\"Adicionar Crédito\" size=\"sm\">\r\n                <form onSubmit={e => { e.preventDefault(); creditMut.mutate(txForm) }} className=\"space-y-4\">\r\n                    {!txForm.user_id && (\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Técnico</label>\r\n                            <select value={txForm.user_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setTxForm(p => ({ ...p, user_id: e.target.value }))} required\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">— Selecionar —</option>\r\n                                {funds.map((f: any) => <option key={f.user_id} value={f.user_id}>{f.technician?.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n                    <Input label=\"Valor (R$)\" type=\"number\" step=\"0.01\" min=\"0.01\" value={txForm.amount} required\r\n                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => setTxForm(p => ({ ...p, amount: e.target.value }))} />\r\n                    <Input label=\"Descrição\" value={txForm.description} required\r\n                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => setTxForm(p => ({ ...p, description: e.target.value }))} />\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowCreditModal(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={creditMut.isPending}>Confirmar Crédito</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n\r\n            {/* Debit Modal */}\r\n            <Modal open={showDebitModal} onOpenChange={setShowDebitModal} title=\"Lançar Débito\" size=\"sm\">\r\n                <form onSubmit={e => { e.preventDefault(); debitMut.mutate(txForm) }} className=\"space-y-4\">\r\n                    {!txForm.user_id && (\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Técnico</label>\r\n                            <select value={txForm.user_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setTxForm(p => ({ ...p, user_id: e.target.value }))} required\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">— Selecionar —</option>\r\n                                {funds.map((f: any) => <option key={f.user_id} value={f.user_id}>{f.technician?.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n                    <Input label=\"Valor (R$)\" type=\"number\" step=\"0.01\" min=\"0.01\" value={txForm.amount} required\r\n                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => setTxForm(p => ({ ...p, amount: e.target.value }))} />\r\n                    <Input label=\"Descrição\" value={txForm.description} required\r\n                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => setTxForm(p => ({ ...p, description: e.target.value }))} />\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowDebitModal(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={debitMut.isPending} className=\"bg-red-600 hover:bg-red-700\">Confirmar Débito</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\pages\\tecnicos\\TimeEntriesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":4,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[127,133],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Play' is defined but never used.","line":4,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Play"},"fix":{"range":[132,138],"text":""},"desc":"Remove unused variable \"Play\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":5,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[195,203],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[543,546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[543,546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[554,557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[554,557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startMut' is assigned a value but never used.","line":80,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4870,4873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4870,4873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11576,11579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11576,11579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18079,18082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18079,18082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18842,18845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18842,18845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport {\r\n    Clock, Play, Square, Timer, Briefcase, Car, Pause,\r\n    Plus, Trash2, Filter,\r\n} from 'lucide-react'\r\nimport api from '@/lib/api'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/Button'\r\nimport { Badge } from '@/components/ui/Badge'\r\nimport { Input } from '@/components/ui/Input'\r\nimport { Modal } from '@/components/ui/Modal'\r\n\r\nconst typeConfig: Record<string, { label: string; variant: any; icon: any }> = {\r\n    work: { label: 'Trabalho', variant: 'success', icon: Briefcase },\r\n    travel: { label: 'Deslocamento', variant: 'info', icon: Car },\r\n    waiting: { label: 'Espera', variant: 'warning', icon: Pause },\r\n}\r\n\r\ninterface TimeEntry {\r\n    id: number; type: string; started_at: string; ended_at: string | null\r\n    duration_minutes: number | null; description: string | null\r\n    technician: { id: number; name: string }\r\n    work_order: { id: number; number: string } | null\r\n}\r\n\r\nconst emptyForm = {\r\n    work_order_id: '' as string | number, technician_id: '' as string | number,\r\n    type: 'work', started_at: '', ended_at: '', description: '',\r\n}\r\n\r\nexport function TimeEntriesPage() {\r\n    const qc = useQueryClient()\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [form, setForm] = useState(emptyForm)\r\n    const [techFilter, setTechFilter] = useState('')\r\n    const [typeFilter, setTypeFilter] = useState('')\r\n    const [dateFrom, setDateFrom] = useState(() => {\r\n        const d = new Date(); d.setDate(d.getDate() - 7); return d.toISOString().split('T')[0]\r\n    })\r\n    const [dateTo, setDateTo] = useState(() => new Date().toISOString().split('T')[0])\r\n\r\n    const { data: res, isLoading } = useQuery({\r\n        queryKey: ['time-entries', techFilter, typeFilter, dateFrom, dateTo],\r\n        queryFn: () => api.get('/time-entries', {\r\n            params: {\r\n                technician_id: techFilter || undefined,\r\n                type: typeFilter || undefined,\r\n                from: dateFrom, to: dateTo + 'T23:59:59',\r\n                per_page: 100,\r\n            },\r\n        }),\r\n    })\r\n    const entries: TimeEntry[] = res?.data?.data ?? []\r\n\r\n    const { data: summaryRes } = useQuery({\r\n        queryKey: ['time-entries-summary', dateFrom, dateTo],\r\n        queryFn: () => api.get('/time-entries-summary', { params: { from: dateFrom, to: dateTo } }),\r\n    })\r\n    const summary = summaryRes?.data?.data ?? []\r\n\r\n    const { data: techsRes } = useQuery({\r\n        queryKey: ['technicians'],\r\n        queryFn: () => api.get('/users', { params: { per_page: 50 } }),\r\n    })\r\n    const technicians = techsRes?.data?.data ?? []\r\n\r\n    const { data: wosRes } = useQuery({\r\n        queryKey: ['work-orders-select-te'],\r\n        queryFn: () => api.get('/work-orders', { params: { per_page: 50 } }),\r\n        enabled: showForm,\r\n    })\r\n    const workOrders = wosRes?.data?.data ?? []\r\n\r\n    const saveMut = useMutation({\r\n        mutationFn: (data: typeof form) => api.post('/time-entries', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['time-entries'] }); qc.invalidateQueries({ queryKey: ['time-entries-summary'] }); setShowForm(false) },\r\n    })\r\n\r\n    const startMut = useMutation({\r\n        mutationFn: (data: { work_order_id: number; type: string }) => api.post('/time-entries/start', data),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['time-entries'] }) },\r\n    })\r\n\r\n    const stopMut = useMutation({\r\n        mutationFn: (id: number) => api.post(`/time-entries/${id}/stop`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['time-entries'] }); qc.invalidateQueries({ queryKey: ['time-entries-summary'] }) },\r\n    })\r\n\r\n    const delMut = useMutation({\r\n        mutationFn: (id: number) => api.delete(`/time-entries/${id}`),\r\n        onSuccess: () => { qc.invalidateQueries({ queryKey: ['time-entries'] }); qc.invalidateQueries({ queryKey: ['time-entries-summary'] }) },\r\n    })\r\n\r\n    const set = <K extends keyof typeof form>(k: K, v: (typeof form)[K]) =>\r\n        setForm(prev => ({ ...prev, [k]: v }))\r\n\r\n    const formatDuration = (m: number | null) => {\r\n        if (!m) return '—'\r\n        const h = Math.floor(m / 60); const min = m % 60\r\n        return h > 0 ? `${h}h${min.toString().padStart(2, '0')}` : `${min}min`\r\n    }\r\n    const formatTime = (s: string) => new Date(s).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })\r\n    const formatDate = (s: string) => new Date(s).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })\r\n\r\n    // Running entries\r\n    const runningEntries = entries.filter(e => !e.ended_at)\r\n\r\n    // Summary per tech\r\n    const techSummary: Record<string, { name: string; work: number; travel: number; waiting: number }> = {}\r\n    summary.forEach((s: any) => {\r\n        const id = s.technician_id\r\n        if (!techSummary[id]) techSummary[id] = { name: s.technician?.name ?? '?', work: 0, travel: 0, waiting: 0 }\r\n        techSummary[id][s.type as 'work' | 'travel' | 'waiting'] = s.total_minutes || 0\r\n    })\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-surface-900\">Apontamento de Horas</h1>\r\n                    <p className=\"mt-1 text-sm text-surface-500\">Registro de tempo dos técnicos nas OS</p>\r\n                </div>\r\n                <Button icon={<Plus className=\"h-4 w-4\" />} onClick={() => { setForm(emptyForm); setShowForm(true) }}>\r\n                    Novo Apontamento\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Running Timers */}\r\n            {runningEntries.length > 0 && (\r\n                <div className=\"rounded-xl border-2 border-emerald-300 bg-emerald-50 p-4\">\r\n                    <h3 className=\"text-sm font-semibold text-emerald-800 mb-2 flex items-center gap-1.5\">\r\n                        <span className=\"relative flex h-2.5 w-2.5\"><span className=\"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400 opacity-75\"></span><span className=\"relative inline-flex h-2.5 w-2.5 rounded-full bg-emerald-500\"></span></span>\r\n                        Em andamento\r\n                    </h3>\r\n                    <div className=\"space-y-2\">\r\n                        {runningEntries.map(e => {\r\n                            const tc = typeConfig[e.type]\r\n                            const Icon = tc?.icon ?? Timer\r\n                            return (\r\n                                <div key={e.id} className=\"flex items-center gap-3 rounded-lg bg-white p-3 shadow-sm\">\r\n                                    <Icon className=\"h-4 w-4 text-emerald-600\" />\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <span className=\"text-sm font-medium text-surface-900\">{e.technician.name}</span>\r\n                                        {e.work_order && <span className=\"ml-2 text-xs text-brand-500\">{e.work_order.number}</span>}\r\n                                        <p className=\"text-xs text-surface-500\">{tc?.label} — Iniciado {formatTime(e.started_at)}</p>\r\n                                    </div>\r\n                                    <Button variant=\"outline\" size=\"sm\" onClick={() => stopMut.mutate(e.id)} loading={stopMut.isPending}>\r\n                                        <Square className=\"h-3.5 w-3.5 mr-1\" /> Parar\r\n                                    </Button>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Summary Cards */}\r\n            {Object.keys(techSummary).length > 0 && (\r\n                <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\r\n                    {Object.values(techSummary).map(ts => (\r\n                        <div key={ts.name} className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                            <p className=\"text-sm font-semibold text-surface-900\">{ts.name}</p>\r\n                            <div className=\"mt-2 grid grid-cols-3 gap-2 text-center\">\r\n                                <div><p className=\"text-lg font-bold text-emerald-600\">{formatDuration(ts.work)}</p><p className=\"text-[10px] text-surface-500\">Trabalho</p></div>\r\n                                <div><p className=\"text-lg font-bold text-sky-600\">{formatDuration(ts.travel)}</p><p className=\"text-[10px] text-surface-500\">Desloc.</p></div>\r\n                                <div><p className=\"text-lg font-bold text-amber-600\">{formatDuration(ts.waiting)}</p><p className=\"text-[10px] text-surface-500\">Espera</p></div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Time composition bar */}\r\n            {Object.keys(techSummary).length > 0 && (() => {\r\n                let totalWork = 0, totalTravel = 0, totalWait = 0\r\n                Object.values(techSummary).forEach(ts => { totalWork += ts.work; totalTravel += ts.travel; totalWait += ts.waiting })\r\n                const grandTotal = totalWork + totalTravel + totalWait\r\n                if (grandTotal === 0) return null\r\n                const pctW = Math.round((totalWork / grandTotal) * 100)\r\n                const pctT = Math.round((totalTravel / grandTotal) * 100)\r\n                const pctWt = 100 - pctW - pctT\r\n                return (\r\n                    <div className=\"rounded-xl border border-surface-200 bg-white p-4 shadow-card\">\r\n                        <h3 className=\"text-xs font-semibold text-surface-700 mb-2\">Composição do Tempo Total</h3>\r\n                        <div className=\"flex h-5 overflow-hidden rounded-full\">\r\n                            {totalWork > 0 && <div className=\"bg-emerald-500 transition-all\" style={{ width: `${pctW}%` }} />}\r\n                            {totalTravel > 0 && <div className=\"bg-sky-500 transition-all\" style={{ width: `${pctT}%` }} />}\r\n                            {totalWait > 0 && <div className=\"bg-amber-400 transition-all\" style={{ width: `${pctWt}%` }} />}\r\n                        </div>\r\n                        <div className=\"mt-2 flex gap-4 text-xs text-surface-600\">\r\n                            <span className=\"flex items-center gap-1\"><span className=\"h-2.5 w-2.5 rounded-full bg-emerald-500\" />Trabalho <strong>{formatDuration(totalWork)}</strong> ({pctW}%)</span>\r\n                            <span className=\"flex items-center gap-1\"><span className=\"h-2.5 w-2.5 rounded-full bg-sky-500\" />Deslocam. <strong>{formatDuration(totalTravel)}</strong> ({pctT}%)</span>\r\n                            <span className=\"flex items-center gap-1\"><span className=\"h-2.5 w-2.5 rounded-full bg-amber-400\" />Espera <strong>{formatDuration(totalWait)}</strong> ({pctWt}%)</span>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            })()}\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <select value={techFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setTechFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todos os técnicos</option>\r\n                    {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                </select>\r\n                <select value={typeFilter} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setTypeFilter(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\">\r\n                    <option value=\"\">Todos os tipos</option>\r\n                    {Object.entries(typeConfig).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n                </select>\r\n                <input type=\"date\" value={dateFrom} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDateFrom(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\" />\r\n                <input type=\"date\" value={dateTo} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDateTo(e.target.value)}\r\n                    className=\"rounded-lg border border-surface-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none\" />\r\n            </div>\r\n\r\n            {/* Entries Table */}\r\n            <div className=\"overflow-hidden rounded-xl border border-surface-200 bg-white shadow-card\">\r\n                <table className=\"w-full\">\r\n                    <thead>\r\n                        <tr className=\"border-b border-surface-200 bg-surface-50\">\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Técnico</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">OS</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Tipo</th>\r\n                            <th className=\"hidden px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600 md:table-cell\">Data</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider text-surface-600\">Horário</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Duração</th>\r\n                            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wider text-surface-600\">Ações</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-surface-100\">\r\n                        {isLoading ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Carregando...</td></tr>\r\n                        ) : entries.length === 0 ? (\r\n                            <tr><td colSpan={7} className=\"px-4 py-12 text-center text-sm text-surface-500\">Nenhum apontamento encontrado</td></tr>\r\n                        ) : entries.map(e => {\r\n                            const tc = typeConfig[e.type] ?? typeConfig.work\r\n                            const Icon = tc.icon\r\n                            return (\r\n                                <tr key={e.id} className=\"hover:bg-surface-50 transition-colors\">\r\n                                    <td className=\"px-4 py-3 text-sm font-medium text-surface-900\">{e.technician.name}</td>\r\n                                    <td className=\"px-4 py-3 text-xs text-brand-600 font-medium\">{e.work_order?.number ?? '—'}</td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <Badge variant={tc.variant} className=\"gap-1\"><Icon className=\"h-3 w-3\" />{tc.label}</Badge>\r\n                                    </td>\r\n                                    <td className=\"hidden px-4 py-3 text-xs text-surface-500 md:table-cell\">{formatDate(e.started_at)}</td>\r\n                                    <td className=\"px-4 py-3 text-xs text-surface-600\">\r\n                                        {formatTime(e.started_at)} — {e.ended_at ? formatTime(e.ended_at) : <span className=\"text-emerald-500 font-medium\">em curso</span>}\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-right\">\r\n                                        <span className=\"text-sm font-semibold text-surface-800\">{formatDuration(e.duration_minutes)}</span>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <div className=\"flex items-center justify-end gap-1\">\r\n                                            {!e.ended_at && (\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => stopMut.mutate(e.id)}>\r\n                                                    <Square className=\"h-4 w-4 text-red-500\" />\r\n                                                </Button>\r\n                                            )}\r\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => { if (confirm('Excluir?')) delMut.mutate(e.id) }}>\r\n                                                <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            )\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Manual Entry Modal */}\r\n            <Modal open={showForm} onOpenChange={setShowForm} title=\"Novo Apontamento\">\r\n                <form onSubmit={e => { e.preventDefault(); saveMut.mutate(form) }} className=\"space-y-4\">\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Técnico *</label>\r\n                            <select value={form.technician_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('technician_id', e.target.value)} required\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Selecionar</option>\r\n                                {technicians.map((t: any) => <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">OS *</label>\r\n                            <select value={form.work_order_id} onChange={(e: React.ChangeEvent<HTMLSelectElement>) => set('work_order_id', e.target.value)} required\r\n                                className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\">\r\n                                <option value=\"\">Selecionar</option>\r\n                                {workOrders.map((wo: any) => <option key={wo.id} value={wo.id}>{wo.number} — {wo.customer?.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-2 block text-sm font-medium text-surface-700\">Tipo</label>\r\n                        <div className=\"flex gap-2\">\r\n                            {Object.entries(typeConfig).map(([k, v]) => {\r\n                                const Icon = v.icon\r\n                                return (\r\n                                    <button key={k} type=\"button\" onClick={() => set('type', k)}\r\n                                        className={cn('flex items-center gap-1.5 rounded-lg border px-3 py-2 text-sm font-medium transition-all',\r\n                                            form.type === k ? 'border-brand-500 bg-brand-50 text-brand-700' : 'border-surface-200 text-surface-500')}>\r\n                                        <Icon className=\"h-4 w-4\" />{v.label}\r\n                                    </button>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                        <Input label=\"Início\" type=\"datetime-local\" value={form.started_at} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('started_at', e.target.value)} required />\r\n                        <Input label=\"Fim\" type=\"datetime-local\" value={form.ended_at} onChange={(e: React.ChangeEvent<HTMLInputElement>) => set('ended_at', e.target.value)} />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"mb-1.5 block text-sm font-medium text-surface-700\">Descrição</label>\r\n                        <textarea value={form.description} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => set('description', e.target.value)} rows={2}\r\n                            className=\"w-full rounded-lg border border-surface-300 bg-white px-3.5 py-2.5 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20\" />\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 border-t border-surface-200 pt-4\">\r\n                        <Button variant=\"outline\" type=\"button\" onClick={() => setShowForm(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" loading={saveMut.isPending}>Salvar</Button>\r\n                    </div>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\stores\\auth-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\stores\\portal-auth-store.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'get' is defined but never used.","line":30,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\r\nimport { persist } from 'zustand/middleware'\r\nimport api from '@/lib/api'\r\n\r\ninterface PortalUser {\r\n    id: number\r\n    name: string\r\n    email: string\r\n    customer_id: number\r\n    tenant_id: number\r\n    customer: {\r\n        id: number\r\n        name: string\r\n    }\r\n}\r\n\r\ninterface PortalAuthState {\r\n    user: PortalUser | null\r\n    token: string | null\r\n    isAuthenticated: boolean\r\n    isLoading: boolean\r\n\r\n    login: (email: string, password: string, tenantId: number) => Promise<void>\r\n    logout: () => Promise<void>\r\n    fetchMe: () => Promise<void>\r\n}\r\n\r\nexport const usePortalAuthStore = create<PortalAuthState>()(\r\n    persist(\r\n        (set, get) => ({\r\n            user: null,\r\n            token: null,\r\n            isAuthenticated: false,\r\n            isLoading: false,\r\n\r\n            login: async (email, password, tenantId) => {\r\n                set({ isLoading: true })\r\n                try {\r\n                    const { data } = await api.post('/portal/login', { email, password, tenant_id: tenantId })\r\n                    // Store token specifically for portal if needed, otherwise re-use auth header mechanism\r\n                    // Ideally we should use a different header or handle conflict. \r\n                    // For simplicity, we'll overwrite auth_token but prefix/manage it carefully or use the same interceptor.\r\n                    // If we use the same axios instance, we need to be careful about conflicting sessions.\r\n                    // Assuming portal users are on a different domain or path usually.\r\n                    // If SPA is shared, we might need a separate axios instance or token management.\r\n                    // Let's assume standard Bearer token.\r\n                    localStorage.setItem('portal_token', data.token)\r\n\r\n                    // We need to inject this token into requests. \r\n                    // Our interceptor likely reads 'auth_token'. We might need to adjust api.ts or use a specific portalApi instance.\r\n                    // For now, let's assume we use a specific interceptor logic or just save to auth_token if they are mutually exclusive.\r\n                    // If I login as portal user, I am likely not logged in as admin.\r\n                    localStorage.setItem('auth_token', data.token)\r\n\r\n                    set({\r\n                        user: data.user,\r\n                        token: data.token,\r\n                        isAuthenticated: true,\r\n                    })\r\n                } finally {\r\n                    set({ isLoading: false })\r\n                }\r\n            },\r\n\r\n            logout: async () => {\r\n                try {\r\n                    await api.post('/portal/logout')\r\n                } catch {\r\n                    // ignore\r\n                } finally {\r\n                    localStorage.removeItem('portal_token')\r\n                    localStorage.removeItem('auth_token')\r\n                    set({\r\n                        user: null,\r\n                        token: null,\r\n                        isAuthenticated: false,\r\n                    })\r\n                }\r\n            },\r\n\r\n            fetchMe: async () => {\r\n                try {\r\n                    const { data } = await api.get('/portal/me')\r\n                    set({\r\n                        user: data,\r\n                        isAuthenticated: true,\r\n                    })\r\n                } catch {\r\n                    set({ isAuthenticated: false, user: null })\r\n                    localStorage.removeItem('portal_token')\r\n                    localStorage.removeItem('auth_token')\r\n                }\r\n            },\r\n        }),\r\n        {\r\n            name: 'portal-auth-store',\r\n            partialize: (state) => ({\r\n                token: state.token,\r\n                isAuthenticated: state.isAuthenticated,\r\n            }),\r\n        }\r\n    )\r\n)\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\src\\stores\\ui-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Roldão testes\\projetos\\sistema\\frontend\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
